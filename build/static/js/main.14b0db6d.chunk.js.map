{"version":3,"sources":["tonva/index.ts","tonva/components/index.ts","tonva/components/nav.tsx","tonva/net/netToken.ts","tonva/components/fetchErrorView.tsx","tonva/components/reloadPage.tsx","tonva/net/guestApi.ts","tonva/net/caller.ts","tonva/tool/cacheIds.ts","tonva/tool/local.ts","tonva/components/page/pageHeader.tsx","tonva/components/page/page.tsx","tonva/net/appBridge.ts","tonva/uq/caller.ts","tonva/uq/entity.ts","tonva/components/edit/itemEdit.tsx","tonva/net/httpChannel.ts","tonva/net/httpChannelUI.ts","tonva/net/uqApi.ts","tonva/net/wsChannel.ts","tonva/res/res.ts","tonva/vm/controller.tsx","tonva/vm/view.tsx","tonva/vm/vpage.tsx","tonva/uq/index.ts","tonva/uq/query.ts","tonva/tool/uid.ts","tonva/components/image.tsx","tonva/tool/user.ts","tonva/net/host.ts","tonva/uq/action.ts","tonva/components/simple/LMR.tsx","tonva/components/simple/Badge.tsx","tonva/components/simple/FA.tsx","tonva/components/simple/IconText.tsx","tonva/components/simple/Muted.tsx","tonva/uq/tuid/idCache.ts","tonva/uq/tuid/tuid.ts","tonva/tool/localDb.ts","tonva/uq/tuid/reactBoxId.tsx","tonva/components/navigo.ts","tonva/components/page/scrollView.tsx","tonva/components/loading.tsx","tonva/tool/env.ts","tonva/uq/tuid/index.ts","tonva/net/apiBase.ts","tonva/components/edit/imageItemEdit.tsx","tonva/res/formRes.ts","tonva/res/listRes.ts","tonva/res/entry/login.ts","tonva/res/entry/register.ts","tonva/tool/pageItems.ts","tonva/components/page/tabs.tsx","tonva/components/resUploader.tsx","tonva/uq/uqMan.ts","tonva/uq/sheet.ts","tonva/uq/book.ts","tonva/uq/history.ts","tonva/uq/map.ts","tonva/uq/pending.ts","tonva/uq/tag/tagView.tsx","tonva/uq/tag/tag.ts","tonva/components/page/index.ts","tonva/components/schema/index.ts","tonva/components/rules/index.ts","tonva/components/dropDownActions/index.tsx","tonva/components/easyDate/index.tsx","tonva/components/media.tsx","tonva/components/searchBox.tsx","tonva/components/userIcon.tsx","tonva/uq/tuid/tuidsCache.ts","tonva/uq/uqsMan.ts","tonva/components/form/rules/index.ts","tonva/components/form/widgets/widget.tsx","tonva/components/form/widgets/textWidget.tsx","tonva/components/form/widgets/textareaWidget.tsx","tonva/components/form/widgets/passwordWidget.tsx","tonva/components/form/widgets/numberWidget.tsx","tonva/components/form/widgets/updownWidget.tsx","tonva/components/form/widgets/dateWidget.tsx","tonva/components/form/widgets/checkBoxWidget.tsx","tonva/components/form/widgets/selectWidget.tsx","tonva/components/form/widgets/radioWidget.tsx","tonva/components/form/widgets/rangeWidget.tsx","tonva/components/form/widgets/idWidget.tsx","tonva/components/form/widgets/unknown.tsx","tonva/components/form/widgets/buttonWidget.tsx","tonva/components/form/context.tsx","tonva/components/form/widgets/arrComponent.tsx","tonva/components/form/widgets/imageWidget.tsx","tonva/components/form/widgets/tagWidget.tsx","tonva/components/form/widgets/factory.tsx","tonva/components/form/form.tsx","tonva/components/form/field.tsx","tonva/components/edit/stringItemEdit.tsx","tonva/components/edit/radioItemEdit.tsx","tonva/components/edit/selectItemEdit.tsx","tonva/components/edit/idItemEdit.tsx","tonva/components/edit/tagItemEdit.tsx","tonva/components/edit/textAreaItemEdit.tsx","tonva/components/edit/edit.tsx","tonva/app/centerApi.ts","tonva/app/vMain.tsx","tonva/app/CAppBase.ts","tonva/app/start.ts","tonva/app/CBase.ts","tonva/app/startRoute.tsx","tonva/components/list/base.tsx","tonva/components/list/clickable.tsx","tonva/components/list/static.tsx","tonva/components/list/selectable.tsx","tonva/components/list/index.tsx","tonva/components/propGrid/row.tsx","tonva/components/propGrid/propView.tsx","tonva/components/propGrid/PropGrid.tsx","tonva/entry/meInfo.tsx","serviceWorker.ts","tapp/appConfig.ts","tapp/appName.ts","tapp/CBase.ts","tapp/main.tsx","note/model.ts","note/task/CTaskNoteItem.ts","note/views/VBasePage.tsx","note/views/VList.tsx","note/views/VSelectContact.tsx","note/item/VNoteBase.tsx","note/item/VNoteItem.tsx","note/item/CNoteItem.tsx","note/item/VNoteForm.tsx","note/text/VEdit.tsx","note/text/VView.tsx","note/text/VAdd.tsx","note/text/CTextNoteItem.ts","note/views/VActions.tsx","note/views/VTo.tsx","note/task/VTaskParams.tsx","note/task/VEdit.tsx","note/task/state/VTaskView.tsx","note/task/state/VCheckTask.tsx","note/task/state/VRateTask.tsx","note/views/VSent.tsx","note/CNote.ts","home/VHome.tsx","home/CHome.ts","relation/VAdd.tsx","relation/VRelation.tsx","relation/CRelation.ts","me/VEditMe.tsx","me/VMe.tsx","me/CMe.ts","tapp/uqs.ts","discover/VDiscover.tsx","discover/CDiscover.ts","tapp/CApp.ts","tapp/CAppAB.tsx","index.tsx"],"names":["logMark","netToken","userId","token","setCenterToken","WSChannel","FetchErrorView","reApi","a","props","clearError","channel","url","options","resolve","reject","refetchApi","close","errContent","this","error","err","i","push","key","style","wordWrap","className","type","onClick","React","SystemNotifyPage","message","header","ReloadPage","timerHandler","reload","clearInterval","nav","seconds","undefined","state","setInterval","setState","title","msg","ConfirmReloadPage","back","confirm","isMobile","RegExp","test","navigator","userAgent","logs","stackKey","NavView","stack","htmlTitle","waitCount","waitTimeHandler","upgradeUq","start","isHistoryBack","navBack","tick","Date","now","console","log","length","len","window","self","top","postMessage","confirmClose","pop","fetchError","wait","set","addEventListener","isRouting","init","env","setTimeout","clearTimeout","unauthorized","showLogin","uq","version","show","view","disposer","clear","removeCeased","history","pushState","ceased","refresh","item","dispose","level","p","backLevel","popAndDispose","find","v","elWait","elError","testing","left","zIndex","name","map","index","visibility","position","ws","wsHost","local","LocalData","navigo","navSettings","language","culture","resUrl","hashParam","centerHost","arrs","windowOnError","event","source","lineno","colno","windowOnUnhandledRejection","ev","reason","windowOnClick","windowOnMouseMove","x","y","windowOnScroll","showPrivacyPage","privacy","getPrivacyContent","privacyPage","getPrivacy","html","content","__html","marked","dangerouslySetInnerHTML","waiting","Promise","race","serviceWorker","ready","registration","unregister","document","location","plus","webview","webView","resetAll","ok","showReloadPage","localStorage","lang","resOptions","district","Navigo","handler","onWsReceiveAny","handlerId","endWsReceive","receive","unitJsonPath","fetch","unitRes","json","res","unit","remove","el","getElementById","innerText","loadUnitJson","innerHTML","JSON","parse","envUnit","process","REACT_APP_UNIT","Number","get","isDevelopment","id","getPredefinedUnitName","unitName","guestApi","unitFromName","unitId","settings","origin","pathname","toLowerCase","endsWith","substr","host","hash","pos","getExHashPos","substring","resHost","resUrlFromHost","setCenterUrl","guest","Error","setGuest","exHash","getExHash","appInFrame","setAppInFrame","parent","wsBridge","loadPredefinedUnit","predefinedUnit","onerror","onunhandledrejection","onselectstart","oncontextmenu","startWait","user","notLogined","logined","endWait","on","absolute","navigate","showPage","onLogined","userApi","me","icon","nick","callback","logoutApis","stringify","saveLocalUser","showAppView","connect","defaultTop","loginTop","headers","Headers","indexOf","http","method","text","withBack","lv","loginView","default","footer","logout","logoutClear","cp","ChangePasswordPage","onError","showUpgradeUq","replace","topKey","popTo","ceaseTop","regConfirmClose","confirmBox","apiId","sheetType","sheetId","sheet","includes","uh","appUrl","src","String","open","date","getTime","toTimeString","step","href","ret","r","parser","DOMParser","htmlDoc","parseFromString","elHtml","getElementsByTagName","newVersion","getAttribute","g","oem","observable","decodeGuestToken","CenterApiBase","Caller","params","_params","maxCount","arr","ids","dict","loadId","shift","delete","_loadIds","items","_loadId","setItem","e","Map","localDb","child","_user","_guest","_unit","forEach","d","PageHeader","afterBack","logoutClick","showLogout","debugLogout","b","right","center","ex","role","rightView","Page","observer","tabsView","tabsProps","TabsView","headerClassName","elFooter","onScroll","onScrollTop","onScrollBottom","children","renderHeader","renderFooter","uqTokens","logoutUqTokens","appsInFrame","page","param","val","isBridged","subFrameStarted","evt","data","subWin","setSubAppWindow","hidden","hideFrameBack","_","clone","initSubWin","onReceiveAppApiMessage","apiName","db","parts","split","uqOwner","uqName","appOwner","appName","uqTokenApi","onAppApiReturn","urlTest","action","uqTokenActions","realUrl","getUrlOrTest","appHash","slice","lastIndexOf","u","uid","getUnit","realUnit","onReceive","callCenterApiFromMessage","bridgeCenterApiReturn","startsWith","buildAppUq","uqToken","centerToken","at","opener","appUq","brideCenterApis","bridgeCenterApi","body","callId","from","callCenterapi","directCall","result","bca","EntityCaller","entity","tries","_entity","loadSchema","innerRequest","uqApi","xcall","innerCall","jsonResult","$uq","$modify","pullModify","xresult","retry","schema","rebuildSchema","buildEntities","setSchema","ver","uqVersion","en","ActionCaller","QueryQueryCaller","unpackReturns","buildParams","QueryPageCaller","pageStart","pageSize","chars","codeBackSlash","charCodeAt","codeN","codeT","codeB","codeF","codeV","codeR","codes","codeBN","codeBT","codeBB","codeBF","codeBV","codeBR","Entity","typeId","jName","sys","cache","fields","arrFields","returns","face","fieldMaps","localMap","f","loadEntitySchema","buildFieldsTuid","loadValues","setJName","buildFieldTuid","buildArrFieldsTuid","value","fieldName","arrName","entities","fn","getTuid","an","fieldArr","tuid","buildFieldsParams","arrResult","pa","rowResult","field","buildDateTimeParam","_tuid","getIdFromObj","dt","Math","floor","toISOString","packRow","arrData","packArr","join","row","ch","escape","values","boxId","ln","unpackRow","unpackArr","ch0","c","fLen","to","reverseNT","n","isNaN","vals","ItemEdit","itemSchema","uiItem","label","_itemSchema","_uiItem","newValue","internalStart","internalEnd","divValue","labelHide","templet","Templet","widget","list","rules","nv","Array","isArray","verifyRule","rule","methodsWithBody","HttpChannel","hostUrl","apiToken","ui","timeout","showError","post","urlPrefix","caller","buildOptions","path","h","append","encodeURI","innerFetch","keys","Object","k","innerFetchResult","buildError","retErr","that","timeOutHandler","statusText","ct","then","retJson","retError","catch","buildHeaders","CenterHttpChannel","UqHttpChannel","HttpChannelNavUI","channelUIs","channelNoUIs","channels","UqApi","basePath","access","showWaiting","channelUI","acc","ApiBase","UnitxApi","buildChannel","centerAppApi","CenterAppApi","unitxUq","centerChannel","centerChannelUI","loginedUserId","t","un","localCache","nowTick","appUqParams","call","loadAppUqs","uqs","decodeUserToken","account","verify","password","prop","subAppWindow","win","WsBase","wsBaseId","handlerSeed","anyHandlers","msgHandlers","seed","$type","wsBaseSeed","WebSocket","onopen","onmessage","wsMessage","onclose","netThis","send","$lang","$district","resLang","merge","l","languages","toUpperCase","setResOptions","resGlobal","setRes","target","str","setGlobalRes","Controller","_t","isDev","receiveHandlerId","unregisterReceiveHandler","onDispose","onMessageReceive","onMessage","_resolve_$","topPageKey","internalT","vp","render","onEvent","alert","openPage","registerReceiveHandler","beforeStart","afterStart","onClosePage","go","caption","yes","no","classNames","closePage","buttons","View","controller","isMe","vm","vCall","returnCall","imageClassName","textClassName","renderUser","replacePage","backPage","ceasePage","popToTopPage","VPage","retOnClosePage","_onClosePage","openPageElement","renderPage","onPageScroll","scroller","onPageScrollTop","onPageScrollBottom","QueryPager","query","firstSize","itemObservable","$page","idFieldName","appendPosition","sortOrder","order","_items","startIndex","getPageId","load","splice","newItem","newId","oldItem","oldId","PageItems","Query","more","startField","isPaged","size","array","deep","pageCaller","request","queryCaller","table","obj","ALPHABET","rtn","charAt","random","Image","altImage","alt","currentTarget","jwtDecode","hosts","centerhost","reshost","uqhost","unitxhost","httpArr","urlFromHost","isAbsoluteUrl","centerUrlFromHost","centerWsFromHost","fetchOptions","mode","tryLocal","getCenterHost","getResHost","promises","hostArr","findIndex","fetchUrl","debugHostUrl","localCheck","all","results","j","hostValue","debugHost","getUrlOrDebug","urlDebug","fetchLocalCheck","Action","ActionSubmitCaller","SubmitReturnsCaller","SubmitConvertCaller","pack","LMR","badge","color","badgeAlign","badgeVertical","cn","cursor","FA","spin","fixWidth","border","pull","pulse","rotate","flip","inverse","IconText","iconClass","textClass","Muted","IdCache","tuidLocal","queue","loading","localArr","waitingIds","tuidInner","divName","initLocalArr","defer","isNumber","has","cacheTuids","moveToHead","removeItem","_id","getValue","useId","loadIds","tuidValues","cacheIdValues","tuids","unpackTuidIds","tuidValue","cacheValue","cacheTuidFieldValues","loadTuidIdsOrLocal","localedValues","filter","getItem","netIds","loadTuidIds","netRet","IdDivCache","div","Tuid","noCache","typeName","idName","cached","unique","isImport","TuidBox","id1","id2","equ","TuidInner","divs","cacheFields","idCache","removeAll","tuidDiv","TuidDiv","createBoxId","resetCache","assureObj","cacheIds","modifyIds","IdsCaller","valueFromId","GetCaller","cacheFieldsInValue","arrValues","mainFields","$create","$update","stampOnMain","unpackTuidIdsOfFields","SaveCaller","SavePropCaller","AllCaller","searchArr","owner","SearchCaller","LoadArrCaller","SaveArrCaller","ArrPosCaller","TuidCaller","$id","transParams","arrParams","arrValue","buildDateParam","bid","$order","TuidImport","assureBox","loadMain","save","saveProp","search","loadArr","saveArr","posArr","hasDiv","ownerField","TuidBoxDiv","__ls","LocalCache","removeLocal","Local","caches","locals","keyForGet","keyForSet","sk","LocalArr","LocalMap","keyForRemove","ks","unshift","saveIndex","max","ls","TuidContent","tuidName","s","uqStringify","ReactBoxId","isUndefined","boxName","nullUI","ttv","divObj","bi","logContent","boxIdContent","useHash","root","_routes","_useHash","_hash","_paused","_destroyed","_lastRouteResolved","_notFoundHandler","_defaultHandler","_usePushState","_genericHooks","_historyUpdateMethod","timout","_onLocationChange","isPushStateAvailable","_cLoc","_listen","updatePageLinks","cleanUrl","match","names","reduce","decodeURIComponent","route","paramNames","regexp","PARAMETER_REGEXP","full","dots","REPLACE_VARIABLE_REGEXP","WILDCARD_REGEXP","REPLACE_WILDCARD","FOLLOWED_BY_SLASH_REGEXP","MATCH_REGEXP_FLAGS","urlA","urlB","getUrlDepth","routes","replaceDynamicURLParts","clean","regExpResultToParams","m","findMatchedRoutes","colonExp","matched","routeExp","fallbackURL","matched0","cleanGETParam","hooks","exHooks","before","shouldRoute","after","_getRoot","_historyUpdate","arg0","arg1","orderedRoutes","sort","compareUrlDepth","uses","_add","current","GETParameters","extractGETParameters","onlyURL","getOnlyURL","already","manageHooks","_callLeave","isHashedRoot","removeEventListener","_findLinks","link","hasListenerAttached","ctrlKey","metaKey","tagName","getLinkPath","preventDefault","toString","status","pause","destroy","as","replaceState","cLocRoot","isHashChangeAPIAvailable","check","querySelectorAll","lastRouteResolved","leave","Scroller","scrollTo","scrollTop","offsetHeight","ScrollView","bottomTime","topTime","refDiv","onResize","sh","scrollHeight","direct","Children","_$scroll","eachChild","ref","Component","Loading","testingTags","pn","isTesting","tag","ms","args","global","handle","getHttpChannel","callFetch","put","ImageItemEdit","resId","onSaved","formRes","required","number","integer","min","zh","listRes","none","loginRes","registerRes","isFirst","pageItemAction","itemConverter","scrollToTop","scrollIntoView","topDiv","scrollToBottom","bottomDiv","changing","divId","loadResults","pageList","beforeLoad","loaded","allLoaded","reset","isAsc","endItem","scrollToEnd","pushItem","endIndex","startId","pid","sum","setLoaded","onLoad","setPageStart","onLoaded","reverse","computed","Tab","contentBuilder","notify","onShown","_content","selected","TabCaptionComponent","tabBg","sep","tabClick","tab","selectedTab","tabArr","shown","tabs","bsCur","bsTab","tabPosition","borderColor","borderStyle","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius","notifyCircle","num","displayNone","pageHeader","pageFooter","tabBack","isSelected","display","ResUploader","fileInput","upload","formData","buildFormData","onFilesChange","files","fileName","maxSize","FormData","file","multiple","onChange","formatSize","pointLength","units","toFixed","ImageUploader","imgBaseSize","suffix","resUploader","onFileChange","fileError","uploaded","enableUploadButton","imageTypes","reader","FileReader","readAsDataURL","onload","srcImage","setSize","desImgSize","desImage","compress","img","width","height","srcImgWidth","srcImgHeight","w","scale","desImgWidth","round","desImgHeight","canvas","createElement","ctx","getContext","anw","createAttribute","nodeValue","anh","setAttributeNode","drawImage","base64","toDataURL","blob","convertBase64UrlToBlob","isChanged","showOrgImage","maxWidth","urlData","mime","bstr","atob","u8arr","Uint8Array","Blob","defaultChecked","disabled","levelDiv","padding","AudioUploader","audioTypes","fileSize","uploading","UqMan","uqData","tvs","actions","sheets","queries","books","maps","histories","pendings","tags","tuidsCache","localAccess","localModifyMax","createBoxIdFromTVs","tuidArr","actionArr","sheetArr","queryArr","bookArr","mapArr","historyArr","pendingArr","tagArr","clearTuids","trim","TuidsCache","accesses","loadAccess","buildTuids","buildAccess","newTuid","entityName","fromType","fromObj","book","Book","Tag","History","pending","Pending","Sheet","newAction","newQuery","newBook","newMap","newHistory","newSheet","newPending","newTag","buildSheet","build","buildTuidBox","buildTuidDivBox","modifyMax","states","ops","op","discription","app","flow","brief","unpackSheet","flows","GetSheetCaller","getArchive","unpack","SheetArchiveCaller","SheetArchivesCaller","StateSheetsCaller","PageStateItems","StateSheetCountCaller","UserSheetsCaller","MySheetsCaller","SheetCaller","count","getStateSheets","queryApiName","BookQueryCaller","schemaFrom","actionSchema","querySchema","AddCaller","DelCaller","PageCaller","qc","QueryCaller","MapCaller","getCaller","MapAddCaller","add","MapDelCaller","MapAllCaller","MapPageCaller","MapQueryCaller","radioStyle","TagView","nameFromId","namesFromIds","renderRadio","renderView","checked","renderCheck","wrapClassName","inputs","inputName","onInputChange","input","coll","_view","lines","line","ext","mobileRegex","emailRegex","timeRes","md","month","ymd","year","yesterday","today","tomorrow","$zh","$en","tt","renderDate","vDate","withTime","always","nDate","_date","nowYear","hour","getHours","minute","getMinutes","getDate","getMonth","getFullYear","appendTime","dPart","hm","EasyTime","SearchBox","allowEmptySearch","onSubmit","initKey","onSearch","inputSize","inputClassName","onFocus","placeholder","buttonText","maxLength","defaultValue","userCache","loader","UserView","noneImage","idProp","useUser","use","cacheTimer","clearCacheTimer","tuidCached","innerPullModify","tuidLists","queueModify","group","modify","UQsMan","tonvaAppName","collection","localData","buildTVs","uqsMan","uqAppData","retErrors","setTuidImportsLocal","_uqs","buildUQs","errors","uqTVs","lj","uqsData","promiseInits","uqFullName","lower","loadEntities","uqMan","Proxy","receiver","showReload","setInner","tuidImport","fromName","iName","setFrom","Rule","RuleCustom","func","defy","RulePredefined","RuleRequired","RuleNum","minMsg","maxMsg","template","checkMore","RuleInt","isInteger","Widget","context","fieldProps","_ui","readOnly","isChanging","changeValue","container","visible","form","inNode","requiredFlag","FieldContainer","renderBody","getUiItem","contextErrors","buildRules","removeErrorWidget","addErrorWidget","initData","fromElement","onChanging","onChanged","prev","allowChange","setDataValue","setElementValue","elDiscription","hasError","discriptionClassName","errorList","fieldClass","FieldClass","uiLabel","TextWidget","inputType","onKeyDown","internalOnKeyDown","keyCode","onEnter","blur","setError","onBlur","checkRules","checkContextRules","hasFocus","clearErrors","renderTemplet","renderErrors","TextAreaWidget","setValue","rows","PasswordWidget","UrlWidget","EmailWidget","NumberWidget","UpdownWidget","returnValue","isValidKey","DateWidget","DateTimeWidget","TimeWidget","MonthWidget","CheckBoxWidget","trueValue","falseValue","SelectWidget","select","option","RadioWidget","rowKey","isRow","RangeWidget","IdWidget","pickId","clearContextError","Unknown","dataType","uiType","dataTypes","ButtonWidget","submit","observerRender","widgetType","button","ButtonClass","Context","uiSchema","subContexts","widgets","arrRowContexts","itemName","getDisabled","setDisabled","getReadOnly","setReadOnly","getVisible","setVisible","buttonName","errorWidgets","ew","onButtonClick","checkFieldRules","rowContext","setContextError","clearWidgetsErrors","clearContextErrors","checkHasError","rowKeySeed","RowContext","parentContext","arrSchema","uiArr","itemSchemas","FormContext","ContextContainer","ArrComponent","selectable","deletable","restorable","getArrRowContexts","arrLabel","ArrContainer","RowContainer","RowSeperator","formSelectable","formDeletable","formRestorable","arrSelectable","arrDeletable","arrRestorable","ac","rc","rs","first","rowContent","typeofTemplet","factory","selectCheck","deleteIcon","$isSelected","$source","isDeleted","$isDeleted","editContainer","Provider","ImageWidget","edit","imageSrc","end","TagWidget","widgetsFactory","textarea","datetime","time","email","updown","checkbox","image","checkboxes","radio","tagSingle","valuesView","renderRadios","tagMulti","defaultArr","def","renderChecks","range","typeWidget","getItemSchema","getTypeWidget","WidgetClass","Form","formContext","Container","watch","calcSelectOrDelete","DefaultContainer","DefaultFieldContainer","fieldLabelSize","labelView","fieldCol","DefaultFieldClass","DefaultButtonClass","DefaultRes","autorun","dv","initDataItem","arrItem","arrItems","arrDict","arrItemOperated","formArrVal","beforeShow","renderContent","contextType","StringItemEdit","preValue","verifyValue","onSave","element","RadioItemEdit","SelectItemEdit","IdItemEdit","TagItemEdit","renderInputs","TagSingleItemEdit","TagMultiItemEdit","TextAreaItemEdit","Edit","defaultSepClassName","defaultRowContainerClassName","topBorder","bottomBorder","rowContainerClassName","rowClick","itemEdit","onItemChanged","onItemClick","stopEdit","topBorderClassName","bottomBorderClassName","sepClassName","divLabel","ie","createItemEdit","requireFlag","centerApi","VUnsupportedUnit","userName","VUnitSelect","renderRow","onRowClick","appUnits","VErrorsPage","VStartError","CAppBase","config","appConfig","noUnit","elements","userAppUnits","showUnsupport","appUnit","openVPage","userFromId","CApp","html0","cApp","CBase","_cApp","CSub","_owner","startRoute","setSettings","resolveRoute","ListBase","pageItems","Clickable","Static","Selectable","inputItems","buildItems","itemsArray","selectedItems","compare","comp","selectItem","retItems","si","labelId","obItem","onSelect","flex","marginBottom","htmlFor","listenArraySplice","isObservableArray","observe","change","removedCount","added","_added","checkAll","anySelected","some","List","listBase","buildBase","prevProps","prevState","isEqual","forceUpdate","selectAll","unselectAll","waitingMore","tabIndex","isLoading","staticRow","PropRow","PropBorder","borderTop","PropGap","LabeledPropRow","gridProps","_prop","col","labelFixLeft","bk","renderLabel","renderProp","align","vAlign","alignValue","renderPropBody","renderPropContent","StringPropRow","NumberPropRow","ListPropRow","borderBottom","ComponentPropRow","component","PropView","buildRows","isGap","setValues","PropGrid","propView","userSetProp","Boolean","hostname","CUqBase","CUqSub","CUqApp","EnumNoteItemType","VMain","cHome","cRelation","cDiscover","cMe","numberFromId","EnumTaskState","VBasePage","renderContact","assigned","renderContactItem","contact","VList","noteKey","noteItem","note","renderNote","unread","renderItem","onNoteClick","getNote","noteModel","onClickItem","notesPager","VSelectContact","buildRight","single","onToggleSelect","contacts","onNext","onContactSelect","onContactClick","VNoteBase","renderFrom","renderSmallContact","renderSpawnItem","divOwner","noteContent","checkable","uncheckedItems","checkedItems","ci","renderCheckItem","data-key","spawn","contain","renderTo","renderFlow","renderSpawn","renderContain","VNoteItem","divFrom","divChanged","create","update","renderCheckItems","CNoteItem","itemKey","buildObj","changedNoteContent","showTo","SetNote","stringifyContent","setNote","updateChange","addNote","VNoteForm","inputAdd","onTitleChange","onContentChange","onCheckableChanged","changed","onAddEnter","onCheckChange","onItemChange","onItemKeyDown","focus","hideNote","renderContentTextArea","renderContentList","onButtonSave","btnSaveDisabled","onDelete","getSaveDisabled","VEdit","renderEdit","VView","onEdit","onSendNote","loadRelation","renderBottomCommands","renderRelatives","VAdd","AddNote","CTextNoteItem","VActions","onSend","toList","sendNoteTo","showSentPage","onAssign","showAssignTaskPage","VTo","VTaskParams","point","onSendTask","assignTask","checker","rater","onClickContacts","callSelectContact","onClickChecker","onClickRater","renderContacts","renderPoint","renderChecker","renderRater","renderBaseItem","renderParam","Fragment","VTaskView","allowCheck","divCaption","renderCaption","renderState","Start","isEnd","VTaskStart","onDone","DoneTask","showActionEndPage","renderStateSpan","VTaskDone","VTaskPass","VTaskFail","VTaskRated","VTaskCanceled","TaskViewFactory","stateViews","Done","Pass","Fail","Rated","Canceled","getView","enumTaskState","TaskView","VCheckTask","onCheck","pass","CheckTask","resultPage","VRateTask","rateValue","onRate","RateTask","renderValueRadio","CTaskNoteItem","getTaskView","renderListItem","noteId","notes","Note","cObj","tos","AssignTask","VSent","cNoteItems","task","CNote","folderId","noteItemConverter","queryResults","cNoteItem","getCNoteItem","parseContent","showAddNotePage","newSub","EnumSpecFolder","GetNotes","setItemConverter","GetNote","folder","sub","theItems","theItem","SendNoteTo","HideNote","cTaskNoteItem","VHome","cNode","renderListView","CHome","newC","fromKey","onAddContact","AddContact","VRelation","CRelation","GetMyContacts","VEditMe","VMe","onExit","changePassword","meInfo","userSpan","aboutRows","logOutRows","CMe","VDiscover","onTaskReport","onOtherReport","CDiscover","gaps","gapIndex","callTick","$Poked","poke","showMain","initTabName","CAppBBBBCCCC","renderDom","renderCApp","App","ReactDOM","StrictMode","queryStr","span"],"mappings":"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","file":"static/js/main.14b0db6d.chunk.js","sourcesContent":["export * from './tool';\r\nexport * from './net';\r\nexport * from './components';\r\nexport * from './entry';\r\nexport * from './uq';\r\nexport * from './app';\r\nexport * from './vm';\r\n","export * from './navigo';\r\nexport * from './nav';\r\nexport * from './page';\r\nexport * from './schema';\r\nexport * from './form';\r\nexport * from './edit';\r\nexport * from '../res/res';\r\nexport * from './loading';\r\nexport * from './image';\r\nexport * from './resUploader';\r\nexport * from './rules';\r\nexport * from './list';\r\nexport * from './dropDownActions';\r\nexport * from './easyDate';\r\nexport * from './propGrid';\r\nexport * from './simple';\r\nexport * from './media';\r\nexport * from './searchBox';\r\nexport * from './userIcon';\r\n\r\n","import * as React from 'react';\r\nimport {observable} from 'mobx';\r\nimport marked from 'marked';\r\nimport {User, Guest/*, UserInNav*/} from '../tool/user';\r\nimport {Page} from './page/page';\r\nimport {netToken} from '../net/netToken';\r\nimport FetchErrorView, { SystemNotifyPage } from './fetchErrorView';\r\nimport {FetchError} from '../net/fetchError';\r\nimport {appUrl, setAppInFrame, getExHash, getExHashPos} from '../net/appBridge';\r\nimport {LocalData, env} from '../tool';\r\nimport {guestApi, logoutApis, setCenterUrl, setCenterToken, WSChannel, appInFrame, host, resUrlFromHost} from '../net';\r\nimport { WsBase, wsBridge } from '../net/wsChannel';\r\nimport { resOptions } from '../res/res';\r\nimport { Loading } from './loading';\r\nimport { Navigo, RouteFunc, Hooks, NamedRoute } from './navigo';\r\n\r\nimport 'font-awesome/css/font-awesome.min.css';\r\nimport '../css/va-form.css';\r\nimport '../css/va.css';\r\nimport '../css/animation.css';\r\nimport { FA } from './simple';\r\nimport { userApi } from '../net';\r\nimport { ReloadPage, ConfirmReloadPage } from './reloadPage';\r\n\r\nconst regEx = new RegExp('Android|webOS|iPhone|iPad|' +\r\n    'BlackBerry|Windows Phone|'  +\r\n    'Opera Mini|IEMobile|Mobile' , \r\n    'i');\r\nconst isMobile = regEx.test(navigator.userAgent);\r\n\r\n/*\r\nexport const mobileHeaderStyle = isMobile? {\r\n    minHeight:  '3em'\r\n} : undefined;\r\n*/\r\n//const logo = require('../img/logo.svg');\r\nlet logMark: number;\r\nconst logs:string[] = [];\r\n\r\nexport interface Props //extends React.Props<Nav>\r\n{\r\n    //view: JSX.Element | (()=>JSX.Element);\r\n    //start?: ()=>Promise<void>;\r\n    onLogined: ()=>Promise<void>;\r\n    notLogined?: ()=>Promise<void>;\r\n};\r\nlet stackKey = 1;\r\nexport interface StackItem {\r\n    key: number;\r\n    view: JSX.Element;\r\n    ceased: boolean;\r\n    confirmClose?: ()=>Promise<boolean>;\r\n    disposer?: ()=>void;\r\n}\r\nexport interface NavViewState {\r\n    stack: StackItem[];\r\n    wait: 0|1|2;\r\n    fetchError: FetchError\r\n}\r\n\r\nexport class NavView extends React.Component<Props, NavViewState> {\r\n    private stack: StackItem[];\r\n    private htmlTitle: string;\r\n    private waitCount: number = 0;\r\n    private waitTimeHandler?: NodeJS.Timer;\r\n\r\n    constructor(props:Props) {\r\n        super(props);\r\n        //this.back = this.back.bind(this);\r\n        //this.navBack = this.navBack.bind(this);\r\n        this.stack = [];\r\n        this.state = {\r\n            stack: this.stack,\r\n            wait: 0,\r\n            fetchError: undefined\r\n        };\r\n        nav.set(this);\r\n    }\r\n    async componentDidMount()\r\n    {\r\n\t\twindow.addEventListener('popstate', this.navBack);\r\n\t\tif (!nav.isRouting) await nav.init();\r\n        await nav.start();\r\n    }\r\n\r\n    get level(): number {\r\n        return this.stack.length;\r\n    }\r\n\r\n    startWait() {\r\n        if (this.waitCount === 0) {\r\n            this.setState({wait: 1});\r\n            this.waitTimeHandler = env.setTimeout(\r\n                'NavView.startWait',\r\n                () => {\r\n                    this.waitTimeHandler = undefined;\r\n                    this.setState({wait: 2});\r\n                },\r\n                1000) as NodeJS.Timer;\r\n        }\r\n        ++this.waitCount;\r\n        this.setState({\r\n            fetchError: undefined,\r\n        });\r\n    }\r\n\r\n    endWait() {\r\n        env.setTimeout(\r\n            undefined, //'NavView.endWait',\r\n            () => {\r\n            /*\r\n            this.setState({\r\n                fetchError: undefined,\r\n            });*/\r\n            --this.waitCount;\r\n            if (this.waitCount === 0) {\r\n                if (this.waitTimeHandler !== undefined) {\r\n                    env.clearTimeout(this.waitTimeHandler);\r\n                    this.waitTimeHandler = undefined;\r\n                }\r\n                this.setState({wait: 0});\r\n            }\r\n        },100);\r\n    }\r\n\r\n    async onError(fetchError: FetchError)\r\n    {\r\n        let err = fetchError.error;\r\n        if (err !== undefined) {\r\n            if (err.unauthorized === true) {\r\n                await nav.showLogin(undefined);\r\n                return;\r\n            }\r\n            switch (err.type) {\r\n                case 'unauthorized':\r\n                    await nav.showLogin(undefined);\r\n                    return;\r\n                case 'sheet-processing':\r\n                    nav.push(<SystemNotifyPage message=\"单据正在处理中。请重新操作！\" />);\r\n                    return;\r\n            }\r\n        }\r\n        this.setState({\r\n            fetchError: fetchError,\r\n        });\r\n    }\r\n\r\n    private upgradeUq = () => {\r\n        nav.start();\r\n    }\r\n\r\n    async showUpgradeUq(uq:string, version:number):Promise<void> {\r\n        this.show(<Page header={false}>\r\n            <div>\r\n                UQ升级了，请点击按钮升级 <br />\r\n                <small className=\"text-muted\">{uq} ver-{version}</small>\r\n                <button className=\"btn btn-primary\" onClick={this.upgradeUq}>升级</button>\r\n            </div>\r\n        </Page>)\r\n    }\r\n\r\n    show(view: JSX.Element, disposer?: ()=>void): number {\r\n        this.clear();\r\n        return this.push(view, disposer);\r\n    }\r\n\r\n    push(view: JSX.Element, disposer?: ()=>void): number {\r\n        this.removeCeased();\r\n        if (this.stack.length > 0) {\r\n            window.history.pushState('forward', null, null);\r\n        }\r\n        let key = stackKey++;\r\n        this.stack.push({\r\n            key: key,\r\n            view: view, \r\n            ceased: false,\r\n            disposer: disposer\r\n        });\r\n        this.refresh();\r\n        //console.log('push: %s pages', this.stack.length);\r\n        return key;\r\n    }\r\n\r\n    replace(view: JSX.Element, disposer?: ()=>void): number {\r\n        let item:StackItem = undefined;\r\n        let stack = this.stack;\r\n        if (stack.length > 0) {\r\n            item = stack.pop();\r\n            //this.popAndDispose();\r\n        }\r\n        let key = stackKey++;\r\n        this.stack.push({\r\n            key: key, \r\n            view: view, \r\n            ceased: false,\r\n            disposer: disposer\r\n        });\r\n        if (item !== undefined) this.dispose(item.disposer);\r\n        this.refresh();\r\n        //console.log('replace: %s pages', this.stack.length);\r\n        return key;\r\n    }\r\n\r\n    ceaseTop(level:number = 1) {\r\n        let p = this.stack.length - 1;\r\n        for (let i=0; i<level; i++, p--) {\r\n            if (p < 0) break;\r\n            let item = this.stack[p];\r\n            item.ceased = true;\r\n        }\r\n    }\r\n\r\n    pop(level:number = 1) {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        //console.log('pop start: %s pages level=%s', len, level);\r\n        if (level <= 0 || len <= 1) return;\r\n        if (len < level) level = len;\r\n        let backLevel = 0;\r\n        for (let i = 0; i < level; i++) {\r\n            if (stack.length === 0) break;\r\n            //stack.pop();\r\n            this.popAndDispose();\r\n            ++backLevel;\r\n        }\r\n        if (backLevel >= len) backLevel--;\r\n        this.refresh();\r\n        if (this.isHistoryBack !== true) {\r\n            //window.removeEventListener('popstate', this.navBack);\r\n            //window.history.back(backLevel);\r\n            //window.addEventListener('popstate', this.navBack);\r\n        }\r\n        //console.log('pop: %s pages', stack.length);\r\n    }\r\n\r\n    popTo(key: number) {\r\n        if (key === undefined) return;\r\n        if (this.stack.find(v => v.key === key) === undefined) return;\r\n        while (this.stack.length >0) {\r\n            let len = this.stack.length;\r\n            let top = this.stack[len-1];\r\n            if (top.key === key) break;\r\n            this.pop();\r\n        }\r\n    }\r\n\r\n    topKey():number {\r\n        let len = this.stack.length;\r\n        if (len === 0) return undefined;\r\n        return this.stack[len-1].key;\r\n    }\r\n\r\n    removeCeased() {\r\n        for (;;) {\r\n            let p=this.stack.length-1;\r\n            if (p < 0) break;\r\n            let top = this.stack[p];\r\n            if (top.ceased === false) break;\r\n            let item = this.stack.pop();\r\n            let {disposer} = item;\r\n            this.dispose(disposer);\r\n        }\r\n        this.refresh();\r\n    }\r\n\r\n    private popAndDispose() {\r\n        this.removeCeased();\r\n        let item = this.stack.pop();\r\n        if (item === undefined) return;\r\n        let {disposer} = item;\r\n        this.dispose(disposer);\r\n        this.removeCeased();\r\n        return item;\r\n    }\r\n\r\n    private dispose(disposer:()=>void) {\r\n        if (disposer === undefined) return;\r\n        let item = this.stack.find(v => v.disposer === disposer);\r\n        if (item === undefined) disposer();\r\n    }\r\n\r\n    clear() {\r\n        let len = this.stack.length;\r\n        while (this.stack.length > 0) this.popAndDispose();\r\n        //this.refresh();\r\n        if (len > 1) {\r\n            //window.removeEventListener('popstate', this.navBack);\r\n            //window.history.back(len-1);\r\n            //window.addEventListener('popstate', this.navBack);\r\n        }\r\n    }\r\n\r\n    regConfirmClose(confirmClose:()=>Promise<boolean>) {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        if (len === 0) return;\r\n        let top = stack[len-1];\r\n        top.confirmClose = confirmClose;\r\n    }\r\n\r\n    private isHistoryBack:boolean = false;\r\n    navBack = () => {\r\n        //nav.log('backbutton pressed - nav level: ' + this.stack.length);\r\n        let tick = Date.now();\r\n        this.isHistoryBack = true;\r\n        this.back(true);\r\n        this.isHistoryBack = false;\r\n        console.log(`///\\\\\\\\ ${Date.now()-tick}ms backbutton pressed - nav level: ${this.stack.length}`);\r\n    }\r\n\r\n    back = async (confirm:boolean = true) => {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        if (len === 0) return;\r\n        if (len === 1) {\r\n            if (window.self !== window.top) {\r\n                window.top.postMessage({type:'pop-app'}, '*');\r\n            }\r\n            return;\r\n        }\r\n        let top = stack[len-1];\r\n        if (confirm===true && top.confirmClose) {\r\n            if (await top.confirmClose()===true) this.pop();\r\n        }\r\n        else {\r\n            this.pop();\r\n        }\r\n    }\r\n\r\n    confirmBox(message?:string): boolean {\r\n        return window.confirm(message);\r\n    }\r\n    clearError = () => {\r\n        this.setState({fetchError: undefined});\r\n    }\r\n    render() {\r\n        const {wait, fetchError} = this.state;\r\n        let stack = this.state.stack;\r\n        let top = stack.length - 1;\r\n        let elWait = null, elError = null;\r\n        switch (wait) {\r\n            case 1:\r\n                elWait = <div className=\"va-wait va-wait1\">\r\n                </div>;\r\n                break;\r\n            case 2:\r\n                elWait = <div className=\"va-wait va-wait2\">\r\n                    <Loading />\r\n                </div>;\r\n                break;\r\n        }\r\n        if (fetchError)\r\n            elError = <FetchErrorView clearError={this.clearError} {...fetchError} />;\r\n        let test = nav.testing===true && \r\n\t\t\t<span className=\"cursor-pointer position-fixed\" style={{top:0,left:'0.2rem',zIndex:90001}}>\r\n                <FA className=\"text-warning\" name=\"info-circle\" />\r\n            </span>;\r\n        return <>\r\n\t\t\t{stack.map((item, index) => {\r\n\t\t\t\tlet {key, view} = item;\r\n\t\t\t\treturn <div key={key} style={index<top? {visibility: 'hidden', position: 'absolute'}:undefined}>\r\n\t\t\t\t\t{view}\r\n\t\t\t\t</div>\r\n\t\t\t})}\r\n\t\t\t{elWait}\r\n\t\t\t{elError}\r\n\t\t\t{test}\r\n        </>;\r\n    }\r\n\r\n    private refresh() {\r\n        this.setState({stack: this.stack });\r\n    }\r\n}\r\n\r\nexport interface NavSettings {\r\n    oem?: string;\r\n    loginTop?: JSX.Element;\r\n    privacy?: string;\r\n}\r\n\r\nexport class Nav {\r\n    private nav:NavView;\r\n    private ws: WsBase;\r\n    private wsHost: string;\r\n    private local: LocalData = new LocalData();\r\n\tprivate navigo: Navigo;\r\n\tisRouting: boolean;\r\n\tnavSettings: NavSettings;\r\n    @observable user: User/*InNav*/ = undefined;\r\n    testing: boolean;\r\n    language: string;\r\n    culture: string;\r\n    resUrl: string;\r\n\r\n    constructor() {\r\n        let {lang, district} = resOptions;\r\n        this.language = lang;\r\n        this.culture = district;\r\n\t\tthis.testing = false;\r\n\t\tthis.navigo = new Navigo();\r\n\t\tthis.isRouting = false;\r\n    }\r\n\r\n    get guest(): number {\r\n        let guest = this.local.guest;\r\n        if (guest === undefined) return 0;\r\n        let g = guest.get();\r\n        if (g === undefined) return 0;\r\n        return g.guest;\r\n    }\r\n\r\n    set(nav:NavView) {\r\n        //this.logo = logo;\r\n        this.nav = nav;\r\n\t}\r\n\t\r\n    registerReceiveHandler(handler: (message:any)=>Promise<void>):number {\r\n        if (this.ws === undefined) return;\r\n        return this.ws.onWsReceiveAny(handler);\r\n    }\r\n\r\n    unregisterReceiveHandler(handlerId:number) {\r\n        if (this.ws === undefined) return;\r\n        if (handlerId === undefined) return;\r\n        this.ws.endWsReceive(handlerId);\r\n    }\r\n\r\n    async onReceive(msg:any) {\r\n        if (this.ws === undefined) return;\r\n        await this.ws.receive(msg);\r\n    }\r\n\r\n\tprivate async loadUnitJson() {\r\n\t\ttry {\r\n\t\t\tlet unitJsonPath = this.unitJsonPath();\r\n\t\t\tlet unitRes = await fetch(unitJsonPath, {});\r\n\t\t\tlet res = await unitRes.json();\r\n\t\t\treturn res.unit;\r\n\t\t}\r\n\t\tcatch (err1) {\r\n\t\t\tthis.local.unit.remove();\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n    private async getPredefinedUnitName() {\t\t\r\n\t\tlet el = document.getElementById('unit');\r\n\t\tif (el) {\r\n\t\t\treturn el.innerText;\r\n\t\t}\r\n\t\tel = document.getElementById('unit.json');\r\n\t\tif (!el) {\r\n\t\t\treturn await this.loadUnitJson();\r\n\t\t}\r\n\t\ttry {\r\n            let json = el.innerHTML;\r\n            let res = JSON.parse(json);\r\n            return res.unit;\r\n        }\r\n        catch (err) {\r\n\t\t\treturn await this.loadUnitJson();\r\n        }\r\n    }\r\n\r\n    private async loadPredefinedUnit() {\r\n        let envUnit = process.env.REACT_APP_UNIT;\r\n        if (envUnit !== undefined) {\r\n            return Number(envUnit);\r\n        }\r\n        let unitName:string;\r\n        let unit = this.local.unit.get();\r\n        if (unit !== undefined) {\r\n            if (env.isDevelopment !== true) return unit.id;\r\n            unitName = await this.getPredefinedUnitName();\r\n            if (unitName === undefined) return;\r\n            if (unit.name === unitName) return unit.id;\r\n        }\r\n        else {\r\n            unitName = await this.getPredefinedUnitName();\r\n            if (unitName === undefined) return;\r\n        }\r\n        let unitId = await guestApi.unitFromName(unitName);\r\n        if (unitId !== undefined) {\r\n            this.local.unit.set({id: unitId, name: unitName});\r\n        }\r\n        return unitId;\r\n    }\r\n\r\n    setSettings(settings?: NavSettings) {\r\n        this.navSettings = settings;\r\n    }\r\n\r\n    get oem():string {\r\n        return this.navSettings && this.navSettings.oem;\r\n    }\r\n\r\n    hashParam: string;\r\n    private centerHost: string;\r\n    private arrs = ['/test', '/test/'];\r\n    private unitJsonPath():string {\r\n        let {origin, pathname} = document.location;\r\n\t\tpathname = pathname.toLowerCase();\r\n        for (let item of this.arrs) {\r\n            if (pathname.endsWith(item) === true) {\r\n                pathname = pathname.substr(0, pathname.length - item.length);\r\n                break;\r\n            }\r\n        }\r\n        if (pathname.endsWith('/') === true || pathname.endsWith('\\\\') === true) {\r\n            pathname = pathname.substr(0, pathname.length-1);\r\n        }\r\n        return origin + pathname + '/unit.json';\r\n    }\r\n    private windowOnError = (event: Event | string, source?: string, lineno?: number, colno?: number, error?: Error) => {\r\n\t\tdebugger;\r\n        console.error('windowOnError');\r\n        console.error(error);\r\n    }\r\n    private windowOnUnhandledRejection = (ev: PromiseRejectionEvent) => {\r\n\t\tdebugger;\r\n        console.error('windowOnUnhandledRejection');\r\n        console.error(ev.reason);\r\n    }\r\n    private windowOnClick = (ev: MouseEvent) => {\r\n        console.error('windowOnClick');\r\n    }\r\n    private windowOnMouseMove = (ev: MouseEvent) => {\r\n        console.log('navigator.userAgent: ' + navigator.userAgent);\r\n        console.log('mouse move (%s, %s)', ev.x, ev.y);\r\n    }\r\n    private windowOnScroll = (ev: Event) => {\r\n        console.log('scroll event');\r\n\t}\r\n\t\r\n\tasync init() {\r\n\t\tthis.testing = env.testing;\r\n\t\tawait host.start(this.testing);\r\n\t\tlet hash = document.location.hash;\r\n\t\tif (hash !== undefined && hash.length > 0) {\r\n\t\t\tlet pos = getExHashPos();\r\n\t\t\tif (pos < 0) pos = undefined;\r\n\t\t\tthis.hashParam = hash.substring(1, pos);\r\n\t\t}\r\n\t\tlet {url, ws, resHost} = host;\r\n\t\tthis.centerHost = url;\r\n\t\tthis.resUrl = resUrlFromHost( resHost);\r\n\t\tthis.wsHost = ws;\r\n\t\tsetCenterUrl(url);\r\n\r\n\t\tlet guest:Guest = this.local.guest.get();\r\n\t\tif (guest === undefined) {\r\n\t\t\tguest = await guestApi.guest();\r\n\t\t}\r\n\t\tif (!guest) {\r\n\t\t\tdebugger;\r\n\t\t\tthrow Error('guest can not be undefined');\r\n\t\t}\r\n\t\tnav.setGuest(guest);\r\n\r\n\t\tlet exHash = getExHash();\r\n\t\tlet appInFrame = setAppInFrame(exHash);\r\n\t\tif (exHash !== undefined && window !== window.parent) {\r\n\t\t\t// is in frame\r\n\t\t\tif (appInFrame !== undefined) {\r\n\t\t\t\tthis.ws = wsBridge;\r\n\t\t\t\tconsole.log('this.ws = wsBridge in sub frame');\r\n\t\t\t\t//nav.user = {id:0} as User;\r\n\t\t\t\tif (window.self !== window.parent) {\r\n\t\t\t\t\twindow.parent.postMessage({type:'sub-frame-started', hash: appInFrame.hash}, '*');\r\n\t\t\t\t}\r\n\t\t\t\t// 下面这一句，已经移到 appBridge.ts 里面的 initSubWin，也就是响应从main frame获得user之后开始。\r\n\t\t\t\t//await this.showAppView();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet predefinedUnit = await this.loadPredefinedUnit();\r\n\t\tappInFrame.predefinedUnit = predefinedUnit;\r\n\t}\r\n\r\n    async start() {\r\n        try {\r\n\t\t\twindow.onerror = this.windowOnError;\r\n            window.onunhandledrejection = this.windowOnUnhandledRejection;\r\n            //window.addEventListener('click', this.windowOnClick);\r\n            //window.addEventListener('mousemove', this.windowOnMouseMove);\r\n            //window.addEventListener('touchmove', this.windowOnMouseMove);\r\n            //window.addEventListener('scroll', this.windowOnScroll);\r\n            if (isMobile === true) {\r\n                document.onselectstart = function() {return false;}\r\n                document.oncontextmenu = function() {return false;}\r\n            }\r\n            //window.setInterval(()=>console.error('tick every 5 seconds'), 5000);\r\n\t\t\tnav.clear();\r\n\t\t\tthis.startWait();\r\n            \r\n            let user: User = this.local.user.get();\r\n            if (user === undefined) {\r\n                let {notLogined} = this.nav.props;\r\n                if (notLogined !== undefined) {\r\n                    await notLogined();\r\n                }\r\n                else {\r\n                    await nav.showLogin(undefined);\r\n                }\r\n                return;\r\n            }\r\n\r\n            await nav.logined(user);\r\n        }\r\n        catch (err) {\r\n\t\t\tconsole.error(err);\r\n\t\t\tdebugger;\r\n        }\r\n        finally {\r\n            this.endWait();\r\n        }\r\n\t}\r\n\r\n\tresolveRoute() {\r\n\t\tthis.isRouting = true;\r\n\t\tthis.navigo.resolve();\r\n\t}\r\n\r\n\ton(routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(url:string, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(regex:RegExp, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(options: {[url:string]: RouteFunc|NamedRoute}):Navigo;\r\n\ton(...args:any[]):Navigo {\r\n\t\treturn this.navigo.on(args[0], args[1], args[2]);\r\n\t}\r\n\r\n\tnavigate(url:string, absolute?:boolean) {\r\n\t\treturn this.navigo.navigate(url, absolute);\r\n\t}\r\n\r\n\tgo(showPage:()=>void, url:string, absolute?:boolean) {\r\n\t\tif (this.isRouting) {\r\n\t\t\tthis.navigate(url, absolute);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tshowPage();\r\n\t\t}\r\n\t}\r\n\r\n    async showAppView() {\r\n        let {onLogined} = this.nav.props;\r\n        if (onLogined === undefined) {\r\n            nav.push(<div>NavView has no prop onLogined</div>);\r\n            return;\r\n        }\r\n        nav.clear();\r\n        await onLogined();\r\n        //console.log('logined: AppView shown');\r\n    }\r\n\r\n    setGuest(guest: Guest) {\r\n        this.local.guest.set(guest);\r\n        netToken.set(0, guest.token);\r\n    }\r\n\r\n    saveLocalUser() {\r\n        this.local.user.set(this.user);\r\n    }\r\n\r\n    async loadMe() {\r\n        let me = await userApi.me();\r\n        this.user.icon = me.icon;\r\n        this.user.nick = me.nick;\r\n    }\r\n\r\n    async logined(user: User, callback?: (user:User)=>Promise<void>) {\r\n        logoutApis();\r\n        console.log(\"logined: %s\", JSON.stringify(user));\r\n        this.user = user;\r\n        this.saveLocalUser();\r\n        netToken.set(user.id, user.token);\r\n        if (callback !== undefined) //this.loginCallbacks.has)\r\n            callback(user);\r\n            //this.loginCallbacks.call(user);\r\n        else {\r\n            await this.showAppView();\r\n        }\r\n    }\r\n\r\n    wsConnect() {\r\n        let ws:WSChannel = this.ws = new WSChannel(this.wsHost, this.user.token);\r\n        ws.connect();\r\n    }\r\n\r\n    loginTop(defaultTop:JSX.Element) {\r\n        return (this.navSettings && this.navSettings.loginTop) || defaultTop;\r\n    }\r\n\r\n    privacyEntry() {\r\n        if (!this.getPrivacyContent()) return;\r\n        return <div className=\"text-center\">\r\n            <button className=\"btn btn-sm btn-link\"\r\n                onClick={this.showPrivacyPage}>\r\n                <small className=\"text-muted\">隐私政策</small>\r\n            </button>\r\n        </div>;\r\n    }\r\n\r\n    private getPrivacyContent():string {\r\n        if (!this.navSettings) return;\r\n        let {privacy} = this.navSettings;\r\n        return privacy;\r\n    }\r\n\r\n    showPrivacyPage = () => {\r\n        let privacy = this.getPrivacyContent();\r\n        if (privacy) {\r\n            this.privacyPage(privacy);\r\n        }\r\n        else {\r\n            nav.push(<Page header=\"隐私政策\">\r\n                <div className=\"p-3\">AppConfig 中没有定义 privacy。可以定义为字符串，或者url。markdown格式</div>\r\n            </Page>);\r\n        }\r\n    }\r\n\r\n    private privacyPage = async (privacy:string) => {\r\n        let html = await this.getPrivacy(privacy);\r\n        let content = {__html: marked(html)};\r\n        nav.push(<Page header=\"隐私政策\">\r\n            <div className=\"p-3\" dangerouslySetInnerHTML={content} />\r\n        </Page>);\r\n    }\r\n\r\n    private async getPrivacy(privacy:string):Promise<string> {\r\n        const headers = new  Headers({\r\n            \"Content-Type\":'text/plain'\r\n       })\r\n        let pos = privacy.indexOf('://');\r\n        if (pos > 0) {\r\n            let http = privacy.substring(0, pos).toLowerCase();\r\n            if (http === 'http' || http === 'https') {\r\n                try {\r\n                    let res = await fetch(privacy, {\r\n                        method:'GET',\r\n                        headers: headers,\r\n                    });\r\n                    let text = await res.text();\r\n                    return text;\r\n                }\r\n                catch (err) {\r\n                    return err.message;\r\n                }\r\n            }\r\n        }\r\n        return privacy;\r\n    }\r\n\r\n    async showLogin(callback?: (user:User)=>Promise<void>, withBack?:boolean) {\r\n        let lv = await import('../entry/login');\r\n        let loginView = <lv.default \r\n            withBack={withBack} \r\n            callback={callback} />;\r\n        if (withBack !== true) {\r\n            this.nav.clear();\r\n            this.pop();\r\n        }\r\n        this.nav.push(loginView);\r\n    }\r\n\r\n    async showLogout(callback?: ()=>Promise<void>) {\r\n        let footer = <div className=\"text-center justify-content-center\">\r\n            <button className=\"btn btn-outline-danger\" onClick={this.resetAll}>升级软件</button>\r\n        </div>;\r\n        nav.push(<Page header=\"安全退出\" back=\"close\" footer={footer}>\r\n            <div className=\"my-5 mx-1 border border-info bg-white rounded p-3 text-center\">\r\n                <div>退出当前账号不会删除任何历史数据，下次登录依然可以使用本账号</div>\r\n                <div className=\"mt-3 text-center\">\r\n                        <button className=\"btn btn-danger\" onClick={()=>this.logout(callback)}>安全退出</button>\r\n                </div>\r\n            </div>\r\n        </Page>);\r\n    }\r\n\r\n    async logout(callback?:()=>Promise<void>) { //notShowLogin?:boolean) {\r\n        appInFrame.unit = undefined;\r\n        this.local.logoutClear();\r\n        this.user = undefined; //{} as User;\r\n        logoutApis();\r\n        let guest = this.local.guest.get();\r\n        setCenterToken(0, guest && guest.token);\r\n        this.ws = undefined;\r\n        /*\r\n        if (this.loginCallbacks.has)\r\n            this.logoutCallbacks.call();\r\n        else {\r\n            if (notShowLogin === true) return;\r\n        }\r\n        await nav.start();\r\n        */\r\n        if (callback === undefined)\r\n            await nav.start();\r\n        else\r\n            await callback();\r\n    }\r\n\r\n    async changePassword() {\r\n        let cp = await import('../entry/changePassword');\r\n        nav.push(<cp.ChangePasswordPage />);\r\n    }\r\n\r\n    get level(): number {\r\n        return this.nav.level;\r\n    }\r\n    startWait() {\r\n        this.nav?.startWait();\r\n    }\r\n    endWait() {\r\n        this.nav?.endWait();\r\n    }\r\n    async onError(error: FetchError) {\r\n        await this.nav.onError(error);\r\n    }\r\n    async showUpgradeUq(uq:string, version:number):Promise<void> {\r\n        await this.nav.showUpgradeUq(uq, version);\r\n    }\r\n\r\n    show (view: JSX.Element, disposer?: ()=>void): void {\r\n        this.nav.show(view, disposer);\r\n    }\r\n    push(view: JSX.Element, disposer?: ()=>void): void {\r\n        this.nav.push(view, disposer);\r\n    }\r\n    replace(view: JSX.Element, disposer?: ()=>void): void {\r\n        this.nav.replace(view, disposer);\r\n    }\r\n    pop(level:number = 1) {\r\n        this.nav.pop(level);\r\n    }\r\n    topKey():number {\r\n        return this.nav.topKey();\r\n    }\r\n    popTo(key:number) {\r\n        this.nav.popTo(key);\r\n    }\r\n    clear() {\r\n        this.nav?.clear();\r\n    }\r\n    navBack() {\r\n        this.nav.navBack();\r\n    }\r\n    ceaseTop(level?:number) {\r\n        this.nav.ceaseTop(level);\r\n    }\r\n    removeCeased() {\r\n        this.nav.removeCeased();\r\n    }\r\n    async back(confirm:boolean = true) {\r\n        await this.nav.back(confirm);\r\n    }\r\n    regConfirmClose(confirmClose: ()=>Promise<boolean>) {\r\n        this.nav.regConfirmClose(confirmClose);\r\n    }\r\n    confirmBox(message?:string): boolean {\r\n        return this.nav.confirmBox(message);\r\n    }\r\n    async navToApp(url: string, unitId: number, apiId?:number, sheetType?:number, sheetId?:number):Promise<void> {\r\n        return new Promise<void>((resolve, reject) => {\r\n            let sheet = this.centerHost.includes('http://localhost:') === true? 'sheet_debug':'sheet'\r\n            let uh = sheetId === undefined?\r\n                    appUrl(url, unitId) :\r\n                    appUrl(url, unitId, sheet, [apiId, sheetType, sheetId]);\r\n            console.log('navToApp: %s', JSON.stringify(uh));\r\n            nav.push(<article className='app-container'>\r\n                <span id={uh.hash} onClick={()=>this.back()} /*style={mobileHeaderStyle}*/>\r\n                    <i className=\"fa fa-arrow-left\" />\r\n                </span>\r\n                {\r\n                    // eslint-disable-next-line \r\n                    <iframe src={uh.url} title={String(sheetId)} />\r\n                }\r\n            </article>, \r\n            ()=> {\r\n                resolve();\r\n            });\r\n        });\r\n    }\r\n\r\n    navToSite(url: string) {\r\n        // show in new window\r\n        window.open(url);\r\n    }\r\n\r\n    get logs() {return logs};\r\n    log(msg:string) {\r\n        logs.push(msg);\r\n    }\r\n    logMark() {\r\n        let date = new Date();\r\n        logMark = date.getTime();\r\n        logs.push('log-mark: ' + date.toTimeString());\r\n    }\r\n    logStep(step:string) {\r\n        logs.push(step + ': ' + (new Date().getTime() - logMark));\r\n    }\r\n\r\n    showReloadPage(msg: string) {\r\n        let seconds = -1;\r\n\t\tthis.push(<ReloadPage message={msg} seconds={seconds} />);\r\n\t\t/*\r\n\t\tif (seconds > 0) {\r\n\t\t\tenv.setTimeout(undefined, this.reload, seconds*1000);\r\n\t\t}\r\n\t\t*/\r\n    }\r\n\r\n    reload = async () => {\r\n        let waiting:Promise<void> = new Promise<void>((resolve, reject) => {\r\n            setTimeout(resolve, 100);\r\n        });\r\n\r\n        if ('serviceWorker' in navigator) {\r\n            let registration =await Promise.race([waiting, navigator.serviceWorker.ready]);\r\n            if (registration) registration.unregister();\r\n        }\r\n\t\twindow.document.location.reload();\r\n\t\t// dcloud hbuilder里面的app自动升级，需要清webview的缓存\r\n\t\tlet plus = (window as any).plus;\r\n\t\tif (plus) {\r\n\t\t\tlet webview = plus.webview;\r\n\t\t\tif (webview) {\r\n\t\t\t\tif (webview.reload) webview.reload(true);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet webView = plus.webView;\r\n\t\t\t\tif (webView) {\r\n\t\t\t\t\tif (webView.reload) webView.reload(true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//plus.webview.reload(true)\r\n\t\t}\r\n    }\r\n\r\n    resetAll = () => {\r\n        this.push(<ConfirmReloadPage confirm={(ok:boolean):Promise<void> => {\r\n            if (ok === true) {\r\n                this.showReloadPage('彻底升级');\r\n\t\t\t\tlocalStorage.clear();\r\n\t\t\t\t/*\r\n                this.local.readToMemory();\r\n                env.localDb.removeAll();\r\n\t\t\t\tthis.local.saveToLocalStorage();\r\n\t\t\t\t*/\r\n            }\r\n            else {\r\n                this.pop();\r\n            }\r\n            return;\r\n        }} />);\r\n    }\r\n\r\n    async checkVersion():Promise<string> {\r\n        let {href} = document.location;\r\n        href += (href.indexOf('?')>=0? '&':'?') + '_t_t_=' + new Date().getTime();\r\n        let ret = await fetch(href);\r\n        let r = await ret.text();\r\n        let parser = new DOMParser();\r\n        let htmlDoc = parser.parseFromString(r, 'text/html');\r\n        let elHtml = htmlDoc.getElementsByTagName('html');\r\n        let newVersion = elHtml[0].getAttribute('data-version');\r\n        return newVersion;\r\n    }\r\n}\r\nexport const nav: Nav = new Nav();\r\n","\r\nimport {setCenterToken} from './uqApi';\r\nimport {WSChannel} from './wsChannel';\r\n\r\nexport const netToken = {\r\n    set(userId:number, token:string) {\r\n        setCenterToken(userId, token);\r\n        WSChannel.setCenterToken(token);\r\n    },\r\n    clear() {\r\n        setCenterToken(0, undefined);\r\n        WSChannel.setCenterToken(undefined);\r\n    }\r\n};\r\n","import * as React from 'react';\r\nimport {FetchError} from '../net/fetchError';\r\nimport { refetchApi } from '../net';\r\nimport { Page } from './page/page';\r\n\r\nexport interface FetchErrorProps extends FetchError {\r\n    clearError: ()=>void\r\n}\r\n\r\nexport default class FetchErrorView extends React.Component<FetchErrorProps, null> {\r\n    private reApi = async () => {\r\n        this.props.clearError();\r\n        const {channel, url, options, resolve, reject} = this.props;\r\n        await refetchApi(channel, url, options, resolve, reject);\r\n    }\r\n    private close = async () => {\r\n        this.props.clearError();\r\n    }\r\n    render() {\r\n        let {error, url} = this.props;\r\n        let errContent:any;\r\n        if (typeof error === 'object') {\r\n            let err = [];\r\n            for (let i in error) {\r\n                err.push(<li key={i}><label>{i}</label><div style={{wordWrap:\"break-word\"}}>{error[i]}</div></li>);\r\n            }\r\n            errContent = <ul>{err}</ul>;\r\n        }\r\n        else {\r\n            errContent = <div>{error}</div>;\r\n        }\r\n        return <div>\r\n            <article>\r\n\t\t\t\t<main className=\"va-error\">\r\n\t\t\t\t\t<div>网络出现问题</div>\r\n\t\t\t\t\t<div>点击重新访问</div>\r\n\t\t\t\t\t<div style={{wordWrap:\"break-word\"}}>url: {url}</div>\r\n\t\t\t\t\t{errContent}\r\n\t\t\t\t\t<div className=\"p-3\">\r\n\t\t\t\t\t\t<button type='button' onClick={this.reApi}>重新API</button>\r\n\t\t\t\t\t\t<button type='button' onClick={this.close}>关闭</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</main>\r\n            </article>\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport const SystemNotifyPage = ({message}:{message:string}):JSX.Element => {\r\n    return <Page header=\"系统提醒\">\r\n        <div className=\"px-3\">{message}</div>\r\n    </Page>;\r\n}","import * as React from 'react';\r\nimport { nav } from './nav';\r\nimport { Page } from './page/page';\r\n\r\ninterface Props {\r\n    message: string,\r\n    seconds: number\r\n}\r\n\r\ninterface State {\r\n    seconds: number\r\n}\r\n\r\nexport class ReloadPage extends React.Component<Props, State> {\r\n    private timerHandler:any;\r\n    constructor(props:Props) {\r\n\t\tsuper(props);\r\n\t\tlet {seconds} = props;\r\n\t\tif (seconds===undefined) return;\r\n        this.state = {seconds};\r\n\t\tif (seconds <= 0) return;\r\n        this.timerHandler = setInterval(() => {\r\n\t\t\tlet {seconds} = this.state;\r\n            seconds--;\r\n            if (seconds <= 0) {\r\n                this.reload();\r\n            }\r\n            else {\r\n                this.setState({seconds: seconds});\r\n            }\r\n        }, 1000);\r\n    }\r\n    private reload = () => {\r\n        clearInterval(this.timerHandler);\r\n        nav.reload();\r\n    }\r\n    render() {\r\n\t\tlet {seconds} = this.state;\r\n\t\tlet title:string, msg:string;\t\t\r\n\t\tif (seconds > 0) {\r\n\t\t\ttitle = '程序升级中...';\r\n\t\t\tmsg = this.state.seconds + '秒钟之后自动重启动';\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttitle = '程序需要升级';\r\n\t\t\tmsg = '请点击下面按钮重启';\r\n\t\t}\r\n        return <Page header={false}>\r\n            <div className=\"text-center p-5\">\r\n                <div className=\"text-info py-5\">\r\n\t\t\t\t\t<span className=\"text-danger\">{title}</span>\r\n\t\t\t\t\t<br/>\r\n\t\t\t\t\t{msg}\r\n                    <br/>\r\n                    <span className=\"small text-muted\">{this.props.message}</span>\r\n                </div>\r\n                <button className=\"btn btn-danger\" onClick={this.reload}>立刻重启</button>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\ninterface ConfirmReloadPageProps {\r\n    confirm: (ok: boolean)=>Promise<void>;\r\n}\r\nexport const ConfirmReloadPage = (props: ConfirmReloadPageProps):JSX.Element => {\r\n    return <Page header=\"升级软件\" back=\"close\">\r\n        <div className=\"py-5 px-3 my-5 mx-2 border bg-white rounded\">\r\n            <div className=\"text-center text-info\">\r\n                升级将清除所有本机缓冲区内容，并从服务器重新安装程序！\r\n            </div>\r\n            <div className=\"text-center mt-5\">\r\n                <button className=\"btn btn-danger mr-3\" onClick={()=>props.confirm(true)}>确认升级</button>\r\n            </div>\r\n        </div>\r\n    </Page>;\r\n    // <button className=\"btn btn-outline-danger\" onClick={()=>props.confirm(false)}>暂不</button>\r\n}\r\n","import { decodeGuestToken } from '../tool/user';\r\nimport { CenterApiBase } from './uqApi';\r\n\r\nexport class GuestApi extends CenterApiBase {\r\n    async guest(): Promise<any> {\r\n        //let guest = nav.local.guest.get();\r\n        let ret = await this.get('', {});\r\n        switch (typeof ret) {\r\n            default: return;\r\n            case 'string': return decodeGuestToken(ret);\r\n            case 'object':\r\n                let guest = decodeGuestToken(ret.token);\r\n                return guest;\r\n        }\r\n    }\r\n\r\n    async unitFromName(unitName:string): Promise<number> {\r\n        let ret = await this.get(unitName);\r\n        return ret && ret.unit;\r\n    }\r\n}\r\n\r\nexport const guestApi = new GuestApi('tv/guest/', undefined);\r\n","export abstract class Caller<T> {\r\n    protected readonly _params: T;\r\n    constructor(params: T, waiting: boolean) {\r\n        this._params = params;\r\n        this.waiting = waiting;\r\n    }\r\n    protected get params():any {return this._params;}\r\n    buildParams():any {return this.params;}\r\n    method: string  = 'POST';\r\n    abstract get path(): string;\r\n    get headers(): {[header:string]: string} {return undefined}\r\n    waiting: boolean;\r\n}\r\n","import {observable} from 'mobx';\r\n\r\nexport interface Id {\r\n    id: number;\r\n}\r\n\r\nexport abstract class CacheIds<T extends Id> {\r\n    constructor(maxCount:number = 100) {\r\n        this.maxCount = maxCount;\r\n    }\r\n    private maxCount:number;\r\n    private arr:T[] = [];\r\n    @observable dict = new Map<number, T>();\r\n\r\n    loadIds(ids:number[]) {\r\n        let arr:number[] = [];\r\n        for (let id of ids) {\r\n            if (id === null) continue;\r\n            let item = this.dict.get(id);\r\n            if (item === undefined) {\r\n                arr.push(id);\r\n                item = {id:id} as T;\r\n                this.dict.set(id, item);\r\n            }\r\n        }                \r\n        this.loadId(arr);\r\n    }\r\n\r\n    get(id:number):T {\r\n        if (id === undefined || id === null) return null;\r\n        let item = this.dict.get(id);\r\n        if (item === undefined) {\r\n            this.dict.set(id, {id:id} as T);\r\n            this.loadId([id]);\r\n            item = this.dict.get(id);\r\n        }\r\n        return item;\r\n    }\r\n    private setItem(id:number, item:T) {\r\n        if (item === undefined) {\r\n            this.dict.set(id, null);\r\n            this.arr.push({id: id} as T);\r\n        }\r\n        else {\r\n            this.dict.set(id, item);\r\n            this.arr.push(item);\r\n        }\r\n        if (this.arr.length > this.maxCount) {\r\n            item = this.arr.shift();\r\n            this.dict.delete(item.id);\r\n        }\r\n    }\r\n    private async loadId(ids:number[]) {\r\n        let items = await this._loadIds(ids);\r\n        if (items === undefined) {\r\n            for (let id of ids) {\r\n                if (id === null) continue;\r\n                let item = await this._loadId(id);\r\n                this.setItem(id, item);\r\n            }\r\n        }\r\n        else {\r\n            for (let id of ids) {\r\n                let item = items.find(v => v.id === id);\r\n                this.setItem(id, item);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected abstract async _loadIds(ids:number[]):Promise<T[]>;\r\n    protected abstract async _loadId(id:number):Promise<T>;\r\n}\r\n","import { env } from './env';\r\n\r\nexport class LocalData {\r\n    user = env.localDb.child('user');\r\n    guest = env.localDb.child('guest');\r\n    unit = env.localDb.child('unit');\r\n\r\n    private _user:string;\r\n    private _guest:string;\r\n    private _unit:string;\r\n    readToMemory() {\r\n        this._user = this.user.get();\r\n        this._guest = this.guest.get();\r\n        this._unit = this.unit.get();\r\n    }\r\n    saveToLocalStorage() {\r\n        this.user.set(this._user);\r\n        this.guest.set(this._guest);\r\n        this.unit.set(this._unit);\r\n    }\r\n\r\n    logoutClear() {\r\n        [\r\n            this.user,\r\n            this.unit,\r\n        ].forEach(d => d.remove());\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {nav} from '../nav';\r\n\r\nexport interface PageHeaderProps {\r\n    back?: 'back' | 'close' | 'none';\r\n    center: string | JSX.Element;\r\n    right?: JSX.Element;\r\n    logout?: boolean | (()=>Promise<void>);\r\n    className?: string;\r\n\tafterBack?: () => void;\r\n\tex?: JSX.Element;\r\n}\r\n\r\nexport class PageHeader extends React.Component<PageHeaderProps> {\r\n    private back = async () => {\r\n        await nav.back(); // 这个才会显示confirm box，在dataForm里面，如果输入了数据的话\r\n\t\tlet {afterBack} = this.props;\r\n\t\tif (afterBack) afterBack();\r\n    }\r\n    openWindow() {\r\n        window.open(document.location.href);\r\n    }\r\n    private logoutClick = () => {\r\n        nav.showLogout(this.logout);\r\n    }\r\n    private logout = async () => {\r\n        let {logout} = this.props;\r\n        if (typeof logout === 'function') {\r\n            await logout(); \r\n        }\r\n        await nav.logout(undefined);\r\n    }\r\n    render() {\r\n        let b = nav.level > 1 || window.self !== window.top;\r\n        let {right, center, logout, className, ex} = this.props;\r\n        let back:any, debugLogout:any;\r\n        if (logout !== undefined && window.self === window.top) {\r\n            if ((typeof logout === 'boolean' && logout === true)\r\n                || typeof logout === 'function')\r\n            {\r\n                let {user} = nav;\r\n                if (user !== undefined) {\r\n                    let {nick, name} = user;\r\n                    debugLogout = <div className=\"d-flex align-items-center\">\r\n                        <small className=\"text-light\">{nick || name}</small>\r\n                        {\r\n                            // eslint-disable-next-line\r\n                            <div className=\"ml-2 py-2 px-3 cursor-pointer\"\r\n                                role=\"button\"\r\n                                onClick={this.logoutClick}>\r\n                                <i className=\"fa fa-sign-out fa-lg\" />\r\n                            </div>\r\n                        }\r\n                    </div>;\r\n                }\r\n            }\r\n        }\r\n        if (b) {\r\n            switch (this.props.back) {\r\n                case 'none':\r\n                    back = undefined;\r\n                    break;\r\n                default:\r\n                case 'back':\r\n                    back = <nav onClick={this.back}><i className=\"fa fa-angle-left\" /></nav>;\r\n                    break;\r\n                case 'close':\r\n                    back = <nav onClick={this.back}><i className=\"fa fa-close\" /></nav>;\r\n                    break;\r\n            }\r\n        }\r\n        if (window.self !== window.top) {\r\n            console.log(document.location.href);\r\n            // pop = <header onClick={this.openWindow} className=\"mx-1\"><FA name=\"external-link\" /></header>;\r\n        }\r\n        if (back === undefined && typeof center === 'string') {\r\n            center = <div className=\"px-3\">{center}</div>;\r\n        }\r\n\t\tlet rightView = (right || debugLogout) && <aside>{right} {debugLogout}</aside>;\r\n\t\tlet header = <header className={className}>\r\n\t\t\t<nav>\r\n\t\t\t\t{back}\r\n\t\t\t\t{/*pop 弹出window暂时停止作用 */}\r\n\t\t\t\t<div>{center}</div>\r\n\t\t\t\t{rightView}\r\n\t\t\t</nav>\r\n\t\t\t{ex}\r\n\t\t</header>;\r\n        return <>\r\n\t\t\t<section className=\"tv-page-header\">{header}</section>\r\n\t\t\t{header}\r\n\t\t</>;\r\n\t\t/*\r\n\t\t\t<header className={className}>\r\n\t\t\t<section>\r\n\t\t\t\t<header>\r\n\t\t\t\t\t{back}\r\n\t\t\t\t\t<div>{center}</div>\r\n\t\t\t\t\t{rightView}\r\n\t\t\t\t</header>\r\n\t\t\t</section>\r\n            {back}\r\n            <div>{center}</div>\r\n            {rightView}\r\n        </header>;*/\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport {PageHeader} from './pageHeader';\r\nimport { TabsProps, TabsView } from './tabs';\r\nimport { ScrollProps, ScrollView } from './scrollView';\r\n\r\nexport interface IVPage {\r\n\tcontent():JSX.Element;\r\n\theader():JSX.Element;\r\n\tfooter():JSX.Element;\r\n}\r\n\r\n\r\nexport interface PageProps extends ScrollProps {\r\n    back?: 'close' | 'back' | 'none';\r\n    header?: boolean | string | JSX.Element;\r\n    right?: JSX.Element;\r\n    footer?: JSX.Element;\r\n    logout?: boolean | (()=>Promise<void>);\r\n\theaderClassName?: string;\r\n\tclassName?: string;\r\n\tafterBack?: () => void;\r\n\ttabsProps?: TabsProps;\r\n}\r\n\r\n@observer\r\nexport class Page extends React.Component<PageProps> {\r\n\tprivate tabsView: TabsView;\r\n    constructor(props: PageProps) {\r\n\t\tsuper(props);\r\n\t\tlet {tabsProps} = props;\r\n\t\tif (tabsProps) {\r\n\t\t\tthis.tabsView = new TabsView(tabsProps);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate renderHeader() {\r\n\t\tconst {back, header, right, headerClassName, afterBack} = this.props;\r\n\t\tlet pageHeader = header !== false && <PageHeader \r\n\t\t\tback={back} \r\n\t\t\tcenter={header as any}\r\n\t\t\tright={right}\r\n\t\t\tlogout={this.props.logout}\r\n\t\t\tclassName={headerClassName}\r\n\t\t\tafterBack={afterBack}\r\n\t\t\t/>;\r\n\t\treturn pageHeader;\r\n\t}\r\n\r\n\tprivate renderFooter() {\r\n\t\tconst {footer} = this.props;\r\n\t\tif (footer) {\r\n\t\t\tlet elFooter = <footer>{footer}</footer>;\r\n\t\t\treturn <>\r\n\t\t\t\t<section className=\"tv-page-footer\">{elFooter}</section>\r\n\t\t\t\t{elFooter}\r\n\t\t\t</>;\r\n\t\t}\r\n\t}\r\n\r\n    render() {\r\n\t\tif (this.tabsView) {\r\n\t\t\treturn React.createElement(this.tabsView.content);\r\n\t\t}\r\n\t\tconst {onScroll, onScrollTop, onScrollBottom, children, className} = this.props;\r\n\t\treturn <ScrollView\r\n\t\t\tonScroll={onScroll}\r\n\t\t\tonScrollTop={onScrollTop}\r\n\t\t\tonScrollBottom={onScrollBottom}\r\n\t\t\tclassName={className}\r\n\t\t>\r\n\t\t\t{this.renderHeader()}\r\n\t\t\t<main>{children}</main>\r\n\t\t\t{this.renderFooter()}\r\n\t\t</ScrollView>;\r\n\t}\r\n}\r\n","import _ from 'lodash';\r\nimport {nav} from '../components';\r\nimport {uid} from '../tool/uid';\r\nimport {uqTokenApi, callCenterapi, centerToken, setCenterToken} from './uqApi';\r\nimport {setSubAppWindow} from './wsChannel';\r\nimport { host } from './host';\r\n\r\nexport interface UqToken {\r\n    name: string;\r\n    db: string;\r\n    url: string;\r\n    token: string;\r\n}\r\nconst uqTokens:{[uqName:string]: UqToken}  = {};\r\nexport function logoutUqTokens() {\r\n    for (let i in uqTokens) {\r\n        uqTokens[i] = undefined;\r\n    }\r\n}\r\n\r\nexport interface AppInFrame {\r\n    hash: string;\r\n    unit: number;       // unit id\r\n    page?: string;\r\n    param?: string[];\r\n    predefinedUnit?: number;  // 比如像Cart这样的应用，直接让用户访问的，就需要在unit.json里面定义unitName\r\n}\r\nconst appsInFrame:{[key:string]:AppInFrame} = {};\r\n\r\nclass AppInFrameClass implements AppInFrame {\r\n    hash: string;\r\n    private _unit: number;\r\n    get unit(): number {return this._unit;}       // unit id\r\n    set unit(val:number) { this._unit=val;}\r\n    page?: string;\r\n    param?: string[];\r\n}\r\n\r\nexport let appInFrame:AppInFrame = new AppInFrameClass();\r\n/* {\r\n    hash: undefined,\r\n    get unit():number {return } undefined, //debugUnitId,\r\n    page: undefined;\r\n    param: undefined,\r\n}*/\r\n\r\nexport function isBridged():boolean {\r\n    return window.self !== window.parent;\r\n}\r\n\r\nwindow.addEventListener('message', async function(evt) {\r\n    var message = evt.data;\r\n    switch (message.type) {\r\n        case 'sub-frame-started':\r\n            subFrameStarted(evt);\r\n            break;\r\n        case 'ws':\r\n            //wsBridge.receive(message.msg);\r\n            await nav.onReceive(message.msg);\r\n            break;\r\n        case 'init-sub-win':\r\n            await initSubWin(message);\r\n            break;\r\n        case 'pop-app':\r\n            window.console.log('///\\\\\\\\\\\\ pop-app');\r\n            nav.navBack();\r\n            break;\r\n        case 'center-api':\r\n            await callCenterApiFromMessage(evt.source as Window, message);\r\n            break;\r\n        case 'center-api-return':\r\n            bridgeCenterApiReturn(message);\r\n            break;\r\n        case 'app-api':\r\n            let ret = await onReceiveAppApiMessage(message.hash, message.apiName);\r\n            (evt.source as Window).postMessage({\r\n                type: 'app-api-return', \r\n                apiName: message.apiName,\r\n                db: ret.db,\r\n                url: ret.url,\r\n                token: ret.token} as any, \"*\");\r\n            break;\r\n        case 'app-api-return':\r\n            console.log(\"app-api-return: %s\", JSON.stringify(message));\r\n            console.log('await onAppApiReturn(message);');\r\n            await onAppApiReturn(message);\r\n            break;\r\n        default:\r\n\t\t\tif ((message.source as string)?.startsWith('react-devtools') === true) break;\r\n            window.console.log('message: %s', JSON.stringify(message));\r\n            break;\r\n    }\r\n});\r\n\r\nfunction subFrameStarted(evt:any) {\r\n    var message = evt.data;\r\n    let subWin = evt.source as Window;\r\n    setSubAppWindow(subWin);\r\n    hideFrameBack(message.hash);\r\n    let msg:any = _.clone(nav.user);\r\n    msg.type = 'init-sub-win';\r\n    subWin.postMessage(msg, '*');\r\n}\r\nfunction hideFrameBack(hash:string) {\r\n    let el = document.getElementById(hash);\r\n    if (el !== undefined) el.hidden = true;\r\n}\r\nasync function initSubWin(message:any) {\r\n    console.log('initSubWin: set nav.user', message);\r\n    let user = nav.user = message; // message.user;\r\n    setCenterToken(user.id, user.token);\r\n    await nav.showAppView();\r\n}\r\nasync function onReceiveAppApiMessage(hash: string, apiName: string): Promise<UqToken> {\r\n    let appInFrame = appsInFrame[hash];\r\n    if (appInFrame === undefined) return {name:apiName, db:undefined, url:undefined, token:undefined};\r\n    //let unit = getUnit();\r\n    let {unit, predefinedUnit} = appInFrame;\r\n    unit = unit || predefinedUnit;\r\n    if (!unit) {\r\n        console.error('no unit defined in unit.json or in index.html, or not logined in', unit);\r\n    }\r\n    let parts = apiName.split('/');\r\n    let param = {unit: unit, uqOwner: parts[0], uqName: parts[1], appOwner: parts[2], appName:parts[3]};\r\n    console.log('uqTokenApi.uq onReceiveAppApiMessage', param);\r\n    let ret = await uqTokenApi.uq(param);\r\n    let {db, url, token} = ret;\r\n    return {name: apiName, db:db, url: url, token: token};\r\n}\r\n\r\nasync function onAppApiReturn(message:any) {\r\n    let {apiName, db, url, urlTest, token} = message;\r\n    let action = uqTokenActions[apiName];\r\n    if (action === undefined) {\r\n        throw new Error('error app api return');\r\n        //return;\r\n    }\r\n    let realUrl = host.getUrlOrTest(db, url, urlTest);\r\n    console.log('onAppApiReturn(message:any): url=' + url + ', real=' + realUrl);\r\n    //action.url = realUrl;\r\n    //action.token = token;\r\n    action.resolve({\r\n        name: apiName,\r\n        db: db,\r\n        url: realUrl,\r\n        token: token,\r\n    } as UqToken);\r\n}\r\n\r\nexport function setAppInFrame(appHash: string):AppInFrame {\r\n    if (appHash) {\r\n        let parts = appHash.split('-');\r\n        let len = parts.length;\r\n        if (len > 0) {\r\n            let p = 1;\r\n            appInFrame.hash = parts[p++];\r\n            if (len>0) appInFrame.unit = Number(parts[p++]);\r\n            if (len>1) appInFrame.page = parts[p++];\r\n            if (len>2) appInFrame.param = parts.slice(p++);\r\n        }\r\n    }\r\n    return appInFrame;\r\n}\r\n\r\nexport function getExHashPos():number {\r\n    let hash = document.location.hash;\r\n    if (hash !== undefined && hash.length > 0) {\r\n        let pos = hash.lastIndexOf('#tv-');\r\n        if (pos < 0) pos = hash.lastIndexOf('#tvdebug-');\r\n        return pos;\r\n    }\r\n    return -1;\r\n}\r\n\r\nexport function getExHash():string {\r\n    let pos = getExHashPos();\r\n    if (pos < 0) return undefined;\r\n    return document.location.hash.substring(pos);\r\n}\r\n\r\nexport function appUrl(url: string, unitId: number, page?:string, param?:any[]):{url:string; hash:string} {\r\n    let u:string;\r\n    for (;;) {\r\n        u = uid();\r\n        let a = appsInFrame[u];\r\n        if (a === undefined) {\r\n            appsInFrame[u] = {hash:u, unit:unitId};\r\n            break;\r\n        }\r\n    }\r\n    url += '#tv-' + u + '-' + unitId;\r\n    if (page !== undefined) {\r\n        url += '-' + page;\r\n        if (param !== undefined) {\r\n            for (let i=0; i<param.length; i++) {\r\n                url += '-' + param[i];\r\n            }\r\n        }\r\n    }\r\n    return {url: url, hash: u};\r\n}\r\n\r\nfunction getUnit():number {\r\n\tlet {unit, predefinedUnit} = appInFrame;\r\n    let realUnit = unit || predefinedUnit;\r\n    if (realUnit === undefined) {\r\n        throw new Error('no unit defined in unit.json or not logined in');\r\n\t}\r\n    return realUnit;\r\n}\r\n\r\ninterface UqTokenAction {\r\n    resolve: (value?: UqToken | PromiseLike<UqToken>) => void;\r\n    reject: (reason?: any) => void;\r\n}\r\nconst uqTokenActions:{[uq:string]: UqTokenAction} = {};\r\nexport async function buildAppUq(uq:string, uqOwner:string, uqName:string, appOwner:string, appName:string):Promise<void> {\r\n    if (!isBridged()) {\r\n        let unit = getUnit();\r\n        let uqToken = await uqTokenApi.uq({unit,  uqOwner, uqName, appOwner, appName});\r\n        if (uqToken.token === undefined) uqToken.token = centerToken;\r\n        let {db, url, urlTest} = uqToken;\r\n        let realUrl = host.getUrlOrTest(db, url, urlTest);\r\n        console.log('realUrl: %s', realUrl);\r\n        uqToken.url = realUrl;\r\n        uqTokens[uq] = uqToken;\r\n        return uqToken;\r\n    }\r\n    console.log(\"**** before buildAppUq ****\", appInFrame);\r\n    let bp = uqTokenActions[uq];\r\n    if (bp !== undefined) return;\r\n    return new Promise<void>((resolve, reject) => {\r\n        uqTokenActions[uq] = {\r\n            resolve: async (at:any) => {\r\n                let {db, url, token} = await at;\r\n                uqTokens[uq] = {\r\n                    name: uq,\r\n                    db: db,\r\n                    url: url,\r\n                    token: token,\r\n                };\r\n                uqTokenActions[uq] = undefined;\r\n                console.log(\"**** after buildAppUq ****\", appInFrame);\r\n                resolve();\r\n            },\r\n            reject: reject,\r\n        };\r\n        (window.opener || window.parent).postMessage({\r\n            type: 'app-api',\r\n            apiName: uq,\r\n            hash: appInFrame.hash,\r\n        }, \"*\");\r\n    });\r\n}\r\n\r\nexport function appUq(uq:string):UqToken {\r\n    let uts = uqTokens;\r\n    return uts[uq];\r\n}\r\n\r\ninterface BridgeCenterApi {\r\n    id: string;\r\n    resolve: (value?:any)=>any;\r\n    reject: (reason?:any)=>void;\r\n}\r\nconst brideCenterApis:{[id:string]: BridgeCenterApi} = {};\r\nexport async function bridgeCenterApi(url:string, method:string, body:any):Promise<any> {\r\n    console.log('bridgeCenterApi: url=%s, method=%s', url, method);\r\n    return await new Promise<any>(async (resolve, reject) => {\r\n        let callId:string;\r\n        for (;;) {\r\n            callId = uid();\r\n            let bca = brideCenterApis[callId];\r\n            if (bca === undefined) {\r\n                brideCenterApis[callId] = {\r\n                    id: callId,\r\n                    resolve: resolve,\r\n                    reject: reject,\r\n                }\r\n                break;\r\n            }\r\n        }\r\n        (window.opener || window.parent).postMessage({\r\n            type: 'center-api',\r\n            callId: callId,\r\n            url: url,\r\n            method: method,\r\n            body: body\r\n        }, '*');\r\n    });\r\n}\r\n\r\nasync function callCenterApiFromMessage(from:Window, message:any):Promise<void> {\r\n    let {callId, url, method, body} = message;\r\n    let result = await callCenterapi.directCall(url, method, body);\r\n    from.postMessage({\r\n        type: 'center-api-return',\r\n        callId: callId,\r\n        result: result,\r\n    }, '*');\r\n}\r\n\r\nfunction bridgeCenterApiReturn(message:any) {\r\n    let {callId, result} = message;\r\n    let bca = brideCenterApis[callId];\r\n    if (bca === undefined) return;\r\n    brideCenterApis[callId] = undefined;\r\n    bca.resolve(result);\r\n}\r\n","//import _ from 'lodash';\r\nimport { Caller } from '../net';\r\nimport { Entity } from './entity';\r\nimport { Action } from './action';\r\nimport { Query } from './query';\r\n\r\ninterface UqResponseSchema {\r\n    uq: any;\r\n    entity: any;\r\n}\r\n\r\nexport abstract class EntityCaller<T> extends Caller<T> {\r\n    private tries: number;\r\n    protected _entity: Entity;\r\n\r\n    constructor(entity: Entity, params:T, waiting: boolean = true) {\r\n        super(params, waiting);\r\n        this.tries = 0;\r\n        this._entity = entity;\r\n    }\r\n\r\n    protected get entity(): Entity {return this._entity;}\r\n\r\n    //大多的entityCaller都不需要这个\r\n    //buildParams() {return this.entity.buildParams(this.params);}\r\n    \r\n    async request(): Promise<any> {\r\n        await this.entity.loadSchema();\r\n        let ret = await this.innerRequest();\r\n        return ret;\r\n    }\r\n\r\n    protected async innerCall(): Promise<any> {\r\n        return await this.entity.uqApi.xcall(this);\r\n    }\r\n\r\n    async innerRequest(): Promise<any> {\r\n        let jsonResult = await this.innerCall();\r\n        let {$uq, $modify, res} = jsonResult;\r\n        this.entity.uq.pullModify($modify);\r\n        if ($uq === undefined) {\r\n            //if (res === undefined) debugger;\r\n            let ret = this.xresult(res);\r\n            //if (ret === undefined) debugger;\r\n            return ret;\r\n        }\r\n        return await this.retry($uq);\r\n    }\r\n\r\n    xresult(res:any):any {return res}\r\n\r\n    get headers(): {[header:string]: string} {\r\n        let {ver, uq} = this.entity;\r\n        let {uqVersion} = uq;\r\n        return {\r\n            uq: `${uqVersion}`,\r\n            en: `${ver}`,\r\n        }\r\n    }\r\n\r\n    private async retry(schema: UqResponseSchema) {\r\n        ++this.tries;\r\n        if (this.tries > 5) throw new Error('can not get right uq response schema, 5 tries');\r\n        this.rebuildSchema(schema);\r\n        return await this.innerRequest();\r\n    }\r\n\r\n    private rebuildSchema(schema: UqResponseSchema) {\r\n        let {uq, entity} = schema;\r\n        if (uq !== undefined) this.entity.uq.buildEntities(uq);\r\n        if (entity !== undefined) {\r\n\t\t\tthis.entity.setSchema(entity);\r\n\t\t}\r\n    }\r\n}\r\n\r\nexport abstract class ActionCaller extends EntityCaller<any> {\r\n    protected get entity(): Action {return this._entity as Action;}\r\n}\r\n\r\nexport class QueryQueryCaller extends EntityCaller<any> {\r\n    protected get entity(): Query {return this._entity as Query};\r\n    get path():string {return `query/${this.entity.name}`;}\r\n    xresult(res:any) {\r\n        let data = this.entity.unpackReturns(res);\r\n        return data;\r\n    }\r\n    buildParams() {return this.entity.buildParams(this.params);}\r\n}\r\n\r\nexport class QueryPageCaller extends EntityCaller<any> {\r\n    protected get params(): {pageStart:any; pageSize:number, params:any} {return this._params};\r\n\tprotected get entity(): Query {return this._entity as Query};\r\n\t//results: {[name:string]:any[]};\r\n\tget path():string {return `query-page/${this.entity.name}`;}\t\r\n    buildParams() {\r\n        let {pageStart, pageSize, params} = this.params;\r\n        let p:any;\r\n        if (params === undefined) {\r\n            p = {key: ''};\r\n        }\r\n        else {\r\n            p = this.entity.buildParams(params);\r\n        }\r\n        /*\r\n        switch (typeof params) {\r\n            case 'undefined': p = {key: ''}; break;\r\n            default: p = _.clone(params); break;\r\n        }\r\n        */\r\n        p['$pageStart'] = pageStart;\r\n        p['$pageSize'] = pageSize;\r\n        return p;\r\n    };\r\n    xresult(res:any): {[name:string]:any[]} {\r\n        let ret = this.entity.unpackReturns(res);\r\n\t\t//return this.results.$page;// as any[];\r\n\t\treturn ret;\r\n    }\r\n}\r\n","import { UqApi } from '../net';\r\nimport { LocalCache } from '../tool';\r\nimport { UqMan, Field, ArrFields, FieldMap } from './uqMan';\r\nimport { Tuid } from './tuid';\r\n\r\nconst tab = '\\t';\r\nconst ln = '\\n';\r\nconst chars = '\\\\ntbfvr';\r\nconst codeBackSlash = chars.charCodeAt(0);\r\nconst codeN = chars.charCodeAt(1);\r\nconst codeT = chars.charCodeAt(2);\r\nconst codeB = chars.charCodeAt(3);\r\nconst codeF = chars.charCodeAt(4);\r\nconst codeV = chars.charCodeAt(5);\r\nconst codeR = chars.charCodeAt(6);\r\n\r\nconst codes = '\\n\\t\\b\\f\\v\\r';\r\nconst codeBN = codes.charCodeAt(0);\r\nconst codeBT = codes.charCodeAt(1);\r\nconst codeBB = codes.charCodeAt(2);\r\nconst codeBF = codes.charCodeAt(3);\r\nconst codeBV = codes.charCodeAt(4);\r\nconst codeBR = codes.charCodeAt(5);\r\n\r\nexport abstract class Entity {\r\n    private jName: string;\r\n    schema: any;\r\n    ver: number = 0;\r\n    sys?: boolean;\r\n    readonly uq: UqMan;\r\n    readonly name: string;\r\n    readonly typeId: number;\r\n    readonly cache: LocalCache;\r\n    readonly uqApi: UqApi;\r\n    abstract get typeName(): string;\r\n    get sName():string {return this.jName || this.name}\r\n    fields: Field[];\r\n    arrFields: ArrFields[];\r\n    returns: ArrFields[];\r\n\r\n    constructor(uq:UqMan, name:string, typeId:number) {\r\n        this.uq = uq;\r\n        this.name = name;\r\n        this.typeId = typeId;\r\n        this.sys = this.name.indexOf('$') >= 0;\r\n        this.cache = this.uq.localMap.item(this.name); // new EntityCache(this);\r\n        this.uqApi = this.uq.uqApi;\r\n    }\r\n\r\n    public face: any;           // 对应字段的label, placeHolder等等的中文，或者语言的翻译\r\n\r\n    //getApiFrom() {return this.entities.uqApi;}\r\n\r\n    private fieldMaps: {[arr:string]: FieldMap} = {};\r\n    fieldMap(arr?:string): FieldMap {\r\n        if (arr === undefined) arr = '$';\r\n        let ret = this.fieldMaps[arr];\r\n        if (ret === undefined) {\r\n            let fields:Field[];\r\n            if (arr === '$') fields = this.fields;\r\n            else if (this.arrFields !== undefined) {\r\n                let arrFields = this.arrFields.find(v => v.name === arr);\r\n                if (arrFields !== undefined) fields = arrFields.fields;\r\n            }\r\n            else if (this.returns !== undefined) {\r\n                let arrFields = this.returns.find(v => v.name === arr);\r\n                if (arrFields !== undefined) fields = arrFields.fields;\r\n            }\r\n            if (fields === undefined) return {};\r\n            ret = {};\r\n            for (let f of fields) ret[f.name] = f;\r\n            this.fieldMaps[arr] = ret;\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    public async loadSchema():Promise<void> {\r\n        if (this.schema !== undefined) return;\r\n        let schema = this.cache.get();\r\n        if (!schema) {\r\n            schema = await this.uq.loadEntitySchema(this.name);\r\n        }\r\n        this.setSchema(schema);\r\n\t\tthis.buildFieldsTuid();\r\n\t\tawait this.loadValues();\r\n\t}\r\n\t\r\n\tprotected async loadValues():Promise<any> {}\r\n\r\n    // 如果要在setSchema里面保存cache，必须先调用clearSchema\r\n    public clearSchema() {\r\n        this.schema = undefined;\r\n    }\r\n\r\n    public setSchema(schema:any) {\r\n        if (schema === undefined) return;\r\n        let {name, version} = schema;\r\n        this.ver = version || 0;\r\n\t\tthis.setJName(name);\r\n        this.cache.set(schema);\r\n\t\tthis.schema = schema;\r\n\t\tthis.buildFieldsTuid();\r\n\t}\r\n\t\r\n\tprotected setJName(name:string) {\r\n        if (name !== this.name) this.jName = name;\r\n\t}\r\n\r\n    public buildFieldsTuid() {\r\n        let {fields, arrs, returns} = this.schema;\r\n        this.uq.buildFieldTuid(this.fields = fields);\r\n        this.uq.buildArrFieldsTuid(this.arrFields = arrs, fields);\r\n        this.uq.buildArrFieldsTuid(this.returns = returns, fields);\r\n    }\r\n\r\n    schemaStringify():string {\r\n        return JSON.stringify(this.schema, (key:string, value:any) => {\r\n            if (key === '_tuid') return undefined;\r\n            return value;\r\n        }, 4);\r\n    }\r\n\r\n    tuidFromName(fieldName:string, arrName?:string):Tuid {\r\n        if (this.schema === undefined) return;\r\n        let {fields, arrs} = this.schema;\r\n        let entities = this.uq;\r\n        function getTuid(fn:string, fieldArr:Field[]) {\r\n            if (fieldArr === undefined) return;\r\n            let f = fieldArr.find(v => v.name === fn);\r\n            if (f === undefined) return;\r\n            return entities.getTuid(f.tuid);\r\n        }\r\n        let fn = fieldName.toLowerCase();\r\n        if (arrName === undefined) return getTuid(fn, fields);\r\n        if (arrs === undefined) return;\r\n        let an = arrName.toLowerCase();\r\n        let arr = (arrs as ArrFields[]).find(v => v.name === an);\r\n        if (arr === undefined) return;\r\n        return getTuid(fn, arr.fields);\r\n    }\r\n\r\n    buildParams(params:any):any {\r\n        let result:any = {};\r\n        let fields = this.fields;\r\n        if (fields !== undefined) this.buildFieldsParams(result, fields, params);\r\n        let arrs = this.arrFields;\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                let {name, fields} = arr;\r\n                let paramsArr:any[] = params[name];\r\n                if (paramsArr === undefined) continue;\r\n                let arrResult:any[] = [];\r\n                result[name] = arrResult;\r\n                for (let pa of params) {\r\n                    let rowResult = {};\r\n                    this.buildFieldsParams(rowResult, fields, pa);\r\n                    arrResult.push(rowResult);\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private buildFieldsParams(result:any, fields:Field[], params:any) {\r\n        for (let field of fields) {\r\n            let {name, type} = field;            \r\n            let d = params[name];\r\n            let val:any;\r\n            if (type === 'datetime') {\r\n                val = this.buildDateTimeParam(d);\r\n            }\r\n            else {\r\n                switch (typeof d) {\r\n                    default: val = d; break;\r\n                    case 'object':\r\n                        let tuid = field._tuid;\r\n                        if (tuid === undefined) val = d.id;\r\n                        else val = tuid.getIdFromObj(d);\r\n                        break;\r\n                }\r\n            }\r\n            result[name] = val;\r\n        }\r\n    }\r\n\r\n    buildDateTimeParam(val:any) {\r\n        let dt: Date;\r\n        switch (typeof val) {\r\n            default: debugger; throw new Error('escape datetime field in pack data error: value=' + val);\r\n            case 'undefined': return '';\r\n            case 'object': dt = (val as Date); break;\r\n            case 'string':\r\n            case 'number': dt = new Date(val); break;\r\n        }\r\n        return Math.floor(dt.getTime()/1000);\r\n    }\r\n\r\n    buildDateParam(val:any) {\r\n        let dt: Date;\r\n        switch (typeof val) {\r\n            default: debugger; throw new Error('escape datetime field in pack data error: value=' + val);\r\n            case 'undefined': return '';\r\n            case 'string': return val;\r\n            case 'object': dt = (val as Date); break;\r\n            case 'number': dt = new Date(val); break;\r\n        }\r\n        let ret = dt.toISOString();\r\n        let p = ret.indexOf('T');\r\n        return p>0? ret.substr(0, p) : ret;\r\n    }\r\n\r\n    pack(data:any):string {\r\n        let ret:string[] = [];\r\n        let fields = this.fields;\r\n        if (fields !== undefined) this.packRow(ret, fields, data);\r\n        let arrs = this.arrFields; \r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n\t\t\t\tlet {name, fields} = arr;\r\n\t\t\t\tlet arrData = data[name];\r\n\t\t\t\tif (!arrData) arrData = data[name.toLowerCase()];\r\n                this.packArr(ret, fields, arrData);\r\n            }\r\n        }\r\n        return ret.join('');\r\n    }\r\n\r\n    private escape(row:any, field:Field):any {\r\n        let d = row[field.name];\r\n        switch (field.type) {\r\n            case 'datetime':\r\n                return this.buildDateTimeParam(d);\r\n            default:\r\n                switch (typeof d) {\r\n                    default: return d;\r\n                    case 'object':\r\n                        let tuid = field._tuid;\r\n                        if (tuid === undefined) return d.id;\r\n                        return tuid.getIdFromObj(d);\r\n                    case 'string':\r\n                        let len = d.length;\r\n                        let r = '', p = 0;\r\n                        for (let i=0;i<len;i++) {\r\n                            let c:number = d.charCodeAt(i), ch:string;\r\n                            switch(c) {\r\n\t\t\t\t\t\t\t\tdefault: continue;\r\n\t\t\t\t\t\t\t\tcase codeBackSlash: ch = '\\\\\\\\'; break;\r\n                                case codeBT: ch = '\\\\t'; break;\r\n\t\t\t\t\t\t\t\tcase codeBN: ch = '\\\\n'; break;\r\n\t\t\t\t\t\t\t\tcase codeBF: ch = '\\\\f'; break;\r\n\t\t\t\t\t\t\t\tcase codeBV: ch = '\\\\v'; break;\r\n\t\t\t\t\t\t\t\tcase codeBB: ch = '\\\\b'; break;\r\n\t\t\t\t\t\t\t\tcase codeBR: ch = '\\\\r'; break;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tr += d.substring(p, i) + ch;\r\n\t\t\t\t\t\t\tp = i+1;\r\n                        }\r\n                        return r + d.substring(p);\r\n                    case 'undefined': return '';\r\n                }\r\n        }\r\n    }\r\n\r\n    private packRow(result:string[], fields:Field[], data:any) {\r\n        let len = fields.length;\r\n        if (len === 0) return;\r\n        let ret = '';\r\n        ret += this.escape(data, fields[0]);\r\n        for (let i=1;i<len;i++) {\r\n            let f = fields[i];\r\n            ret += tab + this.escape(data, f);\r\n        }\r\n        result.push(ret + ln);\r\n    }\r\n\r\n    private packArr(result:string[], fields:Field[], data:any[]) {\r\n        if (data !== undefined) {\r\n            for (let row of data) {\r\n                this.packRow(result, fields, row);\r\n            }\r\n        }\r\n        result.push(ln);\r\n    }\r\n    protected cacheFieldsInValue(values:any, fields:Field[]) {\r\n        for (let f of fields as Field[]) {\r\n            let {name, _tuid} = f;\r\n            if (_tuid === undefined) continue;\r\n            let id = values[name];\r\n            //_tuid.useId(id);\r\n            values[name] = _tuid.boxId(id);\r\n        }\r\n    }\r\n\r\n    protected unpackTuidIdsOfFields(values:string[], fields: Field[]):any[] {\r\n        if (fields === undefined) return values as any[];\r\n        //if (this.fields === undefined) return values as any[];\r\n        let ret:any[] = []\r\n        for (let ln of values) {\r\n            if (!ln) continue;\r\n            let len = ln.length;\r\n            let p = 0;\r\n            while (p<len) {\r\n                let ch = ln.charCodeAt(p);\r\n                if (ch === 10) {\r\n                    ++p;\r\n                    break;\r\n                }\r\n                let row = {};\r\n                p = this.unpackRow(row, fields, ln, p);\r\n                ret.push(row);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    unpackSheet(data:string):any {\r\n        let ret = {} as any; //new this.newMain();\r\n        //if (schema === undefined || data === undefined) return;\r\n        let fields = this.fields;\r\n        let p = 0;\r\n        if (fields !== undefined) p = this.unpackRow(ret, fields, data, p);\r\n        let arrs = this.arrFields; //schema['arrs'];\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                p = this.unpackArr(ret, arr, data, p);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    unpackReturns(data:string):{[name:string]:any[]} {\r\n        if (data === undefined) debugger;\r\n        let ret = {} as any;\r\n        //if (schema === undefined || data === undefined) return;\r\n        //let fields = schema.fields;\r\n        let p = 0;\r\n        //if (fields !== undefined) p = unpackRow(ret, schema.fields, data, p);\r\n        let arrs = this.returns; //schema['returns'];\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                //let creater = this.newRet[arr.name];\r\n                p = this.unpackArr(ret, arr, data, p);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    protected unpackRow(ret:any, fields:Field[], data:string, p:number):number {\r\n        let ch0 = 0, ch = 0, c = p, i = 0, len = data.length, fLen = fields.length;\r\n        for (;p<len;p++) {\r\n            ch0 = ch;\r\n            ch = data.charCodeAt(p);\r\n            if (ch === 9) {\r\n                let f = fields[i];\r\n                let {name} = f;\r\n                if (ch0 !== 8) {\r\n                    if (p>c) {\r\n                        let v = data.substring(c, p);\r\n                        ret[name] = this.to(ret, v, f);\r\n                    }\r\n                }\r\n                else {\r\n                    ret[name] = null;\r\n                }\r\n                c = p+1;\r\n                ++i;\r\n                if (i>=fLen) {\r\n                    p = data.indexOf('\\n', c);\r\n                    if (p >= 0) ++p;\r\n                    else p = len;\r\n                    return p;\r\n                }\r\n            }\r\n            else if (ch === 10) {\r\n                let f = fields[i];\r\n                let {name} = f;\r\n                if (ch0 !== 8) {\r\n                    if (p>c) {\r\n                        let v = data.substring(c, p);\r\n                        ret[name] = this.to(ret, v, f);\r\n                    }\r\n                }\r\n                else {\r\n                    ret[name] = null;\r\n                }\r\n                ++p;\r\n                ++i;\r\n                return p;\r\n            }\r\n        }\r\n        let f = fields[i];\r\n        let {name} = f;\r\n        if (ch0 !== 8) {\r\n            let v = data.substring(c);\r\n            ret[name] = this.to(ret, v, f);\r\n        }\r\n        return len;\r\n    }\r\n\r\n    private to(ret:any, v:string, f:Field):any {\r\n        switch (f.type) {\r\n\t\t\tdefault: return v;\r\n\t\t\tcase 'text':\r\n\t\t\tcase 'char':\r\n\t\t\t\treturn this.reverseNT(v);\r\n            case 'datetime':\r\n            case 'time':\r\n\t\t\tcase 'timestamp':\r\n                let n = Number(v);\r\n                let date = isNaN(n) === true? new Date(v) : new Date(n*1000);\r\n                return date;\r\n            case 'date':\r\n                let parts = v.split('-');\r\n                return new Date(Number(parts[0]), Number(parts[1])-1, Number(parts[2]));\r\n            case 'tinyint':\r\n            case 'smallint':\r\n            case 'int':\r\n            case 'bigint':\r\n            case 'dec':\r\n                return Number(v);\r\n            case 'id':\r\n                let id = Number(v);\r\n                let {_tuid} = f;\r\n                if (_tuid === undefined) return id;\r\n                return _tuid.boxId(id);\r\n        }\r\n\t}\r\n\t\r\n\tprivate reverseNT(text:string):string {\r\n\t\tif (text === undefined) return;\r\n\t\tif (text === null) return;\r\n\t\tlet len = text.length;\r\n\t\tlet r = '';\r\n\t\tlet p = 0;\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tlet c = text.charCodeAt(i);\r\n\t\t\tif (c === codeBackSlash) {\r\n\t\t\t\tif (i===len-1) break;\r\n\t\t\t\tlet c1 = text.charCodeAt(i+1);\r\n\t\t\t\tlet ch:string;\r\n\t\t\t\tswitch (c1) {\r\n\t\t\t\t\tdefault: continue;\r\n\t\t\t\t\tcase codeBackSlash: ch = '\\\\'; break;\r\n\t\t\t\t\tcase codeN: ch = '\\n'; break;\r\n\t\t\t\t\tcase codeT: ch = '\\t'; break;\r\n\t\t\t\t\tcase codeB: ch = '\\b'; break;\r\n\t\t\t\t\tcase codeF: ch = '\\f'; break;\r\n\t\t\t\t\tcase codeV: ch = '\\v'; break;\r\n\t\t\t\t\tcase codeR: ch = '\\r'; break;\r\n\t\t\t\t}\r\n\t\t\t\tr += text.substring(p, i) + ch;\r\n\t\t\t\tp = i+2;\r\n\t\t\t\t++i;\r\n\t\t\t}\r\n\t\t}\r\n\t\tr += text.substring(p, len);\r\n\t\treturn r;\r\n\t}\r\n\r\n    private unpackArr(ret:any, arr:ArrFields, data:string, p:number):number {\r\n        let vals:any[] = [], len = data.length;\r\n        let {name, fields} = arr;\r\n        while (p<len) {\r\n            let ch = data.charCodeAt(p);\r\n            if (ch === 10) {\r\n                ++p;\r\n                break;\r\n            }\r\n            let val = {} as any; //new creater();\r\n            vals.push(val);\r\n            p = this.unpackRow(val, fields, data, p);\r\n        }\r\n        ret[name] = vals;\r\n        return p;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { ItemSchema, UiItem, UiSelectBase } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { observable } from 'mobx';\r\nimport { FieldRule } from '../form/rules';\r\nimport { Image } from '../image';\r\n\r\nexport abstract class ItemEdit {\r\n\tprotected name: string;\r\n\tprotected _itemSchema: ItemSchema;\r\n    get itemSchema(): ItemSchema {return this._itemSchema}\r\n    protected _uiItem:UiItem;\r\n    get uiItem():UiItem {return this._uiItem}\r\n    value: any;\r\n    label: string;\r\n\r\n    @observable protected error: string;\r\n    @observable protected isChanged: boolean = false;\r\n    protected newValue: any;\r\n\r\n    constructor(itemSchema: ItemSchema, uiItem:UiItem, label:string, value: any) {\r\n        this._itemSchema = itemSchema;\r\n        this._uiItem = uiItem\r\n        this.value = value;\r\n        let {name} = itemSchema;\r\n        this.name = name;\r\n        this.label = label;\r\n\t}\r\n\t\r\n\tinit() {\t\t\r\n\t}\r\n\r\n    async start():Promise<any> {\r\n        return await this.internalStart();\r\n    }\r\n\r\n    protected abstract internalStart():Promise<any>;\r\n\r\n    async end():Promise<any> {\r\n        await this.internalEnd()\r\n    }\r\n\r\n\trenderContent() {\t\t\r\n        let {name, type} = this._itemSchema;\r\n        let divValue:any;\r\n        let uiItem = this._uiItem;\r\n        let label:string, labelHide:boolean;\r\n        if (uiItem === undefined) {\r\n            label = name;\r\n        }\r\n        else {\r\n\t\t\tlabel = uiItem.label;\r\n\t\t\tlabelHide = uiItem.labelHide;\r\n            let templet = uiItem.Templet;\r\n            if (templet !== undefined) {\r\n                if (typeof templet === 'function') {\r\n\t\t\t\t\tif (this.value !== undefined) divValue = templet(this.value);\r\n\t\t\t\t}\r\n                else {\r\n\t\t\t\t\tdivValue = {templet};\r\n\t\t\t\t}\r\n            }\r\n            else if (this.value !== undefined) {\r\n                switch (uiItem.widget) {\r\n                    case 'radio':\r\n                    case 'select':\r\n                        let {list} = uiItem as UiSelectBase;\r\n                        divValue = <b>{list.find(v => v.value === this.value).title}</b>;\r\n                        break;\r\n                    case 'id':\r\n                        divValue = <b>no templet for {name}={this.value}</b>\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n        if (divValue === undefined) {\r\n            switch (type) {\r\n                default:\r\n                    divValue = this.value? \r\n\t\t\t\t\t\t<b>{this.value}</b> \r\n\t\t\t\t\t\t:\r\n\t\t\t\t\t\t<small className=\"text-muted\">[{labelHide===true? label:'无'}]</small>;\r\n                    break;\r\n                case 'image':\r\n                    divValue = <Image className=\"w-4c h-4c\" src={this.value} />;\r\n                    break;\r\n            }\r\n\t\t}\r\n\t\treturn divValue;\r\n\t}\r\n\r\n    protected async internalEnd():Promise<void> {nav.pop()}\r\n\r\n    protected verifyValue() {\r\n        if (this.uiItem === undefined) return;\r\n        let {rules} = this.uiItem;\r\n        if (rules === undefined) return;\r\n        let nv = this.newValue;\r\n        function verifyRule(rule:FieldRule, value: any):string {\r\n            let error = rule(nv);\r\n            if (error !== undefined) {\r\n                if (typeof error !== 'object')\r\n                    return error;\r\n                else\r\n                    return JSON.stringify(error);\r\n            }\r\n        }\r\n        if (Array.isArray(rules)) {\r\n            for (let rule of rules) {\r\n                let error = verifyRule(rule as FieldRule, nv);\r\n                if (error !== undefined) {\r\n                    this.error = error;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this.error = verifyRule(rules as FieldRule, nv);\r\n        }\r\n    }\r\n}\r\n","import {bridgeCenterApi, isBridged} from './appBridge';\r\nimport {FetchError} from './fetchError';\r\nimport {HttpChannelUI} from './httpChannelUI';\r\nimport {nav} from '../components/nav';\r\nimport { Caller } from './caller';\r\nimport { env } from '../tool';\r\n\r\n/*\r\nexport async function httpGet(url:string, params?:any):Promise<any> {\r\n    let channel = new HttpChannel(false, url, undefined, undefined);\r\n    let ret = await channel.get('', params);\r\n    return ret;\r\n}\r\n\r\nexport async function httpPost(url:string, params?:any):Promise<any> {\r\n    let channel = new HttpChannel(false, url, undefined, undefined);\r\n    let ret = await channel.post('', params);\r\n    return ret;\r\n}\r\n*/\r\n\r\nconst methodsWithBody = ['POST', 'PUT'];\r\n\r\nexport abstract class HttpChannel {\r\n    private timeout: number;\r\n    protected ui?: HttpChannelUI;\r\n    protected hostUrl: string;\r\n    protected apiToken: string;\r\n\r\n    constructor(hostUrl: string, apiToken:string, ui?: HttpChannelUI) {\r\n        this.hostUrl = hostUrl;\r\n        this.apiToken = apiToken;\r\n        this.ui = ui;\r\n        this.timeout = env.isDevelopment === true? 500000:50000;\r\n    }\r\n\r\n    private startWait = (waiting: boolean) => {\r\n        if (waiting === true) {\r\n            if (this.ui !== undefined) this.ui.startWait();\r\n        }\r\n    }\r\n\r\n    private endWait = (url?:string, reject?:(reason?:any)=>void) => {\r\n        if (this.ui !== undefined) this.ui.endWait();\r\n        if (reject !== undefined) reject('访问webapi超时 ' + url);\r\n    }\r\n\r\n    private showError = async (error:FetchError) => {\r\n        if (this.ui !== undefined) await this.ui.showError(error);\r\n    }\r\n\r\n    used() {\r\n        this.post('', {});\r\n    }\r\n\r\n    async xcall(urlPrefix:string, caller:Caller<any>): Promise<void> {\r\n        let options = this.buildOptions();\r\n        let {headers, path, method} = caller;\r\n        if (headers !== undefined) {\r\n            let h = options.headers;\r\n            for (let i in headers) {\r\n                h.append(i, encodeURI(headers[i]));\r\n            }\r\n        }\r\n        options.method = method;\r\n        let p = caller.buildParams();\r\n        if (methodsWithBody.indexOf(method) >= 0 && p !== undefined) {\r\n            options.body = JSON.stringify(p)\r\n        }\r\n        return await this.innerFetch(urlPrefix + path, options, caller.waiting);\r\n    }\r\n\r\n    private async innerFetchResult(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let ret = await this.innerFetch(url, options, waiting);\r\n        return ret.res;\r\n    }\r\n\r\n    async get(url: string, params: any = undefined, waiting?: boolean): Promise<any> {\r\n        if (params) {\r\n            let keys = Object.keys(params);\r\n            if (keys.length > 0) {\r\n                let c = '?';\r\n                for (let k of keys) {\r\n                    let v = params[k];\r\n                    if (v === undefined) continue;\r\n                    url += c + k + '=' + params[k];\r\n                    c = '&';\r\n                }\r\n            }\r\n        }\r\n        let options = this.buildOptions();\r\n        options.method = 'GET';\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async post(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'POST';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async put(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'PUT';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async delete(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'DELETE';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n    async fetch(url: string, options: any, waiting: boolean, resolve:(value?:any)=>any, reject:(reason?:any)=>void):Promise<void> {\r\n        let that = this;\r\n        this.startWait(waiting);\r\n        let path = url;\r\n        function buildError(err: any, ex?: string) {\r\n            switch (typeof err) {\r\n                case 'string':\r\n                    if (ex !== undefined) err += ' ' + ex;\r\n                    break;\r\n                case 'object':\r\n                    let keys = Object.keys(err);\r\n                    let retErr:any = {\r\n                        ex: ex,\r\n                    };\r\n                    for (let key of keys) {\r\n                        retErr[key] = err[key];\r\n                    }\r\n                    err = retErr;\r\n                    break;\r\n            }\r\n            return {\r\n                channel: that,\r\n                url: path,\r\n                options: options,\r\n                resolve: resolve,\r\n                reject: reject,\r\n                error: err,\r\n            }\r\n        }\r\n        try {\r\n            console.log('%s-%s %s', options.method, path, options.body || '');\r\n            let now = Date.now();\r\n            let timeOutHandler = env.setTimeout(\r\n                undefined, //'httpChannel.fetch',\r\n                () => {\r\n                    that.endWait(url + ' timeout endWait: ' + (Date.now() - now) + 'ms', reject);\r\n                },\r\n                this.timeout);\r\n            let res = await fetch(encodeURI(path), options);\r\n            if (res.ok === false) {\r\n                env.clearTimeout(timeOutHandler);\r\n                console.log('ok false endWait');       \r\n                that.endWait();\r\n                console.log('call error %s', res.statusText);\r\n                throw res.statusText;\r\n            }\r\n            let ct = res.headers.get('content-type');\r\n            if (ct && ct.indexOf('json')>=0) {\r\n                return res.json().then(async retJson => {\r\n                    env.clearTimeout(timeOutHandler);\r\n                    that.endWait();\r\n                    if (retJson.ok === true) {\r\n                        if (typeof retJson !== 'object') {\r\n                            debugger;\r\n                        }\r\n                        else if (Array.isArray(retJson) === true) {\r\n                            debugger;\r\n                        }\r\n                        return resolve(retJson);\r\n                    }\r\n                    let retError = retJson.error;\r\n                    if (retError === undefined) {\r\n                        await that.showError(buildError('not valid tonva json'));\r\n                    }\r\n                    else {\r\n                        await that.showError(buildError(retError, 'retJson.error'));\r\n                        reject(retError);\r\n                    }\r\n                }).catch(async error => {\r\n                    await that.showError(buildError(error, 'catch res.json()'));\r\n                });\r\n            }\r\n            else {\r\n                let text = await res.text();\r\n                env.clearTimeout(timeOutHandler);\r\n                console.log('text endWait');\r\n                that.endWait();\r\n                resolve(text);\r\n            }\r\n        }\r\n        catch(error) {\r\n            this.endWait(url, reject);\r\n            if (typeof error === 'string') {\r\n                let err = error.toLowerCase();\r\n                if (err.startsWith('unauthorized') === true) {\r\n                    nav.logout();\r\n                    return;\r\n                }\r\n            }\r\n            console.error('fecth error (no nav.showError): ' + url);\r\n            // await this.showError(buildError(error, 'catch outmost'));\r\n        };\r\n    }\r\n\r\n    protected abstract async innerFetch(url: string, options: any, waiting: boolean): Promise<any>;\r\n\r\n    async callFetch(url:string, method:string, body:any):Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = method;\r\n        options.body = body;\r\n        return await new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(url, options, true, resolve, reject);\r\n        });\r\n    }\r\n\r\n    private buildOptions(): {method:string; headers:Headers; body:any} {\r\n        let headers = this.buildHeaders();\r\n        let options = {\r\n            headers: headers,\r\n            method: undefined as any,\r\n            body: undefined as any,\r\n            // cache: 'no-cache',\r\n        };\r\n        return options;\r\n    }\r\n\r\n    protected buildHeaders():Headers {\r\n        let {language, culture} = nav;\r\n        let headers = new Headers();\r\n        //headers.append('Access-Control-Allow-Origin', '*');\r\n        headers.append('Content-Type', 'application/json;charset=UTF-8');\r\n        let lang = language;\r\n        if (culture) lang += '-' + culture;\r\n        headers.append('Accept-Language', lang);\r\n        if (this.apiToken) { \r\n            headers.append('Authorization', this.apiToken); \r\n        }\r\n        return headers;\r\n    }\r\n}\r\n\r\nexport class CenterHttpChannel extends HttpChannel {\r\n    protected async innerFetch(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let u = this.hostUrl + url;\r\n        if (this.apiToken === undefined && isBridged())\r\n            return await bridgeCenterApi(u, options.method, options.body);\r\n        return await new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(u, options, waiting, resolve, reject);\r\n        });\r\n    }\r\n}\r\n\r\nexport class UqHttpChannel extends HttpChannel {\r\n    protected async innerFetch(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let u = this.hostUrl + url;\r\n        return await new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(u, options, waiting, resolve, reject);\r\n        });\r\n    }\r\n}\r\n","import {nav} from '../components/nav';\r\nimport {FetchError} from './fetchError';\r\n\r\nexport interface HttpChannelUI {\r\n    startWait():void;\r\n    endWait():void;\r\n    showError(error:FetchError):Promise<void>;\r\n    showUpgradeUq(uq:string, version:number):Promise<void>;\r\n}\r\n\r\nexport class HttpChannelNavUI implements HttpChannelUI {\r\n    startWait() {\r\n        nav.startWait();\r\n    }\r\n    endWait() {\r\n        nav.endWait();\r\n    }\r\n    async showError(error:FetchError):Promise<void> {\r\n        nav.endWait();\r\n        /*\r\n        if (error.name === 'SyntaxError') {\r\n            error = {\r\n                name: error.name,\r\n                message: error.message,\r\n            }\r\n        }*/\r\n        await nav.onError(error);\r\n    }\r\n    async showUpgradeUq(uq:string, version:number):Promise<void> {\r\n        await nav.showUpgradeUq(uq, version);\r\n    }\r\n}\r\n\r\n","import _ from 'lodash';\r\nimport {HttpChannel, CenterHttpChannel, UqHttpChannel} from './httpChannel';\r\nimport {HttpChannelNavUI} from './httpChannelUI';\r\nimport {appUq, logoutUqTokens, buildAppUq} from './appBridge';\r\nimport {ApiBase} from './apiBase';\r\nimport { host } from './host';\r\nimport { LocalMap, env } from '../tool';\r\nimport {decodeUserToken} from '../tool/user';\r\n\r\nlet channelUIs:{[name:string]: HttpChannel} = {};\r\nlet channelNoUIs:{[name:string]: HttpChannel} = {};\r\n\r\nexport function logoutApis() {\r\n    channelUIs = {};\r\n    channelNoUIs = {};\r\n    logoutUnitxApis();\r\n    logoutUqTokens();\r\n}\r\n\r\ninterface UqLocal {\r\n    user: number;\r\n    unit: number;\r\n    value: any;\r\n    tick?: number;\r\n    isNet?: boolean;\r\n}\r\ninterface UqLocals {\r\n    user: number;\r\n    unit: number;\r\n    uqs: {[uq:string]: UqLocal};\r\n}\r\n/*\r\nconst uqLocalEntities = 'uqLocalEntities';\r\nclass CacheUqLocals {\r\n    private local:UqLocals;\r\n\r\n    async loadAccess(uqApi: UqApi):Promise<any> {\r\n        try {\r\n            let {uqOwner, uqName} = uqApi;\r\n            if (this.local === undefined) {\r\n                let ls = null; // localStorage.getItem(uqLocalEntities);\r\n                if (ls !== null) {\r\n                    this.local = JSON.parse(ls);\r\n                }\r\n            }\r\n            if (this.local !== undefined) {\r\n                let {user, uqs} = this.local;\r\n                if (user !== loginedUserId || uqs === undefined) {\r\n                    this.local = undefined;\r\n                }\r\n                else {\r\n                    for (let i in uqs) {\r\n                        let ul = uqs[i];\r\n                        ul.isNet = undefined;\r\n                    }\r\n                }\r\n            }\r\n            if (this.local === undefined) {\r\n                this.local = {\r\n                    user: loginedUserId,\r\n                    unit: undefined,\r\n                    uqs: {}\r\n                };\r\n            }\r\n\r\n            let ret: any;\r\n            let un = uqOwner+'/'+uqName;\r\n            let uq = this.local.uqs[un];\r\n            if (uq !== undefined) {\r\n                let {value} = uq;\r\n                ret = value;\r\n            }\r\n            if (ret === undefined) {\r\n                ret = await uqApi.__loadAccess();\r\n                //this.saveLocal(un, ret);\r\n            }\r\n            return _.cloneDeep(ret);\r\n        }\r\n        catch (err) {\r\n            this.local = undefined;\r\n            localStorage.removeItem(uqLocalEntities);\r\n            throw err;\r\n        }\r\n    }\r\n\r\n    private saveLocal(uqName:string, accessValue: any) {\r\n        this.local.uqs[uqName] = {\r\n            value: accessValue,\r\n            isNet: true,\r\n        }\r\n        let str = JSON.stringify(this.local);\r\n        localStorage.setItem(uqLocalEntities, str);\r\n    }\r\n\r\n    async checkAccess(uqApi: UqApi):Promise<boolean> {\r\n        if (this.local === undefined) return false;\r\n        let {uqOwner, uqName} = uqApi;\r\n        let un = uqOwner+'/'+uqName;\r\n        let uq = this.local.uqs[un];\r\n        if (uq === undefined) return false;\r\n        let {isNet, value} = uq;\r\n        if (isNet === true) return true;\r\n        let ret = await uqApi.__loadAccess();\r\n        let isMatch = _.isMatch(value, ret);\r\n        if (isMatch === false) {\r\n            this.saveLocal(un, ret);\r\n            return false;\r\n        }\r\n        uq.isNet = true;\r\n        return true;\r\n    }\r\n}\r\n\r\nconst localUqs = new CacheUqLocals;\r\n*/\r\nexport class UqApi extends ApiBase {\r\n    private access:string[];\r\n    appOwner:string;\r\n    appName:string;\r\n    uqOwner: string;\r\n    uqName: string;\r\n    uq: string;\r\n\r\n    constructor(basePath:string, appOwner:string, appName:string, uqOwner:string, uqName:string, access:string[], showWaiting?: boolean) {\r\n        super(basePath, showWaiting);\r\n        this.appOwner = appOwner;\r\n        this.appName = appName;\r\n        if (uqName) {\r\n            this.uqOwner = uqOwner;\r\n            this.uqName = uqName;\r\n            this.uq = uqOwner + '/' + uqName;\r\n        }\r\n        this.access = access;\r\n        this.showWaiting = showWaiting;\r\n    }\r\n\r\n    //setUqVersion(uqVersion:number) {this.uqVersion = undefined}\r\n\r\n    async init() {\r\n        await buildAppUq(this.uq, this.uqOwner, this.uqName, this.appOwner, this.appName);\r\n    }\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        let channels: {[name:string]: HttpChannel};\r\n        let channelUI: HttpChannelNavUI;\r\n        if (this.showWaiting === true || this.showWaiting === undefined) {\r\n            channels = channelUIs;\r\n            channelUI = new HttpChannelNavUI();\r\n        }\r\n        else {\r\n            channels = channelNoUIs;\r\n        }\r\n        let channel = channels[this.uq];\r\n        if (channel !== undefined) return channel;\r\n        let uqToken = appUq(this.uq); //, this.uqOwner, this.uqName);\r\n        if (!uqToken) {\r\n            //debugger;\r\n            await this.init();\r\n            uqToken = appUq(this.uq);\r\n        }\r\n        let {url, token} = uqToken;\r\n        this.token = token;\r\n        channel = new UqHttpChannel(url, token, channelUI);\r\n        return channels[this.uq] = channel;\r\n    }\r\n\r\n    /*async update():Promise<string> {\r\n        return await this.get('update');\r\n    }*/\r\n\r\n    /*\r\n    async __loadAccess():Promise<any> {\r\n        let acc = this.access === undefined?\r\n            '' :\r\n            this.access.join('|');\r\n        let ret = await this.get('access', {acc:acc});\r\n        return ret;\r\n    }\r\n    */\r\n    async loadAccess():Promise<any> {\r\n        //return await localUqs.loadAccess(this);\r\n        let acc = this.access === undefined?\r\n            '' :\r\n            this.access.join('|');\r\n        let ret = await this.get('access', {acc:acc});\r\n        return ret;\r\n    }\r\n\r\n    /*async loadEntities():Promise<any> {\r\n        return await this.get('entities');\r\n    }*/\r\n\r\n    /*\r\n    async checkAccess():Promise<boolean> {\r\n        return await localUqs.checkAccess(this);\r\n    }\r\n    */\r\n\r\n    async schema(name:string):Promise<any> {\r\n        return await this.get('schema/' + name);\r\n    }\r\n\r\n    async queueModify(start:number, page:number, entities:string) {\r\n        return await this.post('queue-modify', {start:start, page:page, entities:entities});\r\n    }\r\n\r\n    /*async schemas(names:string[]):Promise<any[]> {\r\n        return await this.post('schema', names);\r\n    }*/\r\n\r\n    /*\r\n    async tuidGet(name:string, id:number):Promise<any> {\r\n        return await this.get('tuid/' + name + '/' + id);\r\n    }\r\n\r\n    async tuidGetAll(name:string):Promise<any[]> {\r\n        return await this.get('tuid-all/' + name + '/');\r\n    }\r\n\r\n    async tuidSave(name:string, params:any):Promise<any> {\r\n        return await this.post('tuid/' + name, params);\r\n    }\r\n\r\n    async tuidSearch(name:string, arr:string, owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        let ret = await this.post('tuids/' + name, {\r\n            arr: arr,\r\n            owner: owner,\r\n            key: key,\r\n            pageStart: pageStart,\r\n            pageSize: pageSize\r\n        });\r\n        return ret;\r\n    }\r\n    async tuidArrGet(name:string, arr:string, owner:number, id:number):Promise<any> {\r\n        return await this.get('tuid-arr/' + name + '/' + owner + '/' + arr + '/' + id);\r\n    }\r\n    async tuidArrGetAll(name:string, arr:string, owner:number):Promise<any[]> {\r\n        return await this.get('tuid-arr-all/' + name + '/' + owner + '/' + arr + '/');\r\n    }\r\n    async tuidArrSave(name:string, arr:string, owner:number, params:any):Promise<any> {\r\n        return await this.post('tuid-arr/' + name + '/' + owner + '/' + arr + '/', params);\r\n    }\r\n    async tuidArrPos(name:string, arr:string, owner:number, id:number, order:number):Promise<any> {\r\n        return await this.post('tuid-arr-pos/' + name + '/' + owner + '/' + arr + '/', {\r\n            id: id,\r\n            $order: order\r\n        });\r\n    }\r\n\r\n    async tuidIds(name:string, arr:string, ids:number[]):Promise<any[]> {\r\n        try {\r\n            let url = 'tuidids/' + name + '/';\r\n            if (arr !== undefined) url += arr;\r\n            else url += '$';\r\n            let ret = await this.post(url, ids);\r\n            return ret;\r\n        }\r\n        catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n    */\r\n    /*async sheetSave(name:string, data:object):Promise<any> {\r\n        return await this.post('sheet/' + name, data);\r\n    }*/\r\n\r\n    /*async sheetAction(name:string, data:object) {\r\n        return await this.put('sheet/' + name, data);\r\n    }*/\r\n\r\n    /*async stateSheets(name:string, data:object) {\r\n        return await this.post('sheet/' + name + '/states', data);\r\n    }*/\r\n\r\n    /*async stateSheetCount(name:string):Promise<any> {\r\n        return await this.get('sheet/' + name + '/statecount');\r\n    }*/\r\n\r\n    /*async mySheets(name:string, data:object) {\r\n        return await this.post('sheet/' + name + '/my-sheets', data);\r\n    }*/\r\n\r\n    /*async getSheet(name:string, id:number):Promise<any> {\r\n        return await this.get('sheet/' + name + '/get/' + id);\r\n    }*/\r\n\r\n    /*async sheetArchives(name:string, data:object):Promise<any> {\r\n        return await this.post('sheet/' + name + '/archives', data);\r\n    }\r\n\r\n    async sheetArchive(name:string, id:number):Promise<any> {\r\n        return await this.get('sheet/' + name + '/archive/' + id);\r\n    }*/\r\n\r\n    /*async action(name:string, data:object):Promise<any> {\r\n        return await this.post('action/' + name, data);\r\n    }\r\n\r\n    async actionReturns(name:string, data:object):Promise<any[][]> {\r\n        return await this.post('action/' + name + '/returns', data);\r\n    }\r\n\r\n    async page(name:string, pageStart:any, pageSize:number, params:any):Promise<string> {\r\n        let p:any;\r\n        switch (typeof params) {\r\n            case 'undefined': p = {key: ''}; break;\r\n            default: p = _.clone(params); break;\r\n        }\r\n        p['$pageStart'] = pageStart;\r\n        p['$pageSize'] = pageSize;\r\n        return await this.post('query-page/' + name, p);\r\n    }\r\n\r\n    async query(name:string, params:any):Promise<any> {\r\n        let ret = await this.post('query/' + name, params);\r\n        return ret;\r\n    }\r\n    */\r\n/*\r\n    async history(name:string, pageStart:any, pageSize:number, params:any):Promise<string> {\r\n        let p = _.clone(params);\r\n        p['$pageStart'] = pageStart;\r\n        p['$pageSize'] = pageSize;\r\n        let ret = await this.post('history/' + name, p);\r\n        return ret;\r\n    }\r\n\r\n    async book(name:string, pageStart:any, pageSize:number, params:any):Promise<string> {\r\n        let p = _.clone(params);\r\n        p['$pageStart'] = pageStart;\r\n        p['$pageSize'] = pageSize;\r\n        let ret = await this.post('history/' + name, p);\r\n        return ret;\r\n    }\r\n*/\r\n    /*async user():Promise<any> {\r\n        return await this.get('user');\r\n    }*/\r\n}\r\n\r\nlet channels:{[unitId:number]: HttpChannel} = {};\r\n\r\nexport function logoutUnitxApis() {\r\n    channels = {};\r\n}\r\n\r\nexport class UnitxApi extends UqApi {\r\n    private unitId:number;\r\n    constructor(unitId:number) {\r\n        super('tv/', undefined, undefined, undefined, undefined, undefined, true);\r\n        this.unitId = unitId;\r\n    }\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        let channel = channels[this.unitId];\r\n        if (channel !== undefined) return channel;\r\n        return channels[this.unitId] = await this.buildChannel();\r\n    }\r\n\r\n    private async buildChannel():Promise<HttpChannel> {\r\n        let channelUI = new HttpChannelNavUI();\r\n        let centerAppApi = new CenterAppApi('tv/', undefined);\r\n        let ret = await centerAppApi.unitxUq(this.unitId);\r\n        let {token, db, url, urlTest} = ret;\r\n        let realUrl = host.getUrlOrTest(db, url, urlTest);\r\n        this.token = token;\r\n        return new UqHttpChannel(realUrl, token, channelUI);\r\n    }\r\n}\r\n\r\nlet centerHost:string;\r\n\r\nexport function setCenterUrl(url:string) {\r\n    console.log('setCenterUrl %s', url);\r\n    centerHost = url;\r\n    //centerToken = undefined;\r\n    centerChannel = undefined;\r\n    centerChannelUI = undefined;\r\n}\r\n\r\nexport let centerToken:string|undefined = undefined;\r\n\r\nlet loginedUserId:number = 0;\r\nexport function setCenterToken(userId:number, t?:string) {\r\n    loginedUserId = userId;\r\n    centerToken = t;\r\n    console.log('setCenterToken %s', t);\r\n    centerChannel = undefined;\r\n    centerChannelUI = undefined;\r\n}\r\n\r\nlet centerChannelUI:HttpChannel;\r\nlet centerChannel:HttpChannel;\r\nfunction getCenterChannelUI():HttpChannel {\r\n    if (centerChannelUI !== undefined) return centerChannelUI;\r\n    return centerChannelUI = new CenterHttpChannel(centerHost, centerToken, new HttpChannelNavUI());\r\n}\r\nfunction getCenterChannel():HttpChannel {\r\n    if (centerChannel !== undefined) return centerChannel;\r\n    return centerChannel = new CenterHttpChannel(centerHost, centerToken);\r\n}\r\n\r\nexport abstract class CenterApiBase extends ApiBase {\r\n    /*\r\n    constructor(path: string, showWaiting?: boolean) {\r\n        super(path, showWaiting);\r\n    }*/\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        return (this.showWaiting === true || this.showWaiting === undefined)?\r\n            getCenterChannelUI():\r\n            getCenterChannel();\r\n    }\r\n}\r\n\r\nconst uqTokensName = 'uqTokens';\r\nexport class UqTokenApi extends CenterApiBase {\r\n    private localMap: LocalMap = env.localDb.map(uqTokensName);\r\n\r\n    async uq(params: {unit:number, uqOwner:string, uqName:string, appOwner:string, appName:string}):Promise<any> {\r\n        let {uqOwner, uqName} = params;\r\n        let un = uqOwner+'/'+uqName;\r\n        let localCache = this.localMap.child(un);\r\n        try {\r\n            let uqToken:UqLocal = localCache.get();\r\n            if (uqToken !== undefined) {\r\n                let {unit, user} = uqToken;\r\n                if (unit !== params.unit || user !== loginedUserId) {\r\n                    localCache.remove();\r\n                    uqToken = undefined;\r\n                }\r\n            }\r\n            let nowTick = Math.floor(Date.now() / 1000);\r\n            if (uqToken !== undefined) {\r\n                let {tick, value} = uqToken;\r\n                if (value !== undefined && (nowTick - tick) < 24*3600) {\r\n                    return _.clone(value);\r\n                }\r\n            }\r\n            let appUqParams:any = _.clone(params);\r\n            appUqParams.testing = host.testing;\r\n            let ret = await this.get('app-uq', appUqParams);\r\n            if (ret === undefined) {\r\n                let {unit, uqOwner, uqName} = params;\r\n                let err = `center get app-uq(unit=${unit}, '${uqOwner}/${uqName}') - not exists or no unit-service`;\r\n                throw err;\r\n            }\r\n\r\n            uqToken = {\r\n                unit: params.unit,\r\n                user: loginedUserId,\r\n                tick: nowTick,\r\n                value: ret,\r\n            }\r\n            localCache.set(uqToken);\r\n            return _.clone(ret);\r\n        }\r\n        catch (err) {\r\n            localCache.remove();\r\n            throw err;\r\n        }\r\n    }\r\n}\r\n\r\nexport const uqTokenApi = new UqTokenApi('tv/tie/', undefined);\r\n\r\nexport class CallCenterApi extends CenterApiBase {\r\n    directCall(url:string, method:string, body:any):Promise<any> {\r\n        return this.call(url, method, body);\r\n    }\r\n}\r\nexport const callCenterapi = new CallCenterApi('', undefined);\r\n\r\nexport interface UqAppData {\r\n    appName: string;\r\n    appOwner: string;\r\n    id: number;\r\n    version: string;        // AppUI version\r\n    uqs: UqData[];\r\n}\r\n\r\nexport interface UqData {\r\n    id: number;\r\n    uqOwner: string;\r\n    uqName: string;\r\n    access: string;\r\n    newVersion: boolean;\r\n}\r\n\r\nexport interface UqServiceData {\r\n    id: number;\r\n    db: string;\r\n    url: string;\r\n    urlTest: string;\r\n    token: string;\r\n}\r\n\r\n//const appUqsName = 'appUqs';\r\n\r\nexport class CenterAppApi extends CenterApiBase {\r\n    //private local: LocalCache = env.localDb.item(appUqsName);\r\n    //private cachedUqs: UqAppData;\r\n    async uqs(appOwner:string, appName:string):Promise<UqAppData> {\r\n        let ret:UqAppData = await this.get('tie/app-uqs', {appOwner:appOwner, appName:appName});\r\n        return ret;\r\n        /*\r\n        let ret:UqAppData;\r\n        let appUqs = this.local.get();\r\n        if (appUqs) {\r\n            let {appOwner:rAppOwner, appName:rAppName} = appUqs;\r\n            if (appOwner === rAppOwner && appName === rAppName) ret = appUqs;\r\n        }\r\n        if (ret === undefined) {\r\n            ret = await this.uqsPure(appOwner, appName);\r\n            ret.appName = appName;\r\n            ret.appOwner = appOwner;\r\n            //localStorage.setItem(JSON.stringify(obj));\r\n            this.local.set(ret);\r\n        }\r\n        //return this.cachedUqs = _.cloneDeep(ret);\r\n        return ret;\r\n        */\r\n    }\r\n    private async uqsPure(appOwner:string, appName:string):Promise<UqAppData> {\r\n        return await this.get('tie/app-uqs', {appOwner:appOwner, appName:appName});\r\n    }\r\n    /*\r\n    private async isOkCheckUqs(appOwner:string, appName:string):Promise<boolean> {\r\n        let ret = await this.uqsPure(appOwner, appName);\r\n        let {id:cachedId, uqs:cachedUqs} = this.local.get(); //.cachedUqs;\r\n        let {id:retId, uqs:retUqs} = ret;\r\n        if (cachedId !== retId) return false;\r\n        if (cachedUqs.length !== retUqs.length) return false;\r\n        let len = cachedUqs.length;\r\n        for (let i=0; i<len; i++) {\r\n            if (_.isMatch(cachedUqs[i], retUqs[i]) === false) return false;\r\n        }\r\n        return true;\r\n    }\r\n    async checkUqs(appOwner:string, appName:string):Promise<boolean> {\r\n        let ret = await this.isOkCheckUqs(appOwner, appName);\r\n        if (ret === false) {\r\n            this.local.remove();\r\n            nav.start();\r\n        }\r\n        return ret;\r\n    }\r\n    */\r\n    async unitxUq(unit:number):Promise<UqServiceData> {\r\n        return await this.get('tie/unitx-uq', {unit:unit});\r\n    }\r\n    async changePassword(param: {orgPassword:string, newPassword:string}) {\r\n        return await this.post('tie/change-password', param);\r\n    }\r\n}\r\n\r\nexport async function loadAppUqs(appOwner:string, appName:string): Promise<UqAppData> {\r\n    let centerAppApi = new CenterAppApi('tv/', undefined);\r\n    //let unit = meInFrame.unit;\r\n    let ret = await centerAppApi.uqs(appOwner, appName);\r\n    //await centerAppApi.checkUqs(appOwner, appName);\r\n    /*\r\n    .then(v => {\r\n        if (v === false) {\r\n            localStorage.removeItem(appUqs);\r\n            nav.start();\r\n        }\r\n    });\r\n    */\r\n    return ret;\r\n}\r\n\r\n//import { nav } from '../ui';\r\n\r\nexport interface RegisterParameter {\r\n    nick:string, \r\n    user:string, \r\n    pwd:string,\r\n    country:number, \r\n    mobile:number, \r\n    mobileCountry:number,\r\n    email:string,\r\n    verify:string,\r\n};\r\n\r\nexport class UserApi extends CenterApiBase {\r\n    async login(params: {user: string, pwd: string, guest: number}): Promise<any> {\r\n        //(params as any).device = nav.local.device.get();\r\n        let ret = await this.get('user/login', params);\r\n        switch (typeof ret) {\r\n            default: return;\r\n            case 'string': return decodeUserToken(ret);\r\n            case 'object':\r\n                let token = ret.token;\r\n                let user = decodeUserToken(token);\r\n                let {nick, icon} = ret;\r\n                if (nick) user.nick = nick;\r\n                if (icon) user.icon = icon;\r\n                return user;\r\n        }\r\n        // !== undefined) return decodeToken(token);\r\n    }\r\n    async register(params: RegisterParameter): Promise<any>\r\n    {\r\n        return await this.post('user/register', params);\r\n    }\r\n\r\n    async sendVerify(account:string, type:'mobile'|'email', oem:string) {\r\n        return await this.post('user/set-verify', {account:account, type:type, oem:oem});\r\n    }\r\n\r\n    async checkVerify(account:string, verify:string) {\r\n        return await this.post('user/check-verify', {account:account, verify:verify});\r\n    }\r\n\r\n    async isExists(account:string) {\r\n        return await this.get('user/is-exists', {account:account});\r\n    }\r\n\r\n    async resetPassword(account:string, password:string, verify:string, type:'mobile'|'email'):Promise<any[]> {\r\n        return await this.post('user/reset-password', {account:account, password, verify, type});\r\n    }\r\n    \r\n    async userSetProp(prop:string, value:any) {\r\n        await this.post('tie/user-set-prop', {prop:prop, value:value});\r\n    }\r\n\r\n    async me():Promise<any> {\r\n        return await this.get('tie/me');\r\n    }\r\n\r\n    async user(id:number): Promise<any> {\r\n        return await this.get('tie/user', {id:id});\r\n\t}\r\n\t\r\n\tasync fromKey(key:string): Promise<{id:number, name:string, nick:string, icon:string}> {\r\n\t\treturn await this.get('tie/user-from-key', {key});\r\n\t}\r\n}\r\n\r\nexport const userApi = new UserApi('tv/', undefined);\r\n","\r\nlet subAppWindow:Window;\r\nfunction postWsToSubApp(msg:any) {\r\n    if (subAppWindow === undefined) return;\r\n    subAppWindow.postMessage({\r\n        type: 'ws',\r\n        msg: msg\r\n    }, '*');\r\n}\r\n\r\nexport function setSubAppWindow(win:Window) {\r\n    subAppWindow = win;\r\n}\r\n\r\nexport function postWsToTop(msg:any) {\r\n    window.top.postMessage({\r\n        type: 'ws',\r\n        msg: msg\r\n    }, '*');\r\n}\r\n\r\nexport abstract class WsBase {\r\n    wsBaseId:string;\r\n    private handlerSeed = 1;\r\n    private anyHandlers:{[id:number]:(msg:any)=>Promise<void>} = {};\r\n    private msgHandlers:{[id:number]:{type:string, handler:(msg:any)=>Promise<void>}} = {};\r\n    onWsReceiveAny(handler:(msg:any)=>Promise<void>):number {\r\n        let seed = this.handlerSeed++;\r\n        this.anyHandlers[seed] = handler;\r\n        return seed;\r\n    }\r\n    onWsReceive(type:string, handler:(msg:any)=>Promise<void>):number {\r\n        let seed = this.handlerSeed++;\r\n        this.msgHandlers[seed] = {type:type, handler: handler};\r\n        return seed;\r\n    }\r\n    endWsReceive(handlerId:number) {\r\n        delete this.anyHandlers[handlerId];\r\n        delete this.msgHandlers[handlerId];\r\n    }\r\n    async receive(msg:any) {\r\n        let {$type} = msg;\r\n        for (let i in this.anyHandlers) {\r\n            await this.anyHandlers[i](msg);\r\n        }\r\n        for (let i in this.msgHandlers) {\r\n            let {type, handler} = this.msgHandlers[i];\r\n            if (type !== $type) continue;\r\n            await handler(msg);\r\n        }\r\n    }\r\n}\r\n\r\nlet wsBaseSeed = 1;\r\nexport class WsBridge extends WsBase {\r\n    wsBaseId:string = 'WsBridge seed ' + wsBaseSeed++;\r\n}\r\n\r\nexport const wsBridge = new WsBridge();\r\n\r\nexport class WSChannel extends WsBase {\r\n    wsBaseId:string = 'WSChannel seed ' + wsBaseSeed++;\r\n    static centerToken:string;\r\n    private wsHost: string;\r\n    private token: string;\r\n    private ws: WebSocket;\r\n\r\n    constructor(wsHost: string, token: string) {\r\n        super();\r\n        this.wsHost = wsHost;\r\n        this.token = token;\r\n    }\r\n\r\n    static setCenterToken(token?: string) {\r\n        WSChannel.centerToken = token;\r\n    }\r\n    \r\n    connect():Promise<void> {\r\n        //this.wsHost = wsHost;\r\n        //this.token = token || WSChannel.centerToken;\r\n        if (this.ws !== undefined) return;\r\n        let that = this;\r\n        return new Promise((resolve, reject) => {\r\n            let ws = new WebSocket(this.wsHost, this.token || WSChannel.centerToken);\r\n            console.log('connect webSocket %s', this.wsHost);\r\n            ws.onopen = (ev) => {\r\n                console.log('webSocket connected %s', this.wsHost);\r\n                that.ws = ws;\r\n                resolve();\r\n            };\r\n            ws.onerror = (ev) => {\r\n                reject('webSocket can\\'t open!');\r\n            };\r\n            ws.onmessage = async (msg) => await that.wsMessage(msg);\r\n            ws.onclose = (ev) => {\r\n                that.ws = undefined;\r\n                console.log('webSocket closed!');\r\n            }\r\n        });\r\n    }\r\n    close() {\r\n        if (this.ws !== undefined) {\r\n            this.ws.close();\r\n            this.ws = undefined;\r\n        }\r\n    }\r\n    private async wsMessage(event:any):Promise<void> {\r\n        try {\r\n            console.log('websocket message: %s', event.data);\r\n            let msg = JSON.parse(event.data);\r\n            postWsToSubApp(msg);\r\n            await this.receive(msg);\r\n        }\r\n        catch (err) {\r\n            console.log('ws msg error: ', err);\r\n        }\r\n    }\r\n    sendWs(msg:any) {\r\n        let netThis = this;\r\n        this.connect().then(() => {\r\n            netThis.ws.send(msg);\r\n        });\r\n    }\r\n}\r\n","import _ from 'lodash';\r\n\r\nexport interface KeyValueRes {\r\n    [key:string]: any;\r\n}\r\n\r\nexport interface Res<T extends KeyValueRes> {\r\n    [lang:string]: T | {[district:string]: T};\r\n}\r\n\r\nexport const resOptions:{\r\n\tlang: string;\r\n\t$lang: string;\r\n\tdistrict: string;\r\n\t$district: string;\r\n} = {\r\n\tlang: undefined,\r\n\t$lang: undefined,\r\n\tdistrict: undefined,\r\n\t$district: undefined,\r\n}\r\n\r\nexport function setResOptions(lang:string, district:string) {\r\n\tresOptions.lang = lang;\r\n\tresOptions.$lang = '$' + lang;\r\n    resOptions.district = district;\r\n    resOptions.$district = '$' + district;\r\n}\r\n\r\n(function() {\r\n    let lang: string, district: string;\r\n    let language = (navigator.languages && navigator.languages[0])  // Chrome / Firefox\r\n        || navigator.language; // ||   // All browsers\r\n    //navigator.userLanguage; // IE <= 10\r\n    if (!language) {\r\n        lang = 'zh';\r\n        district = 'CN';\r\n    }\r\n    else {\r\n        let parts = language.split('-');\r\n        lang = parts[0];\r\n        if (parts.length > 1) district = parts[1].toUpperCase();\r\n    }\r\n    setResOptions(lang, district);\r\n}());\r\n\r\nexport function resLang<T extends KeyValueRes>(res:Res<T>):T {\r\n    let {lang, district} = resOptions;\r\n    let ret:T = {} as T;\r\n    if (res === undefined) return ret;\r\n    _.merge(ret, res._);\r\n    let l = res[lang];\r\n    if (l === undefined) return ret;\r\n    _.merge(ret, l._);\r\n    let d = l[district];\r\n    if (d === undefined) return ret;\r\n    _.merge(ret, d);\r\n    let {entity} = ret;\r\n    if (entity !== undefined) {\r\n        for (let i in entity) {\r\n            entity[i.toLowerCase()] = entity[i];\r\n        }\r\n    }\r\n    return ret;\r\n}\r\n\r\nconst resGlobal:any = {};\r\nexport function setRes(target: any, res: any):(str:string)=>any {\r\n\tif (res === undefined) return;\r\n\tlet {$lang, $district} = resOptions;\r\n\t_.merge(target, res);\r\n\tif ($lang !== undefined) {\r\n\t\tlet l = res[$lang];\r\n\t\tif (l !== undefined) {\r\n\t\t\t_.merge(target, l);\r\n\t\t\tlet d = l[$district];\r\n\t\t\tif (d !== undefined) {\r\n\t\t\t\t_.merge(target, d);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn function(str:string) {\r\n\t\treturn target[str] || str;\r\n\t}\r\n}\r\nexport function setGlobalRes(res: any) {\r\n\tsetRes(resGlobal, res);\r\n}\r\nexport function t(str:string):any {\r\n\treturn resGlobal[str] || str;\r\n}\r\n","import * as React from 'react';\r\nimport _ from 'lodash';\r\nimport {nav, Page, resOptions} from '../components';\r\nimport { User, env } from '../tool';\r\nimport { VPage } from './vpage';\r\nimport { View } from './view';\r\n\r\nexport interface ConfirmOptions {\r\n    caption?: string;\r\n    message: string | JSX.Element;\r\n    classNames?: string;\r\n    ok?: string;\r\n    yes?: string;\r\n    no?: string;\r\n}\r\n\r\nexport abstract class Controller {\r\n    readonly res: any;\r\n\treadonly x: any;\r\n\tprivate _t: any = {};\r\n\treadonly t: (str:string)=>any;\r\n    icon: string|JSX.Element;\r\n    label:string;\r\n    readonly isDev:boolean = env.isDevelopment;\r\n    get user():User {return nav.user}\r\n    get isLogined():boolean {\r\n        let {user} = nav;\r\n        if (user === undefined) return false;\r\n        return user.id > 0;\r\n    }\r\n    constructor(res:any) {\r\n        this.res = res || {};\r\n\t\tthis.x = this.res.x || {};\r\n\t\tthis.t = (str:string):any => this.internalT(str) || str;\r\n\t}\r\n\r\n\tinit(param?: any) {}\r\n\r\n\tinternalT(str:string):any {\r\n\t\treturn this._t[str];\r\n\t}\r\n\t\r\n\tprotected setRes(res:any) {\r\n\t\tif (res === undefined) return;\r\n\t\tlet {$lang, $district} = resOptions;\r\n\t\t_.merge(this._t, res);\r\n\t\tif ($lang !== undefined) {\r\n\t\t\tlet l = res[$lang];\r\n\t\t\tif (l !== undefined) {\r\n\t\t\t\t_.merge(this._t, l);\r\n\t\t\t\tlet d = l[$district];\r\n\t\t\t\tif (d !== undefined) {\r\n\t\t\t\t\t_.merge(this._t, d);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\t\t\r\n\t}\r\n\r\n    private receiveHandlerId:number;\r\n    private disposer:()=>void;\r\n\r\n    private dispose = () => {\r\n        // message listener的清理\r\n        nav.unregisterReceiveHandler(this.receiveHandlerId);\r\n        this.onDispose();\r\n    }\r\n\r\n    protected onDispose() {\r\n    }\r\n\r\n\tisMe(id:any):boolean {\r\n\t\tif (id === null) return false;\r\n\t\tlet {user} = this;\r\n\t\tlet userId = user.id;\r\n\t\tswitch (typeof id) {\r\n\t\t\tdefault: return false;\r\n\t\t\tcase 'string': return Number(id) === userId;\r\n\t\t\tcase 'number': return id === userId;\r\n\t\t\tcase 'object': return id.id === userId;\r\n\t\t}\r\n\t}\r\n\r\n    protected async openVPage<C extends Controller>(vp: new (controller: C)=>VPage<C>, param?:any, afterBack?:(ret:any)=>void):Promise<void> {\r\n        await (new vp((this as any) as C)).open(param, afterBack);\r\n    }\r\n\r\n    protected renderView<C extends Controller>(view: new (controller: C)=>View<C>, param?:any) {\r\n        return (new view((this as any) as C)).render(param);\r\n    }\r\n\r\n    async event(type:string, value:any) {\r\n        await this.onEvent(type, value);\r\n    }\r\n\r\n    protected async onEvent(type:string, value:any) {\r\n    }\r\n\r\n    protected msg(text:string) {\r\n        alert(text);\r\n    }\r\n    protected errorPage(header:string, err:any) {\r\n        this.openPage(<Page header=\"App error!\">\r\n            <pre>\r\n                {typeof err === 'string'? err : err.message}\r\n            </pre>\r\n        </Page>);\r\n    }\r\n\r\n    protected onMessage(message:any):Promise<void> {\r\n        return;\r\n    }\r\n\r\n    private onMessageReceive = async (message:any):Promise<void> => {\r\n        await this.onMessage(message);\r\n    }\r\n\r\n    protected async beforeStart():Promise<boolean> {\r\n        /*\r\n        console.log('this.receiveHandlerId = nav.registerReceiveHandler(this.onMessageReceive);');\r\n        this.receiveHandlerId = nav.registerReceiveHandler(this.onMessageReceive);\r\n        console.log('return true');\r\n        */\r\n        return true;\r\n\t}\r\n\tprotected async afterStart():Promise<void> {\r\n\t}\r\n    protected registerReceiveHandler() {\r\n        this.receiveHandlerId = nav.registerReceiveHandler(this.onMessageReceive);\r\n    }\r\n\r\n    protected abstract internalStart(param?:any, ...params:any[]):Promise<void>;\r\n    async start(param?:any, ...params:any[]):Promise<void> {\r\n        this.disposer = this.dispose;\r\n\t\tthis.registerReceiveHandler();\r\n        let ret = await this.beforeStart();\r\n        if (ret === false) return;\r\n\t\tawait this.internalStart(param, ...params);\r\n\t\tawait this.afterStart();\r\n    }\r\n\r\n    get isCalling():boolean {return this._resolve_$ !== undefined}\r\n\r\n    private _resolve_$:((value:any) => void)[];\r\n    async call<T>(param?:any, ...params:any[]):Promise<T> {\r\n        if (this._resolve_$ === undefined) this._resolve_$ = [];\r\n        return new Promise<T> (async (resolve, reject) => {\r\n            this._resolve_$.push(resolve);\r\n            await this.start(param, ...params);\r\n        });\r\n    }\r\n\r\n    async vCall<C extends Controller>(vp: new (controller: C)=>VPage<C>, param?:any):Promise<any> {\r\n        if (this._resolve_$ === undefined) this._resolve_$ = [];\r\n        return new Promise<any> (async (resolve, reject) => {\r\n            this._resolve_$.push(resolve);\r\n            await (new vp(this as any)).open(param);\r\n        });\r\n    }\r\n\r\n    returnCall(value:any) {\r\n        if (this._resolve_$ === undefined) return;\r\n        let resolve = this._resolve_$.pop();\r\n        if (resolve === undefined) {\r\n            alert('the Controller call already returned, or not called');\r\n            return;\r\n        }\r\n        resolve(value);\r\n    }\r\n\r\n    openPage(page:JSX.Element, onClosePage?: ()=>void) {\r\n\t\tlet disposer: ()=>void;\r\n\t\tif (onClosePage !== undefined) {\r\n\t\t\tdisposer = () => {\r\n\t\t\t\tif (this.disposer) this.disposer();\r\n\t\t\t\tonClosePage();\r\n\t\t\t}\r\n\t\t}\r\n\r\n        nav.push(page, disposer);\r\n        this.disposer = undefined;\r\n    }\r\n\r\n    replacePage(page:JSX.Element) {\r\n        nav.replace(page, this.disposer);\r\n        this.disposer = undefined;\r\n    }\r\n\r\n    backPage() {\r\n        nav.back();\r\n    }\r\n\r\n    closePage(level?:number) {\r\n        nav.pop(level);\r\n    }\r\n\r\n    ceasePage(level?:number) {\r\n        nav.ceaseTop(level);\r\n\t}\r\n\t\r\n\tgo(showPage:()=>void, url:string, absolute?:boolean) {\r\n\t\tnav.go(showPage, url, absolute);\r\n\t}\r\n\r\n    removeCeased() {\r\n        nav.removeCeased();\r\n    }\r\n\r\n    regConfirmClose(confirmClose: ()=>Promise<boolean>) {\r\n        nav.regConfirmClose(confirmClose);\r\n\t}\r\n\r\n\tprivate topPageKey:any;\r\n\tprotected startAction() {\r\n\t\tthis.topPageKey = nav.topKey();\r\n\t}\r\n\tpublic popToTopPage() {\r\n\t\tnav.popTo(this.topPageKey);\r\n\t}\r\n\r\n    async confirm(options: ConfirmOptions): Promise<'ok'|'yes'|'no'|undefined> {\r\n        return new Promise<'ok'|'yes'|'no'|undefined> (async (resolve, reject) => {\r\n            let {caption, message, ok, yes, no, classNames} = options;\r\n            let close = (res:'ok'|'yes'|'no'|undefined) => {\r\n                this.closePage();\r\n                resolve(res);\r\n            }\r\n            let buttons:any[] = [];\r\n            if (ok !== undefined) {\r\n                buttons.push(<button key=\"ok\" className=\"btn btn-primary mr-3\" onClick={()=>close('ok')}>{ok}</button>);\r\n            }\r\n            if (yes !== undefined) {\r\n                buttons.push(<button key=\"yes\" className=\"btn btn-success mr-3\" onClick={()=>close('yes')}>{yes}</button>);\r\n            }\r\n            if (no !== undefined) {\r\n                buttons.push(<button key=\"no\" className=\"btn btn-outline-danger mr-3\" onClick={()=>close('no')}>{no}</button>);\r\n            }\r\n            this.openPage(<Page header={caption || '请确认'} back=\"close\">\r\n                <div className={classNames || \"rounded bg-white m-5 p-3 border\"}>\r\n                    <div className=\"d-flex align-items-center justify-content-center\">\r\n                        {message}\r\n                    </div>\r\n                    <div className=\"mt-3 d-flex align-items-center justify-content-center\">\r\n                        {buttons}\r\n                    </div>\r\n                </div>\r\n            </Page>);\r\n            nav.regConfirmClose(async ():Promise<boolean> => {\r\n                resolve(undefined);\r\n                return true;\r\n            });\r\n        });\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { Page, Image, UserView } from '../components';\r\nimport { env, User } from '../tool';\r\nimport { Controller } from './controller';\r\nimport { VPage } from './vpage';\r\n\r\nexport abstract class View<C extends Controller> {\r\n    protected controller: C;\r\n    protected readonly res: any;\r\n\tprotected readonly x: any;\r\n\tprotected readonly t: (str:string)=>any;\r\n\r\n    constructor(controller: C) {\r\n        this.controller = controller;\r\n        this.res = controller.res;\r\n\t\tthis.x = controller.x;\r\n\t\tthis.t = controller.t;\r\n    }\r\n\r\n\tprotected get isDev() {return  env.isDevelopment}\r\n\tprotected isMe(id:any) {return this.controller.isMe(id)}\r\n    abstract render(param?:any): JSX.Element;\r\n\r\n    protected renderVm(vm: new (controller: C)=>View<C>, param?:any) {\r\n        return (new vm(this.controller)).render(param);\r\n    }\r\n\r\n    protected async openVPage(vp: new (controller: C)=>VPage<C>, param?:any, afterBack?:()=>Promise<void>):Promise<void> {\r\n        await (new vp(this.controller)).open(param, afterBack);\r\n    }\r\n\r\n    protected async event(type:string, value?:any) {\r\n        await this.controller.event(type, value);\r\n\t}\r\n\t\r\n\tprotected go(showPage:()=>void, url:string, absolute?:boolean) {\r\n\t\tthis.controller.go(showPage, url, absolute);\r\n\t}\r\n\r\n    async vCall<C extends Controller>(vp: new (controller: C)=>VPage<C>, param?:any):Promise<any> {\r\n        return await this.controller.vCall(vp, param);\r\n    }\r\n\r\n    protected returnCall(value:any) {\r\n        this.controller.returnCall(value);\r\n    }\r\n\r\n\tprotected renderUser(user:any, imageClassName?:string, textClassName?:string) {\r\n\t\tlet renderUser = (user:User) => {\r\n\t\t\tlet {name, nick, icon} = user;\r\n\t\t\treturn <>\r\n\t\t\t\t<Image src={icon} className={imageClassName || 'w-1c h-1c mr-2'} />\r\n\t\t\t\t<span className={textClassName}>{nick || name}</span>\r\n\t\t\t</>;\r\n\t\t}\r\n\t\treturn <UserView user={user} render={renderUser} />\r\n\t}\r\n\r\n\tprotected renderUserText(user:any) {\r\n\t\tlet renderUser = (user:User) => {\r\n\t\t\tlet {name, nick} = user;\r\n\t\t\treturn <>{nick || name}</>;\r\n\t\t}\r\n\t\treturn <UserView user={user} render={renderUser} />\r\n\t}\r\n\r\n\tprotected renderMe(imageClassName?:string, textClassName?:string) {\r\n\t\tlet {user} = this.controller;\r\n\t\tif (!user) return;\r\n\t\treturn this.renderUser(user.id, imageClassName, textClassName);\r\n\t}\r\n\r\n    protected openPage(view: React.StatelessComponent<any>, param?:any) {\r\n        let type = typeof param;\r\n        if (type === 'object' || type === 'undefined') {\r\n            this.controller.openPage(React.createElement(view, param));\r\n        }\r\n        else {\r\n            this.controller.openPage(<Page header=\"param type error\">\r\n                View.openPage param must be object, but here is {type}\r\n            </Page>);\r\n        }\r\n    }\r\n\r\n    protected replacePage(view: React.StatelessComponent<any>, param?:any) {\r\n        this.controller.replacePage(React.createElement(view, param));\r\n    }\r\n\r\n    protected openPageElement(page: JSX.Element, onClosePage?: ()=>void) {\r\n        this.controller.openPage(page, onClosePage);\r\n    }\r\n\r\n    protected replacePageElement(page: JSX.Element) {\r\n        this.controller.replacePage(page);\r\n    }\r\n\r\n    protected backPage() {\r\n        this.controller.backPage();\r\n    }\r\n\r\n    protected closePage(level?:number) {\r\n        this.controller.closePage(level);\r\n    }\r\n\r\n    protected ceasePage(level?:number) {\r\n        this.controller.ceasePage(level);\r\n    }\r\n\r\n    protected removeCeased() {\r\n        this.controller.removeCeased();\r\n    }\r\n\r\n    protected regConfirmClose(confirmClose: ()=>Promise<boolean>) {\r\n        this.controller.regConfirmClose(confirmClose);\r\n\t}\r\n\r\n\tprotected popToTopPage() {\r\n\t\tthis.controller.popToTopPage();\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { Page, Scroller, TabsProps } from \"../components\";\r\nimport { View } from \"./view\";\r\nimport { Controller } from \"./controller\";\r\n\r\nexport abstract class VPage<C extends Controller> extends View<C> {\r\n\tprotected retOnClosePage: any;\r\n\r\n    open(param?:any, onClosePage?:(ret:any)=>void):Promise<void> {\r\n\t\tthis.init(param);\r\n\t\tlet _onClosePage: ()=>void;\r\n\t\tif (onClosePage !== undefined) _onClosePage = () => onClosePage(this.retOnClosePage);\r\n\t\tthis.openPageElement(this.renderPage(), _onClosePage);\r\n\t\treturn;\r\n\t}\r\n\r\n\trender(param?:any):JSX.Element {\r\n\t\tthis.init(param);\r\n\t\treturn this.renderPage();\r\n\t}\r\n\r\n\tinit(param?:any):void {return;}\r\n\r\n\theader():string|boolean|JSX.Element {return null;}\r\n\tright():JSX.Element {return null;}\r\n\tcontent():JSX.Element {return null;}\r\n\tfooter():JSX.Element {return null;}\r\n\tlogout(): boolean | (()=>Promise<void>) {return false;}\r\n\tprotected renderPage():JSX.Element {\r\n\t\tlet header = this.header();\r\n\t\tif (!header) header = false;\r\n\t\treturn <Page\r\n\t\t\theader={header} right={this.right()} footer={this.footer()}\r\n\t\t\tonScroll={(e:any)=>this.onPageScroll(e)}\r\n\t\t\tonScrollTop={(scroller: Scroller) => this.onPageScrollTop(scroller)}\r\n\t\t\tonScrollBottom={(scroller: Scroller) => this.onPageScrollBottom(scroller)}\r\n\t\t\tback={this.back}\r\n\t\t\theaderClassName={this.headerClassName}\r\n\t\t\tclassName={this.className}\r\n\t\t\tafterBack={()=>this.afterBack()}\r\n\t\t\ttabsProps={this.tabsProps}\r\n\t\t\tlogout={this.logout()}\r\n\t\t>\r\n\t\t\t{this.content()}\r\n\t\t</Page>;\r\n\t}\r\n\r\n\tprotected onPageScroll(e:any) {}\r\n\tprotected async onPageScrollTop(scroller: Scroller): Promise<boolean> {return false;}\r\n\tprotected async onPageScrollBottom(scroller: Scroller): Promise<void> {return;}\r\n\tprotected afterBack():void {}\r\n\tprotected get back(): 'close' | 'back' | 'none' {return 'back'}\r\n\tprotected get headerClassName(): string {return null;}\r\n\tprotected get className(): string {return null;}\r\n\tprotected get tabsProps(): TabsProps {return null;}\r\n}\r\n","export * from './uqMan';\r\nexport * from './entity';\r\nexport * from './action';\r\nexport * from './query';\r\nexport * from './sheet';\r\nexport * from './tuid';\r\nexport * from './book';\r\nexport * from './map';\r\nexport * from './history';\r\nexport * from './pending';\r\nexport * from './uqsMan';\r\nexport * from './tag/tag';\r\n","import _ from 'lodash';\r\nimport {observable, IObservableArray} from 'mobx';\r\nimport { PageItems } from '../tool';\r\nimport {Field, ArrFields} from './uqMan';\r\nimport {Entity} from './entity';\r\nimport { QueryQueryCaller, QueryPageCaller } from './caller';\r\n\r\nexport type QueryPageApi = (name:string, pageStart:any, pageSize:number, params:any) => Promise<string>;\r\n\r\nexport class QueryPager<T extends any> extends PageItems<T> {\r\n\tprivate query: Query;\r\n\tprivate $page: any;\r\n\tprotected idFieldName: any;\r\n    constructor(query: Query, pageSize?: number, firstSize?: number, itemObservable?:boolean) {\r\n        super(itemObservable);\r\n        this.query = query;\r\n        if (pageSize !== undefined) this.pageSize = pageSize;\r\n\t\tif (firstSize !== undefined) this.firstSize = firstSize;\r\n\t}\r\n\r\n\tsetReverse() {\r\n\t\tthis.appendPosition = 'head';\r\n\t}\r\n\r\n    protected async onLoad() {\r\n\t\tif (this.$page) return;\r\n        let {schema} = this.query;\r\n        if (schema === undefined) {\r\n\t\t\tawait this.query.loadSchema();\r\n\t\t\tschema = this.query.schema;\r\n\t\t}\r\n\t\tif (schema === undefined) return;\r\n\t\tlet $page = this.$page = (schema.returns as any[]).find(v => v.name === '$page');\r\n\t\tif ($page === undefined) return;\r\n\t\tthis.sortOrder = $page.order;\r\n\t\tlet fields = $page.fields;\r\n\t\tif (fields !== undefined) {\r\n\t\t\tlet field = fields[0];\r\n\t\t\tif (field) this.idFieldName = field.name;\r\n\t\t}\r\n    }\r\n\r\n    protected async loadResults(param:any, pageStart:number, pageSize:number):Promise<{[name:string]:any[]}> {\r\n\t\tlet ret = await this.query.page(param, pageStart, pageSize);\r\n\t\treturn ret;\r\n\t}\r\n\tprotected getPageId(item:T) {\r\n\t\tif (item === undefined) return;\r\n\t\tif (typeof item === 'number') return item;\r\n\t\tlet start = (item as any)[this.idFieldName];\r\n\t\tif (start === null) return;\r\n\t\tif (start === undefined) return;\r\n\t\tif (typeof start === 'object') {\r\n\t\t\tlet id = start.id;\r\n\t\t\tif (id !== undefined) return id;\r\n\t\t}\r\n\t\treturn start;\r\n\t}\r\n\tasync refreshItems(item:T) {\r\n\t\tlet index = this._items.indexOf(item);\r\n\t\tif (index < 0) return;\r\n\t\tlet startIndex:number;\r\n\t\tif (this.appendPosition === 'tail') {\r\n\t\t\tstartIndex = index - 1;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tstartIndex = index + 1;\r\n\t\t}\r\n\t\tlet pageStart = this.getPageId(this._items[startIndex]);\r\n\t\tlet pageSize = 1;\r\n        let ret = await this.load(\r\n\t\t\tthis.param, \r\n\t\t\tpageStart,\r\n\t\t\tpageSize);\r\n\t\tlet len = ret.length;\r\n\t\tif (len === 0) {\r\n\t\t\tthis._items.splice(index, 1);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tlet newItem = ret[i];\r\n\t\t\tif (!newItem) continue;\r\n\t\t\tlet newId = newItem[this.idFieldName];\r\n\t\t\tif (newId === undefined || newId === null) continue;\r\n\t\t\tif (typeof newId === 'object') newId = newId.id;\r\n\t\t\tlet oldItem = this._items.find(v => {\r\n\t\t\t\tlet oldId = (v as any)[this.idFieldName];\r\n\t\t\t\tif (oldId === undefined || oldId === null) return false;\r\n\t\t\t\tif (typeof oldId === 'object') oldId = oldId.id;\r\n\t\t\t\treturn oldId = newId;\r\n\t\t\t});\r\n\t\t\tif (oldItem) {\r\n\t\t\t\t_.merge(oldItem, newItem);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport class Query extends Entity {\r\n    get typeName(): string { return 'query';}\r\n    private pageStart: any;\r\n    private pageSize:number;\r\n    private params:any;\r\n    private more: boolean;\r\n    private startField: Field;\r\n    @observable list:IObservableArray; // = observable.array([], {deep: false});\r\n    returns: ArrFields[];\r\n    isPaged: boolean;\r\n\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {returns} = schema;\r\n        //this.returns = returns;\r\n        this.isPaged = returns && (returns as any[]).find(v => v.name === '$page') !== undefined;\r\n    }\r\n\r\n    resetPage(size:number, params:any) {\r\n        this.pageStart = undefined;\r\n        this.pageSize = size;\r\n        this.params = params;\r\n        this.more = false;\r\n        this.list = undefined;\r\n    }\r\n    get hasMore() {return this.more;}\r\n    async loadPage():Promise<void> {\r\n        if (this.pageSize === undefined) {\r\n            throw new Error('call resetPage(size:number, params:any) first');\r\n        }\r\n        let pageStart:any;\r\n        if (this.pageStart !== undefined) {\r\n            switch (this.startField.type) {\r\n                default: pageStart = this.pageStart; break;\r\n                case 'date':\r\n                case 'time':\r\n                case 'datetime': pageStart = (this.pageStart as Date).getTime(); break;\r\n            }\r\n        }\r\n\t\tlet ret = await this.page(this.params, pageStart, this.pageSize+1);\r\n\t\tlet page = ret.$page;\r\n        /*\r\n        await this.loadSchema();\r\n        let res = await this.tvApi.page(this.name, pageStart, this.pageSize+1, this.params);\r\n        let data = await this.unpackReturns(res);\r\n        let page = data['$page'] as any[];\r\n        */\r\n        this.list = observable.array([], {deep: false});\r\n        if (page !== undefined) {\r\n            if (page.length > this.pageSize) {\r\n                this.more = true;\r\n                page.pop();\r\n                let ret = this.returns.find(r => r.name === '$page');\r\n                this.startField = ret.fields[0];\r\n                this.pageStart = page[page.length-1][this.startField.name];\r\n            }\r\n            else {\r\n                this.more = false;\r\n            }\r\n            this.list.push(...page);\r\n        }\r\n        //this.loaded = true;\r\n    }\r\n\r\n    protected pageCaller(params: any, showWaiting: boolean = true): QueryPageCaller {\r\n        return new QueryPageCaller(this, params, showWaiting);\r\n    }\r\n\r\n    async page(params:any, pageStart:any, pageSize:number, showWaiting: boolean = true):Promise<{[name:string]:any[]}> {\r\n        /*\r\n        await this.loadSchema();\r\n        let res = await this.uqApi.page(this.name, pageStart, pageSize+1, this.buildParams(params));\r\n        */\r\n        let p = {pageStart:pageStart, pageSize:pageSize, params:params};\r\n        let res = await this.pageCaller(p, showWaiting).request();\r\n        //let data = this.unpackReturns(res);\r\n        //return data.$page;// as any[];\r\n        return res;\r\n    }\r\n    protected queryCaller(params: any, showWaiting: boolean = true): QueryQueryCaller {\r\n        return new QueryQueryCaller(this, params, showWaiting);\r\n    }\r\n    async query(params:any, showWaiting:boolean = true):Promise<any> {\r\n        /*\r\n        await this.loadSchema();\r\n        let res = await this.uqApi.query(this.name, this.buildParams(params));\r\n        */\r\n        let res = await this.queryCaller(params, showWaiting).request();\r\n        //let data = this.unpackReturns(res);\r\n        //return data;\r\n        return res;\r\n    }\r\n    async table(params:any, showWaiting:boolean = true): Promise<any[]> {\r\n        let ret = await this.query(params, showWaiting);\r\n        for (let i in ret) {\r\n            return ret[i];\r\n        }\r\n    }\r\n    async obj(params:any, showWaiting:boolean = true):Promise<any> {\r\n        let ret = await this.table(params, showWaiting);\r\n        if (ret.length > 0) return ret[0];\r\n    }\r\n    async scalar(params:any, showWaiting:boolean = true):Promise<any> {\r\n        let ret = await this.obj(params, showWaiting);\r\n        for (let i in ret) return ret[i];\r\n    }\r\n}\r\n","const ALPHABET = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\r\nconst ID_LENGTH = 8;\r\n\r\nexport function uid():string {\r\n    let len = ALPHABET.length;\r\n    let rtn = '';\r\n    for (let i = 0; i < ID_LENGTH; i++) {\r\n        rtn += ALPHABET.charAt(Math.floor(Math.random() * len));\r\n    }\r\n    return rtn;\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { nav } from './nav';\r\n\r\nexport interface ImageProps {\r\n    src: string;\r\n    className?: string;\r\n    style?: React.CSSProperties;\r\n    altImage?: string;\r\n}\r\n\r\nexport function Image(props: ImageProps) {\r\n    let {className, style, src, altImage} = props;\r\n    if (!src) {\r\n        return <div className={classNames(className, 'image-none')} style={style}>\r\n            <i className=\"fa fa-file-o\" />\r\n        </div>;\r\n    }\r\n    if (src.startsWith(':') === true) {\r\n        src = nav.resUrl + src.substr(1);\r\n    }\r\n    return <img src={src} className={className} alt=\"img\"\r\n        style={style}\r\n        onError={evt=>{\r\n            if (altImage) evt.currentTarget.src=altImage;\r\n            else evt.currentTarget.src = 'https://tv.jkchemical.com/imgs/0001.png';\r\n        }} />;\r\n}\r\n","import jwtDecode from 'jwt-decode';\r\n\r\nexport interface Unit {\r\n    id: number;\r\n    name: string;\r\n}\r\n\r\nexport interface Guest {\r\n    id: number;             // id = 0\r\n    guest: number;\r\n    token: string;\r\n}\r\n\r\nexport interface User extends Guest {\r\n    id: number;\r\n    name: string;\r\n    nick?: string;\r\n    icon?: string;\r\n}\r\n\r\nexport function decodeUserToken(token: string): User {\r\n    let ret:any = jwtDecode(token);\r\n    let user: User = {\r\n        id: ret.id,\r\n        name: ret.name,\r\n        guest: ret.guest,\r\n        token: token,\r\n    };\r\n    return user;\r\n}\r\n\r\nexport function decodeGuestToken(token: string): Guest {\r\n    let ret:any = jwtDecode(token);\r\n    let guest: Guest = {\r\n        id: 0,\r\n        guest: ret.guest,\r\n        token: token,\r\n    };\r\n    return guest;\r\n}\r\n","import { env } from '../tool';\r\n\r\nconst centerHost = process.env['REACT_APP_CENTER_HOST'];\r\nconst centerDebugHost = 'localhost:3000'; //'192.168.86.64';\r\nconst resHost = process.env['REACT_APP_RES_HOST'] || centerHost;\r\nconst resDebugHost = 'localhost:3015'; //'192.168.86.63';\r\nconst uqDebugHost = 'localhost:3015'; //'192.168.86.63';\r\nconst uqDebugBuilderHost = 'localhost:3009';\r\ninterface HostValue {\r\n    value: string;\r\n    local: boolean;\r\n}\r\nconst hosts:{[name:string]:HostValue} = {\r\n    centerhost: {\r\n        value: process.env['REACT_APP_CENTER_DEBUG_HOST'] || centerDebugHost, \r\n        local: false\r\n    },\r\n    reshost: {\r\n        value: process.env['REACT_APP_RES_DEBUG_HOST'] || resDebugHost,\r\n        local: false\r\n    },\r\n    uqhost: {\r\n        value: process.env['REACT_APP_UQ_DEBUG_HOST'] || uqDebugHost, \r\n        local: false\r\n    },\r\n    unitxhost: {\r\n        value: process.env['REACT_APP_UQ_DEBUG_HOST'] || uqDebugHost, \r\n        local: false\r\n    },\r\n    \"uq-build\": {\r\n        value: process.env['REACT_APP_UQ_DEBUG_BUILDER_HOST'] || uqDebugBuilderHost, \r\n        local: false\r\n    }\r\n}\r\n\r\nconst httpArr = ['https://', 'http://'];\r\nfunction isAbsoluteUrl(url:string):boolean {\r\n    for (let str of httpArr) {\r\n        if (url.startsWith(str) === true) return true;\r\n    }\r\n    return false;\r\n}\r\n\r\nfunction urlFromHost(host:string):string {\r\n    if (isAbsoluteUrl(host) === true) {\r\n        if (host.endsWith('/')) return host;\r\n        return host + '/';\r\n    }\r\n    return `http://${host}/`;\r\n}\r\n\r\nfunction centerUrlFromHost(host:string):string {\r\n    return urlFromHost(host);\r\n}\r\nfunction centerWsFromHost(host:string) {\r\n    let https = 'https://';\r\n    if (host.startsWith(https) === true) {\r\n        host = host.substr(https.length);\r\n        if (host.endsWith('/') === true) host = host.substr(0, host.length-1);\r\n        return 'wss://' + host + '/tv/';\r\n    }\r\n    return `ws://${host}/tv/`\r\n}\r\nexport function resUrlFromHost(host:string) {\r\n\tif (!host) return;\r\n    let url = urlFromHost(host);\r\n    return url + 'res/';\r\n}\r\n\r\nconst fetchOptions = {\r\n    method: \"GET\",\r\n    mode: \"no-cors\", // no-cors, cors, *same-origin\r\n    headers: {\r\n        \"Content-Type\": \"text/plain\"\r\n    },\r\n};\r\n\r\nclass Host {\r\n    testing: boolean;\r\n    url: string;\r\n    ws: string;\r\n    resHost: string;\r\n\r\n    async start(testing:boolean) {\r\n        this.testing = testing;\r\n        if (env.isDevelopment === true) {\r\n            await this.tryLocal();\r\n        }\r\n        let host = this.getCenterHost();\r\n        this.url = centerUrlFromHost(host);\r\n        this.ws = centerWsFromHost(host);\r\n        this.resHost = this.getResHost();\r\n    }\r\n\r\n    private debugHostUrl(host:string) {return `http://${host}/hello`}\r\n    private async tryLocal() {\r\n        let promises:PromiseLike<any>[] = [];\r\n        let hostArr:string[] = [];\r\n        for (let i in hosts) {\r\n            let hostValue = hosts[i];\r\n            let {value} = hostValue;\r\n            if (hostArr.findIndex(v => v === value) < 0) hostArr.push(value);\r\n        }\r\n\r\n        for (let host of hostArr) {\r\n            let fetchUrl = this.debugHostUrl(host);\r\n            promises.push(localCheck(fetchUrl));\r\n        }\r\n        let results = await Promise.all(promises);\r\n        let len = hostArr.length;\r\n        for (let i=0; i<len; i++) {\r\n            let local = results[i];\r\n            let host = hostArr[i];\r\n            for (let j in hosts) {\r\n                let hostValue = hosts[j];\r\n                if (hostValue.value === host) {\r\n                    hostValue.local = local;\r\n                }\r\n            }\r\n        }\r\n        /*\r\n        let p = 0;\r\n        for (let i in hosts) {\r\n            let hostValue = hosts[i];\r\n            hostValue.local = results[p];\r\n            ++p;\r\n        }\r\n        */\r\n    }\r\n\r\n    private getCenterHost():string {\r\n        let {value, local} = hosts.centerhost;\r\n        let hash = document.location.hash;\r\n        if (hash.includes('sheet_debug') === true) {\r\n            return value;\r\n        }\r\n        if (env.isDevelopment === true) {\r\n            if (local === true) return value;\r\n        }\r\n        return centerHost;\r\n    }\r\n\r\n    private getResHost():string {\r\n        let {value, local} = hosts.reshost;\r\n        let hash = document.location.hash;\r\n        if (hash.includes('sheet_debug') === true) {\r\n            return value;\r\n        }\r\n        if (env.isDevelopment === true) {\r\n            if (local === true) return value;\r\n        }\r\n        return resHost;\r\n    }\r\n\r\n    getUrlOrDebug(url:string, debugHost:string = 'uqhost'):string {\r\n        if (env.isDevelopment === false) return url;\r\n        let host = hosts[debugHost];\r\n        if (host === undefined) return url;\r\n        let {value, local} = host;\r\n        if (local === false) return url;\r\n        return `http://${value}/`;\r\n    }\r\n    getUrlOrTest(db:string, url:string, urlTest:string):string {\r\n\t\tlet path:string;\r\n\t\tif (!urlTest) {\r\n\t\t\turlTest = url;\r\n\t\t\tif (!urlTest) {\r\n\t\t\t\tconsole.error('no server set for ' + db);\r\n\t\t\t\tdebugger;\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n        if (this.testing === true) {\r\n            if (urlTest !== '-') url = urlTest;\r\n            path = 'uq/test/' + db + '/';\r\n        }\r\n        else {\r\n            path = 'uq/prod/' + db + '/';\r\n        }\r\n\t\turl = this.getUrlOrDebug(url);\r\n\t\tif (url.endsWith('/') === false) {\r\n\t\t\turl += '/';\r\n\t\t}\r\n        return url + path;\r\n    }\r\n\r\n    async localCheck(urlDebug: string):Promise<boolean> {\r\n        return await localCheck(urlDebug);\r\n    }\r\n}\r\n\r\nexport const host:Host = new Host();\r\n\r\n// 因为测试的都是局域网服务器，甚至本机服务器，所以一秒足够了\r\n// 网上找了上面的fetch timeout代码。\r\n// 尽管timeout了，fetch仍然继续，没有cancel\r\n\r\n// 实际上，一秒钟不够。web服务器会自动停。重启的时候，可能会比较长时间。也许两秒甚至更多。\r\n//const timeout = 2000;\r\nconst timeout = 200;\r\n\r\nfunction fetchLocalCheck(url:string):Promise<any> {\r\n    return new Promise((resolve, reject) => {\r\n      fetch(url, fetchOptions as any)\r\n      .then(v => {\r\n          v.text().then(resolve).catch(reject);\r\n      })\r\n      .catch(reject);\r\n      const e = new Error(\"Connection timed out\");\r\n      env.setTimeout('fetchLocalCheck', reject, timeout, e);\r\n    });\r\n}\r\n\r\nasync function localCheck(url:string):Promise<boolean> {\r\n    try {\r\n        await fetchLocalCheck(url);\r\n        return true;\r\n    }\r\n    catch (err) {\r\n        return false;\r\n    }\r\n}\r\n\r\n/*\r\nexport interface IUqForChannel {\r\n    uq: string;\r\n    uqVersion: number;\r\n}\r\n*/","import { Entity } from './entity';\r\nimport { ActionCaller } from './caller';\r\n\r\nexport class Action extends Entity {\r\n    get typeName(): string { return 'action';}\r\n    async submit(data:object, waiting: boolean = true) {\r\n\t\tlet caller = new ActionSubmitCaller(this, data)\r\n\t\tlet ret = await caller.request();\r\n\t\treturn ret;\r\n    }\r\n    async submitReturns(data:object):Promise<{[ret:string]:any[]}> {\r\n       return await new SubmitReturnsCaller(this, data).request();\r\n    }\r\n    async submitConvert(data:object) {\r\n        return await new SubmitConvertCaller(this, data).request();\r\n    }\r\n}\r\n\r\nexport class ActionSubmitCaller extends ActionCaller {\r\n    get path():string {return 'action/' + this.entity.name;}\r\n    buildParams():any {\r\n\t\treturn {data: this.entity.pack(this.params)}\r\n\t}\r\n}\r\n\r\nclass SubmitReturnsCaller extends ActionSubmitCaller {\r\n    get path():string {return 'action/' + this.entity.name + '/returns';}\r\n    xresult(res:any):any {\r\n        let {returns} = this.entity;\r\n        let len = returns.length;\r\n        let ret:{[r:string]:any[]} = {};\r\n        for (let i=0; i<len; i++) {\r\n            let retSchema = returns[i];\r\n            ret[retSchema.name] = res[i];\r\n        }\r\n        return ret;\r\n    }\r\n}\r\n\r\nclass SubmitConvertCaller extends ActionSubmitCaller {\r\n    get path():string {return 'action-convert/' + this.entity.name;}\r\n    buildParams():any {\r\n        return {\r\n            data: this.params\r\n        };\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport '../../css/va-lmr.css';\r\n\r\nexport interface LMRProps {\r\n    className?: string | string[];\r\n    left?: string|JSX.Element;\r\n    right?: string|JSX.Element;\r\n    onClick?: ()=>void;\r\n}\r\n\r\n@observer\r\nexport class LMR extends React.Component<LMRProps> {\r\n    render() {\r\n        let {className, left, children, right, onClick} = this.props;\r\n        let l, r;\r\n        if (left !== undefined) l = <header>{left}</header>;\r\n        if (right !== undefined) r = <footer>{right}</footer>;\r\n        let cursor;\r\n        if (onClick !== undefined) cursor = 'cursor-pointer';\r\n        return <div className={classNames('va-lmr', className, cursor)} onClick={onClick}>\r\n            {l}\r\n            <div>{children}</div>\r\n            {r}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport '../../css/va-badge.css';\r\n\r\nexport interface BadgeProps {\r\n    className?: string;\r\n    badge?: string|number;\r\n    size?: 'xs' | 'sm' | 'lg';\r\n    color?: 'secondary'|'success'|'danger'|'primary'|'info'|'warning';\r\n    badgeAlign?: 'left'|'center'|'right';\r\n    badgeVertical?: 'top'|'middle'|'bottom';\r\n}\r\n\r\n@observer\r\nexport class Badge extends React.Component<BadgeProps> {\r\n    render() {\r\n        let {className, badge, size, color, badgeAlign, badgeVertical, children} = this.props;\r\n        let cn = classNames(\r\n            className,\r\n            'va-badge',\r\n            size && 'va-badge-'+size,\r\n            'va-badge-' + (color||'secondary'),\r\n            badgeAlign && 'va-badg-'+badgeAlign,\r\n            badgeVertical && 'va-badg-'+badgeVertical,\r\n        );\r\n        let b;\r\n        if (badge) b = <b>{badge}</b>;\r\n        return <div className={cn}>\r\n            {children}\r\n            {b}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport interface FAProps {\r\n    name: string;\r\n    className?: string;\r\n    size?: 'lg'|'2x'|'3x'|'4x'|'5x';\r\n    spin?: boolean;\r\n    fixWidth?: boolean;\r\n    border?: boolean;\r\n    pull?: 'left'|'right';\r\n    pulse?: boolean;\r\n    rotate?: 90|180|270;\r\n    flip?: 'horizontal'|'vertical';\r\n    inverse?: boolean;\r\n}\r\n\r\nexport class FA extends React.Component<FAProps> {\r\n    render() {\r\n        let {name, className, size, spin, fixWidth, border, pull, pulse, rotate, flip, inverse} = this.props;\r\n        let cn = classNames(className, 'fa',\r\n            name && ('fa-' + name),\r\n            size && 'fa-'+size,\r\n            fixWidth && 'fa-fw',\r\n            border && 'fa-border',\r\n            pull && 'fa-pull-' + pull,\r\n            spin && 'fa-spin',\r\n            pulse && 'fa-pulse',\r\n            rotate && 'fa-rotate-' + rotate,\r\n            flip && 'fa-flip-' + flip,\r\n            inverse && 'fa-inverse',\r\n        );\r\n        return <i className={cn} />\r\n    }\r\n}\r\n\r\nexport interface StackedFAProps {\r\n    className?: string;\r\n    size?: 'lg',\r\n}\r\nexport class StackedFA extends React.Component<StackedFAProps> {\r\n    render() {\r\n        let {className, size, children} = this.props;\r\n        let cn = classNames(\r\n            'fa-stack',\r\n            className,\r\n            size && 'fa-' + size);\r\n        return <span className={cn}>\r\n            {children}\r\n        </span>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {FA} from './FA';\r\n\r\nexport interface IconTextProps {\r\n    icon: string;\r\n    iconClass?: string;\r\n    text: string;\r\n    textClass?: string;\r\n}\r\n\r\nexport class IconText extends React.Component<IconTextProps> {\r\n    render() {\r\n        let {icon, iconClass, text, textClass} = this.props;\r\n        return <div className=\"py-2\">\r\n            <FA className={iconClass} name={icon} fixWidth={true} />\r\n            <span className={textClass}>{text}</span>\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport const Muted = (props:any) => \r\n<small className={classNames('text-muted', props.className)} style={props.style}>\r\n    {props.children}\r\n</small>;\r\n","import { observable } from 'mobx';\r\nimport { isNumber } from 'util';\r\nimport _ from 'lodash';\r\nimport { LocalArr } from '../../tool';\r\nimport { BoxId } from './boxId';\r\nimport { TuidInner, TuidDiv } from './tuid';\r\n\r\nconst maxCacheSize = 1000;\r\n\r\nexport class IdCache {\r\n    private queue: number[] = [];               // 每次使用，都排到队头\r\n\tprivate cache = observable.map({}, {deep: false});    // 已经缓冲的\r\n\tprivate loading:boolean = false;\r\n\r\n    protected localArr:LocalArr;\r\n    protected waitingIds: number[] = [];          // 等待loading的\r\n    protected tuidInner: TuidInner;\r\n\r\n    constructor(tuidLocal: TuidInner) {\r\n        this.tuidInner = tuidLocal;\r\n        this.initLocalArr();\r\n    }\r\n\r\n    protected initLocalArr() {\r\n        this.localArr = this.tuidInner.cache.arr(this.tuidInner.name + '.ids');\r\n    }\r\n\r\n    useId(id:number, defer?:boolean) {\r\n        if (!id) return;\r\n        if (isNumber(id) === false) return;\r\n        if (this.cache.has(id) === true) {\r\n            this.moveToHead(id);\r\n            return;\r\n        }\r\n        this.tuidInner.cacheTuids(defer===true?70:20);\r\n        this.cache.set(id, id);\r\n        if (this.waitingIds.findIndex(v => v === id) >= 0) {\r\n            this.moveToHead(id);\r\n            return;\r\n        }\r\n\r\n        if (this.queue.length >= maxCacheSize) {\r\n            // 缓冲已满，先去掉最不常用的\r\n            let r = this.queue.shift();\r\n            if (r === id) {\r\n                // 如果移除的，正好是现在用的，则插入\r\n                this.queue.push(r);\r\n                return;\r\n            }\r\n\r\n            //let rKey = String(r);\r\n            if (this.cache.has(r) === true) {\r\n                // 如果移除r已经缓存\r\n                this.cache.delete(r);\r\n            }\r\n            else {\r\n                // 如果移除r还没有缓存\r\n                let index = this.waitingIds.findIndex(v => v === r);\r\n                this.waitingIds.splice(index, 1);\r\n            }\r\n        }\r\n        this.waitingIds.push(id);\r\n        this.queue.push(id);\r\n        return;\r\n    }\r\n\r\n    private moveToHead(id:number) {\r\n        let index = this.queue.findIndex(v => v === id);\r\n        this.queue.splice(index, 1);\r\n        this.queue.push(id);\r\n    }\r\n\r\n    getValue(id:number) {\r\n        return this.cache.get(id);\r\n    }\r\n\r\n    remove(id:number) {\r\n        this.cache.delete(id);\r\n        let index = this.queue.findIndex(v => v === id);\r\n\t\tthis.queue.splice(index, 1);\r\n\t\tthis.localArr.removeItem(id);\r\n    }\r\n\r\n    valueFromId(id:number|BoxId):any {\r\n        let _id:number;\r\n        switch (typeof id) {\r\n            case 'object': _id = (id as BoxId).id; break;\r\n            case 'number': _id = id as number; break;\r\n            default: return;\r\n        }\r\n        return this.getValue(_id);\r\n    }\r\n\r\n    resetCache(id:number) {\r\n        this.remove(id);\r\n        this.useId(id);\r\n    }\r\n\r\n    cacheValue(val:any):boolean {\r\n        if (val === undefined) return false;\r\n        let id = this.getIdFromObj(val);\r\n        if (id === undefined) return false;\r\n        let index = this.waitingIds.findIndex(v => v === id);\r\n        if (index>=0) this.waitingIds.splice(index, 1);\r\n        this.cache.set(id, val);\r\n        return true;\r\n    }\r\n    protected getIdFromObj(val:any) {return this.tuidInner.getIdFromObj(val)}\r\n\r\n    async cacheIds():Promise<void> {\r\n        if (this.waitingIds.length === 0) return;\r\n\t\tlet tuidValues = await this.loadIds();\r\n\t\tif (tuidValues === undefined || tuidValues.length === 0) {\r\n\t\t\tthis.waitingIds.splice(0, this.waitingIds.length);\r\n\t\t\treturn;\r\n\t\t}\r\n        this.cacheIdValues(tuidValues);\r\n    }\r\n\r\n    private cacheIdValues(tuidValues: any[]) {\r\n        if (tuidValues === undefined) return;\r\n        let tuids = this.unpackTuidIds(tuidValues);\r\n        for (let tuidValue of tuids) {\r\n            if (this.cacheValue(tuidValue) === false) continue;\r\n            this.cacheTuidFieldValues(tuidValue);\r\n        }\r\n    }\r\n    async modifyIds(ids:any[]):Promise<void> {\r\n        let tuidValues:string[] = await this.loadTuidIdsOrLocal(ids);\r\n        let localedValues = tuidValues.filter(v => {\r\n            let p = v.indexOf('\\t');\r\n            if (p<0) p = v.length;\r\n            let id = Number(v.substr(0, p));\r\n            let val = this.localArr.getItem(id);\r\n            return (val !== undefined);\r\n        });\r\n        if (localedValues.length === 0) return;\r\n        this.cacheIdValues(localedValues);\r\n    }\r\n    protected divName:string = undefined;\r\n    protected async loadIds(): Promise<any[]> {\r\n\t\tif (this.loading === true) return;\r\n\t\tthis.loading = true;\r\n\t\tlet ret = await this.loadTuidIdsOrLocal(this.waitingIds);\r\n\t\tthis.loading = false;\r\n        return ret;\r\n    }\r\n    protected unpackTuidIds(values:string[]):any[] {\r\n        return this.tuidInner.unpackTuidIds(values);\r\n    }\r\n    protected cacheTuidFieldValues(tuidValue: any) {\r\n        this.tuidInner.cacheTuidFieldValues(tuidValue);\r\n    }\r\n\r\n    async assureObj(id:number):Promise<void> {\r\n        let val = this.cache.get(id);\r\n        switch (typeof val) {\r\n            case 'object': return val;\r\n            case 'number': this.cache.set(id, id); break;\r\n        }\r\n        let ret = await this.loadTuidIdsOrLocal([id]);\r\n        this.cacheIdValues(ret);\r\n    }\r\n\r\n    private async loadTuidIdsOrLocal(ids:number[]):Promise<string[]> {\r\n        let ret:string[] = [];        \r\n        let netIds:number[] = [];\r\n        for (let id of ids) {\r\n            let value = this.localArr.getItem(id);\r\n            //if (value === undefined)\r\n            // 值不存在或者是空字符串，重新获取\r\n            if (!value)\r\n                netIds.push(id);\r\n            else\r\n                ret.push(value);\r\n        }\r\n        let len = netIds.length;\r\n        if (len > 0) {\r\n            let netRet = await this.tuidInner.loadTuidIds(this.divName, netIds);\r\n            for (let i=0; i<len; i++) {\r\n                //有些id可能没有内容，不会返回\r\n                //let id = netIds[i]; \r\n                let row:string = netRet[i];\r\n                if (!row) continue;\r\n                let p = row.indexOf('\\t');\r\n                if (p < 0) p = row.length;\r\n                let id = Number(row.substr(0, p));\r\n\t\t\t\t_.remove(netIds, v => v === id);\r\n                ret.push(row);\r\n                this.localArr.setItem(id, row);\r\n            }\r\n            len = netIds.length;\r\n            for (let i=0; i<len; i++) {\r\n                this.localArr.setItem(netIds[i], '');\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n}\r\n\r\nexport class IdDivCache extends IdCache {\r\n    private div: TuidDiv;\r\n    protected divName:string;\r\n\r\n    constructor(tuidLocal:TuidInner, div: TuidDiv) {\r\n        super(tuidLocal);\r\n        this.div = div;\r\n        this.divName = div.name;\r\n        this.localArr = tuidLocal.cache.arr(tuidLocal.name + '.ids.' + this.divName);\r\n    }\r\n\r\n    protected initLocalArr() {\r\n        // 这个不需要，必须去掉\r\n        // this.localArr = this.tuidInner.cache.arr(this.tuidInner.name + '.ids');\r\n    }\r\n\r\n    protected getIdFromObj(val:any) {return this.div.getIdFromObj(val)}\r\n    protected unpackTuidIds(values:string[]):any[] {\r\n        return this.div.unpackTuidIds(values);\r\n    }\r\n    protected cacheTuidFieldValues(tuidValue: any) {\r\n        this.div.cacheTuidFieldValues(tuidValue);\r\n    }\r\n\r\n    /*\r\n    async cacheIds():Promise<void> {\r\n        if (this.waitingIds.length === 0) return;\r\n        let tuidValues = await this.loadIds();\r\n        if (tuidValues !== undefined) {\r\n            let tuids = this.tuidLocal.unpackTuidIds(tuidValues);\r\n            for (let tuidValue of tuids) {\r\n                if (this.cacheValue(tuidValue) === false) continue;\r\n                this.tuidLocal.cacheTuidFieldValues(tuidValue);\r\n                this.afterCacheValue(tuidValue);\r\n            }\r\n        }\r\n    }\r\n    */\r\n}\r\n","import _ from 'lodash';\r\nimport { LocalArr } from '../../tool';\r\nimport { Entity } from '../entity';\r\nimport { UqMan, ArrFields, Field, SchemaFrom } from '../uqMan';\r\nimport { EntityCaller } from '../caller';\r\nimport { BoxId } from './boxId';\r\nimport { IdCache, IdDivCache } from './idCache';\r\n\r\nexport interface TuidSaveResult {\r\n    id: number;\r\n    inId: number;\r\n}\r\n\r\nexport abstract class Tuid extends Entity {\r\n    protected noCache: boolean;\r\n    readonly typeName:string = 'tuid';\r\n    protected idName: string;\r\n    cached: boolean;\r\n    unique: string[];\r\n\r\n    public setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {id} = schema;\r\n        this.idName = id;\r\n    }\r\n\r\n    buildTuidBox(): TuidBox {\r\n        return new TuidBox(this);\r\n    }\r\n\r\n    getIdFromObj(obj:any):number {return obj[this.idName]}\r\n    stopCache():void {this.noCache = true}\r\n    abstract useId(id:number):void;\r\n    abstract boxId(id:number):BoxId;\r\n    abstract valueFromId(id:number):any;\r\n\tabstract resetCache(id:number|BoxId):void;\r\n    abstract async assureBox<T> (id:number|BoxId): Promise<T>;\r\n    static equ(id1:BoxId|number, id2:BoxId|number): boolean {\r\n        if (id1 === undefined) return false;\r\n        if (id2 === undefined) return false;\r\n        if (typeof id1 === 'object') {\r\n            return id1.equ(id2);\r\n        }\r\n        if (typeof id2 === 'object') {\r\n            return id2.equ(id1);\r\n        }\r\n        return id1 === id2;\r\n    }\r\n    cacheIds() {}\r\n    async modifyIds(ids:any[]) {}\r\n    isImport = false;\r\n    abstract get hasDiv():boolean;// {return this.divs!==undefined}\r\n    abstract div(name:string):TuidDiv;\r\n    abstract async loadMain(id:number|BoxId):Promise<any>;\r\n\tabstract async load(id:number|BoxId):Promise<any>;\r\n    abstract async all():Promise<any[]>;\r\n\tabstract async save(id:number, props:any):Promise<TuidSaveResult>;\r\n\tabstract saveProp(id:number, prop:string, value:any):Promise<void>;\r\n    abstract async search(key:string, pageStart:string|number, pageSize:number):Promise<any>;\r\n    abstract async searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any>;\r\n    abstract async loadArr(arr:string, owner:number, id:number):Promise<any>;\r\n    abstract async saveArr(arr:string, owner:number, id:number, props:any):Promise<void>;\r\n    abstract async posArr(arr:string, owner:number, id:number, order:number):Promise<void>;\r\n}\r\n\r\nexport class TuidInner extends Tuid {\r\n    private divs: {[div:string]: TuidDiv};\r\n    protected cacheFields: Field[];\r\n    protected idCache: IdCache;\r\n    protected localArr:LocalArr;\r\n    constructor(uq:UqMan, name:string, typeId:number) {\r\n        super(uq, name, typeId);\r\n        this.idCache = new IdCache(this);\r\n        this.localArr = this.cache.arr(this.name + '.whole');\r\n        if (uq.newVersion === true) this.localArr.removeAll();\r\n    }\r\n\r\n    public setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {arrs} = schema;\r\n        if (arrs !== undefined) {\r\n            this.divs = {};\r\n            for (let arr of arrs) {\r\n                let {name} = arr;\r\n                let tuidDiv = new TuidDiv(this.uq, this, name);\r\n                this.divs[name] = tuidDiv;\r\n                tuidDiv.setSchema(arr);\r\n                tuidDiv.buildFieldsTuid();\r\n            }\r\n        }\r\n    }\r\n    \r\n    useId(id:number, defer?:boolean) {\r\n        if (this.noCache === true) return;\r\n        if (!id) return;\r\n        this.idCache.useId(id, defer);\r\n    }\r\n    boxId(id:number):BoxId {\r\n        if (!id) return;\r\n        if (typeof id === 'object') return id;\r\n        this.useId(id);\r\n        let {createBoxId} = this.uq;\r\n        if (!createBoxId) return {id: id} as BoxId;\r\n        return createBoxId(this, id);\r\n    }\r\n    valueFromId(id:number) {return this.idCache.getValue(id)}\r\n\tresetCache(id:number|BoxId):void {\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tthis.idCache.resetCache(id);\r\n\t}\r\n    async assureBox<T> (id:number|BoxId):Promise<T> {\r\n\t\tif (!id) return;\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tawait this.idCache.assureObj(id);\r\n\t\treturn this.idCache.getValue(id);\r\n    }\r\n\r\n    cacheIds() {\r\n        this.idCache.cacheIds();\r\n        if (this.divs === undefined) return;\r\n        for (let i in this.divs) this.divs[i].cacheIds();\r\n    }\r\n    async modifyIds(ids:any[]) {\r\n        await this.idCache.modifyIds(ids);\r\n    }\r\n    cacheTuids(defer:number) {this.uq.cacheTuids(defer)}\r\n    get hasDiv():boolean {return this.divs!==undefined}\r\n    div(name:string):TuidDiv {\r\n        return this.divs && this.divs[name];\r\n    }\r\n    async loadTuidIds(divName:string, ids:number[]):Promise<any[]> {\r\n        let ret:any[] = await new IdsCaller(this, {divName:divName, ids:ids}, false).request();\r\n        if (ret.length > 0) this.cached = true;\r\n        return ret;\r\n    }\r\n    async loadMain(id:number|BoxId):Promise<any> {\r\n        if (typeof id === 'object') id = id.id;\r\n        await this.idCache.assureObj(id);\r\n        return this.idCache.valueFromId(id);\r\n    }\r\n    async load(id:number|BoxId):Promise<any> {\r\n        if (id === undefined || id === 0) return;\r\n        //let cacheValue = this.idCache.valueFromId(id); \r\n        //if (typeof cacheValue === 'object') return cacheValue;\r\n        if (typeof id === 'object') id = id.id;\r\n        let valuesText = undefined; //this.localArr.getItem(id);\r\n        let values: any;\r\n        if (valuesText) {\r\n            values = JSON.parse(valuesText);\r\n        }\r\n        else {\r\n            values = await new GetCaller(this, id).request();\r\n            if (values !== undefined) {\r\n                // this.localArr.setItem(id, JSON.stringify(values));\r\n            }\r\n        }\r\n        if (values === undefined) return;\r\n        for (let f of this.schema.fields) {\r\n            let {tuid} = f;\r\n            if (tuid === undefined) continue;\r\n            let t = this.uq.getTuid(tuid);\r\n            if (t === undefined) continue;\r\n            let n = f.name;\r\n            values[n] = t.boxId(values[n]);\r\n        }\r\n        this.idCache.cacheValue(values);\r\n        this.cacheTuidFieldValues(values);\r\n        return values;\r\n    }\r\n\r\n    cacheTuidFieldValues(values:any) {\r\n        let {fields, arrs} = this.schema;\r\n        this.cacheFieldsInValue(values, fields);\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs as ArrFields[]) {\r\n                let {name, fields} = arr;\r\n                let arrValues = values[name];\r\n                if (arrValues === undefined) continue;\r\n                let tuidDiv = this.div(name);\r\n                for (let row of arrValues) {\r\n                    //row._$tuid = tuidDiv;\r\n                    //row.$owner = this.boxId(row.owner);\r\n                    tuidDiv.cacheValue(row);\r\n                    this.cacheFieldsInValue(row, fields);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public buildFieldsTuid() {\r\n        super.buildFieldsTuid();\r\n        let {mainFields, $create, $update, stampOnMain} = this.schema;\r\n\t\tif (mainFields === undefined) debugger;\r\n\t\tthis.cacheFields = mainFields || this.fields;\r\n\t\tif (stampOnMain === true) {\r\n\t\t\tif ($create === true) this.cacheFields.push({name: '$create', type: 'timestamp', _tuid: undefined});\r\n\t\t\tif ($update === true) this.cacheFields.push({name: '$update', type: 'timestamp', _tuid: undefined});\r\n\t\t}\r\n        this.uq.buildFieldTuid(this.cacheFields);\r\n    }\r\n\r\n    unpackTuidIds(values:string[]):any[] {\r\n        return this.unpackTuidIdsOfFields(values, this.cacheFields);\r\n    }\r\n\r\n    async save(id:number, props:any):Promise<TuidSaveResult> {\r\n        let ret = await new SaveCaller(this, {id:id, props:props}).request();\r\n        if (id !== undefined) {\r\n            this.idCache.remove(id);\r\n            this.localArr.removeItem(id);\r\n        }\r\n        return ret;\r\n\t}\r\n\tasync saveProp(id:number, prop:string, value:any):Promise<void> {\r\n\t\tawait new SavePropCaller(this, {id, prop, value}).request();\r\n\t\tthis.idCache.remove(id);\r\n\t\tawait this.idCache.assureObj(id);\r\n\t}\r\n    async all():Promise<any[]> {\r\n        let ret: any[] = await new AllCaller(this, {}).request();\r\n        return ret;\r\n    }\r\n    async search(key:string, pageStart:string|number, pageSize:number):Promise<any[]> {\r\n        let ret:any[] = await this.searchArr(undefined, key, pageStart, pageSize);\r\n        return ret;\r\n    }\r\n    async searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        //let api = this.uqApi;\r\n        //let ret = await api.tuidSearch(this.name, undefined, owner, key, pageStart, pageSize);\r\n        let params:any = {arr:undefined, owner:owner, key:key, pageStart:pageStart, pageSize:pageSize};\r\n        let ret = await new SearchCaller(this, params).request();\r\n        let {fields} = this.schema;\r\n        for (let row of ret) {\r\n            this.cacheFieldsInValue(row, fields);\r\n        }\r\n        return ret;\r\n    }\r\n    async loadArr(arr:string, owner:number, id:number):Promise<any> {\r\n        if (id === undefined || id === 0) return;\r\n        //let api = this.uqApi;\r\n        //return await api.tuidArrGet(this.name, arr, owner, id);\r\n        return await new LoadArrCaller(this, {arr:arr, owner:owner, id:id}).request();\r\n    }\r\n    async saveArr(arr:string, owner:number, id:number, props:any) {\r\n        //let params = _.clone(props);\r\n        //params[\"$id\"] = id;\r\n        //return await this.uqApi.tuidArrSave(this.name, arr, owner, params);\r\n        return await new SaveArrCaller(this, {arr:arr, owner:owner, id:id, props:props}).request();\r\n    }\r\n\r\n    async posArr(arr:string, owner:number, id:number, order:number) {\r\n        //return await this.uqApi.tuidArrPos(this.name, arr, owner, id, order);\r\n        return await new ArrPosCaller(this, {arr:arr, owner:owner, id:id, order:order}).request();\r\n    }\r\n}\r\n\r\nabstract class TuidCaller<T> extends EntityCaller<T> {\r\n    protected get entity(): Tuid {return this._entity as Tuid};\r\n}\r\n\r\n// 包含main字段的load id\r\n// 当前为了兼容，先调用的包含所有字段的内容\r\nclass GetCaller extends TuidCaller<number> {\r\n    method = 'GET';\r\n    get path():string {return `tuid/${this.entity.name}/${this.params}`}\r\n}\r\n\r\nclass IdsCaller extends TuidCaller<{divName:string, ids:number[]}> {\r\n    get path():string {\r\n        let {divName} = this.params;\r\n        return `tuidids/${this.entity.name}/${divName !== undefined?divName:'$'}`;\r\n    }\r\n    buildParams():any {return this.params.ids}\r\n    xresult(res:any):any {\r\n        return (res as string).split('\\n');\r\n    }\r\n}\r\n\r\n\r\nclass SaveCaller extends TuidCaller<{id:number, props:any}> {\r\n    get path():string {return `tuid/${this.entity.name}`}\r\n    buildParams():any {\r\n        let {fields, arrs} = this.entity.schema;\r\n        let {id, props} = this.params;\r\n        let params:any = {$id: id};\r\n        this.transParams(params, props, fields);\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                let arrName = arr.name;\r\n                let arrParams = [];\r\n                let arrFields = arr.fields;\r\n                let arrValues = props[arrName];\r\n                if (arrValues !== undefined) {\r\n                    for (let arrValue of arrValues) {\r\n                        let row = {};\r\n                        this.transParams(row, arrValue, arrFields);\r\n                        arrParams.push(row);\r\n                    }\r\n                }\r\n                params[arrName] = arrParams;\r\n            }\r\n        }\r\n        return params;\r\n    }\r\n    private transParams(values:any, params:any, fields:Field[]) {\r\n        if (params === undefined) return;\r\n        for (let field of fields) {\r\n            let {name, tuid, type} = field;\r\n            let val = params[name];\r\n            if (tuid !== undefined) {\r\n                if (typeof val === 'object') {\r\n                    if (val !== null) val = val.id;\r\n                }\r\n            }\r\n            else {\r\n                switch (type) {\r\n                    case 'date':\r\n                        val = this.entity.buildDateParam(val); \r\n                        //val = (val as string).replace('T', ' ');\r\n                        //val = (val as string).replace('Z', '');\r\n                        break;\r\n                    case 'datetime':\r\n                        val = this.entity.buildDateTimeParam(val);\r\n                        //val = new Date(val).toISOString();\r\n                        //val = (val as string).replace('T', ' ');\r\n                        //val = (val as string).replace('Z', '');\r\n                        break;\r\n                }\r\n            }\r\n            values[name] = val;\r\n        }\r\n    }\r\n}\r\n\r\nclass SearchCaller extends TuidCaller<{arr:string, owner:number, key:string, pageStart:string|number, pageSize:number}> {\r\n    get path():string {return `tuids/${this.entity.name}`}\r\n}\r\n\r\nclass AllCaller extends TuidCaller<{}> {\r\n    method = 'GET';\r\n    get path():string {return `tuid-all/${this.entity.name}`}\r\n}\r\n\r\nclass LoadArrCaller extends TuidCaller<{arr:string, owner:number, id:number}> {\r\n    method = 'GET';\r\n    get path():string {\r\n        let {arr, owner, id} = this.params;\r\n        return `tuid-arr/${this.entity.name}/${owner}/${arr}/${id}`;\r\n    }\r\n}\r\nclass SavePropCaller extends TuidCaller<{id:number, prop:string, value:any}> {\r\n    get path():string {return `tuid-prop/${this.entity.name}/`;}\r\n}\r\nclass SaveArrCaller extends TuidCaller<{arr:string, owner:number, id:number, props:any}> {\r\n    get path():string {\r\n        let {arr, owner} = this.params;\r\n        return `tuid-arr/${this.entity.name}/${owner}/${arr}/`;\r\n    }\r\n    buildParams():any {\r\n        let {id, props} = this.params;\r\n        let params = _.clone(props);\r\n        params['$id'] = id;\r\n        return params;\r\n    }\r\n}\r\n\r\nclass ArrPosCaller extends TuidCaller<{arr:string, owner:number, id:number, order:number}> {\r\n    get path():string {\r\n        let {arr, owner} = this.params;\r\n        return `tuid-arr-pos/${this.entity.name}/${owner}/${arr}/`;\r\n    }\r\n    buildParams():any {\r\n        let {id, order} = this.params;\r\n        return { bid: id, $order: order}\r\n    }\r\n}\r\n\r\nexport class TuidImport extends Tuid {\r\n    private tuidLocal: TuidInner;\r\n\r\n    constructor(uq:UqMan, name:string, typeId:number, from: SchemaFrom) {\r\n        super(uq, name, typeId);\r\n        this.from = from;\r\n    }\r\n\r\n    setFrom(tuidLocal: TuidInner) {this.tuidLocal = tuidLocal}\r\n    \r\n    readonly from: SchemaFrom;\r\n    isImport = true;\r\n\r\n    useId(id:number) {this.tuidLocal.useId(id);}\r\n    boxId(id:number):BoxId {return this.tuidLocal.boxId(id);}\r\n    valueFromId(id:number) {return this.tuidLocal.valueFromId(id)}\r\n\tresetCache(id:number|BoxId):void {\r\n\t\tthis.tuidLocal.resetCache(id);\r\n\t}\r\n    async assureBox<T>(id:number):Promise<T> {\r\n        await this.tuidLocal.assureBox(id);\r\n\t\treturn this.tuidLocal.valueFromId(id);\r\n    }\r\n    get hasDiv():boolean {return this.tuidLocal.hasDiv}\r\n    div(name:string):TuidDiv {return this.tuidLocal.div(name)}\r\n    async loadMain(id:number|BoxId):Promise<any> {\r\n        let ret = await this.tuidLocal.loadMain(id);\r\n        return ret;\r\n    }\r\n    async load(id:number|BoxId):Promise<any> {\r\n        return await this.tuidLocal.load(id);\r\n    }\r\n    async save(id:number, props:any):Promise<TuidSaveResult> {\r\n        return await this.tuidLocal.save(id, props);\r\n\t}\r\n\tasync saveProp(id:number, prop:string, value:any):Promise<void> {\r\n\t\tawait this.tuidLocal.saveProp(id, prop, value);\r\n\t}\r\n    async all():Promise<any[]> {\r\n        return await this.tuidLocal.all();\r\n    }\r\n    async search(key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        return await this.tuidLocal.search(key, pageStart, pageSize);\r\n    }\r\n    async searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        return await this.tuidLocal.searchArr(owner, key, pageStart, pageSize);\r\n    }\r\n    async loadArr(arr:string, owner:number, id:number):Promise<any> {\r\n        return await this.tuidLocal.loadArr(arr, owner, id);\r\n    }\r\n    async saveArr(arr:string, owner:number, id:number, props:any):Promise<void> {\r\n        await this.tuidLocal.saveArr(arr, owner, id, props);\r\n    }\r\n    async posArr(arr:string, owner:number, id:number, order:number):Promise<void> {\r\n        await this.tuidLocal.posArr(arr, owner, id, order);\r\n    }\r\n}\r\n\r\n// field._tuid 用这个接口\r\n// Tuid, TuidDiv 实现这个接口\r\nexport class TuidBox {\r\n    tuid: Tuid;\r\n    ownerField:Field = undefined;\r\n    constructor(tuid: Tuid) {\r\n        this.tuid = tuid;\r\n    }\r\n\r\n    boxId(id:number):BoxId {\r\n        return this.tuid.boxId(id);\r\n    }\r\n    getIdFromObj(obj:any):number {\r\n        return this.tuid.getIdFromObj(obj);\r\n    }\r\n    useId(id:number):void {\r\n        return this.tuid.useId(id);\r\n    }\r\n    async showInfo() {\r\n        alert('showInfo not implemented');\r\n    }\r\n}\r\n\r\n\r\nexport class TuidDiv extends TuidInner /* Entity*/ {\r\n    readonly typeName:string = 'div';\r\n    protected cacheFields: Field[];\r\n    protected tuid: TuidInner;\r\n    protected idName: string;\r\n    protected idCache: IdDivCache;\r\n\r\n    //ui: React.StatelessComponent<any>;\r\n    //res: any;\r\n\r\n    constructor(uq: UqMan, tuid: TuidInner, name: string) {\r\n        super(uq, name, 0);\r\n        this.tuid = tuid;\r\n        this.idName = 'id';\r\n        this.idCache = new IdDivCache(tuid, this);\r\n    }\r\n\r\n    get owner() {return this.tuid}\r\n\r\n    /*\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        this.buildFieldsTuid();\r\n    }*/\r\n\r\n    /*\r\n    setUIRes(ui:any, res:any) {\r\n        this.ui = ui && ui.content;\r\n        this.res = res;\r\n    }\r\n    */\r\n\r\n    buildFieldsTuid() {\r\n        super.buildFieldsTuid();\r\n        let {mainFields} = this.schema;\r\n        if (mainFields === undefined) debugger;\r\n        this.uq.buildFieldTuid(this.cacheFields = mainFields);\r\n    }\r\n\r\n    buildTuidDivBox(ownerField: Field): TuidBoxDiv {\r\n        return new TuidBoxDiv(this.tuid, this, ownerField);\r\n    }\r\n\r\n    getIdFromObj(obj:any):number {return obj[this.idName]}\r\n    cacheValue(value:any):void {\r\n        this.idCache.cacheValue(value);\r\n    }\r\n\r\n    useId(id:number, defer?:boolean):void {\r\n        if (this.noCache === true) return;\r\n        this.idCache.useId(id, defer);\r\n    }\r\n\r\n    /*\r\n    boxId(id:number):BoxId {\r\n        if (typeof id === 'object') return id;\r\n        this.useId(id);\r\n        //return new BoxDivId(this.tuid, this, id);\r\n        return this.tuid.boxDivId(this, id);\r\n    }\r\n    */\r\n    valueFromId(id:number):any {\r\n        return this.idCache.getValue(id)\r\n    }\r\n\r\n    async assureBox<T>(id:number):Promise<T> {\r\n\t\tawait this.idCache.assureObj(id);\r\n\t\treturn this.idCache.getValue(id);\r\n    }\r\n\r\n    async cacheIds() {\r\n        await this.idCache.cacheIds();\r\n    }\r\n\r\n    cacheTuidFieldValues(values:any) {\r\n        let fields = this.schema.fields;\r\n        this.cacheFieldsInValue(values, fields);\r\n    }\r\n\r\n    unpackTuidIds(values:string[]):any[] {\r\n        return this.unpackTuidIdsOfFields(values, this.cacheFields);\r\n    }\r\n}\r\n\r\nexport class TuidBoxDiv extends TuidBox {\r\n    ownerField: Field;\r\n    private div: TuidDiv;\r\n    constructor(tuid: Tuid, div: TuidDiv, ownerField: Field) {\r\n        super(tuid);\r\n        this.div = div;\r\n        this.ownerField = ownerField;\r\n    }\r\n\r\n    boxId(id:number):BoxId {\r\n        return this.div.boxId(id);\r\n    }\r\n    getIdFromObj(obj:any):number {\r\n        return this.div.getIdFromObj(obj);\r\n    }\r\n    useId(id:number):void {\r\n        return this.div.useId(id);\r\n    }\r\n}\r\n","import _ from 'lodash';\r\n\r\nclass _LocalStorage {\r\n    getItem(key:string) {\r\n        return localStorage.getItem(key)\r\n    }\r\n    setItem(key:string, value:string) {\r\n        localStorage.setItem(key, value);\r\n    }\r\n    removeItem(key:string) {\r\n        localStorage.removeItem(key);\r\n    }\r\n}\r\n\r\nconst __ls = new _LocalStorage(); // new Ls;\r\n\r\nexport class LocalCache {\r\n    private readonly local: Local;\r\n    //private value: T;\r\n    readonly key: string|number;\r\n\r\n    constructor(local:Local, key:string|number) {\r\n        this.local = local;\r\n        this.key = key;\r\n    }\r\n    get():any {\r\n        try {\r\n            // 下面缓冲的内容不能有，可能会被修改，造成circular引用\r\n            //if (this.value !== undefined) return this.value;\r\n            let text = this.local.getItem(this.key);\r\n            if (text === null) return;\r\n            if (text === undefined) return undefined;\r\n            //return this.value = \r\n            return JSON.parse(text);\r\n        }\r\n        catch (err) {\r\n            this.local.removeItem(this.key);\r\n            return;\r\n        }\r\n    }\r\n    set(value:any) {\r\n\t\tlet t = JSON.stringify(value, (key, value) => {\r\n\t\t\tif (key !== '_tuid') return value;\r\n\t\t});\r\n\t\tthis.local.setItem(this.key, t);\r\n    }\r\n    remove(local?:Local) {\r\n        if (local === undefined) {\r\n            this.local.removeItem(this.key);\r\n        }\r\n        else {\r\n            this.local.removeLocal(local);\r\n        }\r\n    }\r\n    child(key:string|number):LocalCache {\r\n        return this.local.child(key);\r\n    }\r\n    arr(key:string|number):LocalArr {\r\n        return this.local.arr(key);\r\n    }\r\n    map(key:string|number):LocalMap {\r\n        return this.local.map(key);\r\n    }\r\n}\r\n\r\nabstract class Local {\r\n    private readonly caches: {[key:string]:LocalCache};\r\n    private readonly locals: {[key:string]:Local};\r\n    protected readonly name: string;\r\n    constructor(name: string) {\r\n        this.name = name;\r\n        this.caches = {};\r\n        this.locals = {};\r\n    }\r\n\r\n    protected abstract keyForGet(key:string|number):string;\r\n    protected abstract keyForSet(key:string|number):string;\r\n    protected abstract keyForRemove(key:string|number):string;\r\n    abstract removeAll():void;\r\n    getItem(key:string|number):string {\r\n        let k = this.keyForGet(key);\r\n        if (k === undefined) return;\r\n        return __ls.getItem(k);\r\n    }\r\n    setItem(key:string|number, value: string):void {\r\n        let k = this.keyForSet(key);\r\n        __ls.setItem(k, value);\r\n    }\r\n    removeItem(key:string|number):void {\r\n        let k = this.keyForSet(key);\r\n        if (k === undefined) return;\r\n        localStorage.removeItem(k);\r\n    }\r\n    arr(key:string|number):LocalArr {\r\n        let sk = String(key);\r\n        let arr = this.locals[sk] as LocalArr;\r\n        if (arr === undefined) {\r\n            let k = this.keyForSet(key);\r\n            this.locals[sk] = arr = new LocalArr(k);\r\n        }\r\n        return arr;\r\n    }\r\n    map(key:string|number):LocalMap {\r\n        let sk = String(key);\r\n        let map = this.locals[sk] as LocalMap;\r\n        if (map === undefined) {\r\n            let k = this.keyForSet(key);\r\n            this.locals[sk] = map = new LocalMap(k);\r\n        }\r\n        return map;\r\n    }\r\n    removeLocal(local:Local) {\r\n        let sk = local.name;\r\n        let k = this.keyForRemove(sk);\r\n        if (k === undefined) return;\r\n        let arr = this.locals[sk];\r\n        if (arr === undefined) arr = new LocalArr(k);\r\n        else this.locals[sk] = undefined;\r\n        arr.removeAll();\r\n    }\r\n    child(key:string|number):LocalCache {\r\n        let ks = String(key);\r\n        let ret = this.caches[ks];\r\n        if (ret !== undefined) return ret;\r\n        return this.caches[ks] =ret = new LocalCache(this, key);\r\n    }\r\n}\r\n\r\nconst maxArrSize = 500;\r\nexport class LocalArr extends Local {\r\n    private readonly index: number[];\r\n    constructor(name: string) {\r\n        super(name);\r\n        let index = __ls.getItem(this.name);\r\n        this.index = index === null? [] : index.split('\\n').map(v => Number(v));\r\n    }\r\n    private saveIndex() {\r\n        __ls.setItem(this.name, this.index.join('\\n'));\r\n    }\r\n    protected keyForGet(key:number):string {\r\n        let i = _.indexOf(this.index, key);\r\n        if (i < 0) return undefined;\r\n        return `${this.name}.${key}`;\r\n    }\r\n    protected keyForSet(key:number):string {\r\n        let i = _.indexOf(this.index, key);\r\n        if (i<0) {\r\n            this.index.unshift(key);\r\n            if (this.index.length > maxArrSize) this.index.pop();\r\n        }\r\n        else {\r\n            this.index.splice(i, 1);\r\n            this.index.unshift(key)\r\n        }\r\n        this.saveIndex();\r\n        return `${this.name}.${key}`;\r\n    }\r\n    protected keyForRemove(key:number):string {\r\n        let i = _.indexOf(this.index, key);\r\n        if (i<0) return;\r\n        this.index.splice(i, 1);\r\n        this.saveIndex();\r\n        return `${this.name}.${key}`;\r\n    }\r\n    removeAll():void {\r\n        for (let i of this.index) {\r\n            __ls.removeItem(`${this.name}.${i}`);\r\n        }\r\n        __ls.removeItem(this.name);\r\n        this.index.splice(0);\r\n    }\r\n    item(index:number):LocalCache {\r\n        return this.child(index);\r\n    }\r\n}\r\n\r\nexport class LocalMap extends Local {\r\n    private readonly index: {[key:string]:number};\r\n    private max: number;\r\n    constructor(name: string) {\r\n        super(name);\r\n        this.max = 0;\r\n        this.index = {};\r\n        let index = __ls.getItem(this.name);\r\n        if (index !== null) {\r\n            let ls = index.split('\\n');\r\n            ls.forEach(l => {\r\n                let p = l.indexOf('\\t');\r\n                if (p<0) return;\r\n                let key = l.substr(0, p);\r\n                let i = Number(l.substr(p+1));\r\n                if (isNaN(i) === true) return;\r\n                this.index[key] = i;\r\n                if (i>this.max) this.max = i;\r\n            });\r\n        }\r\n    }\r\n    private saveIndex() {\r\n        let ls:string[] = [];\r\n        for (let k in this.index) {\r\n            let v = this.index[k];\r\n            if (v === undefined) continue;\r\n            ls.push(`${k}\\t${v}`);\r\n        }\r\n        __ls.setItem(this.name, ls.join('\\n'));\r\n    }\r\n    protected keyForGet(key:number):string {\r\n        let i = this.index[key];\r\n        if (i === undefined) return undefined;\r\n        return `${this.name}.${i}`;\r\n    }\r\n    protected keyForSet(key:number):string {\r\n        let i = this.index[key];\r\n        if (i === undefined) {\r\n            ++this.max;\r\n            i = this.max;\r\n            this.index[key] = i;\r\n            this.saveIndex();\r\n        }\r\n        return `${this.name}.${i}`;\r\n    }\r\n    protected keyForRemove(key:string|number):string {\r\n        let i = this.index[key];\r\n        if (i===undefined) return;\r\n        this.index[key] = undefined;\r\n        this.saveIndex();\r\n        return `${this.name}.${i}`;\r\n    }\r\n    removeAll():void {\r\n        for (let i in this.index) {\r\n            __ls.removeItem(`${this.name}.${this.index[i]}`);\r\n            this.index[i] = undefined;\r\n        }\r\n        __ls.removeItem(this.name);\r\n        this.max = 0;\r\n    }\r\n    item(key:string):LocalCache {\r\n        return this.child(key);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { BoxId } from './boxId';\r\nimport { Tuid } from './tuid';\r\nimport { observer } from 'mobx-react';\r\n\r\nconst TuidContent = (tuidName:string, values:any, x?:any) => {\r\n    return <>{tuidName}: {uqStringify(values)}</>;\r\n};\r\n\r\nexport function uqStringify(values: any): string {\r\n    let s = '{';\r\n    if (values === undefined) return 'undefined';\r\n    for (let i in values) {\r\n        let v = values[i];\r\n        s += i + ': ';\r\n        if (v === undefined) {\r\n            s += 'undefined';\r\n        }\r\n        else if (v === null) {\r\n            s += 'null';\r\n        }\r\n        else {\r\n            switch (typeof v) {\r\n                default:\r\n                    s += v;\r\n                    break;\r\n                case 'function':\r\n                    s += 'function';\r\n                    break;\r\n                case 'object':\r\n                    s += '{obj}';\r\n                    break;\r\n            }\r\n        }\r\n        s += ', ';\r\n    }\r\n    return s + '}';\r\n}\r\n\r\nexport class ReactBoxId implements BoxId {\r\n    readonly id: number;\r\n    protected tuid: Tuid;\r\n    protected ui: (values:any) => JSX.Element;\r\n    readonly isUndefined:boolean;\r\n    constructor(id: number, tuid: Tuid, ui: (values:any) => JSX.Element) {\r\n        this.id = Number(id);\r\n        this.tuid = tuid;\r\n        this.ui = ui;\r\n        this.isUndefined = (this.tuid === undefined);\r\n    }\r\n\r\n    get obj():any {\r\n        return this.tuid.valueFromId(this.id);\r\n    }\r\n\r\n    equ(id:BoxId|number): boolean {\r\n        if (id === undefined || id === null) return false;\r\n        if (typeof id === 'object') return this.id === id.id;\r\n        return this.id === id;\r\n    }\r\n\r\n    render(ui:TvTemplet, x:any):JSX.Element {\r\n        if (this.id === undefined || this.id === null || isNaN(this.id) === true) return;\r\n        let boxName = this.boxName; // this.tuid.name;\r\n        let val = this.obj; // this.tuid.valueFromId(this.id);\r\n        if (this.isUndefined === true) {\r\n            if (ui !== undefined) return ui(val, x);\r\n            return TuidContent(boxName, val, x);\r\n        }\r\n        switch (typeof val) {\r\n            case 'undefined':\r\n                return <span className=\"text-black-50\">{boxName} undefined</span>;\r\n            case 'number':\r\n                return <span className=\"text-light\">{boxName} {this.id}</span>;\r\n        }\r\n        if (ui === undefined) {\r\n            ui = this.ui;\r\n        }\r\n        if (ui !== undefined) {\r\n            if (typeof ui !== 'function') {\r\n                ui = (ui as any).content;\r\n            }\r\n            if (ui !== undefined) {\r\n                let ret = ui(val/*, this.tuidUR.res*/);\r\n                if (ret !== undefined) return ret;\r\n                return <span className=\"text-danger\">{boxName} {this.id}</span>;\r\n            }\r\n        }\r\n\r\n        return TuidContent(boxName, val);\r\n    }\r\n\r\n    get boxName():string {return this.tuid.name}\r\n    // ui(): TvTemplet {return this.tuid.ui}\r\n    // res(): any {return this.tuid.res}\r\n\r\n    async assure(): Promise<BoxId> {\r\n        await this.tuid.assureBox(this.id);\r\n        return this;\r\n    }\r\n}\r\n\r\nfunction boxIdContent(bi: number|BoxId, ui:TvTemplet, x:any) {\r\n    let logContent:any;\r\n    let boxId:ReactBoxId = bi as ReactBoxId;\r\n    switch(typeof bi) {\r\n        case 'undefined': logContent = <>boxId undefined</>; break;\r\n        case 'number': logContent = <>id:{bi}</>; break;\r\n        default:\r\n            if (typeof boxId.render !== 'function') {\r\n                if (ui === undefined) {\r\n                    logContent = TuidContent(boxId.boxName, bi, x);\r\n                }\r\n                else {\r\n                    return ui(bi, x);\r\n                }\r\n            }\r\n            break;\r\n    }\r\n    if (logContent !== undefined) {\r\n        return <del className=\"text-danger\">{logContent}</del>;\r\n    }\r\n    return boxId.render(ui, x);\r\n}\r\n\r\nexport type TvTemplet = (values?:any, x?:any) => JSX.Element;\r\n\r\ninterface Props {\r\n    tuidValue: number|BoxId, \r\n    ui?: TvTemplet,\r\n    x?: any,\r\n    nullUI?: ()=>JSX.Element\r\n}\r\n\r\nconst Tv = observer(({tuidValue, ui, x, nullUI}:Props) => {\r\n    if (tuidValue === undefined) {\r\n        if (nullUI === undefined) return <small className=\"text-muted\">[无]</small>;\r\n        return nullUI();\r\n    }\r\n    if (tuidValue === null) {\r\n        if (nullUI === undefined) return <>[null]</>;\r\n        return nullUI();\r\n    }\r\n    let ttv = typeof tuidValue;\r\n    switch (ttv) {\r\n        default:\r\n            if (ui === undefined)\r\n                return <>{ttv}-{tuidValue}</>;\r\n            else {\r\n                let ret = ui(tuidValue, x);\r\n                if (ret !== undefined) return ret;\r\n                return <>{tuidValue}</>;\r\n            }\r\n        case 'object':\r\n            let divObj = boxIdContent(tuidValue, ui, x);\r\n            if (divObj !== undefined) return divObj;\r\n            return nullUI === undefined? <>id null</>: nullUI();\r\n        case 'number':\r\n            return <>id...{tuidValue}</>;\r\n    }\r\n});\r\n\r\nexport const tv = (tuidValue:number|BoxId, ui?:TvTemplet, x?:any, nullUI?:()=>JSX.Element):JSX.Element => {\r\n    return <Tv tuidValue={tuidValue} ui={ui} x={x} nullUI={nullUI} />;\r\n};\r\n","// typescript version of krasimir/navigo\r\n\r\nexport type RouteFunc = (params?:string|{[name:string]:string}, query?:string) => void;\r\n\r\nexport interface NamedRoute {\r\n\tas: string;\r\n\tuses: RouteFunc;\r\n\thooks?: Hooks;\r\n}\r\nexport interface Hooks {\r\n\tbefore: (done:()=>void, params:object) => void;\r\n\tafter: (params:object) => void;\r\n\tleave: (params:object) => void;\r\n\talready: (params:object) => void;\r\n}\r\ninterface Handler {\r\n\thandler: RouteFunc;\r\n\thooks: Hooks;\r\n}\r\ninterface LastResolved {\r\n\turl: string;\r\n\tquery: string;\r\n\thooks: Hooks;\r\n\tparams?: {[name:string]:string};\r\n\tname?: string;\r\n}\r\ninterface Route {\r\n\troute: string|RegExp;\r\n\thandler: RouteFunc,\r\n\tname: string,\r\n\thooks: Hooks\r\n}\r\n\r\nexport class Navigo {\r\n\tprivate static PARAMETER_REGEXP = /([:*])(\\w+)/g;\r\n\tprivate static WILDCARD_REGEXP = /\\*/g;\r\n\tprivate static REPLACE_VARIABLE_REGEXP = '([^\\\\/]+)';   \t// 单\\，编译错误 ([^\\/]+)\r\n\tprivate static REPLACE_WILDCARD = `(?:.*)`;\r\n\tprivate static FOLLOWED_BY_SLASH_REGEXP = '(?:\\\\/$|$)';\t\t// 单\\，编译错误 (?:\\/$|$)\r\n\tprivate static MATCH_REGEXP_FLAGS = '';\r\n\r\n\tprivate static isPushStateAvailable() {\r\n\t\treturn !!(\r\n\t\t  typeof window !== 'undefined' &&\r\n\t\t  window.history &&\r\n\t\t  window.history.pushState\r\n\t\t);\r\n\t}\r\n\t\r\n\tprivate static clean(s:string|RegExp) {\r\n\t\tif (s instanceof RegExp) return s;\r\n\t\treturn Navigo.cleanUrl(s);\r\n\t}\r\n\tprivate static cleanUrl(s:string) {\r\n\t\treturn s.replace(/\\/+$/, '').replace(/^\\/+/, '^/');\r\n\t}\r\n\r\n\tprivate static regExpResultToParams(match:any[], names:string[]) {\r\n\t\tif (names.length === 0) return null;\r\n\t\tif (!match) return null;\r\n\t\treturn match\r\n\t\t  .slice(1, match.length)\r\n\t\t  .reduce((params, value, index) => {\r\n\t\t\t\tif (params === null) params = {};\r\n\t\t\t\tparams[names[index]] = decodeURIComponent(value);\r\n\t\t\t\treturn params;\r\n\t\t  }, null);\r\n\t}\r\n\t  \r\n\tprivate static replaceDynamicURLParts(route:string|RegExp) {\r\n\t\tlet paramNames:string[] = [], regexp:RegExp;\r\n\t  \r\n\t\tif (route instanceof RegExp) {\r\n\t\t\tregexp = route;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tregexp = new RegExp(\r\n\t\t\t\troute.replace(Navigo.PARAMETER_REGEXP, function (full, dots, name) {\r\n\t\t\t\t\t\tparamNames.push(name);\r\n\t\t\t\t\t\treturn Navigo.REPLACE_VARIABLE_REGEXP;\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.replace(Navigo.WILDCARD_REGEXP, Navigo.REPLACE_WILDCARD) + Navigo.FOLLOWED_BY_SLASH_REGEXP\r\n\t\t\t\t, Navigo.MATCH_REGEXP_FLAGS);\r\n\t\t}\r\n\t\treturn { regexp, paramNames };\r\n\t}\r\n\t  \r\n\tprivate static getUrlDepth(url:string):number {\r\n\t\treturn url.replace(/\\/$/, '').split('/').length;\r\n\t}\r\n\t  \r\n\tprivate static compareUrlDepth(urlA:string, urlB:string) {\r\n\t\treturn Navigo.getUrlDepth(urlB) - Navigo.getUrlDepth(urlA);\r\n\t}\r\n\t  \r\n\tprivate static findMatchedRoutes(url:string, routes:Route[] = []) {\r\n\t\treturn routes.map(route => {\r\n\t\t\tlet { regexp, paramNames } = Navigo.replaceDynamicURLParts(Navigo.clean(route.route));\r\n\t\t\tlet match = url.replace(/^\\/+/, '/').match(regexp);\r\n\t\t\tlet params = Navigo.regExpResultToParams(match, paramNames);\r\n\t\t\treturn match ? { match, route, params } : false;\r\n\t\t}).filter(m => m);\r\n\t}\r\n\t  \r\n\tprivate static match(url:string, routes:Route[]) {\r\n\t\treturn Navigo.findMatchedRoutes(url, routes)[0] || false;\r\n\t}\r\n\t  \r\n\tprivate static root(url:string, routes:Route[]) {\r\n\t\tconst colonExp = RegExp('\\\\/:\\\\D(\\\\w*)', 'g');\r\n\t\tconst exp = ''; // '($|\\\\/)';  // 单\\，编译报错 ($|\\/)\r\n\t\tlet matched = routes.map(\r\n\t\t\troute => {\r\n\t\t\t\tlet r = route.route;\r\n\t\t\t\tif (r === '' || r === '*') return url;\r\n\t\t\t\tif (typeof r === 'string') {\r\n\t\t\t\t\tr = r.replace(colonExp, '\\\\/\\\\w+');\r\n\t\t\t\t}\r\n\t\t\t\tlet routeExp = r + exp;\r\n\t\t\t\tlet ret = url.split(new RegExp(routeExp))[0];\r\n\t\t\t\treturn ret;\r\n\t\t\t}\r\n\t\t);\r\n\t\tlet fallbackURL = Navigo.cleanUrl(url);\r\n\t\tlet len = matched.length;\r\n\t\tif (len === 0) return fallbackURL;\r\n\t\tlet matched0 = matched[0];\r\n\t\tif (len === 1) return matched0;\r\n\t\treturn matched.reduce((result, url) => {\r\n\t\t\tif (result.length > url.length) result = url;\r\n\t\t\treturn result;\r\n\t\t}, matched0);\r\n\t}\r\n\t  \r\n\tprivate static isHashChangeAPIAvailable() {\r\n\t\treturn typeof window !== 'undefined' && 'onhashchange' in window;\r\n\t}\r\n\t  \r\n\tprivate static extractGETParameters(url:string):string {\r\n\t\treturn url.split(/\\?(.*)?$/).slice(1).join('');\r\n\t}\r\n\t  \r\n\tprivate static getOnlyURL(url:string, useHash:boolean, hash:string) {\r\n\t\tlet onlyURL = url, split:string[];\r\n\t\tvar cleanGETParam = (str:string) => str.split(/\\?(.*)?$/)[0];\r\n\t  \r\n\t\tif (typeof hash === 'undefined') {\r\n\t\t\t// To preserve BC\r\n\t\t\thash = '#';\r\n\t\t}\r\n\t  \r\n\t\tif (Navigo.isPushStateAvailable() && !useHash) {\r\n\t\t  \tonlyURL = cleanGETParam(url).split(hash)[0];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tsplit = url.split(hash);\r\n\t\t\tonlyURL = split.length > 1 ? cleanGETParam(split[1]) : cleanGETParam(split[0]);\r\n\t\t}\r\n\t\treturn onlyURL;\r\n\t}\r\n\t  \r\n\tprivate static manageHooks(handler:RouteFunc, hooks:Hooks, params?:any, exHooks?:Hooks) {\r\n\t\tif (hooks && typeof hooks === 'object') {\r\n\t\t\tif (hooks.before) {\r\n\t\t\t\thooks.before((shouldRoute = true) => {\r\n\t\t\t\tif (!shouldRoute) return;\r\n\t\t\t\thandler();\r\n\t\t\t\thooks.after && hooks.after(params);\r\n\t\t\t\t}, params);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\telse if (hooks.after) {\r\n\t\t\t\thandler();\r\n\t\t\t\thooks.after && hooks.after(params);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\thandler();\r\n\t}\r\n\t  \r\n\tprivate static isHashedRoot(url:string, useHash:boolean, hash:string) {\r\n\t\tif (Navigo.isPushStateAvailable() && !useHash) {\r\n\t\t  return false;\r\n\t\t}\r\n\t  \r\n\t\tif (!url.match(hash)) {\r\n\t\t  return false;\r\n\t\t}\r\n\t  \r\n\t\tlet split = url.split(hash);\r\n\t  \r\n\t\treturn split.length < 2 || split[1] === '';\r\n\t}\r\n\t\r\n\tprivate root:string;\r\n\tprivate _routes:Route[] = [];\r\n\tprivate _useHash:boolean;\r\n\tprivate _hash:string;\r\n\tprivate _paused:boolean;\r\n\tprivate _destroyed:boolean;\r\n\tprivate _lastRouteResolved:LastResolved;\r\n\tprivate _notFoundHandler:Handler;\r\n\tprivate _defaultHandler:Handler;\r\n\tprivate _usePushState:boolean;\r\n\tprivate _genericHooks:Hooks;\r\n\tprivate _historyUpdateMethod: 'pushState' | 'replaceState'; // HistoryUpdateMethod;\r\n\tprivate timout: any; //NodeJS.Timeout;\r\n\r\n\tconstructor(r:string = null, useHash:boolean = false, hash:string = '#') {\r\n\t\tthis.root = null;\r\n\t\tthis._useHash = useHash;\r\n\t\tthis._hash = (!hash)? '#' : hash;\r\n\t\tthis._paused = false;\r\n\t\tthis._destroyed = false;\r\n\t\tthis._lastRouteResolved = null;\r\n\t\tthis._notFoundHandler = null;\r\n\t\tthis._defaultHandler = null;\r\n\t\tthis._usePushState = !useHash && Navigo.isPushStateAvailable();\r\n\t\t//this._onLocationChange = this._onLocationChange.bind(this);\r\n\t\tthis._genericHooks = null;\r\n\t\tthis._historyUpdateMethod = 'pushState';\r\n\t\r\n\t\tif (r) {\r\n\t\t\tthis.root = useHash ? r.replace(/\\/$/, '/' + this._hash) : r.replace(/\\/$/, '');\r\n\t\t} else if (useHash) {\r\n\t\t\tthis.root = this._cLoc().split(this._hash)[0].replace(/\\/$/, '/' + this._hash);\r\n\t\t}\r\n\t\r\n\t\tthis._listen();\r\n\t\tthis.updatePageLinks();\r\n\t}\r\n  \r\n\tnavigate(path:string, absolute:boolean = false):Navigo {\r\n\t\tlet to:string;\r\n\t\tpath = path || '';\r\n\t\tif (this._usePushState) {\r\n\t\t\tto = (!absolute ? this._getRoot() + '/' : '') + path.replace(/^\\/+/, '/');\r\n\t\t\tto = to.replace(/([^:])(\\/{2,})/g, '$1/');\r\n\t\t\tthis._historyUpdate({}, '', to);\r\n\t\t\tthis.resolve();\r\n\t\t}\r\n\t\telse if (typeof window !== 'undefined') {\r\n\t\t\tpath = path.replace(new RegExp('^' + this._hash), '');\r\n\t\t\tlet {location} = window;\r\n\t\t\tlocation.href = location.href\r\n\t\t\t\t.replace(/#$/, '')\r\n\t\t\t\t.replace(new RegExp(this._hash + '.*$'), '') + this._hash + path;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\ton(routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(url:string, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(regex:RegExp, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(options: {[url:string]: RouteFunc|NamedRoute}):Navigo;\r\n\ton(...args:any[]):Navigo {\r\n\t\tlet arg0 = args[0];\r\n\t\tlet arg1 = args[1];\r\n\t\tswitch (typeof arg0) {\r\n\t\t\tcase 'function':\r\n\t\t\t\tthis._defaultHandler = { handler: arg0, hooks: arg1 };\r\n\t\t\t\tif (!this._notFoundHandler) {\r\n\t\t\t\t\tthis._notFoundHandler = this._defaultHandler;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'object':\r\n\t\t\t\tlet orderedRoutes = Object.keys(arg0).sort(Navigo.compareUrlDepth);\r\n\t\t\t\torderedRoutes.forEach(route => this.on(route, arg0[route]));\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tif (args.length < 2) break;\r\n\t\t\t\tif (arg0 === '/') {\r\n\t\t\t\t\tthis._defaultHandler = { \r\n\t\t\t\t\t\thandler: typeof arg1 === 'object'? arg1.uses : arg1, \r\n\t\t\t\t\t\thooks: args[2],\r\n\t\t\t\t\t};\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tthis._add(arg0, arg1, args[2]);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\toff(handler:RouteFunc):Navigo {\r\n\t\tif (this._defaultHandler !== null && handler === this._defaultHandler.handler) {\r\n\t\t\tthis._defaultHandler = null;\r\n\t\t}\r\n\t\telse if (this._notFoundHandler !== null && handler === this._notFoundHandler.handler) {\r\n\t\t\tthis._notFoundHandler = null;\r\n\t\t}\r\n\t\tthis._routes = this._routes.reduce((result, r) => {\r\n\t\t\tif (r.handler !== handler) result.push(r);\r\n\t\t\treturn result;\r\n\t\t}, []);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tnotFound(handler:RouteFunc, hooks:Hooks):Navigo {\r\n\t\tthis._notFoundHandler = { handler, hooks };\r\n\t\treturn this;\r\n\t}\r\n\r\n\tresolve(current?:string) {\r\n\t\tlet c = current || this._cLoc();\r\n\t\tlet root = this._getRoot();\r\n\t\tlet url = c.replace(root, '');\r\n\t\r\n\t\tif (this._useHash) {\r\n\t\t\tconst exp = '^\\\\/';  // 单\\，编译报错 ^\\/\r\n\t\t\turl = url.replace(new RegExp(exp + this._hash), '/');\r\n\t\t}\r\n\t\r\n\t\tlet GETParameters = Navigo.extractGETParameters(current || this._cLoc());\r\n\t\tlet onlyURL = Navigo.getOnlyURL(url, this._useHash, this._hash);\r\n\t\r\n\t\tif (this._paused) return false;\r\n\t\r\n\t\tif (\r\n\t\t\tthis._lastRouteResolved &&\r\n\t\t\tonlyURL === this._lastRouteResolved.url &&\r\n\t\t\tGETParameters === this._lastRouteResolved.query\r\n\t\t) {\r\n\t\t\tif (this._lastRouteResolved.hooks && this._lastRouteResolved.hooks.already) {\r\n\t\t\t\tthis._lastRouteResolved.hooks.already(this._lastRouteResolved.params);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\r\n\t\tlet matched = Navigo.match(onlyURL, this._routes);\r\n\t\r\n\t\tlet manageHooks = (handler:Handler) => {\r\n\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\tquery: GETParameters, \r\n\t\t\t\t\t\thooks: handler.hooks\r\n\t\t\t\t\t};\r\n\t\t\t\t\thandler.handler(GETParameters);\r\n\t\t\t\t}, handler.hooks);\r\n\t\t\t}, this._genericHooks);\r\n\t\t}\r\n\r\n\t\tif (matched === false) {\r\n\t\t\tif (this._defaultHandler && (\r\n\t\t\t\tonlyURL === '' ||\r\n\t\t\t\tonlyURL === '/' ||\r\n\t\t\t\tonlyURL === this._hash ||\r\n\t\t\t\tNavigo.isHashedRoot(onlyURL, this._useHash, this._hash)\r\n\t\t\t)) {\r\n\t\t\t\t/*\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\t\tquery: GETParameters, \r\n\t\t\t\t\t\t\thooks: this._defaultHandler.hooks\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis._defaultHandler.handler(GETParameters);\r\n\t\t\t\t\t}, this._defaultHandler.hooks);\r\n\t\t\t\t}, this._genericHooks);\r\n\t\t\t\t*/\r\n\t\t\t\tmanageHooks(this._defaultHandler);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\telse if (this._notFoundHandler) {\r\n\t\t\t\t/*\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\t\tquery: GETParameters,\r\n\t\t\t\t\t\t\thooks: this._notFoundHandler.hooks\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis._notFoundHandler.handler(GETParameters);\r\n\t\t\t\t\t}, this._notFoundHandler.hooks);\r\n\t\t\t\t}, this._genericHooks);\r\n\t\t\t\t*/\r\n\t\t\t\tmanageHooks(this._notFoundHandler);\r\n\t\t\t}\r\n\t\t\treturn false;\t\r\n\t\t}\r\n\t\tlet m = matched;\r\n\t\tif (m) {\r\n\t\t\tthis._callLeave();\r\n\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\turl: onlyURL,\r\n\t\t\t\tquery: GETParameters,\r\n\t\t\t\thooks: m.route.hooks,\r\n\t\t\t\tparams: m.params,\r\n\t\t\t\tname: m.route.name\r\n\t\t\t};\r\n\t\t\tlet handler = m.route.handler;\r\n\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tm.route.route instanceof RegExp ?\r\n\t\t\t\t\thandler(...(m.match.slice(1, m.match.length))) :\r\n\t\t\t\t\thandler(m.params, GETParameters);\r\n\t\t\t\t}, m.route.hooks, m.params, this._genericHooks);\r\n\t\t\t}, this._genericHooks, m.params);\r\n\t\t\treturn m;\r\n\t\t}\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis._routes = [];\r\n\t\tthis._destroyed = true;\r\n\t\tthis._lastRouteResolved = null;\r\n\t\tthis._genericHooks = null;\r\n\t\tclearTimeout(this.timout);\r\n\t\tif (typeof window !== 'undefined') {\r\n\t\t\twindow.removeEventListener('popstate', this._onLocationChange);\r\n\t\t\twindow.removeEventListener('hashchange', this._onLocationChange);\r\n\t\t}\r\n\t}\r\n\r\n\tupdatePageLinks() {\r\n\t\t//var self = this;\r\n\t\tif (typeof document === 'undefined') return;\r\n\t\t\tthis._findLinks().forEach(link => {\r\n\t\t\tif (!link.hasListenerAttached) {\r\n\t\t\t\tlink.addEventListener('click', (e: React.MouseEvent<HTMLElement>) => {\r\n\t\t\t\t\tif((e.ctrlKey || e.metaKey) && e.currentTarget.tagName.toLowerCase() === 'a'){ return false; }\r\n\t\t\t\t\tvar location = this.getLinkPath(link);\r\n\t\t\r\n\t\t\t\t\tif (!this._destroyed) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tthis.navigate(location.replace(/\\/+$/, '').replace(/^\\/+/, '/'));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tlink.hasListenerAttached = true;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tgenerate(name:string, data:any = {}) {\r\n\t\tlet result = this._routes.reduce((result, route) => {\r\n\t\t\tif (route.name === name) {\r\n\t\t\t\tresult = route.route.toString();\r\n\t\t\t\tfor (let key in data) {\r\n\t\t\t\t\tresult = result.replace(':' + key, data[key]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t}, '');\r\n\t\r\n\t\treturn this._useHash ? this._hash + result : result;\r\n\t}\r\n\r\n\tlink(path:string) {\r\n\t\treturn this._getRoot() + path;\r\n\t}\r\n\r\n\tpause(status:boolean = true) {\r\n\t\tthis._paused = status;\r\n\t\tif (status) {\r\n\t\t\tthis._historyUpdateMethod = 'replaceState';\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._historyUpdateMethod = 'pushState';\r\n\t\t}\r\n\t}\r\n\r\n\tresume() {\r\n\t\tthis.pause(false);\r\n\t}\r\n\r\n\thistoryAPIUpdateMethod(value:'pushState' | 'replaceState') {\r\n\t\tif (typeof value === 'undefined') return this._historyUpdateMethod;\r\n\t\tthis._historyUpdateMethod = value;\r\n\t\treturn value;\r\n\t}\r\n\r\n\tdisableIfAPINotAvailable() {\r\n\t\tif (!Navigo.isPushStateAvailable()) {\r\n\t\t\tthis.destroy();\r\n\t\t}\r\n\t}\r\n\r\n\tlastRouteResolved() {\r\n\t\treturn this._lastRouteResolved;\r\n\t}\r\n\r\n\tgetLinkPath(link:any) {\r\n\t\treturn link.getAttribute('href');\r\n\t}\r\n\r\n\thooks(hooks:Hooks) {\r\n\t\tthis._genericHooks = hooks;\r\n\t}\r\n\r\n\tprivate _add(route:string|RegExp, handler:RouteFunc|NamedRoute, hooks:Hooks) {\r\n\t\tif (typeof route === 'string') {\r\n\t\t\troute = encodeURI(route);\r\n\t\t}\r\n\t\tthis._routes.push(\r\n\t\t\ttypeof handler === 'object' ?\r\n\t\t\t{\r\n\t\t\t\troute,\r\n\t\t\t\thandler: handler.uses,\r\n\t\t\t\tname: handler.as,\r\n\t\t\t\thooks: hooks || handler.hooks\r\n\t\t\t} \r\n\t\t\t:\r\n\t\t\t{\r\n\t\t\t\troute,\r\n\t\t\t\thandler, \r\n\t\t\t\tname: undefined,\r\n\t\t\t\thooks,\r\n\t\t\t}\r\n\t\t);\r\n\t\treturn this._add;\r\n\t}\r\n\r\n\tprivate _historyUpdate(data:any, title:string, url?:string) {\r\n\t\tswitch (this._historyUpdateMethod) {\r\n\t\t\tdefault: throw Error('unknow history method ' + this._historyUpdateMethod);\r\n\t\t\tcase 'pushState': window.history.pushState(data, title, url); return;\r\n\t\t\tcase 'replaceState': window.history.replaceState(data, title, url); return;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _getRoot() {\r\n\t\tif (this.root !== null) return this.root;\r\n\t\tlet cLoc = this._cLoc();\r\n\t\tlet cLocRoot = cLoc.split('?')[0];\r\n\t\tthis.root = Navigo.root(cLocRoot, this._routes);\r\n\t\treturn this.root;\r\n\t}\r\n\r\n\tprivate _listen() {\r\n\t\tif (this._usePushState) {\r\n\t\t\twindow.addEventListener('popstate', this._onLocationChange);\r\n\t\t}\r\n\t\telse if (Navigo.isHashChangeAPIAvailable()) {\r\n\t\t\twindow.addEventListener('hashchange', this._onLocationChange);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet cached = this._cLoc();\r\n\t\r\n\t\t\tlet check = () => {\r\n\t\t\t\tlet current = this._cLoc();\r\n\t\t\t\tif (cached !== current) {\r\n\t\t\t\t\tcached = current;\r\n\t\t\t\t\tthis.resolve();\r\n\t\t\t\t}\r\n\t\t\t\tif (this.timout) clearTimeout(this.timout);\r\n\t\t\t\tthis.timout = setTimeout(check, 200);\r\n\t\t\t};\r\n\t\t\tcheck();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _cLoc() {\r\n\t\tif (typeof window !== 'undefined') {\r\n\t\t\t//if (typeof window.__NAVIGO_WINDOW_LOCATION_MOCK__ !== 'undefined') {\r\n\t\t\t//\treturn window.__NAVIGO_WINDOW_LOCATION_MOCK__;\r\n\t\t\t//}\r\n\t\t\treturn Navigo.cleanUrl(window.location.href);\r\n\t\t}\r\n\t\treturn '';\r\n\t}\r\n\r\n\tprivate _findLinks() {\r\n\t\treturn [].slice.call(document.querySelectorAll('[data-navigo]'));\r\n\t}\r\n\r\n\tprivate _onLocationChange = () => {\r\n\t\tconsole.log('_onLocationChange');\r\n\t\tthis.resolve();\r\n\t}\r\n\r\n\tprivate _callLeave() {\r\n\t\tconst lastRouteResolved = this._lastRouteResolved;\t\r\n\t\tif (lastRouteResolved) {\r\n\t\t\tlet {params, hooks} = lastRouteResolved;\r\n\t\t\tif (hooks) {\r\n\t\t\t\tif (hooks.leave) {\r\n\t\t\t\t\thooks.leave(params);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n//export default Navigo;\r\nexport const navigo = new Navigo();\r\n","import React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nconst scrollAfter = 20; // 20ms之后，scroll执行\r\nexport class Scroller {\r\n    private el: HTMLBaseElement;\r\n    constructor(el: HTMLBaseElement) {\r\n        this.el = el;\r\n    }\r\n\r\n    scrollToTop():void {\r\n        setTimeout(() => this.el.scrollTo(0, 0), scrollAfter);\r\n    }\r\n    scrollToBottom():void {\r\n        setTimeout(() => this.el.scrollTo(0, this.el.scrollTop + this.el.offsetHeight), scrollAfter);\r\n    }\r\n}\r\n\r\nexport interface ScrollProps {\r\n    onScroll?: (e:any) => void;\r\n    onScrollTop?: (scroller: Scroller) => Promise<boolean>;\r\n\tonScrollBottom?: (scroller: Scroller) => Promise<void>;\r\n\tclassName?: string;\r\n}\r\ninterface ScrollViewProps extends ScrollProps {\r\n\tclassName?: string;\r\n\tstyle?: React.CSSProperties;\r\n}\r\nconst scrollTimeGap = 100;\r\nexport class ScrollView extends React.Component<ScrollViewProps, null> {\r\n    private bottomTime:number = 0;\r\n\tprivate topTime:number = 0;\r\n\tprivate div: HTMLDivElement;\r\n\r\n\tprivate refDiv = (div:HTMLDivElement) => {\r\n\t\tif (!div) {\r\n\t\t\tif (this.div) {\r\n\t\t\t\tthis.div.removeEventListener('resize', this.onResize)\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.div = div;\r\n\t\tthis.div.addEventListener('resize', this.onResize);\r\n\t}\r\n\r\n\tprivate onResize = (ev:UIEvent) => {\r\n\t\tconsole.error('div resize');\r\n\t};\r\n\r\n    private onScroll = async (e:any) => {\r\n        let {onScroll, onScrollTop, onScrollBottom} = this.props;\r\n        if (onScroll) this.props.onScroll(e);\r\n        let el = e.target as HTMLBaseElement;\r\n        let scroller = new Scroller(el);\r\n        if (el.scrollTop < 30) {\r\n            if (onScrollTop !== undefined) {\r\n                let topTime = new Date().getTime();\r\n                if (topTime-this.topTime > scrollTimeGap) {\r\n                    this.topTime = topTime;\r\n\t\t\t\t\tonScrollTop(scroller).then(ret => {\r\n\t\t\t\t\t\t // has more\r\n\t\t\t\t\t\tif (ret === true) {\r\n\t\t\t\t\t\t\tlet sh = el.scrollHeight;\r\n\t\t\t\t\t\t\tlet top = 200;\r\n\t\t\t\t\t\t\tif (top > sh) top = sh;\r\n\t\t\t\t\t\t\tel.scrollTop = top;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n                }\r\n            }\r\n        }\r\n        if (el.scrollTop + el.offsetHeight > el.scrollHeight - 30) {\r\n            //this.eachChild(this, 'bottom');\r\n            if (onScrollBottom !== undefined) {\r\n                let bottomTime = new Date().getTime();\r\n                if (bottomTime - this.bottomTime > scrollTimeGap) {\r\n                    this.bottomTime = bottomTime;\r\n                    onScrollBottom(scroller);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    private eachChild(c:any, direct:'top'|'bottom') {\r\n        let { props } = c;\r\n        if (props === undefined)\r\n            return;\r\n        let { children } = props;\r\n        if (children === undefined)\r\n            return;\r\n        React.Children.forEach(children, (child, index) => {\r\n            let {_$scroll} = child as any;\r\n            if (_$scroll) _$scroll(direct);\r\n            console.log(child.toString());\r\n            this.eachChild(child, direct);\r\n        });\r\n\t}\r\n\t\r\n    render() {\r\n\t\tlet {className, style} = this.props;\r\n\t\treturn <div ref={this.refDiv} className={classNames('tv-page')}\r\n\t\t\tonScroll={this.onScroll} style={style}>\r\n\t\t\t<article className={className}>\r\n\t\t\t\t{this.props.children}\r\n\t\t\t</article>\r\n\t\t</div>;\r\n    }\r\n}\r\n\r\n","import * as React from 'react';\r\n\r\nexport function Loading() {\r\n    return <div className=\"d-flex h-100 align-items-center justify-content-center\">\r\n        <i className=\"fa fa-spinner fa-spin fa-2x fa-fw text-info\" />\r\n    </div>;\r\n}\r\n","import { LocalMap } from './localDb';\r\n\r\nconst testingTags:string[] = ['/test', '/test/', '-test', '-test/'];\r\nfunction isTesting():boolean {\r\n    let {pathname} = document.location;\r\n    let pn = pathname.toLowerCase();\r\n    for (let item of testingTags) {\r\n        if (pn.endsWith(item) === true) return true;\r\n    }\r\n    return false;\r\n}\r\n\r\nexport const env = (function () {\r\n    let testing = isTesting();\r\n    let localDb = new LocalMap(testing===true? '$$':'$');\r\n    return {\r\n        testing: testing,\r\n        isDevelopment: process.env.NODE_ENV === 'development',\r\n        localDb: localDb,\r\n        setTimeout: (tag:string, callback: (...args: any[]) => void, ms: number, ...args: any[]):NodeJS.Timer => {\r\n            //if (tag !== undefined) console.log('setTimeout ' + tag);\r\n            return global.setTimeout(callback, ms, ...args);\r\n        },\r\n        clearTimeout: (handle:NodeJS.Timer):void => {\r\n            global.clearTimeout(handle);\r\n        },\r\n        setInterval: (callback: (...args: any[]) => void, ms: number, ...args: any[]): NodeJS.Timer => {\r\n            return global.setInterval(callback, ms, ...args);\r\n        },\r\n        clearInterval: (handle:NodeJS.Timer):void => {\r\n            global.clearInterval(handle);\r\n        }\r\n    }\r\n}());\r\n","\r\nexport * from './boxId';\r\nexport { Tuid, TuidImport, TuidInner, TuidDiv, TuidBox } from './tuid';\r\nexport { TuidsCache } from './tuidsCache';\r\nexport { tv, ReactBoxId, uqStringify } from './reactBoxId';","import {HttpChannel} from './httpChannel';\r\nimport { Caller } from './caller';\r\n\r\nexport async function refetchApi(channel:HttpChannel, url:string, options:any, \r\n    resolve:(values:any)=>any, reject:(reason:any)=>void)\r\n{\r\n    await channel.fetch(url, options, false, resolve, reject);\r\n}\r\n\r\nexport abstract class ApiBase {\r\n    protected token: string;\r\n    protected path: string;\r\n    protected showWaiting: boolean;\r\n\r\n    constructor(path: string, showWaiting: boolean) {\r\n        this.path = path || '';\r\n        this.showWaiting = showWaiting;\r\n    }\r\n\r\n    protected abstract async getHttpChannel(): Promise<HttpChannel>;\r\n\r\n    async xcall(caller:Caller<any>):Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.xcall(this.path, caller);\r\n    }\r\n\r\n    public async call(url:string, method:string, body:any):Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.callFetch(url, method, body);\r\n    }\r\n\r\n    public async get(path:string, params:any=undefined): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.get(this.path + path, params);\r\n    }\r\n\r\n    public async post(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.post(this.path + path, params);\r\n    }\r\n\r\n    public async put(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.put(this.path + path, params);\r\n    }\r\n\r\n    public async delete(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.delete(this.path + path, params);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\nimport { UiImageItem } from '../schema';\r\nimport { ImageUploader } from '../resUploader';\r\nimport { nav } from '../nav';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class ImageItemEdit extends ItemEdit {\r\n    get uiItem(): UiImageItem {return this._uiItem as UiImageItem}\r\n    @observable private resId: string;\r\n\r\n    protected async internalStart():Promise<any> {\r\n        this.resId = this.value;\r\n        return new Promise<any>((resolve, reject) => {\r\n            nav.push(React.createElement(this.page, {resolve:resolve, reject:reject}), ()=>reject());\r\n        });\r\n    }\r\n\r\n    /*\r\n    private upload = async () => {\r\n        if (!this.resUploader) return;\r\n        let ret = await this.resUploader.upload();\r\n        if (ret === null) {\r\n            this.overSize = true;\r\n            env.setTimeout('imageItemEdit upload', () => this.overSize = false, 3000);\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.value);\r\n    }\r\n    */\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let size:any = this.uiItem && this.uiItem.size;\r\n\r\n        /*\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center\"\r\n            disabled={!this.isChanged}\r\n            onClick={()=>resolve(this.resId)}>保存</button>;\r\n        let overSize:any;\r\n        if (this.overSize === true) {\r\n            overSize = <div className=\"text-danger\">\r\n                <i className=\"fa fa-times-circle\" /> 图片文件大小超过2M，无法上传\r\n            </div>;\r\n        }\r\n        */\r\n        return <ImageUploader \r\n            label={'更改' + this.label}\r\n            id={this.resId}\r\n            size={size}\r\n            onSaved={(resId):Promise<void>=>{resolve(resId); return;}} />;\r\n        /*\r\n        return <Page header={'更改' + this.label} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div>上传图片：</div>\r\n                    <div className=\"my-3\">\r\n                        <ResUploader ref={v=>this.resUploader=v} multiple={false} maxSize={2048} />\r\n                    </div>\r\n                    <div>\r\n                        <button className=\"btn btn-primary\" onClick={this.upload}>上传</button>\r\n                    </div>\r\n                </div>\r\n                {overSize}\r\n                <div className=\"small muted my-4\">支持JPG、GIF、PNG格式图片，不超过2M。</div>\r\n                <div className=\"d-flex\">\r\n                    <div className=\"w-12c h-12c mr-4\"\r\n                        style={{border: '1px dotted gray', padding: '8px'}}>\r\n                        <Image className=\"w-100 h-100\" src={this.resId} />\r\n                    </div>\r\n                    <div>\r\n                        <div className=\"small\">图片预览</div>\r\n                        <Image className=\"w-4c h-4c mt-3\" src={this.resId} />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n        */\r\n    })\r\n}\r\n","//import _ from 'lodash';\r\nimport { KeyValueRes, Res } from './res';\r\n\r\nexport interface FormRes extends KeyValueRes {\r\n    required: string;\r\n    number: string;\r\n    integer: string;\r\n    min: string;\r\n    max: string;\r\n}\r\n\r\n/*eslint no-template-curly-in-string: 0*/\r\nexport const formRes:Res<FormRes> = {\r\n    _: {\r\n        required: 'required',\r\n        number: 'not valid number',\r\n        integer: 'not valid integer',\r\n        min: 'min value is ${min}',\r\n        max: 'max value is ${max}',\r\n    },\r\n    zh: {\r\n        _: {\r\n            required: '必须填',\r\n            number: '需要数字',\r\n            integer: '需要整数',\r\n            min: '不能小于${min}',\r\n            max: '不能大于${max}',\r\n        }\r\n    },\r\n}\r\n","import { KeyValueRes, Res } from './res';\r\n\r\nexport interface ListRes extends KeyValueRes {\r\n    none: string;\r\n}\r\n\r\n/*eslint no-template-curly-in-string: 0*/\r\nexport const listRes:Res<ListRes> = {\r\n    _: {\r\n        none: '[none]',\r\n    },\r\n    zh: {\r\n        _: {\r\n            none: '[无]',\r\n        }\r\n    },\r\n}\r\n","import { Res } from '../res';\r\n\r\nexport interface LoginRes {\r\n    a: string;\r\n}\r\n\r\nexport const loginRes: Res<LoginRes> = {\r\n    _: {\r\n        a: 'd',\r\n    }\r\n}\r\n","import { Res } from '../res';\r\n\r\nexport interface RegisterRes {\r\n    a: string;\r\n}\r\n\r\nexport const registerRes: Res<RegisterRes> = {\r\n    _: {\r\n        a: 'd',\r\n    }\r\n}\r\n","import _ from 'lodash';\r\nimport {observable, IObservableArray, computed} from 'mobx';\r\n\r\nexport abstract class PageItems<T> {\r\n    constructor(itemObservable:boolean = false) {\r\n        this._items = observable.array<T>([], {deep:itemObservable});\r\n    }\r\n\tprivate isFirst: boolean = true;\r\n\tprivate pageItemAction: (item:T, results:{[name:string]:any[]}) => void;\r\n\tprivate itemConverter: (item:any, queryResults:{[name:string]:any[]}) => T;\r\n    @observable loading: boolean = false;\r\n    @observable private beforeLoad: boolean = true;\r\n    @observable protected loaded: boolean = false;\r\n    protected _items:IObservableArray<T>;\r\n    @observable allLoaded: boolean = false;\r\n    @computed get items():IObservableArray<T> {\r\n        if (this.beforeLoad === true) return null;\r\n        if (this.loaded === false) return undefined;\r\n        return this._items;\r\n\t}\r\n\t\r\n\tsetEachPageItem(pageItemAction: (item:T, results:{[name:string]:any[]}) => void) {\r\n\t\tthis.pageItemAction = pageItemAction;\r\n\t}\r\n\r\n\tsetItemConverter(itemConverter: (item:any, queryResults:{[name:string]:any[]}) => T) {\r\n\t\tthis.itemConverter = itemConverter;\r\n\t}\r\n\r\n    @observable topDiv:string = '$$top';\r\n    @observable bottomDiv:string = '$$bottom';\r\n    scrollToTop = () => {\r\n\t\tthis.scrollIntoView(this.topDiv);\r\n\t\t//let id = '$$top'+uid();\r\n\t\t//this.topDiv = id;\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tlet div = document.getElementById(this.topDiv);\r\n\t\t\tdiv?.scrollIntoView();\r\n\t\t}, 20);\r\n\t\t*/\r\n    }\r\n    scrollToBottom = () => {\r\n\t\tthis.scrollIntoView(this.bottomDiv);\r\n\t\t//let id = '$$bottom'+uid();\r\n\t\t//this.bottomDiv = id;\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tlet div = document.getElementById(this.bottomDiv);\r\n\t\t\tdiv?.scrollIntoView();\r\n\t\t}, 20);\r\n\t\t*/\r\n\t}\r\n\tprivate scrollIntoView(divId:string) {\r\n\t\tsetTimeout(() => {\r\n\t\t\tlet div = document.getElementById(divId);\r\n\t\t\tdiv?.scrollIntoView();\r\n\t\t}, 20);\r\n\t}\r\n\r\n    protected param: any;\r\n    protected firstSize = 100;\r\n    protected pageStart:any = undefined;\r\n    protected pageSize = 30;\r\n    protected appendPosition:'head'|'tail' = 'tail';\r\n\r\n\tprotected sortOrder:'asc'|'desc';\r\n\tprotected abstract async loadResults(param:any, pageStart:any, pageSize:number):Promise<{[name:string]:any[]}>;\r\n\tprotected getPageId(item:T):any {return;}\r\n\tprotected setPageStart(item:T) {\r\n\t\tthis.pageStart = this.getPageId(item);\r\n\t}\r\n\t\r\n\tprotected async load(param:any, pageStart:any, pageSize:number):Promise<any[]> {\r\n\t\tlet results = await this.loadResults(param, pageStart, pageSize);\r\n\t\tlet pageList = results.$page;\r\n\t\tif (this.itemConverter) {\r\n\t\t\tlet ret:T[] = [];\r\n\t\t\tlet len = pageList.length;\r\n\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\tlet item = this.itemConverter(pageList[i], results);\r\n\t\t\t\tret.push(item);\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t\tif (this.pageItemAction !== undefined) {\r\n\t\t\tlet len = pageList.length;\r\n\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\tthis.pageItemAction(pageList[i], results);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn pageList;\r\n\t}\r\n\r\n    reset() {\r\n        this.isFirst = true;\r\n        this.beforeLoad = true;\r\n        this.loaded = false;\r\n        this.param = undefined;\r\n\t\tthis.allLoaded = false;\r\n\t\tthis.pageStart = undefined;\r\n        this._items.clear();\r\n        //this.setPageStart(undefined);\r\n    }\r\n\r\n    append(item:T) {\r\n        if (this.appendPosition === 'tail')\r\n            this._items.unshift(item);\r\n        else\r\n            this._items.push(item);\r\n    }\r\n\r\n    async first(param:any):Promise<void> {\r\n        this.reset();\r\n        this.beforeLoad = false;\r\n        this.param = param;\r\n        await this.more();\r\n\t}\r\n\r\n\tprivate changing = false;\r\n\tasync attach(): Promise<void> {\r\n\t\tif (this.sortOrder === undefined) {\r\n\t\t\tconsole.error('没有定义增减序，无法attach');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.changing === true) return;\r\n\t\tthis.changing = true;\r\n\t\tlet items = this._items;\r\n\t\tlet isAsc = this.sortOrder === 'asc';\r\n\t\t//let isTail:boolean, \r\n\t\tlet endItem:T;\r\n\t\tlet scrollToEnd:() => void;\r\n\t\tlet pushItem:(item:T) => void;\r\n\t\tif (this.appendPosition === 'tail') {\r\n\t\t\t//isTail = true;\r\n\t\t\tendItem = items[0];\r\n\t\t\tscrollToEnd = this.scrollToTop;\r\n\t\t\tpushItem = (item:T) => items.unshift(item);\r\n\r\n\t\t}\r\n\t\telse {\r\n\t\t\t//isTail = false;\r\n\t\t\tlet endIndex = items.length;\r\n\t\t\tendItem = items[endIndex-1];\r\n\t\t\tscrollToEnd = this.scrollToBottom;\r\n\t\t\tpushItem = (item:T) => items.splice(endIndex, 0, item);\r\n\t\t}\r\n\t\tlet startId = this.getPageId(endItem);\r\n\t\tlet pid = undefined;\r\n\t\tlet sum = 0, max = 50;\r\n\t\tfor (;sum < max;) {\r\n\t\t\tlet ret = await this.load(this.param, pid, 3);\r\n\t\t\tlet len = ret.length;\r\n\t\t\tif (len === 0) break;\r\n\r\n\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\tlet item = ret[i];\r\n\t\t\t\tpid = this.getPageId(item);\r\n\t\t\t\tif (isAsc === true) {\r\n\t\t\t\t\tif (pid >= startId) {\r\n\t\t\t\t\t\tmax = 0;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (pid <= startId) {\r\n\t\t\t\t\t\tmax = 0;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tpushItem(item);\r\n\t\t\t\t/*\r\n\t\t\t\tif (isTail === true) {\r\n\t\t\t\t\tthis._items.unshift(item);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis._items.push(item);\r\n\t\t\t\t}\r\n\t\t\t\t*/\r\n\t\t\t\t++sum;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.changing = false;\r\n\t\tif (sum > 0) {\r\n\t\t\tscrollToEnd();\r\n\t\t\t/*\r\n\t\t\tif (isTail === true) this.scrollToTop();\r\n\t\t\telse this.scrollToBottom();\r\n\t\t\t*/\r\n\t\t}\r\n\t}\r\n\r\n\tasync refresh(): Promise<void> {\r\n\t\tif (this.changing === true) return;\r\n\t\tthis.changing = true;\r\n\t\tlet ret = await this.load(this.param, undefined, this.firstSize>this.pageSize? this.firstSize:this.pageSize);\r\n\t\tthis._items.clear();\r\n\t\tthis.setLoaded(ret);\r\n\t\t/*\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tlet item = ret[i];\r\n\t\t\tlet pid = this.getRefreshPageId(item);\r\n\t\t\tlet index = this._items.findIndex(v => this.getRefreshPageId(v) === pid);\r\n\t\t\t//let index = _.sortedIndexBy(this._items, item, v=>this.getRefreshPageId(v));\r\n\t\t\t//let oldItem = this._items[index];\r\n\t\t\t//let oid = this.getRefreshPageId(oldItem);\r\n\t\t\tif (index >= 0) {\r\n\t\t\t\t_.merge(this._items[index], item);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._items.splice(0, 0, item);\r\n\t\t\t}\r\n\t\t}\r\n\t\t*/\r\n\t\tthis.changing = false;\r\n\t}\r\n\r\n\tprotected getRefreshPageId(item:T) {\r\n\t\treturn this.getPageId(item);\r\n\t}\r\n\r\n    protected async onLoad(): Promise<void> {}\r\n    protected async onLoaded(): Promise<void> {}\r\n\r\n    async more():Promise<boolean> {\r\n        if (this.allLoaded === true) return false;\r\n\t\tif (this.loading === true) return true;\r\n\t\tif (this.changing === true) return true;\r\n\t\tthis.loading = true;\r\n\t\tthis.changing = true;\r\n        await this.onLoad();\r\n        if (this.pageStart === undefined) this.setPageStart(undefined);\r\n        let pageSize = this.pageSize + 1;\r\n        if (this.isFirst === true) {\r\n            if (this.firstSize > this.pageSize) pageSize = this.firstSize+1;\r\n        }\r\n        let ret = await this.load(\r\n                this.param, \r\n                this.pageStart,\r\n\t\t\t\tpageSize);\r\n        this.loaded = true;\r\n\t\tlet len = ret.length;\r\n        if ((this.isFirst===true && len>this.firstSize) ||\r\n            (this.isFirst===false && len>this.pageSize))\r\n        {\r\n            this.allLoaded = false;\r\n            --len;\r\n            ret.splice(len, 1);\r\n        }\r\n        else {\r\n            this.allLoaded = true;\r\n\t\t}\r\n\t\t/*\r\n        if (len === 0) {\r\n\t\t\tthis.setPageStart(undefined);\r\n            this._items.clear();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.setPageStart(ret[len-1]);\r\n\t\t\tif (this.appendPosition === 'tail') {\r\n\t\t\t\tthis._items.push(...ret);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._items.unshift(...ret.reverse());\r\n\t\t\t}\r\n\t\t}\r\n\t\t*/\r\n\t\tthis.setLoaded(ret);\r\n\t\tthis.isFirst = false;\r\n\t\tthis.onLoaded();\r\n\t\tthis.changing = false;\r\n\t\tthis.loading = false;\r\n\t\treturn !this.allLoaded;\r\n\t}\r\n\t\r\n\tprivate setLoaded(data:any[]) {\r\n\t\tlet len = data.length;\r\n        if (len === 0) {\r\n\t\t\tthis.setPageStart(undefined);\r\n            this._items.clear();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.setPageStart(data[len-1]);\r\n\t\t\tif (this.appendPosition === 'tail') {\r\n\t\t\t\tthis._items.push(...data);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._items.unshift(...data.reverse());\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfindItem(item:any):T {\r\n\t\tlet pid = this.getPageId(item);\r\n\t\tlet index = _.findIndex(this._items, v => this.getPageId(v) === pid);\r\n\t\tif (index < 0) return;\r\n\t\treturn this._items[index];\r\n\t\t//let oldItem = this._items[index];\r\n\t\t//let oid = this.getPageId(oldItem);\r\n\t\t//if (pid === oid) return oldItem;\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport { IVPage } from './page';\r\nimport { IObservableValue } from 'mobx/lib/internal';\r\nimport '../../css/va-tab.css';\r\nimport { ScrollView } from './scrollView';\r\n\r\nexport type TabCaption = (selected:boolean) => JSX.Element;\r\n\r\nexport interface TabProp {\r\n    name: string;\r\n    caption: TabCaption;\r\n\tcontent?: () => JSX.Element;\r\n\tpage?: IVPage;\r\n    notify?: IObservableValue<number>;\r\n    load?: () => Promise<void>;\r\n\tonShown?: () => Promise<void>;\r\n\tisSelected?: boolean;\r\n\tonScroll?: () => void;\r\n\tonScrollTop?: () => Promise<boolean>;\r\n\tonScrollBottom?: () => Promise<void>;\r\n\tclassName?: string;\r\n}\r\n\r\nexport interface TabsProps {\r\n    tabs: TabProp[];\r\n    tabPosition?: 'top' | 'bottom';\r\n    size?: 'sm' | 'lg' | 'md';\r\n    tabBg?: string;\r\n    contentBg?: string;\r\n    sep?: string;\r\n    selected?: string;\r\n    borderColor?: string;\r\n    borderWidth?: string;\r\n}\r\n\r\nclass Tab {\r\n\t@observable private loaded: boolean = false;\r\n    name: string;\r\n    @observable selected: boolean;\r\n    caption: TabCaption;\r\n\tcontentBuilder: ()=>JSX.Element;\r\n\tpage: IVPage;\r\n    notify: IObservableValue<number>;\r\n    load?: () => Promise<void>;\r\n\tonShown?: () => Promise<void>;\r\n\tonScroll?: () => void;\r\n\tonScrollTop?: () => Promise<boolean>;\r\n\tonScrollBottom?: () => Promise<void>;\r\n\tclassName?: string;\r\n\r\n    private _content: JSX.Element;\r\n    \r\n    get content(): JSX.Element {\r\n\t\tif (this.load && this.loaded === false) return null;\r\n\t\tif (this.selected === false) return this._content;\r\n\t\tif (!this._content) {\r\n\t\t\tif (this.contentBuilder !== undefined) {\r\n\t\t\t\tthis._content = this.contentBuilder();\r\n\t\t\t}\r\n\t\t\telse if (this.page !== undefined) {\r\n\t\t\t\tthis._content = this.page.content();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._content = <div className=\"p-5\">tab 应该定义content或者page</div>;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._content;\r\n    }\r\n\r\n    async shown() {\r\n        if (this.onShown !== undefined) {\r\n            await this.onShown();\r\n        }\r\n        if (this.load !== undefined) {\r\n\t\t\tif (this.loaded === false) {\r\n\t\t\t\tawait this.load();\r\n\t\t\t\tthis.loaded = true;\r\n\t\t\t}\r\n        }\r\n    }\r\n}\r\n\r\nexport const TabCaptionComponent = (label:string, icon:string, color:string) => <div \r\n    className={'d-flex justify-content-center align-items-center flex-column cursor-pointer ' + color}>\r\n    <div><i className={'fa fa-lg fa-' + icon} /></div>\r\n    <small>{label}</small>\r\n</div>;\r\n\r\nexport const TabCaption = TabCaptionComponent;\r\n\r\nexport class TabsView {\r\n\tprivate props: TabsProps;\r\n    private size: string;\r\n    private tabBg: string;\r\n    //private contentBg: string;\r\n    private sep: string;\r\n    @observable private selectedTab: Tab;\r\n    @observable private tabArr: Tab[];\r\n\r\n    constructor(props: TabsProps) {\r\n\t\tthis.props = props;\r\n\t\tlet {size, tabs, tabBg: tabBack, sep, selected} = props;\r\n\t\tthis.size = size || 'md';\r\n        this.tabArr = tabs.map(v => {\r\n            let tab = new Tab();\r\n            let {name, caption, content, page, notify, load, onShown, isSelected, onScroll, onScrollTop, onScrollBottom, className} = v;\r\n\t\t\ttab.name = name;\r\n\t\t\tif (isSelected === true || name === selected) {\r\n\t\t\t\tthis.selectedTab = tab;\r\n\t\t\t}\r\n\t\t\ttab.selected = false;\r\n\t\t\ttab.caption = caption;\r\n\t\t\tif (content !== undefined) {\r\n\t\t\t\ttab.contentBuilder = content;\r\n\t\t\t}\r\n\t\t\telse if (page !== undefined) {\r\n\t\t\t\ttab.page = page;\r\n\t\t\t\t//contentBuilder = () => {return page.content()};\r\n\t\t\t}\r\n            tab.notify = notify;\r\n            tab.load = load;\r\n\t\t\ttab.onShown = onShown;\r\n\t\t\ttab.onScroll = onScroll;\r\n\t\t\ttab.onScrollTop = onScrollTop;\r\n\t\t\ttab.onScrollBottom = onScrollBottom;\r\n\t\t\ttab.className = className;\r\n            return tab;\r\n        });\r\n        this.tabBg = tabBack;\r\n        //this.contentBg = contentBack;\r\n        this.sep = sep;\r\n        if (this.selectedTab === undefined) {\r\n\t\t\tthis.selectedTab = this.tabArr[0];\r\n\t\t}\r\n        this.selectedTab.selected = true;\r\n    }\r\n\r\n    tabClick = async (tab:Tab) => {\r\n\t\tif (!tab) {\r\n\t\t\ttab = this.selectedTab;\r\n\t\t\tif (tab === undefined) {\r\n\t\t\t\tif (this.tabArr === undefined) return;\r\n\t\t\t\tif (this.tabArr.length === 0) return;\r\n\t\t\t\ttab = this.tabArr[0];\r\n\t\t\t}\r\n\t\t}\r\n\r\n        this.selectedTab.selected = false;\r\n        tab.selected = true;\r\n\t\tthis.selectedTab = tab;\r\n\t\t\r\n\t\tawait tab.shown();\r\n    }\r\n\r\n\t/*\r\n    showTab(tabName: string) {\r\n        let tab = this.tabs.find(v => v.name === tabName);\r\n        if (tab === undefined) return;\r\n        if (this.selectedTab !== undefined) this.selectedTab.selected = false;\r\n        tab.selected = true;\r\n        this.selectedTab = tab;\r\n\t}\r\n\t*/\r\n\r\n\tprivate tabs = observer(() => {\r\n        let {tabPosition, borderColor} = this.props;\r\n        let bsCur:React.CSSProperties, bsTab:React.CSSProperties\r\n        if (borderColor) {\r\n            bsCur = {\r\n                borderColor: borderColor,\r\n                borderStyle: 'solid',\r\n                borderTopWidth: 1,\r\n                borderLeftWidth: 1,\r\n                borderRightWidth: 1,\r\n                borderBottomWidth: 1,\r\n            }\r\n            bsTab = {\r\n                borderColor: borderColor,\r\n                borderStyle: 'solid',\r\n                borderTopWidth: 1,\r\n                borderBottomWidth: 1,\r\n                borderLeftWidth: 0,\r\n                borderRightWidth: 0,\r\n            }\r\n            if (tabPosition === 'top') {\r\n                bsCur.borderBottomWidth = 0;\r\n                bsCur.borderTopLeftRadius = 10;\r\n                bsCur.borderTopRightRadius = 10;\r\n                bsTab.borderTopWidth = 0;\r\n            }\r\n            else {\r\n                bsCur.borderTopWidth = 0;\r\n                bsCur.borderBottomLeftRadius = 10;\r\n                bsCur.borderBottomRightRadius = 10;\r\n                bsTab.borderBottomWidth = 0;\r\n            }\r\n        }\r\n\t\tlet cn = classNames('tv-tabs', this.tabBg, this.sep, 'tv-tabs-' + this.size);\r\n\t\tlet tabs = <div className={cn}>\r\n            {this.tabArr.map((v,index) => {\r\n                let {selected, caption, notify} = v;\r\n                let notifyCircle:any;\r\n                if (notify !== undefined) {\r\n                    let num = notify.get();\r\n                    if (num !== undefined) {\r\n                        if (num > 0) notifyCircle = <u>{num>99?'99+':num}</u>;\r\n                        else if (num < 0) notifyCircle = <u className=\"dot\" />;\r\n                    }\r\n                }\r\n                return <div key={index} onClick={()=>this.tabClick(v)} style={selected===true? bsCur:bsTab}>\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t{notifyCircle}\r\n\t\t\t\t\t{caption(selected)}\r\n\t\t\t\t\t</div>\r\n                </div>\r\n            })}\r\n\t\t</div>;\r\n\t\treturn tabs;\r\n\t});\r\n\r\n\tcontent = observer(() => {\r\n\t\tlet displayNone:React.CSSProperties = {visibility: 'hidden'};\r\n\t\treturn <>\r\n\t\t\t{this.tabArr.map((v,index) => {\r\n\t\t\t\tlet {tabPosition} = this.props;\r\n\t\t\t\tlet {content, page, onScroll, onScrollTop, onScrollBottom, className} = v;\r\n\t\t\t\tlet tabs = React.createElement(this.tabs);\r\n\t\t\t\tlet pageHeader:any, pageFooter:any;\r\n\t\t\t\tif (page !== undefined) {\r\n\t\t\t\t\tpageHeader = page.header();\r\n\t\t\t\t\tpageFooter = page.footer();\r\n\t\t\t\t}\r\n\t\t\t\tlet header:any, footer:any;\r\n\t\t\t\tlet visibility:React.CSSProperties = {visibility:'hidden'};\r\n\t\t\t\tif (tabPosition === 'top') {\r\n\t\t\t\t\theader = <>\r\n\t\t\t\t\t\t<section className=\"tv-page-header\">\r\n\t\t\t\t\t\t\t<header>{tabs}{pageHeader}</header>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<header style={visibility}>{tabs}{pageHeader}</header>\r\n\t\t\t\t\t</>;\r\n\t\t\t\t\tif (pageFooter !== undefined) {\r\n\t\t\t\t\t\tfooter = <>\r\n\t\t\t\t\t\t\t<footer style={visibility}>{pageFooter}</footer>\r\n\t\t\t\t\t\t\t<section className=\"tv-page-footer\">\r\n\t\t\t\t\t\t\t\t<footer>{pageFooter}</footer>\r\n\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t</>;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (pageHeader !== undefined) {\r\n\t\t\t\t\t\theader = <>\r\n\t\t\t\t\t\t\t<section className='tv-page-header'>\r\n\t\t\t\t\t\t\t\t<header>{pageHeader}</header>\r\n\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t\t<header style={visibility}>{pageHeader}</header>\r\n\t\t\t\t\t\t</>;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfooter = <>\r\n\t\t\t\t\t\t<footer style={visibility}>{pageFooter}{tabs}</footer>\r\n\t\t\t\t\t\t<section className='tv-page-footer'>\r\n\t\t\t\t\t\t\t<footer>{pageFooter}{tabs}</footer>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t</>;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet style:React.CSSProperties;\r\n\t\t\t\tif (v.selected===false) style = displayNone;\r\n\t\t\t\treturn <ScrollView key={index} className={className}\r\n\t\t\t\t\tstyle={style}\r\n\t\t\t\t\tonScroll={onScroll} onScrollTop={onScrollTop} onScrollBottom={onScrollBottom}>\r\n\t\t\t\t\t{header}\r\n\t\t\t\t\t{content}\r\n\t\t\t\t\t{footer}\r\n\t\t\t\t</ScrollView>;\r\n\t\t\t})}\r\n\t\t</>;\r\n\t});\r\n\r\n    render() {\r\n\t\tlet {tabPosition} = this.props;\r\n\t\tlet tabs = <this.tabs />;\r\n\t\tlet header:any, footer:any;\r\n\t\tlet visibility:React.CSSProperties = {display:'none'};\r\n\t\tif (tabPosition === 'top') {\r\n\t\t\theader = <header>{tabs}</header>;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tfooter = <footer>{tabs}</footer>;\r\n\t\t}\r\n\t\treturn <>\r\n\t\t\t{header}\r\n\t\t\t{this.tabArr.map((v,index) => {\r\n\t\t\t\tlet style:React.CSSProperties;\r\n\t\t\t\tif (v.selected===false) style = visibility;\r\n\t\t\t\treturn <div key={index} className={classNames(v.className)} style={style}>\r\n\t\t\t\t\t{v.content}\r\n\t\t\t\t</div>;\r\n\t\t\t})}\r\n\t\t\t{footer}\r\n\t\t</>;\r\n    }\r\n};\r\n\r\n@observer export class Tabs extends React.Component<TabsProps> {\r\n\tprivate readonly tabsView: TabsView;\r\n    constructor(props: TabsProps) {\r\n\t\tsuper(props);\r\n\t\tthis.tabsView = new TabsView(props);\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabsView.tabClick(undefined);\r\n\t\t}, 100);\r\n    }\r\n\r\n    render() {\r\n\t\treturn this.tabsView.render();\r\n    }\r\n};\r\n\r\n@observer export class RootTabs extends React.Component<TabsProps> {\r\n\tprivate readonly tabsView: TabsView;\r\n    constructor(props: TabsProps) {\r\n\t\tsuper(props);\r\n\t\tthis.tabsView = new TabsView(props);\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabsView.tabClick(undefined);\r\n\t\t}, 100);\r\n    }\r\n\r\n    render() {\r\n\t\treturn React.createElement(this.tabsView.content);\r\n    }\r\n};\r\n","import * as React from 'react';\r\nimport { nav } from './nav';\r\nimport { Loading } from './loading';\r\nimport { Image as ImageControl } from './image';\r\nimport { Page } from './page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\nimport { LMR } from './simple';\r\n\r\nexport interface ResUploaderProps {\r\n    className?: string;\r\n    label?: string;\r\n    multiple?: boolean;\r\n    maxSize?: number;\r\n    onFilesChange?: (evt: React.ChangeEvent<HTMLInputElement>) => void;\r\n}\r\n\r\n@observer\r\nexport class ResUploader extends React.Component<ResUploaderProps> {\r\n    private fileInput: HTMLInputElement;\r\n    @observable private fileName: string;\r\n\r\n    buildFormData():FormData {\r\n        let {maxSize} = this.props;\r\n        if (maxSize === undefined || maxSize <= 0) \r\n            maxSize = 100000000000;\r\n        else\r\n            maxSize = maxSize * 1024;\r\n        var files:FileList = this.fileInput.files;\r\n        var data = new FormData();\r\n        let len = files.length;\r\n        for (let i=0; i<len; i++) {\r\n            let file = files[i];\r\n            if (file.size > maxSize) return null;\r\n            data.append('files[]', file, file.name);\r\n        }\r\n    }\r\n\r\n    getFile0(): File {\r\n        return this.fileInput.files[0];\r\n    }\r\n\r\n    upload = async (formData?: FormData):Promise<string|{error:any}> => {\r\n        let resUrl = nav.resUrl + 'upload';\r\n        if (!formData) formData = this.buildFormData();\r\n        try {\r\n            nav.startWait();\r\n            let headers = new Headers();\r\n            headers.append('Access-Control-Allow-Origin', '*');\r\n            //2019-12-18：因为 vivo按oppo某些版本不支持，暂时先不要 \r\n            //let abortController = new AbortController();\r\n            let res = await fetch(resUrl, {\r\n                method: \"POST\",\r\n                body: formData,\r\n                headers: headers,\r\n                //signal: abortController.signal,\r\n            });\r\n            let json = await res.json();\r\n            return ':' + json.res.id;\r\n        }\r\n        catch (err) {\r\n            console.error('%s %s', resUrl, err);\r\n            return {error:err};\r\n        }\r\n        finally {\r\n            nav.endWait();\r\n        }\r\n    }\r\n\r\n    private onFilesChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        let {onFilesChange} = this.props;\r\n        if (onFilesChange) onFilesChange(evt);\r\n        let files = evt.target.files;\r\n        let len = files.length;\r\n        let names:string[] = [];\r\n        for (let i=0; i<len; i++) {\r\n            names.push(files.item(i).name);\r\n        }\r\n        this.fileName = names.join(', ');\r\n    }\r\n\r\n    render() {\r\n        let {className, multiple, label} = this.props;\r\n        return <div>\r\n                <label className=\"btn btn-outline-success\">\r\n                    {label || '选择文件'} \r\n                    <input \r\n                        className={className}\r\n                        ref={t=>this.fileInput=t} \r\n                        onChange={this.onFilesChange}\r\n                        type='file' name='file' \r\n                        multiple={multiple} style={{display:'none'}} />\r\n                </label>\r\n                &nbsp;\r\n                {this.fileName}\r\n            </div>\r\n    }\r\n}\r\n\r\nfunction formatSize(size:number, pointLength:number=2, units?:string[]) {\r\n    var unit;\r\n    units = units || [ 'B', 'K', 'M', 'G', 'TB' ];\r\n    while ( (unit = units.shift()) && size > 1024 ) {\r\n        size = size / 1024;\r\n    }\r\n    return (unit === 'B' ? size : size.toFixed( pointLength === undefined ? 2 : pointLength)) + unit;\r\n}\r\n\r\ninterface ImageUploaderProps {\r\n    id?: string;\r\n    label?: string;\r\n    size?: 'sm' | 'md' | 'lg';\r\n    onSaved?: (imageId:string) => Promise<void>;\r\n}\r\n\r\nconst largeSize = 800;\r\nconst mediumSize = 400;\r\nconst smallSize = 180;\r\n\r\n@observer\r\nexport class ImageUploader extends React.Component<ImageUploaderProps> {\r\n\tprivate static imageTypes = ['gif', 'jpg', 'jpeg', 'png', 'svg', 'apng', 'bmp', 'ico', 'cur', 'tiff', 'tif', 'webp'];\r\n    private imgBaseSize: number;\r\n    private suffix: string;\r\n    private resUploader: ResUploader;\r\n    @observable private file: File;    \r\n    @observable private desImgWidth: number;\r\n    @observable private desImgHeight: number;\r\n    @observable private desImgSize: number;\r\n    @observable private srcImgWidth: number;\r\n    @observable private srcImgHeight: number;\r\n    @observable private isChanged: boolean = false;\r\n    @observable private resId: string;\r\n    @observable private enableUploadButton: boolean = false;\r\n    @observable private srcImage: string;\r\n    @observable private desImage: string;\r\n    @observable private fileError: string;\r\n    @observable private uploaded: boolean = false;\r\n\r\n    constructor(props: ImageUploaderProps) {\r\n        super(props);\r\n        this.resId = props.id;\r\n    }\r\n\r\n    private onFileChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.fileError = undefined;\r\n        this.uploaded = false;\r\n        this.enableUploadButton = evt.target.files.length > 0;\r\n        if (this.enableUploadButton) {\r\n            this.file = evt.target.files[0];\r\n            let pos = this.file.name.lastIndexOf('.');\r\n            if (pos >= 0) this.suffix = this.file.name.substr(pos+1).toLowerCase();\r\n            if(ImageUploader.imageTypes.indexOf(this.suffix) < 0){\r\n                this.fileError = `图片类型必须是 ${ImageUploader.imageTypes.join(', ')} 中的一种`;\r\n                return;\r\n            }\r\n            let reader = new FileReader();\r\n            reader.readAsDataURL(this.file);\r\n            reader.onload = async () => {\r\n\t\t\t\tthis.srcImage = reader.result as string;\r\n\t\t\t\tswitch (this.suffix ) {\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tawait this.setSize(this.props.size);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'svg':\r\n\t\t\t\t\t\tthis.imgBaseSize = mediumSize;\r\n\t\t\t\t\t\tthis.desImgSize = this.srcImage.length;\r\n\t\t\t\t\t\tthis.desImage = this.srcImage;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n            };\r\n        }\r\n    }\r\n\r\n    private async setSize(size?: 'sm' | 'md' | 'lg') {\r\n        switch (size) {\r\n            default:\r\n            case 'sm':\r\n                this.imgBaseSize = smallSize; break;\r\n            case 'md':\r\n                this.imgBaseSize = mediumSize; break;\r\n            case 'lg':\r\n                this.imgBaseSize = largeSize; break;\r\n\t\t}\r\n\t\tthis.desImage = await this.compress();\r\n    }\r\n\r\n    private compress = ():Promise<string> => {\r\n        return new Promise<string>((resolve, reject) => {\r\n            var img = new Image();\r\n            img.src = this.srcImage;\r\n            img.onload = () => {\r\n                //var that = this;\r\n                // 默认按比例压缩\r\n                let {width, height} = img;\r\n                this.srcImgWidth = width;\r\n                this.srcImgHeight = height;\r\n                let scale = width / height;\r\n                let w:number, h:number;\r\n                if (width <= this.imgBaseSize && height <= this.imgBaseSize) {\r\n                    w = width;\r\n                    h = height;\r\n                }\r\n                else if (scale < 0) {\r\n                    w = this.imgBaseSize;\r\n                    h = w / scale;\r\n                }\r\n                else {\r\n                    h = this.imgBaseSize;\r\n                    w = h * scale;\r\n                }\r\n                this.desImgWidth = Math.round(w);\r\n                this.desImgHeight = Math.round(h);\r\n                var quality = 0.7;  // 默认图片质量为0.7\r\n                //生成canvas\r\n                var canvas = document.createElement('canvas');\r\n                var ctx = canvas.getContext('2d');\r\n                // 创建属性节点\r\n                var anw = document.createAttribute(\"width\");\r\n                anw.nodeValue = String(w);\r\n                var anh = document.createAttribute(\"height\");\r\n                anh.nodeValue = String(h);\r\n                canvas.setAttributeNode(anw);\r\n                canvas.setAttributeNode(anh);\r\n                ctx.drawImage(img, 0, 0, w, h);\r\n                let base64 = canvas.toDataURL('image/' + this.suffix , quality);\r\n                let blob = this.convertBase64UrlToBlob(base64);\r\n                this.desImgSize = blob.size;\r\n                if (this.desImgSize > 3*1024*1024) {\r\n                    this.fileError = \"图片大于3M，无法上传\";\r\n                    this.enableUploadButton = false;\r\n                }\r\n                resolve(base64);\r\n            }\r\n        });\r\n    }\r\n\r\n    private convertBase64UrlToBlob(urlData: string):Blob {\r\n        let arr = urlData.split(',');\r\n        let mime = arr[0].match(/:(.*?);/)[1];\r\n        let bstr = atob(arr[1]);\r\n        let n = bstr.length;\r\n        let u8arr = new Uint8Array(n);\r\n        while(n--){\r\n            u8arr[n] = bstr.charCodeAt(n);\r\n        }\r\n        return new Blob([u8arr], {type:mime});\r\n    }\r\n\r\n    private upload = async () => {\r\n        if (!this.resUploader) return;\r\n        let formData = new FormData();\r\n        let blob = this.convertBase64UrlToBlob(this.desImage);\r\n        formData.append('image', blob, this.file.name);\r\n        let ret = await this.resUploader.upload(formData);\r\n        if (typeof ret === 'object') {\r\n            let {error} = ret;\r\n            let type = typeof error;\r\n            let err:string;\r\n            switch (type) {\r\n                case 'undefined': err = 'error: undefined'; break;\r\n                case 'string': err = error; break;\r\n                case 'object': err = error.message; break;\r\n                default: err = String(err); break;\r\n            }\r\n            this.fileError = 'error: ' + type + ' - ' + err;\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.props.id);\r\n        this.uploaded = true;\r\n    }\r\n\r\n    private onSaved = (): Promise<void> => {\r\n        let {onSaved} = this.props;\r\n        onSaved && onSaved(this.resId);\r\n        return;\r\n    }\r\n\r\n    private showOrgImage = () => {\r\n        nav.push(<Page header=\"原图\">\r\n            <div className=\"p-3 text-center\">\r\n                <ImageControl className=\"h-min-4c\" style={{maxWidth:'100%'}} src={this.srcImage} />\r\n            </div>\r\n        </Page>);\r\n    }\r\n\r\n    private levelDiv() {\r\n        if (this.props.size) return;\r\n        let arr = [{caption:'小图', size:'sm'}];\r\n        if (this.srcImgHeight > mediumSize || this.srcImgWidth > mediumSize) {\r\n            arr.push({caption:'中图', size:'md'});\r\n        }\r\n        if (this.srcImgHeight > largeSize || this.srcImgWidth > largeSize) {\r\n            arr.push({caption:'大图', size:'lg'});\r\n        }\r\n        if (arr.length < 2) return;\r\n        return <div>{arr.map((v, index) => {\r\n            let {caption, size} = v;\r\n            return <label key={index} className=\"mr-3\"><input type=\"radio\" name=\"size\" \r\n                onChange={()=>this.setSize(size as any)}\r\n                defaultChecked={index===0} /> {caption}</label>;\r\n        })}</div>\r\n    }\r\n\r\n    render() {\r\n        let {label} = this.props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center mr-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={this.onSaved}>保存</button>;\r\n        return <Page header={label || '更改图片'} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div className=\"mb-3\">\r\n                        <ResUploader ref={v=>this.resUploader=v} \r\n                            multiple={false} maxSize={2048} \r\n                            label=\"选择图片文件\"\r\n                            onFilesChange={this.onFileChange} />\r\n                        <div className=\"small text-muted\">支持 {ImageUploader.imageTypes.join(', ')} 格式图片。</div>\r\n                        {this.fileError && <div className=\"text-danger\">{this.fileError}</div>}\r\n                    </div>\r\n                    <LMR left=\r\n                    {\r\n                        this.uploaded === true? \r\n                            <div className=\"text-success p-2\">上传成功！</div>\r\n                            :\r\n                            this.file && this.desImgSize > 0 && <div className=\"mb-3 d-flex align-items-end\">\r\n                                <div className=\"mr-5\">\r\n                                    {this.levelDiv()}\r\n                                    <div>分辨率：{this.desImgWidth} x {this.desImgHeight}\r\n                                    &nbsp; &nbsp;\r\n                                    文件大小：{formatSize(this.desImgSize)}\r\n                                    </div>\r\n                                </div>\r\n                                <button className=\"btn btn-primary\" \r\n                                    disabled={!this.enableUploadButton}\r\n                                    onClick={this.upload}>上传</button>\r\n                            </div>\r\n                    }\r\n                    right={this.desImage && \r\n                        <button className=\"btn btn-link btn-sm text-right mb-3\" onClick={this.showOrgImage}>\r\n                            原图大小: {formatSize(this.file.size)}<br/>\r\n                            分辨率：{this.srcImgWidth} x {this.srcImgHeight}\r\n                        </button>\r\n                    }\r\n                    ></LMR>\r\n                </div>\r\n                <div className=\"text-center\" \r\n                    style={{\r\n                        border: (this.uploaded===true? '2px solid green' : '1px dotted gray'),\r\n                        padding: '8px'\r\n                    }}>\r\n                    <ImageControl className=\"h-min-4c\" style={{maxWidth:'100%'}} src={this.desImage} />\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\ninterface AudioUploaderProps {\r\n    id?: string;\r\n    label?: string;\r\n    onSaved?: (imageId:string) => Promise<void>;\r\n}\r\n\r\n@observer\r\nexport class AudioUploader extends React.Component<AudioUploaderProps> {\r\n\tprivate static audioTypes = ['mp3', 'wav'];\r\n\r\n    private suffix: string;\r\n\tprivate resUploader: ResUploader;\r\n\t@observable private content: string;\r\n\t@observable private file: File;    \r\n\t@observable private fileSize: number;\r\n\r\n    @observable private isChanged: boolean = false;\r\n    @observable private resId: string;\r\n    @observable private enableUploadButton: boolean = false;\r\n    @observable private fileError: string;\r\n\t@observable private uploaded: boolean = false;\r\n\t@observable private uploading: boolean = false;\r\n\r\n    constructor(props: AudioUploaderProps) {\r\n        super(props);\r\n        this.resId = props.id;\r\n    }\r\n\r\n    private onFileChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.fileError = undefined;\r\n        this.uploaded = false;\r\n        this.enableUploadButton = evt.target.files.length > 0;\r\n        if (this.enableUploadButton) {\r\n            this.file = evt.target.files[0];\r\n            let pos = this.file.name.lastIndexOf('.');\r\n            if (pos >= 0) this.suffix = this.file.name.substr(pos+1).toLowerCase();\r\n            if(AudioUploader.audioTypes.indexOf(this.suffix) < 0){\r\n                this.fileError = `音频类型必须是 ${AudioUploader.audioTypes.join(', ')} 中的一种`;\r\n                return;\r\n            }\r\n            let reader = new FileReader();\r\n            reader.readAsDataURL(this.file);\r\n            reader.onload = async () => {\r\n\t\t\t\tthis.content = reader.result as string;\r\n\t\t\t\tthis.fileSize = this.content.length;\r\n            };\r\n        }\r\n    }\r\n\r\n    private convertBase64UrlToBlob(urlData: string):Blob {\r\n        let arr = urlData.split(',');\r\n        let mime = arr[0].match(/:(.*?);/)[1];\r\n        let bstr = atob(arr[1]);\r\n        let n = bstr.length;\r\n        let u8arr = new Uint8Array(n);\r\n        while(n--){\r\n            u8arr[n] = bstr.charCodeAt(n);\r\n        }\r\n        return new Blob([u8arr], {type:mime});\r\n    }\r\n\r\n    private upload = async () => {\r\n\t\tif (!this.resUploader) return;\r\n\t\tthis.uploading = true;\r\n        let formData = new FormData();\r\n        let blob = this.convertBase64UrlToBlob(this.content);\r\n        formData.append('image', blob, this.file.name);\r\n        let ret = await this.resUploader.upload(formData);\r\n        if (typeof ret === 'object') {\r\n            let {error} = ret;\r\n            let type = typeof error;\r\n            let err:string;\r\n            switch (type) {\r\n                case 'undefined': err = 'error: undefined'; break;\r\n                case 'string': err = error; break;\r\n                case 'object': err = error.message; break;\r\n                default: err = String(err); break;\r\n            }\r\n            this.fileError = 'error: ' + type + ' - ' + err;\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.props.id);\r\n        this.uploaded = true;\r\n    }\r\n\r\n    private onSaved = (): Promise<void> => {\r\n        let {onSaved} = this.props;\r\n        onSaved && onSaved(this.resId);\r\n        return;\r\n    }\r\n\r\n    render() {\r\n        let {label} = this.props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center mr-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={this.onSaved}>保存</button>;\r\n        return <Page header={label || '更改文件'} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div className=\"mb-3\">\r\n                        <ResUploader ref={v=>this.resUploader=v} \r\n                            multiple={false} maxSize={2048} \r\n                            label=\"选择音频文件\"\r\n                            onFilesChange={this.onFileChange} />\r\n                        <div className=\"small text-muted\">支持 {AudioUploader.audioTypes.join(', ')} 格式。</div>\r\n                        {this.fileError && <div className=\"text-danger\">{this.fileError}</div>}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\t\t\t<LMR left=\r\n                    {\r\n                        this.uploaded === true? \r\n                            <div className=\"text-success p-2\">上传成功！</div>\r\n\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\tthis.uploading === true?\r\n\t\t\t\t\t\t\t\t<div className=\"m-3\"><Loading /></div>\r\n\t\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\t\tthis.file && this.content && <div className=\"m-3\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"mb-3\">\r\n\t\t\t\t\t\t\t\t\t\t文件大小：{formatSize(this.fileSize)}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<button className=\"btn btn-primary\" \r\n\t\t\t\t\t\t\t\t\t\tdisabled={!this.enableUploadButton}\r\n\t\t\t\t\t\t\t\t\t\tonClick={this.upload}>上传</button>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t\t\t/>\r\n        </Page>;\r\n    }\r\n}\r\n","import _ from 'lodash';\r\nimport { UqApi, UqData, UnitxApi, appInFrame } from '../net';\r\nimport { Tuid, TuidDiv, TuidImport, TuidInner, TuidBox, TuidsCache } from './tuid';\r\nimport { Action } from './action';\r\nimport { Sheet } from './sheet';\r\nimport { Query } from './query';\r\nimport { Book } from './book';\r\nimport { History } from './history';\r\nimport { Map } from './map';\r\nimport { Pending } from './pending';\r\nimport { CreateBoxId, BoxId } from './tuid';\r\nimport { LocalMap, LocalCache } from '../tool';\r\nimport { UQsMan } from './uqsMan';\r\nimport { ReactBoxId } from './tuid/reactBoxId';\r\nimport { Tag } from './tag/tag';\r\n\r\nexport type FieldType = 'id' | 'tinyint' | 'smallint' | 'int' | 'bigint' | 'dec' | 'char' | 'text'\r\n    | 'datetime' | 'date' | 'time' | 'timestamp';\r\n\r\nexport function fieldDefaultValue(type:FieldType) {\r\n    switch (type) {\r\n        case 'tinyint':\r\n        case 'smallint':\r\n        case 'int':\r\n        case 'bigint':\r\n        case 'dec':\r\n            return 0;\r\n        case 'char':\r\n        case 'text':\r\n            return '';\r\n        case 'datetime':\r\n        case 'date':\r\n            return '2000-1-1';\r\n        case 'time':\r\n            return '0:00';\r\n    }\r\n}\r\n\r\nexport interface Field {\r\n    name: string;\r\n    type: FieldType;\r\n    tuid?: string;\r\n    arr?: string;\r\n    null?: boolean;\r\n    size?: number;\r\n    owner?: string;\r\n    _tuid: TuidBox;\r\n}\r\nexport interface ArrFields {\r\n    name: string;\r\n    fields: Field[];\r\n    id?: string;\r\n    order?: string;\r\n}\r\nexport interface FieldMap {\r\n    [name:string]: Field;\r\n}\r\nexport interface SchemaFrom {\r\n    owner:string;\r\n    uq:string;\r\n}\r\nexport interface TuidModify {\r\n    max: number;\r\n    seconds: number;\r\n}\r\n\r\nexport class UqMan {\r\n    private readonly actions: {[name:string]: Action} = {};\r\n    private readonly sheets: {[name:string]: Sheet} = {};\r\n    private readonly queries: {[name:string]: Query} = {};\r\n    private readonly books: {[name:string]: Book} = {};\r\n    private readonly maps: {[name:string]: Map} = {};\r\n    private readonly histories: {[name:string]: History} = {};\r\n\tprivate readonly pendings: {[name:string]: Pending} = {};\r\n\tprivate readonly tags: {[name:string]: Tag} = {};\r\n    private readonly tuidsCache: TuidsCache;\r\n    private readonly localAccess: LocalCache;\r\n    private readonly tvs:{[entity:string]:(values:any)=>JSX.Element};\r\n    readonly localMap: LocalMap;\r\n    readonly localModifyMax: LocalCache;\r\n    readonly tuids: {[name:string]: Tuid} = {};\r\n    readonly createBoxId: CreateBoxId;\r\n    readonly newVersion: boolean;\r\n    readonly uqOwner: string;\r\n    readonly uqName: string;\r\n    readonly name: string;\r\n    readonly uqApi: UqApi;\r\n    readonly id: number;\r\n\r\n    uqVersion: number;\r\n\r\n    constructor(uqs:UQsMan, uqData: UqData, createBoxId:CreateBoxId, tvs:{[entity:string]:(values:any)=>JSX.Element}) {\r\n        this.createBoxId = createBoxId;\r\n        if (createBoxId === undefined) {\r\n            this.createBoxId = this.createBoxIdFromTVs;\r\n            this.tvs = tvs || {};\r\n        }\r\n        let {id, uqOwner, uqName, access, newVersion: clearTuids} = uqData;\r\n        this.newVersion = clearTuids;\r\n        this.uqOwner = uqOwner;\r\n        this.uqName = uqName;\r\n        this.id = id;\r\n        this.name = uqOwner + '/' + uqName;\r\n        this.uqVersion = 0;\r\n        this.localMap = uqs.localMap.map(this.name);\r\n        this.localModifyMax = this.localMap.child('$modifyMax');\r\n        this.localAccess = this.localMap.child('$access');\r\n        //let hash = document.location.hash;\r\n        let baseUrl = 'tv/';\r\n\r\n        let acc: string[];\r\n        if (access === null || access === undefined || access === '*') {\r\n            acc = [];\r\n        }\r\n        else {\r\n            acc = access.split(';').map(v => v.trim()).filter(v => v.length > 0);\r\n        }\r\n        if (this.name === '$$$/$unitx') {\r\n            // 这里假定，点击home link之后，已经设置unit了\r\n            // 调用 UnitxApi会自动搜索绑定 unitx service\r\n            this.uqApi = new UnitxApi(appInFrame.unit);\r\n        }\r\n        else {\r\n            let {appOwner, appName} = uqs;\r\n            this.uqApi = new UqApi(baseUrl, appOwner, appName, uqOwner, uqName, acc, true);\r\n        }\r\n        this.tuidsCache = new TuidsCache(this);\r\n    }\r\n\r\n    get entities() {\r\n        return _.merge({}, \r\n            this.actions, this.sheets, this.queries, this.books,\r\n\t\t\tthis.maps, this.histories, this.pendings, this.tuids,\r\n\t\t\tthis.tags,\r\n        );\r\n    }\r\n\r\n    private createBoxIdFromTVs:CreateBoxId = (tuid:Tuid, id:number):BoxId =>{\r\n        let {name} = tuid;\r\n        /*\r\n        let tuidUR = this.tuidURs[name];\r\n        if (tuidUR === undefined) {\r\n            let {ui, res} = this.getUI(tuid);\r\n            this.tuidURs[name] = tuidUR = new TuidWithUIRes(tuid, ui, res);\r\n        }\r\n        */\r\n        return new ReactBoxId(id, tuid, this.tvs[name]);\r\n    }\r\n\r\n    tuid(name:string):Tuid {return this.tuids[name.toLowerCase()]}\r\n    tuidDiv(name:string, div:string):TuidDiv {\r\n        let tuid = this.tuids[name.toLowerCase()]\r\n        return tuid && tuid.div(div.toLowerCase());\r\n    }\r\n    action(name:string):Action {return this.actions[name.toLowerCase()]}\r\n    sheet(name:string):Sheet {return this.sheets[name.toLowerCase()]}\r\n    query(name:string):Query {return this.queries[name.toLowerCase()]}\r\n    book(name:string):Book {return this.books[name.toLowerCase()]}\r\n    map(name:string):Map {return this.maps[name.toLowerCase()]}\r\n    history(name:string):History {return this.histories[name.toLowerCase()]}\r\n    pending(name:string):Pending {return this.pendings[name.toLowerCase()]}\r\n\r\n    sheetFromTypeId(typeId:number):Sheet {\r\n        for (let i in this.sheets) {\r\n            let sheet = this.sheets[i];\r\n            if (sheet.typeId === typeId) return sheet;\r\n        }\r\n    }\r\n\r\n    readonly tuidArr: Tuid[] = [];\r\n    readonly actionArr: Action[] = [];\r\n    readonly sheetArr: Sheet[] = [];\r\n    readonly queryArr: Query[] = [];\r\n    readonly bookArr: Book[] = [];\r\n    readonly mapArr: Map[] = [];\r\n    readonly historyArr: History[] = [];\r\n    readonly pendingArr: Pending[] = [];\r\n    readonly tagArr: Tag[] = [];\r\n\r\n    async init() {\r\n        await this.uqApi.init();\r\n    }\r\n\r\n    async loadEntities(): Promise<string> {\r\n        try {\r\n            let accesses = this.localAccess.get();\r\n            if (!accesses) {\r\n                accesses = await this.uqApi.loadAccess();\r\n            }\r\n            if (!accesses) return;\r\n            this.buildEntities(accesses);\r\n        }\r\n        catch (err) {\r\n            return err;\r\n        }\r\n    }\r\n\r\n\tbuildEntities(entities:any) {\r\n        if (entities === undefined) {\r\n            debugger;\r\n        }\r\n        this.localAccess.set(entities);\r\n        let {access, tuids, version} = entities;\r\n        this.uqVersion = version;\r\n        this.buildTuids(tuids);\r\n        this.buildAccess(access);\r\n\t}\r\n\t\r\n    private buildTuids(tuids:any) {\r\n        for (let i in tuids) {\r\n            let schema = tuids[i];\r\n            let {typeId, from} = schema;\r\n            let tuid = this.newTuid(i, typeId, from);\r\n            tuid.sys = true;\r\n        }\r\n        for (let i in tuids) {\r\n            let schema = tuids[i];\r\n            let tuid = this.getTuid(i);\r\n            tuid.setSchema(schema);\r\n        }\r\n        for (let i in this.tuids) {\r\n            let tuid = this.tuids[i];\r\n            tuid.buildFieldsTuid();\r\n        }\r\n\t}\r\n\r\n    async loadEntitySchema(entityName: string): Promise<any> {\r\n        return await this.uqApi.schema(entityName);\r\n    }\r\n\r\n    getTuid(name:string): Tuid {\r\n        return this.tuids[name];\r\n    }\r\n\r\n    private buildAccess(access:any) {\r\n        for (let a in access) {\r\n            let v = access[a];\r\n            switch (typeof v) {\r\n                case 'string': this.fromType(a, v); break;\r\n                case 'object': this.fromObj(a, v); break;\r\n            }\r\n        }\r\n    }\r\n\r\n    cacheTuids(defer:number) {\r\n        this.tuidsCache.cacheTuids(defer);\r\n    }\r\n\r\n    newAction(name:string, id:number):Action {\r\n        let action = this.actions[name];\r\n        if (action !== undefined) return action;\r\n        action = this.actions[name] = new Action(this, name, id)\r\n        this.actionArr.push(action);\r\n        return action;\r\n    }\r\n    private newTuid(name:string, id:number, from:SchemaFrom):Tuid {\r\n        let tuid = this.tuids[name];\r\n        if (tuid !== undefined) return tuid;\r\n        if (from !== undefined)\r\n            tuid = new TuidImport(this, name, id, from);\r\n        else\r\n            tuid = new TuidInner(this, name, id);\r\n        this.tuids[name] = tuid;\r\n        this.tuidArr.push(tuid);\r\n        return tuid;\r\n    }\r\n    newQuery(name:string, id:number):Query {\r\n        let query = this.queries[name];\r\n        if (query !== undefined) return query;\r\n        query = this.queries[name] = new Query(this, name, id)\r\n        this.queryArr.push(query);\r\n        return query;\r\n    }\r\n    private newBook(name:string, id:number):Book {\r\n        let book = this.books[name];\r\n        if (book !== undefined) return book;\r\n        book = this.books[name] = new Book(this, name, id);\r\n        this.bookArr.push(book);\r\n        return book;\r\n    }\r\n    private newMap(name:string, id:number):Map {\r\n        let map = this.maps[name];\r\n        if (map !== undefined) return map;\r\n        map = this.maps[name] = new Map(this, name, id)\r\n        this.mapArr.push(map);\r\n        return map;\r\n    }\r\n    private newTag(name:string, id:number):Tag {\r\n        let tag = this.tags[name];\r\n        if (tag !== undefined) return tag;\r\n        tag = this.tags[name] = new Tag(this, name, id)\r\n        this.tagArr.push(tag);\r\n        return tag;\r\n    }\r\n    private newHistory(name:string, id:number):History {\r\n        let history = this.histories[name];\r\n        if (history !== undefined) return;\r\n        history = this.histories[name] = new History(this, name, id)\r\n        this.historyArr.push(history);\r\n        return history;\r\n    }\r\n    private newPending(name:string, id:number):Pending {\r\n        let pending = this.pendings[name];\r\n        if (pending !== undefined) return;\r\n        pending = this.pendings[name] = new Pending(this, name, id)\r\n        this.pendingArr.push(pending);\r\n        return pending;\r\n    }\r\n    newSheet(name:string, id:number):Sheet {\r\n        let sheet = this.sheets[name];\r\n        if (sheet !== undefined) return sheet;\r\n        sheet = this.sheets[name] = new Sheet(this, name, id);\r\n        this.sheetArr.push(sheet);\r\n        return sheet;\r\n    }\r\n    private fromType(name:string, type:string) {\r\n        let parts = type.split('|');\r\n        type = parts[0];\r\n        let id = Number(parts[1]);\r\n        switch (type) {\r\n            //case 'uq': this.id = id; break;\r\n            case 'tuid':\r\n                // Tuid should not be created here!;\r\n                //let tuid = this.newTuid(name, id);\r\n                //tuid.sys = false;\r\n                break;\r\n            case 'action': this.newAction(name, id); break;\r\n            case 'query': this.newQuery(name, id); break;\r\n            case 'book': this.newBook(name, id); break;\r\n            case 'map': this.newMap(name, id); break;\r\n            case 'history': this.newHistory(name, id); break;\r\n            case 'sheet':this.newSheet(name, id); break;\r\n\t\t\tcase 'pending': this.newPending(name, id); break;\r\n\t\t\tcase 'tag': this.newTag(name, id); break;\r\n        }\r\n    }\r\n    private fromObj(name:string, obj:any) {\r\n        switch (obj['$']) {\r\n            case 'sheet': this.buildSheet(name, obj); break;\r\n        }\r\n    }\r\n    private buildSheet(name:string, obj:any) {\r\n        let sheet = this.sheets[name];\r\n        if (sheet === undefined) sheet = this.newSheet(name, obj.id);\r\n        sheet.build(obj);\r\n    }\r\n    buildFieldTuid(fields:Field[], mainFields?:Field[]) {\r\n        if (fields === undefined) return;\r\n        for (let f of fields) {\r\n            let {tuid} = f;\r\n            if (tuid === undefined) continue;\r\n            let t = this.getTuid(tuid);\r\n            if (t === undefined) continue;\r\n            f._tuid = t.buildTuidBox();\r\n        }\r\n        for (let f of fields) {\r\n            let {owner} = f;\r\n            if (owner === undefined) continue;\r\n            let ownerField = fields.find(v => v.name === owner);\r\n            if (ownerField === undefined) {\r\n                if (mainFields !== undefined) {\r\n                    ownerField = mainFields.find(v => v.name === owner);\r\n                }\r\n                if (ownerField === undefined) {\r\n                    debugger;\r\n                    throw new Error(`owner field ${owner} is undefined`);\r\n                }\r\n            }\r\n            let {arr, tuid} = f;\r\n            let t = this.getTuid(ownerField._tuid.tuid.name);\r\n            if (t === undefined) continue;\r\n            let div = t.div(arr || tuid);\r\n            f._tuid = div && div.buildTuidDivBox(ownerField);\r\n            if (f._tuid === undefined) {\r\n                debugger;\r\n                throw new Error(`owner field ${owner} is not tuid`);\r\n            }\r\n        }\r\n    }\r\n    buildArrFieldsTuid(arrFields:ArrFields[], mainFields:Field[]) {\r\n        if (arrFields === undefined) return;\r\n        for (let af of arrFields) {\r\n            let {fields} = af;\r\n            if (fields === undefined) continue;\r\n            this.buildFieldTuid(fields, mainFields);\r\n        }\r\n    }\r\n\r\n    pullModify(modifyMax:number) {\r\n        this.tuidsCache.pullModify(modifyMax);\r\n    }\r\n}\r\n","import { Entity } from './entity';\r\nimport { PageItems } from '../tool/pageItems';\r\nimport { EntityCaller } from './caller';\r\n\r\nexport interface SheetState {\r\n    name: string;\r\n    actions: SheetAction[];\r\n}\r\n\r\nexport interface SheetAction {\r\n    name: string;\r\n}\r\n\r\nexport interface StateCount {\r\n    state: string;\r\n    count: number;\r\n}\r\n\r\nexport class Sheet extends Entity {\r\n    get typeName(): string { return 'sheet';}\r\n    states: SheetState[];\r\n\r\n    /*\r\n    setStates(states: SheetState[]) {\r\n        for (let state of states) {\r\n            this.setStateAccess(this.states.find(s=>s.name==state.name), state);\r\n        }\r\n    }*/\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        this.states = schema.states;\r\n    }\r\n    build(obj:any) {\r\n        this.states = [];\r\n        for (let op of obj.ops) {\r\n            this.states.push({name: op, actions:undefined});\r\n        }\r\n        /*\r\n        for (let p in obj) {\r\n            switch(p) {\r\n                case '#':\r\n                case '$': continue;\r\n                default: this.states.push(this.createSheetState(p, obj[p])); break;\r\n            }\r\n        }*/\r\n    }\r\n    private createSheetState(name:string, obj:object):SheetState {\r\n        let ret:SheetState = {name:name, actions:[]};\r\n        let actions = ret.actions;\r\n        for (let p in obj) {\r\n            let action:SheetAction = {name: p};\r\n            actions.push(action);\r\n        }\r\n        return ret;\r\n    }\r\n    /*\r\n    private setStateAccess(s:SheetState, s1:SheetState) {\r\n        if (s === undefined) return;\r\n        for (let action of s1.actions) {\r\n            let acn = action.name;\r\n            let ac = s.actions.find(a=>a.name === acn);\r\n            if (ac === undefined) continue;\r\n            s.actions.push(action);\r\n        }\r\n    }*/\r\n    async save(discription:string, data:any):Promise<any> {\r\n        /*\r\n        await this.loadSchema();\r\n        let {id} = this.uq;\r\n        let text = this.pack(data);\r\n\r\n        let ret = await this.uqApi.sheetSave(this.name, );\r\n        return ret;\r\n        */\r\n        let {id} = this.uq;\r\n        //let text = this.pack(data);\r\n        let params = {app: id, discription: discription, data:data};\r\n        return await new SaveCaller(this, params).request();\r\n        /*\r\n        let {id, state} = ret;\r\n        if (id > 0) this.changeStateCount(state, 1);\r\n        return ret;\r\n        */\r\n    }\r\n    async action(id:number, flow:number, state:string, action:string) {\r\n        /*\r\n        await this.loadSchema();\r\n        return await this.uqApi.sheetAction(this.name, {id:id, flow:flow, state:state, action:action});\r\n        */\r\n        return await new ActionCaller(this, {id:id, flow:flow, state:state, action:action}).request();\r\n    }\r\n    private unpack(data:any):any {\r\n        //if (this.schema === undefined) await this.loadSchema();\r\n        let ret = data[0];\r\n        let brief = ret[0];\r\n        let sheetData = this.unpackSheet(brief.data);\r\n        let flows = data[1];\r\n        return {\r\n            brief: brief,\r\n            data: sheetData,\r\n            flows: flows,\r\n        }\r\n    }\r\n    async getSheet(id:number):Promise<any> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.getSheet(this.name, id);\r\n        */\r\n        let ret = await new GetSheetCaller(this, id).request();\r\n        if (ret[0].length === 0) return await this.getArchive(id);\r\n        return this.unpack(ret);\r\n    }\r\n    async getArchive(id:number):Promise<any> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.sheetArchive(this.name, id)\r\n        return this.unpack(ret);\r\n        */\r\n        let ret = await new SheetArchiveCaller(this, id).request();\r\n        return this.unpack(ret);\r\n    }\r\n\r\n    async getArchives(pageStart:number, pageSize:number) {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.sheetArchives(this.name, {pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = {pageStart:pageStart, pageSize:pageSize};\r\n        return await new SheetArchivesCaller(this, params).request();\r\n    }\r\n\r\n    async getStateSheets(state:string, pageStart:number, pageSize:number):Promise<any[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.stateSheets(this.name, {state:state, pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = {state:state, pageStart:pageStart, pageSize:pageSize};\r\n        return await new StateSheetsCaller(this, params).request();\r\n    }\r\n    createPageStateItems<T>(): PageStateItems<T> {return new PageStateItems<T>(this);}\r\n\r\n    async stateSheetCount():Promise<StateCount[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret:StateCount[] = await this.uqApi.stateSheetCount(this.name);\r\n        return this.states.map(s => {\r\n            let n = s.name, count = 0;\r\n            let r = ret.find(v => v.state === n);\r\n            if (r !== undefined) count = r.count;\r\n            return {state: n, count: count} \r\n        });\r\n        */\r\n        return await new StateSheetCountCaller(this, undefined).request();\r\n    }\r\n\r\n    async userSheets(state:string, user:number, pageStart:number, pageSize:number):Promise<any[]> {\r\n        let params = {state:state, user:user, pageStart:pageStart, pageSize:pageSize};\r\n        return await new UserSheetsCaller(this, params).request();\r\n    }\r\n\r\n    async mySheets(state:string, pageStart:number, pageSize:number):Promise<any[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.mySheets(this.name, {state:state, pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = {state:state, pageStart:pageStart, pageSize:pageSize};\r\n        return await new MySheetsCaller(this, params).request();\r\n    }\r\n}\r\n\r\n\r\nabstract class SheetCaller<T> extends EntityCaller<T> {\r\n    protected get entity(): Sheet {return this._entity as Sheet;}\r\n    protected readonly suffix:string;\r\n    get path():string {return `sheet/${this.entity.name}/${this.suffix}`;}\r\n}\r\n\r\nclass SaveCaller extends SheetCaller<{app:number; discription:string; data:any}> {\r\n    get path():string {return `sheet/${this.entity.name}`;}\r\n    buildParams() {\r\n        let {app, discription, data} = this.params;\r\n        return {\r\n            app: app,\r\n            discription: discription,\r\n            data: this.entity.pack(data)\r\n        };\r\n    }\r\n}\r\n\r\nclass ActionCaller extends SheetCaller<{id:number, flow:number, state:string, action:string}> {\r\n    method = 'PUT';\r\n    get path():string {return `sheet/${this.entity.name}`;}\r\n    //buildParams() {return this.entity.buildParams(this.params);}\r\n}\r\n\r\nclass GetSheetCaller extends SheetCaller<number> {\r\n    //protected readonly params: number;  // id\r\n    method = 'GET';\r\n    //private id:number;\r\n    //protected readonly suffix = 'archive';\r\n    buildParams() {}\r\n    get path():string {return `sheet/${this.entity.name}/get/${this.params}`;}\r\n}\r\n\r\nclass SheetArchiveCaller extends SheetCaller<number> {\r\n    //protected readonly params: number;  // id\r\n    method = 'GET';\r\n    //protected readonly suffix = 'archive';\r\n    buildParams() {}\r\n    get path():string {return `sheet/${this.entity.name}/archive/${this.params}`;}\r\n}\r\n\r\nclass SheetArchivesCaller extends SheetCaller<{pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'archives';\r\n}\r\n\r\nclass StateSheetsCaller extends SheetCaller<{state:string, pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'states';\r\n}\r\n\r\nclass StateSheetCountCaller extends SheetCaller<undefined> {\r\n    method = 'GET';\r\n    protected readonly suffix = 'statecount';\r\n    xresult(res:any):any {\r\n        let {states} = this.entity;\r\n        return states.map(s => {\r\n            let n = s.name, count = 0;\r\n            let r = (res as any[]).find(v => v.state === n);\r\n            if (r !== undefined) count = r.count;\r\n            return {state: n, count: count} \r\n        });\r\n    }\r\n}\r\n\r\nclass UserSheetsCaller extends SheetCaller<{state:string, user:number, pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'user-sheets';\r\n    xresult(res:any):any {\r\n        return res;\r\n    }\r\n}\r\n\r\nclass MySheetsCaller extends SheetCaller<{state:string, pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'my-sheets';\r\n    xresult(res:any):any {\r\n        return res;\r\n    }\r\n}\r\n\r\nexport class PageStateItems<T> extends PageItems<T> {\r\n    private sheet: Sheet;\r\n    constructor(sheet: Sheet) {\r\n        super(true);\r\n        this.sheet = sheet;\r\n        this.pageSize = 10;\r\n\t}\r\n\tprotected async loadResults(param:any, pageStart:any, pageSize:number):Promise<{[name:string]:any[]}> {\r\n\t\tlet ret = await this.sheet.getStateSheets(param, pageStart, pageSize);\r\n\t\treturn {$page: ret};\r\n\t}\r\n\t/*\r\n    protected async load(param:any, pageStart:any, pageSize:number):Promise<any[]> {\r\n        let ret = await this.sheet.getStateSheets(param, pageStart, pageSize);\r\n        return ret;\r\n\t}\r\n\t*/\r\n\tprotected getPageId(item:T) {\r\n\t\treturn item === undefined? 0 : (item as any).id;\r\n\t}\r\n\t/*\r\n    protected setPageStart(item:any) {\r\n        this.pageStart = item === undefined? 0 : item.id;\r\n\t}\r\n\t*/\r\n}\r\n","import {Query} from './query';\r\nimport { QueryQueryCaller } from './caller';\r\n\r\nexport class Book extends Query {\r\n    get typeName(): string { return 'book';}\r\n    protected queryApiName = 'book';\r\n\r\n    protected queryCaller(params: any): QueryQueryCaller {\r\n        return new BookQueryCaller(this, params);\r\n    }\r\n}\r\n\r\nexport class BookQueryCaller extends QueryQueryCaller {\r\n    //protected get entity(): Query {return this._entity as Query};\r\n    get path():string {return `book/${this.entity.name}`;}\r\n    /*\r\n    xresult(res:any) {\r\n        let data = this.entity.unpackReturns(res);\r\n        return data;\r\n    }\r\n    buildParams() {return this.entity.buildParams(this.params);}\r\n    */\r\n}\r\n","import {Query} from './query';\r\n\r\nexport class History extends Query {\r\n    get typeName(): string { return 'history';}\r\n    protected queryApiName = 'history';\r\n}\r\n","import { Entity } from './entity';\r\nimport { Action, ActionSubmitCaller } from './action';\r\nimport { Query } from './query';\r\nimport { Field } from './uqMan';\r\nimport { EntityCaller, QueryPageCaller, QueryQueryCaller } from './caller';\r\n\r\ninterface MapActions {\r\n    add: Action;\r\n    del: Action;\r\n}\r\ninterface MapQueries {\r\n    all: Query;\r\n    page: Query;\r\n    query: Query;\r\n}\r\n\r\nexport class Map extends Entity {\r\n    get typeName(): string { return 'map';}\r\n    keys: Field[];\r\n    actions: MapActions = {} as any;\r\n    queries: MapQueries = {} as any;\r\n    schemaFrom: {owner:string; uq:string};\r\n\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        this.schemaFrom = this.schema.from;\r\n        let {actions, queries, keys} = schema;\r\n        this.uq.buildFieldTuid(this.keys = keys);\r\n        //let t = this.schemaStringify();\r\n        for (let i in actions) {\r\n            let actionSchema = actions[i];\r\n            let {name} = actionSchema;\r\n            let action = this.uq.newAction(name, undefined);\r\n            action.setSchema(actionSchema);\r\n            action.buildFieldsTuid();\r\n            (this.actions as any)[i] = action;\r\n        }\r\n        for (let i in queries) {\r\n            let querySchema = queries[i];\r\n            let {name} = querySchema;\r\n            let query = this.uq.newQuery(name, undefined);\r\n            query.setSchema(querySchema);\r\n            query.buildFieldsTuid();\r\n            (this.queries as any)[i] = query;\r\n        }\r\n    }\r\n\r\n    async add(param:any) {\r\n        /*\r\n        await this.loadSchema();\r\n        return await this.actions.add.submit(param);\r\n        */\r\n        let ret = await new AddCaller(this, param).request();\r\n        return ret;\r\n    }\r\n\r\n    async del(param:any) {\r\n        /*\r\n        await this.loadSchema();\r\n        return await this.actions.del.submit(param);\r\n        */\r\n        let ret = await new DelCaller(this, param).request();\r\n        return ret;\r\n    }\r\n\r\n    async all() {\r\n        /*\r\n        await this.loadSchema();\r\n        return await this.queries.all.query({});\r\n        */\r\n        let ret = await new AllCaller(this, undefined).request();\r\n        return ret;\r\n    }\r\n\r\n    async page(param:any, pageStart:any, pageSize: number) {\r\n        /*\r\n        await this.loadSchema();\r\n        return await this.queries.page.page(param, pageStart, pageSize);\r\n        */\r\n        let ret = await new PageCaller(this, {pageStart:pageStart, pageSize:pageSize, param:param}).request();\r\n        return ret;\r\n    }\r\n\r\n    async query(param:any) {\r\n        /*\r\n        await this.loadSchema();\r\n        return await this.queries.query.query(param);\r\n        */\r\n       let qc = new QueryCaller(this, param);\r\n       let ret = await qc.request();\r\n       return ret;\r\n   }\r\n    async table(params:any): Promise<any[]> {\r\n        let ret = await this.query(params);\r\n        for (let i in ret) {\r\n            return ret[i];\r\n        }\r\n    }\r\n    async obj(params:any):Promise<any> {\r\n        let ret = await this.table(params);\r\n        if (ret.length > 0) return ret[0];\r\n    }\r\n    async scalar(params:any):Promise<any> {\r\n        let ret = await this.obj(params);\r\n        for (let i in ret) return ret[i];\r\n    }\r\n}\r\n\r\nabstract class MapCaller extends EntityCaller<any> {\r\n    protected get entity(): Map {return this._entity as Map;}\r\n    get path():string {return undefined;}\r\n\r\n    protected abstract getCaller(param: any):EntityCaller<any>;\r\n\r\n    protected async innerCall(): Promise<any> {\r\n        let caller = this.getCaller(this.params);\r\n        let res = await this.entity.uqApi.xcall(caller);\r\n        let ret = caller.xresult(res.res);\r\n        return {res: ret};\r\n    }\r\n\r\n    buildParams() {\r\n        let p = super.buildParams();\r\n        return p;\r\n    }\r\n}\r\n\r\nclass AddCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapAddCaller(this.entity, this.entity.actions.add, param);\r\n    }\r\n}\r\n\r\nclass DelCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapDelCaller(this.entity, this.entity.actions.add, param);\r\n    }\r\n}\r\n\r\nclass AllCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapAllCaller(this.entity, this.entity.queries.all, param);\r\n    }\r\n}\r\n\r\nclass PageCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapPageCaller(this.entity, this.entity.queries.page, param);\r\n    }\r\n}\r\n\r\nclass QueryCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapQueryCaller(this.entity, this.entity.queries.query, param);\r\n    }\r\n}\r\n\r\nclass MapAddCaller extends ActionSubmitCaller {\r\n    private map: Map;\r\n    constructor(map:Map, action:Action, params:any) {\r\n        super(action, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/add`}\r\n    get headers(): {[header:string]: string} {return undefined;}\r\n    /*\r\n        let {ver, uq} = this.map;\r\n        let {uqVersion} = uq;\r\n        return {\r\n            uq: `${uqVersion}`,\r\n            en: `${ver}`,\r\n        }\r\n    }*/\r\n}\r\n\r\nclass MapDelCaller extends ActionSubmitCaller {\r\n    private map: Map;\r\n    constructor(map:Map, action:Action, params:any) {\r\n        super(action, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/del`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n    /*\r\n        let {ver, uq} = this.map;\r\n        let {uqVersion} = uq;\r\n        return {\r\n            uq: `${uqVersion}`,\r\n            en: `${ver}`,\r\n        }\r\n    }*/\r\n}\r\n\r\nclass MapAllCaller extends QueryPageCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/all`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n    /*\r\n        let {ver, uq} = this.map;\r\n        let {uqVersion} = uq;\r\n        return {\r\n            uq: `${uqVersion}`,\r\n            en: `${ver}`,\r\n        }\r\n    }*/\r\n}\r\n\r\n\r\nclass MapPageCaller extends QueryPageCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/page`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n    /*\r\n        let {ver, uq} = this.map;\r\n        let {uqVersion} = uq;\r\n        return {\r\n            uq: `${uqVersion}`,\r\n            en: `${ver}`,\r\n        }\r\n    }*/\r\n}\r\n\r\nclass MapQueryCaller extends QueryQueryCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/query`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n    /*\r\n        let {ver, uq} = this.map;\r\n        let {uqVersion} = uq;\r\n        return {\r\n            uq: `${uqVersion}`,\r\n            en: `${ver}`,\r\n        }\r\n    }*/\r\n}","import {Query} from './query';\r\n\r\nexport class Pending extends Query {\r\n    get typeName(): string { return 'pending';}\r\n    protected queryApiName = 'pending';\r\n}\r\n","import * as React from 'react';\r\nimport { IValuesView, IValuesViewRenderOptions } from '../../components';\r\nimport { Tag, TagValue } from './tag';\r\n\r\nconst radioStyle:React.CSSProperties = {height: 'auto'};\r\n\r\nexport class TagView implements IValuesView {\r\n\tprivate tag: Tag;\r\n\tconstructor(tag: Tag) {\r\n\t\tthis.tag = tag;\r\n\t}\r\n\trender(values: number|string):JSX.Element {\r\n\t\tlet names:string[];\r\n\t\tif (typeof values === 'number') {\r\n\t\t\tnames = [this.tag.nameFromId(values)];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tnames = this.tag.namesFromIds(values);\r\n\t\t}\r\n\t\treturn <div className=\"d-flex flex-wrap \">{names.map((name, index)=>{\r\n\t\t\treturn <div key={index} className=\"mx-2 border border-muted rounded px-3 bg-light\">{name}</div>\r\n\t\t})}</div>;\r\n\t}\r\n\trenderRadios(value: number, options: IValuesViewRenderOptions): JSX.Element {\r\n        let content = this.tag.values.map((item,index) => {\r\n\t\t\treturn <div className=\"col\" key={index}>{this.renderRadio(item, value, options)}</div>;\r\n        });\r\n\t\treturn this.renderView(options, content);\r\n\t}\r\n\trenderChecks(values: string, options: IValuesViewRenderOptions): JSX.Element {\r\n\t\tlet arr = values===undefined? undefined : values.split('|').map(v => Number(v));\r\n\t\tlet content = this.tag.values.map((item,index) => {\r\n\t\t\tlet checked: boolean = arr===undefined? undefined : arr.indexOf(item.id)>=0;\r\n\t\t\treturn <div className=\"col\" key={index}>{this.renderCheck(item, checked, options)}</div>\r\n\t\t});\r\n\t\treturn this.renderView(options, content);\r\n\t}\r\n\tprivate renderView(options: IValuesViewRenderOptions, content:any) {\r\n\t\tlet {className, wrapClassName} = options;\r\n\t\twrapClassName = wrapClassName?\r\n\t\t\t'row ' + wrapClassName\r\n\t\t\t:\r\n\t\t\t'row row-cols-2 row-cols-sm-3 row-cols-md-4';\r\n\t\treturn <div className={className} style={radioStyle}>\r\n\t\t\t<div className={wrapClassName}>\r\n                {content}\r\n\t\t\t</div>\r\n        </div>;\r\n\t}\r\n\tprivate renderRadio(item:TagValue, value: number, options: IValuesViewRenderOptions):JSX.Element {\r\n\t\tlet {id, name} = item;\r\n\t\tlet {inputs, inputName, onInputChange} = options;\r\n\t\tlet ref = inputs && ((input:HTMLInputElement)=>inputs[id]=input);\r\n\t\treturn <label className=\"form-radio-inline\">\r\n\t\t\t<input ref={ref} type=\"radio\" name={inputName}\r\n\t\t\t\tvalue={id} defaultChecked={value===id}\r\n\t\t\t\tonChange={onInputChange} />\r\n\t\t\t{name}\r\n\t\t</label>;\r\n\t}\r\n\r\n\tprivate renderCheck(item:TagValue, checked: boolean, options: IValuesViewRenderOptions):JSX.Element {\r\n\t\tlet {id, name} = item;\r\n\t\tlet {inputs, onInputChange} = options;\r\n\t\tlet ref = inputs && ((input:HTMLInputElement)=>inputs[id]=input);\r\n\t\treturn <label className=\"form-radio-inline\">\r\n\t\t\t<input ref={ref} type=\"checkbox\"\r\n\t\t\t\tvalue={id} defaultChecked={checked}\r\n\t\t\t\tonChange={onInputChange} />\r\n\t\t\t{name}\r\n\t\t</label>;\r\n\t}\r\n}\r\n","import { Entity } from \"../entity\";\r\nimport { TagView } from \"./tagView\";\r\n\r\nexport interface TagValue {\r\n\tid: number;\r\n\tname: string;\r\n\text: string;\r\n}\r\n\r\nexport class Tag extends Entity {\r\n    get typeName(): string { return 'tag';}\r\n\tvalues: TagValue[];\r\n\tprivate coll: {[id:number]: TagValue} = {};\r\n\r\n\tprivate _view: TagView;\r\n\tget view(): TagView { \r\n\t\tif (this._view !== undefined) return this._view; \r\n\t\treturn this._view = new TagView(this);\r\n\t}\r\n\r\n\tnameFromId(id:number) {\r\n\t\tlet c = this.coll[id]; \r\n\t\treturn c===undefined? undefined : c.name;\r\n\t}\r\n\r\n\tnamesFromIds(ids:string):string[] {\r\n\t\tlet ret:string[] = [];\r\n\t\tfor (let id of ids.split('|')) {\r\n\t\t\tlet c = this.coll[Number(id)];\r\n\t\t\tlet name = c===undefined? undefined : c.name;\r\n\t\t\tif (name !== undefined) ret.push(name);\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync loadValues():Promise<TagValue[]> {\r\n\t\tif (this.values !== undefined) return this.values;\r\n\t\tthis.values = [];\r\n\t\tlet ret = await this.uqApi.get('tag/values/' + this.name);\r\n\t\tif (ret === undefined) return;\r\n\t\tlet lines = (ret as string).split('\\n');\r\n\t\tfor (let line of lines) {\r\n\t\t\tif (line.length === 0) continue;\r\n\t\t\tlet parts = line.split('\\t');\r\n\t\t\tlet id = Number(parts[0]);\r\n\t\t\tlet val = {\r\n\t\t\t\tid: id,\r\n\t\t\t\tname: parts[1],\r\n\t\t\t\text: parts[2],\r\n\t\t\t};\r\n\t\t\tthis.values.push(val);\r\n\t\t\tthis.coll[id] = val;\r\n\t\t}\r\n\t\treturn this.values;\r\n\t}\r\n}\r\n","export * from './page';\r\nexport * from './tabs';\r\nexport * from './scrollView';\r\n","export * from './schema';\r\nexport * from './uiSchema';\r\nexport * from './toUiSelectItems';\r\nexport * from './IValuesView';","\r\nexport const mobileRegex = /^[0-9]*$/;\r\nexport const emailRegex = /\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*/;\r\n// /^([a-zA-Z0-9]+[_|\\_|\\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\\_|\\.]?)*[a-zA-Z0-9]+\\.[a-zA-Z]{2,3}$/\r\n\r\nexport const EmailFieldRule = (value:any): string|string[] => {\r\n    if (emailRegex.test(value as string) === false) return '电子邮件格式错误';\r\n}\r\n\r\nexport const MobileFieldRule = (value:any): string|string[] => {\r\n    if (emailRegex.test(value as string) === false) return '手机格式错误';\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport interface DropdownAction {\r\n    icon?: string;\r\n    caption?: string;\r\n    action?: () => void;\r\n}\r\n\r\nexport interface DropdownActionsProps {\r\n    icon?: string;\r\n    actions: DropdownAction[];\r\n    isRight?: boolean;\r\n    className?: string;\r\n}\r\n\r\nexport interface DropdownActionsState {\r\n    dropdownOpen: boolean;\r\n}\r\n\r\nexport class DropdownActions extends React.Component<DropdownActionsProps, DropdownActionsState> {\r\n    private menu: HTMLDivElement;\r\n    private button: HTMLElement;\r\n    constructor(props:DropdownActionsProps) {\r\n        super(props);\r\n        this.state = {\r\n            dropdownOpen: false\r\n        };\r\n    }\r\n\r\n    componentDidMount() {\r\n        document.addEventListener('click', this.handleDocumentClick);\r\n        document.addEventListener('touchstart', this.handleDocumentClick);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        document.removeEventListener('click', this.handleDocumentClick);\r\n        document.removeEventListener('touchstart', this.handleDocumentClick);\r\n    }\r\n\r\n    private handleDocumentClick = (evt:any) => {\r\n        if (this.state.dropdownOpen === false) return;\r\n        if (this.button && this.button.contains(evt.target)) return;\r\n        if (!this.menu) return;\r\n        //if (!this.menu.contains(evt.target)) \r\n        this.toggle();\r\n    }\r\n\r\n    private toggle = () => {\r\n        this.setState({\r\n            dropdownOpen: !this.state.dropdownOpen\r\n        });\r\n    }\r\n\r\n    render() {\r\n        let {icon, actions, isRight, className} = this.props;\r\n        if (isRight === undefined) isRight = true;\r\n        let hasIcon = actions.some(v => v.icon!==undefined);\r\n        let {dropdownOpen} = this.state;\r\n\t\t//isOpen={this.state.dropdownOpen} toggle={this.toggle}\r\n\t\tlet cn = 'cursor-pointer dropdown-toggle btn btn-sm ';\r\n\t\tif (className) cn += className;\r\n        return <div className={'dropdown'}>\r\n\t\t\t<button ref={v=>this.button=v} \r\n\t\t\t\tclassName={cn}\r\n                data-toggle=\"dropdown\"\r\n                aria-expanded={dropdownOpen}\r\n                onClick={this.toggle}>\r\n                <i className={classNames('fa fa-fw ', 'fa-'+(icon||'ellipsis-v'))} />\r\n            </button>\r\n            <div ref={v => this.menu=v} className={classNames({\"dropdown-menu\":true, \"dropdown-menu-right\":isRight, \"show\":dropdownOpen})}>\r\n                {\r\n                    actions.map((v,index) => {\r\n                        let {icon, caption, action} = v;\r\n                        if (icon === undefined && caption === undefined) \r\n                            return <div className=\"dropdown-divider\" />;\r\n                        let i:any;\r\n                        if (hasIcon === true) {\r\n                            if (icon !== undefined) icon = 'fa-' + icon;\r\n                            i = <><i className={classNames('fa', icon, 'fa-fw')} aria-hidden={true}></i>&nbsp; </>;\r\n                        }\r\n                        if (action === undefined) \r\n                            return <h6 className=\"dropdown-header\">{i} {caption}</h6>;\r\n                        let onMenuItemClick = (evt:React.MouseEvent<HTMLAnchorElement>)=>{\r\n                            evt.preventDefault();\r\n                            action();\r\n                        }\r\n                        let onTouchStart = (evt: React.TouchEvent<HTMLAnchorElement>) => {\r\n                            action();\r\n                        }\r\n                            // eslint-disable-next-line\r\n                        return <a className=\"dropdown-item\" key={index} href=\"#/\" \r\n                            onClick={onMenuItemClick} onTouchStart={onTouchStart}\r\n                            >{i} {caption}</a>\r\n                    })\r\n                }\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { setRes } from '../../components';\r\n\r\nexport interface EasyDateProps {\r\n    date: Date | number;\r\n}\r\n\r\n//type YMD = (year:number, month:number, date:number) => string;\r\n//type MD = (month:number, date:number) => string;\r\n\r\nconst timeRes:{[prop:string]:any} = {\r\n\tmd: (month:number, date:number) => `${month}-${date}`,\r\n\tymd: (year:number, month:number, date:number) => `${year}-${month}-${date}`,\r\n\tyesterday: 'Yday',\r\n\ttoday: 'Today',\r\n\ttomorrow: 'Tmw',\r\n\t$zh: {\r\n\t\tmd: (month:number, date:number) => `${month}月${date}日`,\r\n\t\tymd: (year:number, month:number, date:number) => `${year}年${month}月${date}日`,\r\n\t\tyesterday: '昨天',\r\n\t\ttoday: '今天',\r\n\t\ttomorrow: '明天',\r\n\t},\r\n\t$en: {\r\n\t\tmd: (month:number, date:number) => `${month}-${date}`,\r\n\t\tymd: (year:number, month:number, date:number) => `${year}-${month}-${date}`,\r\n\t\tyesterday: 'Yday',\r\n\t\ttoday: 'Today',\r\n\t\ttomorrow: 'Tmw',\r\n\t}\r\n}\r\n\r\nsetRes(timeRes, timeRes);\r\n\r\nfunction tt(str:string):any {\r\n\treturn timeRes[str];\r\n}\r\n\r\nfunction renderDate(vDate:Date|number, withTime:boolean, always:boolean = false) {\r\n    if (!vDate) return null;\r\n    let date: Date;\r\n    switch (typeof vDate) {\r\n        default: date = vDate as Date; break;\r\n        case 'string': date = new Date(vDate); break;\r\n        case 'number': date = new Date((vDate as number)*1000); break;\r\n    }\r\n\r\n    let now = new Date();\r\n    let tick:number, nDate:number, _date:number, month:number, year:number, nowYear:number;\r\n    let d = date;\r\n    tick = now.getTime() - d.getTime();\r\n    let hour=d.getHours(), minute=d.getMinutes();\r\n    nDate=now.getDate();\r\n    _date=d.getDate();\r\n    month=d.getMonth()+1;\r\n    year=d.getFullYear();\r\n\tnowYear = now.getFullYear();\r\n\r\n\tlet appendTime:boolean = false;\r\n\tlet dPart:string = (function() {\r\n\t\tif (tick < -24*3600*1000) {\r\n\t\t\tif (year === nowYear) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt('md')(month, _date);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt('ymd')(year, month, _date);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (tick < 24*3600*1000) {\r\n\t\t\tif (_date!==nDate) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt(tick < 0? 'tomorrow' : 'yesterday');\r\n\t\t\t}\r\n\t\t\tif (withTime===true) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn '';\r\n\t\t\t}\r\n\t\t\treturn tt('today');\r\n\t\t}\r\n\t\tif (year === nowYear) {\r\n\t\t\treturn tt('md')(month, _date);\r\n\t\t}\r\n\t\treturn tt('ymd')(year, month, _date);\r\n\t})();\r\n\r\n\tlet hm = hour + ((minute<10?':0':':') + minute);\r\n\r\n\t/*\r\n    if (tick < -24*3600*1000) {\r\n        if (year === nowYear)\r\n            return tt('md')(month, _date) + ' ' + hm;\r\n        else\r\n            return tt('ymd')(year, month, _date) + ' ' + hm;\r\n    }\r\n    if (always === true || tick < 24*3600*1000) {\r\n        return _date!==nDate? \r\n            tt(tick < 0? 'tomorrow' : 'yesterday') + ' ' + hm \r\n            : withTime===true? hm : tt('today');\r\n    }\r\n    if (year === nowYear) {\r\n        return tt('md')(month, _date);\r\n    }\r\n\treturn tt('ymd')(year, month, _date);\r\n\t*/\r\n\tif (appendTime === true || always === true) {\r\n\t\treturn dPart + ' ' + hm;\r\n\t}\r\n\treturn dPart;\r\n}\r\n\r\n\r\nexport class EasyDate extends React.Component<EasyDateProps> {\r\n    render() {\r\n        return renderDate(this.props.date, false);\r\n    }\r\n}\r\n\r\ninterface EasyTimeProps extends EasyDateProps {\r\n\talways?: boolean;\r\n}\r\nexport class EasyTime extends React.Component<EasyTimeProps> {\r\n    render() {\r\n\t\tlet {date, always} = this.props;\r\n        return renderDate(date, true, always);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Image } from '.';\r\n\r\nexport interface MediaProps {\r\n    icon: string;\r\n    main: string|JSX.Element;\r\n    discription?: string | JSX.Element;\r\n    px?: number;\r\n    py?: number;\r\n}\r\n\r\nexport class Media extends React.Component<MediaProps> {\r\n    render() {\r\n        let {icon, main, discription, px, py} = this.props;\r\n        let disp:any;\r\n        if (typeof discription === 'string')\r\n            disp = <div>{discription}</div>;\r\n        else\r\n            disp = discription;\r\n        let cn = classNames(\r\n            'media', \r\n            px===undefined? 'px-0':'px-'+px, \r\n            py===undefined? 'py-2':'py-'+py);\r\n        return <div className={cn}>\r\n            <Image className=\"mr-3 w-4c h-4c\" src={icon} />\r\n            <div className=\"media-body\">\r\n                <h5 className=\"mt-0\">{main}</h5>\r\n                {disp}\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { observable } from 'mobx';\r\n\r\nexport interface SearchBoxProps {\r\n    className?: string;\r\n    label?: string;\r\n    initKey?: string;\r\n    placeholder?: string;\r\n    buttonText?: string;\r\n    maxLength?: number;\r\n    size?: 'sm' | 'md' | 'lg';\r\n    inputClassName?: string;\r\n    onSearch: (key:string)=>Promise<void>;\r\n    onFocus?: ()=>void;\r\n    allowEmptySearch?: boolean;\r\n}\r\n\r\n/*\r\nexport interface SearchBoxState {\r\n    disabled: boolean;\r\n}*/\r\n\r\nexport class SearchBox extends React.Component<SearchBoxProps> { //}, SearchBoxState> {\r\n    private input: HTMLInputElement;\r\n    private key: string = null;\r\n    @observable private disabled: boolean;\r\n\r\n    private onChange = (evt: React.ChangeEvent<any>) => {\r\n        this.key = evt.target.value;\r\n        if (this.key !== undefined) {\r\n            this.key = this.key.trim();\r\n            if (this.key === '') this.key = undefined;\r\n        }\r\n        if (this.props.allowEmptySearch !== true) {\r\n            this.disabled = !this.key;\r\n        }\r\n    }\r\n    private onSubmit = async (evt: React.FormEvent<any>) => {\r\n        evt.preventDefault();\r\n        if (this.key === null) this.key = this.props.initKey || '';\r\n        if (this.props.allowEmptySearch !== true) {\r\n            if (!this.key) return;\r\n            if (this.input) this.input.disabled = true;\r\n        }\r\n        await this.props.onSearch(this.key);\r\n        if (this.input) this.input.disabled = false;\r\n    }\r\n    clear() {\r\n        if (this.input) this.input.value = '';\r\n    }\r\n    render() {\r\n        let {className, inputClassName, onFocus,\r\n            label, placeholder, buttonText, maxLength, size} = this.props;\r\n        let inputSize:string;\r\n        switch (size) {\r\n            default:\r\n            case 'sm': inputSize = 'input-group-sm'; break;\r\n            case 'md': inputSize = 'input-group-md'; break;\r\n            case 'lg': inputSize = 'input-group-lg'; break;\r\n        }\r\n        return <form className={className} onSubmit={this.onSubmit} >\r\n            <div className={classNames(\"input-group\", inputSize)}>\r\n                {label && <div className=\"input-group-addon align-self-center mr-2\">{label}</div>}\r\n                <input ref={v=>this.input=v} onChange={this.onChange}\r\n                    type=\"text\"\r\n                    name=\"key\"\r\n                    onFocus={onFocus}\r\n                    className={classNames('form-control', inputClassName || 'border-primary')}\r\n                    placeholder={placeholder}\r\n                    defaultValue={this.props.initKey}\r\n                    maxLength={maxLength} />\r\n                <div className=\"input-group-append\">\r\n                    <button className=\"btn btn-primary\"\r\n                        type=\"submit\"\r\n                        disabled={this.disabled}>\r\n                        <i className='fa fa-search' />\r\n                        <i className=\"fa\"/>\r\n                        {buttonText}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </form>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { nav } from './nav';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\nimport { userApi } from '../net';\r\nimport { User } from '../tool';\r\n\r\nexport type UserLoader = (userId:number)=>Promise<any>;\r\n\r\nexport class UserCache<T> {\r\n\tprivate loader: UserLoader;\r\n\tprivate onLoaded: (user:User) => void;\r\n\tprivate map = observable(new Map<number, T|number>());\r\n\r\n\tconstructor(loader: UserLoader) {\r\n\t\tif (loader === undefined) loader = (userId:number)=>userApi.user(userId);\r\n\t\tthis.loader = loader;\r\n\t}\r\n\r\n\tuse(id:number|any, onLoaded?:(user:User)=>void) {\t\t\r\n\t\tif (!id) return;\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tif (!id) return;\r\n\t\tthis.onLoaded = onLoaded;\r\n\t\tid = Number(id);\r\n\t\tlet ret = this.map.get(id);\r\n\t\tif (ret === undefined) {\r\n\t\t\tthis.map.set(id, id);\r\n\t\t}\r\n\t}\r\n\r\n\tgetValue(id:number|any):any {\r\n\t\tif (!id) return;\r\n\t\tswitch (typeof(id)) {\r\n\t\t\tcase 'object': \r\n\t\t\t\tid = id.id; \r\n\t\t\t\tif (!id) return;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tlet ret = this.map.get(id);\r\n\t\tif (!ret) return;\r\n\t\tswitch (typeof(ret)) {\r\n\t\tdefault:\r\n\t\t\treturn ret;\r\n\t\tcase 'number':\r\n\t\t\tif (ret < 0) return id;\r\n\t\t\tthis.map.set(id, -id);\r\n\t\t\tthis.loader(id).then(v => {\r\n\t\t\t\tif (!v) v = null;\r\n\t\t\t\tthis.map.set(id, v);\r\n\t\t\t\tif (this.onLoaded) this.onLoaded(v);\r\n\t\t\t}).catch(reason => {\r\n\t\t\t\tconsole.error(reason);\r\n\t\t\t});\r\n\t\t\treturn id;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconst userCache = new UserCache(undefined);\r\n\r\nexport interface UserIconProps {\r\n    id: number;\r\n    className?: string;\r\n    style?: React.CSSProperties;\r\n    altImage?: string;\r\n    noneImage?: any;\r\n}\r\n\r\nexport const UserIcon = observer((props: UserIconProps):JSX.Element => {\r\n    let {className, style, id, altImage, noneImage} = props;\r\n    let user = userCache.getValue(id);\r\n    switch (typeof user) {\r\n\tcase 'undefined':\r\n\tcase 'number':\r\n        return <div className={classNames(className, 'image-none')} style={style}>\r\n            {noneImage || <i className=\"fa fa-file-o\" />}\r\n        </div>;\r\n    }\r\n    let {icon} = user;\r\n    if (!icon) {\r\n        return <div className={classNames(className, 'image-none')} style={style}>\r\n            <i className=\"fa fa-file-o\" />\r\n        </div>;\r\n    }\r\n    if (icon.startsWith(':') === true) {\r\n        icon = nav.resUrl + icon.substr(1);\r\n    }\r\n    return <img src={icon} className={className} alt=\"img\"\r\n        style={style}\r\n        onError={evt=>{\r\n            if (altImage) evt.currentTarget.src=altImage;\r\n            else evt.currentTarget.src = 'https://tv.jkchemical.com/imgs/0001.png';\r\n        }} />;\r\n});\r\n\r\nexport interface UserViewProps {\r\n\tid?: number;\r\n\tuser?: number|User;\r\n\trender: (user:User) => JSX.Element;\r\n\tonLoaded?: (user:User) => void\r\n}\r\n\r\nexport const UserView = observer((props: UserViewProps):JSX.Element => {\r\n\tlet {id:idProp, user, render, onLoaded} = props;\r\n\tif (user === null) return <>null</>;\r\n\tswitch (typeof user) {\r\n\t\tcase 'undefined': \r\n\t\t\tuser = userCache.getValue(idProp);\r\n\t\t\tbreak;\r\n\t\tcase 'object': \r\n\t\t\tlet {/*obj, */id} = user as any;\r\n\t\t\t//if (typeof obj !== 'object') {\r\n\t\t\t\tuseUser(id, onLoaded);\r\n\t\t\t\tuser = userCache.getValue(id);\r\n\t\t\t//}\r\n\t\t\tbreak;\r\n\t\tcase 'number':\r\n\t\t\tuseUser(user as number, onLoaded);\r\n\t\t\tuser = userCache.getValue(user as number);\r\n\t\t\tbreak;\r\n\t\tcase 'string':\r\n\t\t\tuseUser(Number(user), onLoaded);\r\n\t\t\tuser = userCache.getValue(Number(user));\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tuser = undefined;\r\n\t\t\tbreak;\r\n\t}\r\n    switch (typeof user) {\r\n\t\tcase 'undefined':\r\n\t\tcase 'number':\r\n        \treturn <>{user}</>;\r\n    }\r\n    return render(user);\r\n});\r\n\r\nexport function useUser(id: number|object, onLoaded?: (user:User)=>void) {\r\n\tif (!id) return;\r\n\tif (typeof(id) === 'object') {\r\n\t\tid = (id as any).id;\r\n\t}\r\n\tuserCache.use(id, onLoaded);\r\n}\r\n","import { UqMan, TuidModify } from '../uqMan';\r\nimport { Tuid } from \"./tuid\";\r\nimport { env } from '../../tool';\r\n\r\ninterface Modify {\r\n    id: number;\r\n    entity: string;\r\n    key: string;\r\n}\r\n\r\nexport class TuidsCache {\r\n    private readonly uq: UqMan;\r\n    private modifyMax: TuidModify;\r\n    private cacheTimer: any;\r\n    constructor(uq: UqMan) {\r\n        this.uq = uq;\r\n    }\r\n\r\n    cacheTuids(defer:number) {\r\n        this.clearCacheTimer();\r\n        this.cacheTimer = env.setTimeout('TuidsCache.cacheTuids', this.loadIds, defer);\r\n    }\r\n    private clearCacheTimer() {\r\n        if (this.cacheTimer === undefined) return;\r\n        env.clearTimeout(this.cacheTimer);\r\n        this.cacheTimer = undefined;\r\n    }\r\n    private loadIds = () => {\r\n        this.clearCacheTimer();\r\n        let {tuids} = this.uq;\r\n        for (let i in tuids) {\r\n            let tuid = tuids[i];\r\n            tuid.cacheIds();\r\n        }\r\n    }\r\n    \r\n    pullModify(modifyMax:number) {\r\n        if (modifyMax === undefined) return;\r\n        let now = Math.floor(Date.now() / 1000);\r\n        if (this.modifyMax === undefined) {\r\n            this.modifyMax = this.uq.localModifyMax.get();\r\n            if (this.modifyMax === undefined) {\r\n                this.modifyMax = {\r\n                    max: modifyMax,\r\n                    seconds: now,\r\n                };\r\n                this.uq.localModifyMax.set(this.modifyMax);\r\n            }\r\n        }\r\n        let {max, seconds} = this.modifyMax;\r\n        let lockGap = 3600;\r\n        if (now - seconds < lockGap) return;\r\n        if (modifyMax <= max) return;\r\n        let tuidCached:string[] = [];\r\n        let {tuids} = this.uq;\r\n        for (let i in tuids) {\r\n            //if (tuids[i].cached === true) \r\n            tuidCached.push(i);\r\n        }\r\n        if (tuidCached.length === 0) return;\r\n        this.modifyMax.seconds = now;\r\n        this.innerPullModify(tuidCached.join('\\t'));\r\n    }\r\n\r\n    private async innerPullModify(tuidLists:string):Promise<void> {\r\n        let {uqApi, tuids} = this.uq;\r\n        let {max} = this.modifyMax;\r\n        let ret:{queue:Modify[], queueMax:number} = await uqApi.queueModify(max, 30, tuidLists);\r\n        let group:{[entity:string]: {tuid:Tuid; ids: string[]}} = {};\r\n        let modifyMax:number = 0;\r\n        for (let modify of ret.queue) {\r\n\t\t\tlet {id, entity, key} = modify;\r\n\t\t\tif (!key) continue;\r\n            let tuid = tuids[entity];\r\n            if (tuid === undefined) continue;\r\n            let item = group[entity];\r\n            if (item === undefined) {\r\n                item = group[entity] = {tuid: tuid, ids:[]};\r\n            }\r\n            item.ids.push(key);\r\n            if (id > modifyMax) modifyMax = id;\r\n        }\r\n        for (let i in group) {\r\n            let {tuid, ids} = group[i];\r\n            await tuid.modifyIds(ids);\r\n        }\r\n        let now = Math.floor(Date.now() / 1000);\r\n        this.modifyMax = {\r\n            max: modifyMax,\r\n            seconds: now,\r\n        }\r\n        this.uq.localModifyMax.set(this.modifyMax);\r\n    }\r\n}\r\n","import { LocalMap, LocalCache, env } from '../tool';\r\nimport { UqData, UqAppData, loadAppUqs } from '../net';\r\nimport { UqMan } from './uqMan';\r\nimport { TuidImport, TuidInner } from './tuid';\r\nimport { nav } from '../components';\r\n\r\nexport interface TVs {\r\n    [uqName:string]: {\r\n        [tuidName: string]: (values: any) => JSX.Element;\r\n    }\r\n}\r\n\r\nexport class UQsMan {\r\n\tstatic _uqs: any;\r\n\tstatic value: UQsMan;\r\n\tstatic errors: string[];\r\n\r\n\tstatic async load(tonvaAppName:string, version:string, tvs:TVs) {\r\n\t\tlet uqsMan = UQsMan.value = new UQsMan(tonvaAppName, tvs);\r\n        let {appOwner, appName} = uqsMan;\r\n        let {localData} = uqsMan;\r\n        let uqAppData:UqAppData = localData.get();\r\n        if (!uqAppData || uqAppData.version !== version) {\r\n\t\t\tuqAppData = await loadAppUqs(appOwner, appName);\r\n\t\t\tif (!uqAppData.id) {\r\n\t\t\t\treturn [\r\n\t\t\t\t\t`${appOwner}/${appName}不存在。请仔细检查app全名。`\r\n\t\t\t\t];\r\n\t\t\t}\r\n            uqAppData.version = version;\r\n            localData.set(uqAppData);\r\n            // \r\n            for (let uq of uqAppData.uqs) uq.newVersion = true;\r\n        }\r\n        let {id, uqs} = uqAppData;\r\n        uqsMan.id = id;\r\n        await uqsMan.init(uqs);\r\n        let retErrors = await uqsMan.load();\r\n        if (retErrors.length === 0) {\r\n            retErrors.push(...uqsMan.setTuidImportsLocal());\r\n            if (retErrors.length === 0) {\r\n                UQsMan._uqs = uqsMan.buildUQs();\r\n                return;\r\n            }\r\n        }\r\n        UQsMan.errors = retErrors;\r\n\t}\r\n\r\n    private collection: {[uqName: string]: UqMan};\r\n    private readonly tvs: TVs;\r\n\r\n    readonly name: string;\r\n    readonly appOwner: string;\r\n    readonly appName: string;\r\n    readonly localMap: LocalMap;\r\n    readonly localData: LocalCache;\r\n    id: number;\r\n\r\n    private constructor(tonvaAppName:string, tvs:TVs) {\r\n        this.tvs = tvs || {};\r\n        this.buildTVs();\r\n        this.collection = {};\r\n        let parts = tonvaAppName.split('/');\r\n        if (parts.length !== 2) {\r\n            throw new Error('tonvaApp name must be / separated, owner/app');\r\n        }\r\n        this.appOwner = parts[0];\r\n        this.appName = parts[1];\r\n        this.localMap = env.localDb.map(tonvaAppName);\r\n        this.localData = this.localMap.child('uqData');\r\n    }\r\n\r\n    // to be removed in the future\r\n    addUq(uq: UqMan) {\r\n        this.collection[uq.name] = uq;\r\n    }\r\n\r\n    private buildTVs() {\r\n        for (let i in this.tvs) {\r\n            let uqTVs = this.tvs[i];\r\n            if (uqTVs === undefined) continue;\r\n            let l = i.toLowerCase();\r\n            if (l === i) continue;\r\n            this.tvs[l] = uqTVs;\r\n            for (let j in uqTVs) {\r\n                let en = uqTVs[j];\r\n                if (en === undefined) continue;\r\n                let lj = j.toLowerCase();\r\n                if (lj === j) continue;\r\n                uqTVs[lj] = en;\r\n            }\r\n        }\r\n    }\r\n\r\n    async init(uqsData:UqData[]):Promise<void> {\r\n        let promiseInits: PromiseLike<void>[] = [];\r\n        for (let uqData of uqsData) {\r\n            let {uqOwner, uqName} = uqData;\r\n            let uqFullName = uqOwner + '/' + uqName;\r\n            //let uqUI = this.ui.uqs[uqFullName] as UqUI || {};\r\n            //let cUq = this.newCUq(uqData, uqUI);\r\n            //this.cUqCollection[uqFullName] = cUq;\r\n            //this.uqs.addUq(cUq.uq);\r\n            let uq = new UqMan(this, uqData, undefined, this.tvs[uqFullName] || this.tvs[uqName]);\r\n            this.collection[uqFullName] = uq;\r\n            let lower = uqFullName.toLowerCase();\r\n            if (lower !== uqFullName) {\r\n                this.collection[lower] = uq;\r\n            }\r\n            promiseInits.push(uq.init());\r\n        }\r\n        await Promise.all(promiseInits);\r\n    }\r\n\r\n    async load(): Promise<string[]> {\r\n        let retErrors:string[] = [];\r\n        let promises: PromiseLike<string>[] = [];\r\n        for (let i in this.collection) {\r\n            let uq = this.collection[i];\r\n            promises.push(uq.loadEntities());\r\n\t\t}\t\t\r\n        let results = await Promise.all(promises);\r\n        for (let result of results)\r\n        {\r\n            let retError = result; // await cUq.loadSchema();\r\n            if (retError !== undefined) {\r\n                retErrors.push(retError);\r\n                continue;\r\n            }\r\n\t\t}\r\n        return retErrors;\r\n    }\r\n\r\n    buildUQs(): any {\r\n        let that = this;\r\n        let uqs:any = {};\r\n        for (let i in this.collection) {\r\n            let uqMan = this.collection[i];\r\n            //let n = uqMan.name;\r\n            let uqName = uqMan.uqName;\r\n            let l = uqName.toLowerCase();\r\n            let entities = uqMan.entities;\r\n            let keys = Object.keys(entities);\r\n            for (let key of keys) {\r\n                let entity = entities[key];\r\n                let {name} = entity;\r\n                //if (name !== sName) \r\n                //entities[sName] = entity;\r\n                entities[name.toLowerCase()] = entity;\r\n            }\r\n            //uqs[i] = entities;\r\n            //uqs[uqName] = entities;\r\n            //if (l !== uqName) \r\n            uqs[l] = new Proxy(entities, {\r\n                get: function(target, key, receiver) {\r\n                    let lk = (key as string).toLowerCase();\r\n                    let ret = target[lk];\r\n                    if (ret !== undefined) return ret;\r\n\t\t\t\t\tdebugger;\r\n\t\t\t\t\tlet err = `entity ${uqName}.${String(key)} not defined`;\r\n                    console.error(err);\r\n                    that.showReload('UQ错误：' + err);\r\n                    return undefined;\r\n                }\r\n            });\r\n        }\r\n        //let uqs = this.collection;\r\n        return new Proxy(uqs, {\r\n            get: function (target, key, receiver) {\r\n                let lk = (key as string).toLowerCase();\r\n                let ret = target[lk];\r\n                if (ret !== undefined) return ret;\r\n                /*\r\n                for (let i in uqs) {\r\n                    if (i.toLowerCase() === lk) {\r\n                        return uqs[i];\r\n                    }\r\n                }*/\r\n                debugger;\r\n                console.error('error in uqs');\r\n                that.showReload(`代码错误：新增 uq ${String(key)}`);\r\n                return undefined;\r\n            },\r\n        });\r\n    }\r\n\r\n    private showReload(msg: string) {\r\n        this.localMap.removeAll();\r\n        nav.showReloadPage(msg);\r\n    }\r\n\r\n    setTuidImportsLocal():string[] {\r\n        let ret:string[] = [];\r\n        for (let i in this.collection) {\r\n            let uq = this.collection[i];\r\n            for (let tuid of uq.tuidArr) {\r\n                if (tuid.isImport === true) {\r\n                    let error = this.setInner(tuid as TuidImport);\r\n                    if (error) ret.push(error);\r\n                }\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    private setInner(tuidImport: TuidImport):string {\r\n        let {from} = tuidImport;\r\n        let fromName = from.owner + '/' + from.uq;\r\n        let uq = this.collection[fromName];\r\n        if (uq === undefined) {\r\n            //debugger;\r\n            return `setInner(tuidImport: TuidImport): uq ${fromName} is not loaded`;\r\n        }\r\n        let iName = tuidImport.name\r\n        let tuid = uq.tuid(iName);\r\n        if (tuid === undefined) {\r\n            //debugger;\r\n            return `setInner(tuidImport: TuidImport): uq ${fromName} has no Tuid ${iName}`;\r\n        }\r\n        if (tuid.isImport === true) {\r\n            //debugger;\r\n            return `setInner(tuidImport: TuidImport): uq ${fromName} Tuid ${iName} is import`;\r\n        }\r\n        tuidImport.setFrom(tuid as TuidInner);\r\n    }\r\n}\r\n","import _ from 'lodash';\r\nimport { Context } from '../context';\r\nimport { FormRes } from '../../../res/formRes';\r\n\r\nexport abstract class Rule {\r\n    abstract check(defy:string[], value:any):void;\r\n}\r\n\r\nexport type ContextRule = (context:Context)=>{[target:string]:string[]|string} | string[] | string;\r\nexport type FieldRule = (value:any) => string[] | string;\r\n\r\nexport class RuleCustom extends Rule {\r\n    private func: FieldRule;\r\n    constructor(func: FieldRule) {\r\n        super();\r\n        this.func = func;\r\n    }\r\n    check(defy:string[], value:any) {\r\n        let ret = this.func(value);\r\n        if (ret === undefined) return;\r\n        switch (typeof ret) {\r\n            case 'undefined': return;\r\n            case 'string': defy.push(ret as string); return;\r\n            default: defy.push(...ret); return;\r\n        }        \r\n    }\r\n}\r\n\r\nexport abstract class RulePredefined extends Rule {\r\n    protected res: FormRes;\r\n    constructor(res: FormRes) {\r\n        super();\r\n        this.res = res;\r\n    }\r\n}\r\n\r\nexport class RuleRequired extends RulePredefined {\r\n    check(defy:string[], value:any) {\r\n        switch (typeof value) {\r\n            default:\r\n            case 'boolean': return;\r\n            case 'object':\r\n                if (value !== null) return;\r\n                break;\r\n            case 'string':\r\n                if ((value as string).trim().length > 0) return;\r\n                break;\r\n            case 'number':\r\n                if (isNaN(value as number) === false) return;\r\n                break;\r\n            case 'undefined':\r\n                break;\r\n        }\r\n        defy.push(this.res.required);\r\n    }\r\n}\r\n\r\nexport class RuleNum extends RulePredefined {\r\n    private minMsg: _.TemplateExecutor;\r\n    private maxMsg: _.TemplateExecutor;\r\n    protected min: number;\r\n    protected max: number\r\n    constructor(res: FormRes, min?: number, max?: number) {\r\n        super(res);\r\n        this.minMsg = _.template(res.min);\r\n        this.maxMsg = _.template(res.max);\r\n        this.min = min;\r\n        this.max = max;\r\n    }\r\n    check(defy:string[], value:any) {\r\n        if (value === undefined || value === null) return;\r\n        let n = Number(value);\r\n        if (isNaN(n) === true) {\r\n            defy.push(this.res.number);\r\n        }\r\n        else {\r\n            this.checkMore(defy, n);\r\n        }\r\n    }\r\n\r\n    protected checkMore(defy:string[], value: number) {\r\n        if (this.min !== undefined && Number(value) < this.min) {\r\n            defy.push(this.minMsg({min:this.min}));\r\n        }\r\n        if (this.max !== undefined && Number(value) > this.max) {\r\n            defy.push(this.maxMsg({max:this.max}));\r\n        }\r\n    }\r\n}\r\n\r\nexport class RuleInt extends RuleNum {\r\n    protected checkMore(defy:string[], n: number) {\r\n        super.checkMore(defy, n);\r\n        if (Number.isInteger(n) === false) {\r\n            defy.push(this.res.integer);\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { UiItem, ChangingHandler, ChangedHandler } from '../../schema';\r\nimport { FieldProps } from '../field';\r\nimport { Context } from '../context';\r\nimport { ItemSchema } from '../../schema';\r\nimport { Rule, RuleRequired, RuleCustom, FieldRule } from '../rules';\r\nimport { computed, observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport abstract class Widget {\r\n    name: string;\r\n    protected context: Context;\r\n    protected fieldProps:FieldProps;\r\n    protected children: React.ReactNode;\r\n    protected _itemSchema: ItemSchema;\r\n    protected _ui: UiItem;\r\n    protected defaultValue: any;\r\n    protected value: any;\r\n    protected rules: Rule[];\r\n    @observable errors: string[] = [];\r\n    @observable protected contextErrors: string[] = [];\r\n    @computed protected get hasError():boolean {return (this.errors.length + this.contextErrors.length)>0}\r\n    protected readOnly:boolean;\r\n    protected disabled:boolean;\r\n    @observable visible:boolean;\r\n\r\n    constructor(context:Context, itemSchema:ItemSchema, fieldProps:FieldProps, children: React.ReactNode) {\r\n        this.context = context;\r\n        let {name} = itemSchema;\r\n        this.name = name;\r\n        this._itemSchema = itemSchema;\r\n        this.fieldProps = fieldProps;\r\n        this.children = children;\r\n        this._ui = context.getUiItem(name);\r\n        if (this.ui === undefined) {\r\n            this.readOnly = false;\r\n            this.disabled = false;\r\n            this.visible = true;\r\n        }\r\n        else {\r\n            let {readOnly, disabled, visible} = this.ui;\r\n            this.readOnly = (readOnly === true);\r\n            this.disabled = (disabled === true);\r\n            this.visible = !(visible === false);            \r\n        }\r\n        this.value = this.defaultValue =  context.getValue(name); //defaultValue;\r\n        // this.init();\r\n    }\r\n\r\n    protected get itemSchema(): ItemSchema {return this._itemSchema};\r\n    protected get ui(): UiItem {return this._ui};\r\n\r\n    init() {\r\n        this.rules = [];\r\n        if (this.itemSchema.required === true) {\r\n            this.rules.push(new RuleRequired(this.context.form.res));\r\n        }\r\n        this.buildRules();\r\n        if (this.ui === undefined) return;\r\n        let {rules} = this.ui;\r\n        if (rules === undefined) return;\r\n        if (Array.isArray(rules) === false) {\r\n            this.rules.push(new RuleCustom(rules as FieldRule));\r\n            return;\r\n        }\r\n        for (let rule of rules as FieldRule[]) {\r\n            this.rules.push(new RuleCustom(rule));\r\n        }\r\n    }\r\n\r\n    protected buildRules() {\r\n    }\r\n\r\n    checkRules() {\r\n        let defy:string[] = [];\r\n        for (let r of this.rules) r.check(defy, this.value);\r\n        if (defy.length === 0) {\r\n            this.context.removeErrorWidget(this);\r\n        }\r\n        else {\r\n            this.context.addErrorWidget(this);\r\n            this.errors.push(...defy);\r\n        }\r\n    }\r\n\r\n    @computed get isOk() {\r\n        return this.errors.length ===0;\r\n    }\r\n\r\n    setError(err:string | string[]) {\r\n        if (err === undefined) return;\r\n        if (typeof err === 'string') this.errors.push(err);\r\n        else this.errors.push(...err);\r\n    }\r\n\r\n    setContextError(err:string | string[]) {\r\n        if (err === undefined) return;\r\n        if (typeof err === 'string') this.contextErrors.push(err);\r\n        else this.contextErrors.push(...err);\r\n    }\r\n\r\n    clearError() {\r\n        this.errors.splice(0);\r\n    }\r\n\r\n    clearContextError() {\r\n        this.contextErrors.splice(0);\r\n    }\r\n\r\n    protected parse(value:any):any {return value}\r\n\r\n    protected setElementValue(value:any) {}\r\n    protected setDataValue(value:any) {\r\n        if (this.isChanging === true) return;\r\n        this.context.initData[this.name] = this.value = this.parse(value);\r\n    }\r\n\r\n    setValue(value:any) {\r\n        if (this.isChanging === true) return;\r\n        //this.setDataValue(value);\r\n        //this.setElementValue(value);\r\n        this.changeValue(value, false);\r\n    }\r\n\r\n    getValue() {\r\n        return this.context.getValue(this.name);\r\n    }\r\n\r\n    getReadOnly():boolean {return this.readOnly}\r\n    getDisabled():boolean {return this.disabled}\r\n    getVisible():boolean {return this.visible}\r\n    setReadOnly(value:boolean) {this.readOnly = value}\r\n    setDisabled(value:boolean) {this.disabled = value}\r\n    setVisible(value:boolean) {this.visible = value}\r\n\r\n    private isChanging: boolean;\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n        this.changeValue(evt.target.value, true);\r\n    }\r\n\r\n    protected changeValue(newValue: any, fromElement: boolean) {\r\n        let prev = this.value;\r\n        let onChanging: ChangingHandler;\r\n        let onChanged: ChangedHandler;\r\n        if (this.ui !== undefined) {\r\n            onChanging = this.ui.onChanging;\r\n            onChanged = this.ui.onChanged;\r\n        }\r\n        let allowChange = true;\r\n        if (onChanging !== undefined) {\r\n            this.isChanging = true;\r\n            allowChange = onChanging(this.context, this.value, prev);\r\n            this.isChanging = false;\r\n        }\r\n        if (allowChange === true) {\r\n            this.setDataValue(newValue);\r\n            if (fromElement !== true) this.setElementValue(newValue);\r\n            if (onChanged !== undefined) {\r\n                this.isChanging = true;\r\n                onChanged(this.context, this.value, prev);\r\n                this.isChanging = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected get className():string {\r\n        let fieldClass:string;\r\n        if (this.context.inNode === false) fieldClass = 'form-control';\r\n        return classNames(fieldClass, this.context.form.FieldClass, this.ui && this.ui.className);\r\n    }\r\n\r\n    protected abstract render():JSX.Element;\r\n\r\n    protected renderBody():JSX.Element {\r\n        let elDiscription;\r\n        if (this.hasError === false && this.ui) {\r\n            let {discription, discriptionClassName} = this.ui;\r\n            if (discriptionClassName === undefined) discriptionClassName = 'small text-muted';\r\n            elDiscription = <span className={discriptionClassName}>\r\n                {discription}\r\n            </span>;\r\n        }\r\n        return <>\r\n            {this.render()}\r\n            {elDiscription}\r\n        </>;\r\n    }\r\n\r\n    container = observer(():JSX.Element => {\r\n        if (this.visible === false) return null;\r\n        let {form, inNode} = this.context;\r\n        if (inNode === true) return this.render();\r\n        let label:any = this.label;\r\n        if (this.itemSchema.required === true && form.props.requiredFlag !== false) {\r\n            if (label !== null) label = <>{label}&nbsp;<span className=\"text-danger\">*</span></>;\r\n        }\r\n        return form.FieldContainer(label, this.renderBody());\r\n    })\r\n\r\n    protected get label():string {\r\n        let label:any;\r\n        if (this.ui === undefined) {\r\n            label = this.name;\r\n        }\r\n        else {\r\n            let uiLabel = this.ui.label;\r\n            if (uiLabel === null) label = null;\r\n            else label = uiLabel || this.name;\r\n        }\r\n        return label;\r\n    }\r\n\r\n    protected renderTemplet():JSX.Element | undefined {\r\n        if (this.children !== undefined) {\r\n            return <>{this.children}</>;\r\n        }\r\n        if (this.ui === undefined) return undefined;\r\n        let {Templet} = this.ui;\r\n        if (typeof Templet === 'function') return Templet(this.value);\r\n        return Templet;\r\n    }\r\n\r\n    protected renderErrors() {\r\n        let errorList:string[] = [...this.errors, ...this.contextErrors];\r\n        if (errorList.length === 0) return null;\r\n        let {inNode} = this.context;\r\n        let tag = inNode === true? 'span' : 'div';\r\n        return errorList.map(err => React.createElement(tag, \r\n            {\r\n                key: err, \r\n                className: 'text-danger d-inline-block my-2 ml-3'\r\n            },\r\n            <><i className=\"fa fa-exclamation-circle\" /> &nbsp;{err}</>\r\n        ));\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiTextItem, StringSchema } from '../../schema';\r\nimport { observable } from 'mobx';\r\n\r\nexport class TextWidget extends Widget {\r\n    protected inputType = 'text';\r\n    protected get ui(): UiTextItem {return this._ui as UiTextItem};\r\n    protected input: HTMLInputElement;\r\n    @observable protected hasFocus: boolean;\r\n\r\n    protected setElementValue(value:any) {\r\n        if (this.input === null) return;\r\n        this.input.value = value;\r\n    }\r\n    protected get placeholder() {return (this.ui && this.ui.placeholder) || this.name}\r\n    protected onKeyDown = async (evt:React.KeyboardEvent<HTMLInputElement>) => {\r\n        this.internalOnKeyDown(evt);\r\n        if (evt.keyCode !== 13) return;\r\n        let {onEnter} = this.context.form.props;\r\n        if (onEnter === undefined) return;\r\n\r\n        this.changeValue(evt.currentTarget.value, true);\r\n\r\n        //this.checkRules();\r\n        //this.context.checkContextRules();\r\n        this.input.blur();\r\n\r\n        let ret = await onEnter(this.name, this.context);\r\n        if (ret !== undefined) {\r\n            this.context.setError(this.name, ret);\r\n        }\r\n    }\r\n\r\n    protected internalOnKeyDown(evt:React.KeyboardEvent<HTMLInputElement>) {\r\n    }\r\n\r\n    protected onBlur = (evt: React.FocusEvent<any>) => {\r\n        this.onInputChange(evt);\r\n        this.checkRules();\r\n\t\tthis.context.checkContextRules();\r\n\t\tthis.hasFocus = false;\r\n    }\r\n    protected onFocus = (evt: React.FocusEvent<any>) => {\r\n        this.clearError();\r\n        this.context.removeErrorWidget(this);\r\n        this.context.clearErrors();\r\n\t\tthis.hasFocus = true;\r\n    }\r\n    protected onChange(evt: React.ChangeEvent<any>) {\r\n    }\r\n\r\n    setReadOnly(value:boolean) {\r\n        if (this.input === null) return;\r\n        this.input.readOnly = this.readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        if (this.input === null) return;\r\n        this.input.disabled = this.disabled = value;\r\n    }\r\n\r\n    render() {\r\n        let renderTemplet = this.renderTemplet();\r\n        if (renderTemplet !== undefined) return renderTemplet;\r\n        let cn:any = {\r\n            //'form-control': true,\r\n        };\r\n        if (this.hasError === true) {\r\n            cn['is-invalid'] = true;\r\n        }\r\n        else {\r\n            cn['required-item'] = this.itemSchema.required === true;\r\n        }\r\n        return <><input ref={input=>this.input = input}\r\n            className={classNames(this.className, cn)}\r\n            type={this.inputType}\r\n            defaultValue={this.value}\r\n            onChange={(evt: React.ChangeEvent<any>) => this.onChange(evt)}\r\n            placeholder={this.placeholder}\r\n            readOnly={this.readOnly}\r\n            disabled={this.disabled}\r\n            onKeyDown = {this.onKeyDown}\r\n            onFocus = {this.onFocus}\r\n            onBlur={this.onBlur}\r\n            maxLength={(this.itemSchema as StringSchema).maxLength} />\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiTextAreaItem } from '../../schema';\r\nimport { StringSchema } from '../../schema';\r\n\r\nexport class TextAreaWidget extends Widget {\r\n    protected get itemSchema(): StringSchema {return this._itemSchema as StringSchema};\r\n    protected input: HTMLTextAreaElement;\r\n    protected get ui(): UiTextAreaItem {return this._ui as UiTextAreaItem};\r\n\r\n    protected setElementValue(value:any) {this.input.value = value}\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.setValue(evt.currentTarget.value);\r\n    }\r\n\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n\tprotected onBlur = (evt: React.FocusEvent<any>) => {\r\n        this.onInputChange(evt);\r\n        this.checkRules();\r\n        this.context.checkContextRules();\r\n    }\r\n    protected onFocus = (evt: React.FocusEvent<any>) => {\r\n        this.clearError();\r\n        this.context.removeErrorWidget(this);\r\n        this.context.clearErrors();\r\n    }\r\n\r\n    render() {\r\n        let renderTemplet = this.renderTemplet();\r\n        if (renderTemplet !== undefined) return renderTemplet;\r\n        let cn:any = {};\r\n        if (this.hasError === true) {\r\n            cn['is-invalid'] = true;\r\n        }\r\n        else {\r\n            cn['required-item'] = this.itemSchema.required === true;\r\n        }\r\n        return <>\r\n\t\t\t<textarea ref={(input) => this.input=input}\r\n\t\t\t\tonBlur={this.onBlur} \r\n\t\t\t\tonFocus={this.onFocus}\r\n                className={classNames(this.className, cn)}\r\n                rows={this.ui && this.ui.rows}\r\n                maxLength={this.itemSchema.maxLength}\r\n                defaultValue={this.defaultValue} onChange={this.onInputChange} />\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\n\r\nexport class PasswordWidget extends TextWidget {\r\n    protected inputType = 'password';\r\n}\r\n\r\nexport class UrlWidget extends TextWidget {\r\n    protected inputType = 'url';\r\n}\r\n\r\nexport class EmailWidget extends TextWidget {\r\n    protected inputType = 'email';\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\nimport { RuleNum, RuleInt } from '../rules';\r\nimport { NumBaseSchema } from '../../schema';\r\n\r\nexport class NumberWidget extends TextWidget {\r\n    protected inputType = 'number';\r\n    protected get itemSchema(): NumBaseSchema {return this._itemSchema as NumBaseSchema};\r\n\r\n    protected buildRules() {\r\n        super.buildRules();\r\n        let res = this.context.form.res;\r\n        let {min, max} = this.itemSchema;\r\n        this.rules.push(\r\n            this.itemSchema.type === 'integer'?\r\n                new RuleNum(res, min, max) :\r\n                new RuleInt(res, min, max)\r\n        );\r\n        /*\r\n        if (this.itemSchema.type === 'integer') {\r\n            this.rules.push(new RuleInt);\r\n        }\r\n        let {min, max} = this.itemSchema;\r\n        if (min !== undefined) this.rules.push(new RuleMin(min));\r\n        if (max !== undefined) this.rules.push(new RuleMax(max));\r\n        */\r\n    }\r\n\r\n    protected parse(value:any):any {\r\n        if (value === undefined || value === null) return;\r\n        return Number(value);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { NumberWidget } from './numberWidget';\r\n\r\nexport class UpdownWidget extends NumberWidget {\r\n    protected inputType = 'number';\r\n\r\n    protected isValidKey(key:number):boolean {\r\n        return key===46 || key===8 || key===37 || key===39\r\n            || (key>=48 && key<=57)\r\n            || (key>=96 && key<=105)\r\n            || key===109 || key===189;\r\n    }\r\n    \r\n    protected internalOnKeyDown(evt:React.KeyboardEvent<HTMLInputElement>) {\r\n        let key = evt.keyCode;\r\n        window.event.returnValue = this.isValidKey(key);\r\n    }\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\n\r\nexport class DateWidget extends TextWidget {\r\n    protected inputType = 'date';\r\n}\r\n\r\nexport class DateTimeWidget extends TextWidget {\r\n    protected inputType = 'datetime';\r\n}\r\n\r\nexport class TimeWidget extends TextWidget {\r\n    protected inputType = 'time';\r\n}\r\n\r\nexport class MonthWidget extends TextWidget {\r\n    protected inputType = 'month';\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiCheckItem } from '../../schema';\r\n\r\nexport class CheckBoxWidget extends Widget {\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiCheckItem {return this._ui as UiCheckItem};\r\n    protected trueValue: any;\r\n    protected falseValue: any;\r\n\r\n    init() {\r\n        super.init();\r\n        if (this.ui !== undefined) {\r\n            let {trueValue, falseValue} = this.ui;\r\n            if (trueValue === undefined) this.trueValue = true;\r\n            else this.trueValue = trueValue;\r\n            if (falseValue === undefined) this.falseValue = false;\r\n            else this.falseValue = falseValue;\r\n        }\r\n        else {\r\n            this.trueValue = true;\r\n            this.falseValue = false;\r\n        }\r\n    }\r\n    protected setElementValue(value:any) {\r\n        this.input.checked = value === this.trueValue;\r\n    }\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        let v = evt.target.checked === true? this.trueValue : this.falseValue;\r\n        this.setDataValue(v);\r\n    }\r\n\r\n    protected onClick = () => {\r\n        this.context.clearErrors();\r\n    }\r\n\r\n    render() {\r\n        let cn = classNames(this.className, 'form-check-inline p-0');\r\n        let input = <input\r\n            ref={(input)=>this.input = input}\r\n            className={'align-self-center'}\r\n            type=\"checkbox\"\r\n            defaultChecked={this.defaultValue} \r\n            onChange={this.onInputChange}\r\n            onClick={this.onClick} />;\r\n        if (this.context.inNode === true) {\r\n            return <label className={cn}>\r\n                {input} {(this.ui&&this.ui.label) || this.name}\r\n            </label>\r\n        }\r\n        else {\r\n            return <div className={cn}>\r\n                <label className=\"w-100 h-100 mb-0 d-flex justify-content-center\">{input}</label>\r\n            </div>;\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { observable } from 'mobx';\r\nimport { Widget } from './widget';\r\nimport { UiSelect } from '../../schema';\r\n\r\nexport class SelectWidget extends Widget {\r\n    protected select: HTMLSelectElement;\r\n    protected get ui(): UiSelect {return this._ui as UiSelect};\r\n    @observable protected readOnly: boolean;\r\n\r\n    protected setElementValue(value:any) {this.select.value = value}\r\n    protected onInputChange = (evt:React.ChangeEvent<HTMLSelectElement>) => {\r\n        this.setDataValue(evt.target.value);\r\n    }\r\n\r\n    setReadOnly(value:boolean) {this.select.disabled = this.readOnly = !value}\r\n    setDisabled(value:boolean) {this.select.disabled = this.disabled = value}\r\n\r\n    render() {\r\n        if (this.readOnly === true) {\r\n            let option = this.ui.list.find(v => v.value === this.value);\r\n            let title = (option === undefined)? '(???)' : option.title;\r\n            return <span className=\"form-control w-min-6c\">{title}</span>;\r\n        }\r\n        return <select\r\n            ref={(select)=>this.select = select}\r\n            className={classNames(this.className, 'form-control')}\r\n            defaultValue={this.defaultValue} \r\n            onChange={this.onInputChange}>\r\n            {this.ui.list.map((v,index) => {\r\n                let {title, value} = v;\r\n                let cn:string;\r\n                //if (value === undefined || value === null) cn = 'text-light small';\r\n                //else cn = 'text-danger';\r\n                return <option className={cn} key={index} value={value}>{title || value}</option>\r\n            })}\r\n        </select>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n//import { TextWidget } from './textWidget';\r\nimport { Widget } from './widget';\r\nimport { UiRadio } from '../../schema';\r\nimport { RowContext } from '../context';\r\n\r\n\r\nconst radioStyle:React.CSSProperties = {height: 'auto'};\r\n\r\nexport class RadioWidget extends Widget {\r\n    protected inputs: {[index:number]: HTMLInputElement} = {};\r\n    protected get ui(): UiRadio {return this._ui as UiRadio};\r\n\r\n    protected setElementValue(value:any) {\r\n        for (let i in this.inputs) {\r\n            let input = this.inputs[i];\r\n            input.checked = value === input.value;\r\n        }\r\n    }\r\n    setReadOnly(value:boolean) {\r\n        this.readOnly = value;\r\n        for (let i in this.inputs) this.inputs[i].readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        this.disabled = value;\r\n        for (let i in this.inputs) this.inputs[i].disabled = value\r\n    }\r\n\r\n    /*\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n        this.changeValue(evt.target.value, true);\r\n    }\r\n    */\r\n\r\n    render() {\r\n        let {defaultValue, list} = this.ui;\r\n        let {isRow} = this.context;\r\n        let rowKey:number;\r\n        if (isRow === true) {\r\n            rowKey = (this.context as RowContext).rowKey;\r\n        }\r\n        let cn = classNames(this.className, 'py-0');\r\n        return <span className={cn} style={radioStyle}>\r\n                {list.map((v,index) => {\r\n                    let {value, title} = v;\r\n                    let name = this.name;\r\n                    if (rowKey !== undefined) name += '-' + rowKey;\r\n                    return <label key={index} className=\"form-radio-inline\">\r\n                        <input ref={input=>this.inputs[index]=input} type=\"radio\" name={name}\r\n                            value={value} defaultChecked={(this.defaultValue || defaultValue)===value}\r\n                            onChange={this.onInputChange} />\r\n                        {title || value}\r\n                    </label>;\r\n                    //</span>\r\n                })}\r\n            </span>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { UiRange } from '../../schema';\r\nimport { Widget } from './widget';\r\n\r\nexport class RangeWidget extends Widget {\r\n    protected inputType = 'range';\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiRange {return this._ui as UiRange};\r\n\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n    render() {\r\n        let {min, max, step} = this.ui;\r\n        return <><input ref={input=>this.input = input}\r\n            className={classNames(this.className, 'form-control', 'w-min-6c')}\r\n            type={this.inputType}\r\n            defaultValue={this.defaultValue} \r\n            onChange={this.onInputChange}\r\n            max={max}\r\n            min={min}\r\n            step={step}\r\n            />\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiIdItem, TempletType } from '../../schema';\r\nimport { observable } from 'mobx';\r\n\r\nexport class IdWidget extends Widget {\r\n    protected get ui(): UiIdItem {return this._ui as UiIdItem};\r\n    @observable protected value:number;\r\n    setReadOnly(value:boolean) {this.readOnly = value}\r\n    setDisabled(value:boolean) {this.disabled = value}    \r\n\r\n    protected onClick = async () => {\r\n        let pickId = this.ui && this.ui.pickId;\r\n        if (pickId === undefined) {\r\n            alert('no pickId defined!');\r\n            return;\r\n        }\r\n        let id = await pickId(this.context, this.name, this.value);        \r\n        this.setDataValue(id);\r\n        this.clearError();\r\n        this.clearContextError();\r\n        this.checkRules();\r\n    }\r\n\r\n    render() {\r\n        let placeholder:string|JSX.Element, Templet: TempletType;\r\n        if (this.ui !== undefined) {\r\n            placeholder = this.ui.placeholder;\r\n            Templet = this.ui.Templet;\r\n        }\r\n        let cn:any = {\r\n            'form-control': true,\r\n            'required-item': this.itemSchema.required === true,\r\n            'cursor-pointer': true,\r\n            'is-invalid': this.hasError,\r\n        };\r\n        let content;\r\n        if (this.value === undefined || this.value === null) {\r\n            content = placeholder || <small className=\"text-muted\">[无]</small>;\r\n            cn['text-muted'] = true;\r\n        }\r\n        else if (Templet === undefined) {\r\n            let c: any;\r\n            if (this.value === null) {\r\n                c = 'null';\r\n            }\r\n            else {\r\n                switch (typeof this.value) {\r\n                    case 'undefined': c = <small className=\"text-muted\">[无]</small>; break;\r\n                    case 'object': c = (this.value as any).id; break;\r\n                    default: c = this.value; break;\r\n                }\r\n            }\r\n            content = <>{c}</>;\r\n        }\r\n        else if (typeof Templet === 'function') {\r\n            content = Templet(this.value);\r\n        }\r\n        else {\r\n            content = Templet;\r\n        }\r\n        return <>\r\n            <div className={classNames(cn)} onClick={this.onClick}>{content}</div>\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { DataType } from '../../schema';\r\nimport { UiType } from '../../schema';\r\n\r\nexport const Unknown = (dataType:DataType, uiType:UiType, dataTypes:DataType[]) => {\r\n    return <span className=\"text-danger\">!!data type {dataType} only support {(dataTypes || []).join(', ')}, can't use ui {uiType}!!</span>;\r\n};\r\n","import * as React from 'react';\r\nimport { UiButton, TempletType } from '../../schema';\r\nimport { Unknown } from './unknown';\r\nimport { Widget } from './widget';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class ButtonWidget extends Widget {\r\n    protected get ui(): UiButton {return this._ui as UiButton};\r\n\r\n    protected onClick = async () => {\r\n        this.clearError();\r\n        this.clearContextError();\r\n        let {name, type} = this.itemSchema;\r\n        if (type === 'submit') {\r\n            await this.context.submit(name);\r\n        }\r\n        /*\r\n        let {onButtonClick} = this.context.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`button ${name} clicked. you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(name, this.context);\r\n        if (ret === undefined) return;\r\n        this.context.setError(name, ret);\r\n        */\r\n    }\r\n\r\n    private observerRender = observer(() => {\r\n        let {name, type} = this.itemSchema;\r\n        let Templet:TempletType, cn:string, caption:string;\r\n        if (this.ui !== undefined) {\r\n            let {widget:widgetType} = this.ui;\r\n            if (widgetType !== 'button') return Unknown(type, widgetType, ['button']);\r\n            Templet = this.ui.Templet;\r\n            cn = this.ui.className;\r\n            caption = this.ui.label;\r\n        }\r\n        let {form, hasError} = this.context;\r\n        let context = this.context;\r\n        let disabled = type==='submit' && hasError;\r\n        let content:any;\r\n        if (this.children !== undefined) content = this.children;\r\n        else if (typeof Templet === 'function') content = Templet();\r\n        else if (Templet !== undefined) content = Templet;\r\n        else content = caption; \r\n        let button = <button \r\n            className={cn} \r\n            type=\"button\"\r\n            disabled={disabled}\r\n            onClick={this.onClick}>\r\n            {content || name}\r\n        </button>;\r\n        if (context.inNode === true) return <>{button}{this.renderErrors()}</>;\r\n        return <div className={form.ButtonClass}>\r\n            <div>{this.renderErrors()}</div>\r\n            {button}\r\n        </div>;\r\n    });\r\n    \r\n    protected get label():string {return null}\r\n\r\n    render() {\r\n        return <this.observerRender />\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { Form } from './form';\r\nimport { UiSchema, UiArr, UiItem } from '../schema';\r\nimport { ArrSchema, ItemSchema } from '../schema';\r\nimport { Widget } from './widgets/widget';\r\n//import { ArrRow } from './arrRow';\r\nimport { observable, computed } from 'mobx';\r\nimport { ContextRule } from './rules';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport abstract class Context {\r\n    private subContexts:{[name:string]:{[rowKey:string]:Context}};\r\n    readonly form: Form;\r\n    readonly uiSchema: UiSchema;\r\n    readonly initData: any;\r\n    readonly inNode: boolean;           // true: 在</> 流中定义Field\r\n    readonly widgets: {[name:string]: Widget} = {};\r\n    readonly rules: ContextRule[];\r\n    readonly isRow: boolean;\r\n    @observable errors: string[] = [];\r\n    @observable errorWidgets:Widget[] = [];\r\n\r\n    constructor(form: Form, uiSchema: UiSchema, data: any, inNode: boolean, isRow: boolean) {\r\n        this.form = form;\r\n        this.uiSchema = uiSchema;\r\n        this.initData = data;\r\n        this.inNode = inNode;\r\n        this.isRow = isRow;\r\n        if (uiSchema !== undefined) {\r\n            let {rules} = uiSchema;\r\n            if (rules !== undefined) {\r\n                this.rules = [];\r\n                if (Array.isArray(rules) === false)\r\n                    this.rules.push(rules as ContextRule);\r\n                else\r\n                    this.rules.push(...rules as ContextRule[]);\r\n            }\r\n        }\r\n    }\r\n\r\n    getArrRowContexts(arrName: string) {\r\n        if (this.subContexts === undefined) this.subContexts = {};\r\n        let arrRowContexts = this.subContexts[arrName];\r\n        if (arrRowContexts === undefined) this.subContexts[arrName] = arrRowContexts = {};\r\n        return arrRowContexts;\r\n    }\r\n\r\n    abstract get data():any;\r\n    abstract getItemSchema(itemName:string):ItemSchema;\r\n    abstract getUiItem(itemName:string):UiItem;\r\n    get arrName():string {return undefined}\r\n    getValue(itemName:string):any {return this.initData[itemName]}\r\n    setValue(itemName:string, value:any) {\r\n        this.initData[itemName] = value;\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setValue(value);\r\n    }\r\n    getDisabled(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) return widget.getDisabled();\r\n        return undefined;\r\n    }\r\n    setDisabled(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setDisabled(value);\r\n    }\r\n    getReadOnly(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.getReadOnly();\r\n        return undefined;\r\n    }\r\n    setReadOnly(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setReadOnly(value);\r\n    }\r\n    getVisible(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.getVisible();\r\n        return undefined;\r\n    }\r\n    setVisible(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setVisible(value);\r\n    }\r\n\r\n    async submit(buttonName: string) {\r\n        this.checkRules()\r\n        if (this.hasError === true) {\r\n            let err = '';\r\n            for (let ew of this.errorWidgets) {\r\n                err += ew.name + ':\\n' + ew.errors.join('\\n');\r\n            }\r\n            console.error(err);\r\n            return;\r\n        }\r\n        let {onButtonClick} = this.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`button ${buttonName} clicked. you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(buttonName, this);\r\n        if (ret === undefined) return;\r\n        this.setError(buttonName, ret);\r\n\r\n    }\r\n\r\n    checkFieldRules() {\r\n        for (let i in this.widgets) {\r\n            this.widgets[i].checkRules();\r\n        }\r\n        if (this.subContexts === undefined) return;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                arrRowContexts[j].checkFieldRules();\r\n            }\r\n        }\r\n    }\r\n\r\n    checkContextRules() {\r\n        this.clearErrors();\r\n        if (this.rules === undefined) return;\r\n        for (let rule of this.rules) {\r\n            let ret = rule(this);\r\n            if (ret === undefined) continue;\r\n            if (Array.isArray(ret) === true) {\r\n                this.errors.push(...ret as string[]);\r\n            }\r\n            else if (typeof ret === 'string') {\r\n                this.errors.push(ret as string);\r\n            }\r\n            else {\r\n                for (let i in ret as object) this.setError(i, (ret as any)[i]);\r\n            }\r\n        }\r\n        if (this.subContexts === undefined) return;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                let rowContext = arrRowContexts[j];\r\n                rowContext.clearErrors();\r\n                rowContext.checkContextRules();\r\n            }\r\n        }\r\n    }\r\n\r\n    setError(itemName:string, error:string) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget === undefined) return;\r\n        widget.setContextError(error);\r\n        this.addErrorWidget(widget);\r\n    }\r\n\r\n    clearContextErrors() {\r\n        for (let i in this.widgets) {\r\n            let widget = this.widgets[i];\r\n            if (widget === undefined) continue;\r\n            widget.clearContextError();\r\n        }\r\n    }\r\n\r\n    clearWidgetsErrors() {\r\n        for (let i in this.widgets) {\r\n            let widget = this.widgets[i];\r\n            if (widget === undefined) continue;\r\n            widget.clearError();\r\n        }\r\n    }\r\n\r\n    checkRules() {\r\n        this.clearErrors();\r\n        this.clearWidgetsErrors();\r\n        this.checkFieldRules();\r\n        if (this.hasError === true) return;\r\n        this.checkContextRules();\r\n    }\r\n\r\n    addErrorWidget(widget:Widget) {\r\n        let pos = this.errorWidgets.findIndex(v => v === widget);\r\n        if (pos < 0) this.errorWidgets.push(widget);\r\n    }\r\n    removeErrorWidget(widget:Widget) {\r\n        let pos = this.errorWidgets.findIndex(v => v === widget);\r\n        if (pos >= 0) this.errorWidgets.splice(pos, 1);\r\n    }\r\n\r\n    protected checkHasError():boolean {\r\n        let ret = (this.errorWidgets.length + this.errors.length) > 0;\r\n        if (ret === true) return true;\r\n        if (this.subContexts === undefined) return false;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                if (arrRowContexts[j].hasError === true) return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    @computed get hasError():boolean {\r\n        return this.checkHasError();\r\n    };\r\n\r\n    clearErrors() {\r\n        this.errors.splice(0);\r\n        this.errorWidgets.splice(0);\r\n        this.clearContextErrors();\r\n    }\r\n\r\n    renderErrors = observer((): JSX.Element => {\r\n        let {errors} = this;\r\n        if (errors.length === 0) return null;\r\n        return <>\r\n            {errors.map(err => <span key={err} className=\"text-danger inline-block my-1 ml-3\">\r\n                <i className=\"fa fa-exclamation-circle\" /> &nbsp;{err}\r\n            </span>)}\r\n        </>\r\n    });\r\n}\r\n\r\nlet rowKeySeed:number = 1;\r\nexport class RowContext extends Context {\r\n    readonly parentContext: Context;\r\n    readonly arrSchema: ArrSchema;\r\n    readonly rowKey: number;\r\n\treadonly data: any;\r\n    //readonly uiSchema: UiArr;\r\n\t\r\n    constructor(parentContext:Context, arrSchema: ArrSchema, data: any, inNode: boolean) {\r\n        let uiArr:UiArr;\r\n        let {uiSchema} = parentContext;\r\n        if (uiSchema !== undefined) {\r\n            let {items} = uiSchema;\r\n            if (items !== undefined) uiArr = items[arrSchema.name] as UiArr;\r\n        }\r\n        super(parentContext.form, uiArr, data, inNode, true);\r\n        this.parentContext = parentContext;\r\n        this.arrSchema = arrSchema;\r\n        this.rowKey = rowKeySeed++;\r\n        this.data = data;\r\n    }\r\n    getItemSchema(itemName:string):ItemSchema {return this.arrSchema.itemSchemas[itemName]}\r\n    getUiItem(itemName:string):UiItem {\r\n        if (this.uiSchema === undefined) return undefined;\r\n        let {items} = this.uiSchema;\r\n        if (items === undefined) return undefined;\r\n        return items[itemName]\r\n    }\r\n    get arrName():string {return this.arrSchema.name}\r\n    clearErrors() {\r\n        super.clearErrors();\r\n        this.parentContext.clearErrors();\r\n    }\r\n\r\n    get parentData():any {return this.parentContext.data;}\r\n}\r\n\r\nexport class FormContext extends Context {\r\n    constructor(form:Form, inNode:boolean) {\r\n        super(form, form.uiSchema, form.data, inNode, false);\r\n    }\r\n    get data():any {return this.form.data}\r\n    getItemSchema(itemName:string):ItemSchema {return this.form.itemSchemas[itemName]}\r\n    getUiItem(itemName:string):UiItem {\r\n        let {uiSchema} = this.form;\r\n        if (uiSchema === undefined) return undefined;\r\n        let {items} = uiSchema;\r\n        if (items === undefined) return undefined;\r\n        return items[itemName];\r\n    }\r\n}\r\n\r\nexport const ContextContainer = React.createContext<Context>({} as any);\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\n//import { ArrRow } from '../arrRow';\r\nimport { Context, RowContext, ContextContainer } from '../context';\r\nimport { ArrSchema } from '../../schema';\r\nimport { UiArr, TempletType } from '../../schema';\r\nimport { Unknown } from './unknown';\r\nimport { factory } from './factory';\r\n\r\nexport const ArrComponent = observer((\r\n    {parentContext, arrSchema, children}:{parentContext: Context, arrSchema: ArrSchema, children: React.ReactNode}) => \r\n{\r\n    let {name, arr} = arrSchema;\r\n    let data = parentContext.initData[name] as any[];\r\n    let {form} = parentContext;\r\n    let arrRowContexts = parentContext.getArrRowContexts(name);\r\n    let ui = parentContext.getUiItem(name) as UiArr;\r\n    let arrLabel = name;\r\n    let Templet:TempletType;\r\n    let selectable:boolean, deletable:boolean, restorable:boolean;\r\n    let {ArrContainer, RowContainer, RowSeperator, uiSchema} = form;\r\n    if (uiSchema !== undefined) {\r\n        let {selectable:formSelectable, deletable:formDeletable, restorable:formRestorable} = uiSchema;\r\n        if (selectable !== true) selectable = formSelectable;\r\n        if (deletable !== true) deletable = formDeletable;\r\n        if (restorable !== true) restorable = formRestorable;\r\n    }\r\n    if (ui !== undefined) {\r\n        let {widget:widgetType, label, \r\n            selectable:arrSelectable, deletable:arrDeletable, restorable:arrRestorable,\r\n            ArrContainer:ac, RowContainer:rc, RowSeperator:rs\r\n        } = ui;\r\n        if (arrSelectable !== undefined) selectable = arrSelectable;\r\n        if (arrDeletable !== undefined) deletable = arrDeletable;\r\n        if (arrRestorable !== undefined) restorable = arrRestorable;\r\n        if (ac !== undefined) ArrContainer = ac;\r\n        if (rc !== undefined) RowContainer = rc;\r\n        if (rs !== undefined) RowSeperator = rs;\r\n        Templet = ui.Templet;\r\n        if (widgetType !== 'arr') return Unknown(arrSchema.type, widgetType, ['arr']);\r\n        arrLabel = label || arrLabel;\r\n    }\r\n    let first = true;\r\n    return ArrContainer(arrLabel, <>\r\n        {data.map((row:any, index) => {\r\n            let rowContext: RowContext;\r\n            let rowContent: JSX.Element;\r\n            let sep = undefined;\r\n            if (first === false) sep = RowSeperator;\r\n            else first = false;\r\n            if (children !== undefined) {\r\n                rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                rowContent = <>{children}</>;\r\n            }\r\n            else {\r\n                let typeofTemplet = typeof Templet;\r\n                if (typeofTemplet === 'function') {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                    rowContent = React.createElement(observer(Templet as React.StatelessComponent), row);\r\n                }\r\n                else if (typeofTemplet === 'object') {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                    rowContent = Templet as JSX.Element;\r\n                }\r\n                else {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, false);\r\n                    rowContent = <>{\r\n                        arr.map((v, index) => {\r\n                            return <React.Fragment key={v.name}>\r\n                                {factory(rowContext, v, undefined)}\r\n                            </React.Fragment>\r\n                        })}\r\n                    </>;\r\n                }\r\n            }\r\n            let {rowKey} = rowContext;\r\n            arrRowContexts[rowKey] = rowContext;\r\n\r\n            let selectCheck:JSX.Element, deleteIcon:JSX.Element;\r\n            if (selectable === true) {\r\n                let onClick = (evt: React.MouseEvent<HTMLInputElement>)=>{\r\n                    let {checked} = (evt.target as HTMLInputElement);\r\n                    row.$isSelected = checked;\r\n                    let {$source} = row;\r\n                    if ($source !== undefined) $source.$isSelected = checked;\r\n                    rowContext.clearErrors();\r\n                }\r\n                selectCheck = <div className=\"form-row-checkbox\">\r\n                    <input type=\"checkbox\" onClick={onClick} defaultChecked={row.$isSelected} />\r\n                </div>;\r\n            }\r\n            let isDeleted = !(row.$isDeleted===undefined || row.$isDeleted===false);\r\n            if (deletable === true) {\r\n                let icon = isDeleted? 'fa-undo' : 'fa-trash';\r\n                let onDelClick = () => {\r\n                    if (restorable === true) {\r\n                        row.$isDeleted = !isDeleted;\r\n                        let {$source} = row;\r\n                        if ($source !== undefined) $source.$isDeleted = !isDeleted;\r\n                    }\r\n                    else {\r\n                        let p = data.indexOf(row);\r\n                        if (p>=0) data.splice(p, 1);\r\n                    }\r\n                    rowContext.clearErrors();\r\n                }\r\n                deleteIcon = <div className=\"form-row-edit text-info\" onClick={onDelClick}>\r\n                    <i className={classNames('fa', icon, 'fa-fw')} />\r\n                </div>;\r\n            }\r\n            let editContainer = selectable===true || deletable===true?\r\n                (content:any) => <fieldset disabled={isDeleted}><div className={classNames('d-flex', {'deleted':isDeleted, 'row-selected':row.$isSelected})}>\r\n                    {selectCheck}\r\n                    <div className={selectable===true && deletable===true? \"form-row-content\":\"form-row-content-1\"}>{content}</div>\r\n                    {deleteIcon}\r\n                </div></fieldset>\r\n                :\r\n                (content:any) => content;\r\n\r\n            return <ContextContainer.Provider key={rowKey} value={rowContext}>\r\n                {sep}\r\n                {RowContainer(editContainer(<><rowContext.renderErrors />{rowContent}</>))}\r\n            </ContextContainer.Provider>;\r\n        })}\r\n    </>);\r\n});\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiImageItem } from '../../schema';\r\nimport { Image } from '../../image';\r\nimport { ImageItemEdit } from '../../edit/imageItemEdit';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\n\r\nexport class ImageWidget extends Widget {\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiImageItem {return this._ui as UiImageItem};\r\n    @observable private imageSrc: string;\r\n\r\n    init() {\r\n        super.init();\r\n        this.imageSrc = this.value;\r\n    }\r\n\r\n    protected onClick = async () => {\r\n        let edit = new ImageItemEdit(this.itemSchema, this.ui, this.ui.label, this.value);\r\n        let ret = await edit.start();\r\n        if (ret !== null) {\r\n            this.setValue(ret);\r\n            this.imageSrc = ret;\r\n        }\r\n        await edit.end();\r\n    }\r\n\r\n    render() {\r\n        return <this.observerRender />;\r\n    }\r\n\r\n    private observerRender = observer(() => {\r\n        let cn = [\r\n            'bg-white p-1 d-flex justify-content-center',\r\n        ];\r\n        let onClick: any;\r\n        if (!this.readOnly && !this.disabled) {\r\n            cn.push('cursor-pointer');\r\n            onClick = this.onClick;\r\n        }\r\n        return <div className={classNames(cn)} onClick={onClick}>\r\n            <Image src={this.imageSrc} className=\"w-4c h-4c\"/>\r\n        </div>;\r\n    });\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiTag, IValuesViewRenderOptions } from '../../schema';\r\nimport { RowContext } from '../context';\r\n\r\nabstract class TagWidget extends Widget {\r\n    protected inputs: {[index:number]: HTMLInputElement} = {};\r\n    protected get ui(): UiTag {return this._ui as UiTag};\r\n\r\n    protected setElementValue(value:any) {\r\n        for (let i in this.inputs) {\r\n            let input = this.inputs[i];\r\n            input.checked = value === input.value;\r\n        }\r\n    }\r\n    setReadOnly(value:boolean) {\r\n        this.readOnly = value;\r\n        for (let i in this.inputs) this.inputs[i].readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        this.disabled = value;\r\n        for (let i in this.inputs) this.inputs[i].disabled = value\r\n\t}\r\n\t\r\n\tabstract render():JSX.Element;\r\n}\r\n\r\nexport class TagSingleWidget extends TagWidget {\r\n\trender() {\r\n\t\tlet {valuesView, wrapClassName} = this.ui;\r\n\t\tif (valuesView === undefined) return <>valuesView must be defined</>;\r\n        let {isRow} = this.context;\r\n        let rowKey:number;\r\n        if (isRow === true) {\r\n            rowKey = (this.context as RowContext).rowKey;\r\n        }\r\n        let cn = classNames(this.className, 'py-0');\r\n\t\tlet name = this.name;\r\n\t\tif (rowKey !== undefined) name += '-' + rowKey;\r\n\t\tlet options:IValuesViewRenderOptions = {\r\n\t\t\tclassName: cn,\r\n\t\t\tinputName: name,\r\n\t\t\twrapClassName,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t}\r\n\t\treturn valuesView.renderRadios(this.defaultValue, options);\r\n    }\r\n}\r\n\r\nexport class TagMultiWidget extends TagWidget {\r\n\tprivate defaultArr:number[];\r\n\tinit() {\r\n\t\tsuper.init();\r\n\t\tlet def = this.defaultValue;\r\n\t\tswitch (typeof def) {\r\n\t\t\tdefault:\r\n\t\t\t\tthis.defaultArr = [];\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'string':\r\n\t\t\t\tthis.defaultArr = def.split('|').map(v => Number(v));\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n\t\tlet values:string[] = [];\r\n\t\tfor (let i in this.inputs) {\r\n\t\t\tlet input = this.inputs[i];\r\n\t\t\tif (input.checked === true) values.push(input.value);\r\n\t\t}\r\n        this.changeValue(values.join('|'), true);\r\n\t}\r\n\trender() {\r\n\t\tlet {valuesView, wrapClassName} = this.ui;\r\n\t\tif (valuesView === undefined) return <>valuesView must be defined</>;\r\n        let cn = classNames(this.className, 'py-0');\r\n\t\tlet options:IValuesViewRenderOptions = {\r\n\t\t\tclassName: cn,\r\n\t\t\tinputs: this.inputs,\r\n\t\t\twrapClassName,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t}\r\n\t\treturn valuesView.renderChecks(this.defaultValue, options);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { ArrSchema, DataType, ItemSchema } from '../../schema';\r\nimport { TypeWidget, UiCustom } from '../../schema';\r\nimport { TextWidget } from './textWidget';\r\nimport { TextAreaWidget } from './textareaWidget';\r\nimport { PasswordWidget, UrlWidget, EmailWidget } from './passwordWidget';\r\nimport { UpdownWidget } from './updownWidget';\r\nimport { NumberWidget } from './numberWidget';\r\nimport { DateWidget, DateTimeWidget, TimeWidget, MonthWidget } from './dateWidget';\r\nimport { CheckBoxWidget } from './checkBoxWidget';\r\nimport { FieldProps } from '../field';\r\nimport { Context } from '../context';\r\nimport { SelectWidget } from './selectWidget';\r\nimport { RadioWidget } from './radioWidget';\r\nimport { RangeWidget } from './rangeWidget';\r\nimport { IdWidget } from './idWidget';\r\nimport { ButtonWidget } from './buttonWidget';\r\nimport { ArrComponent } from './arrComponent';\r\nimport { ImageWidget } from './imageWidget';\r\nimport { TagSingleWidget, TagMultiWidget } from './tagWidget';\r\n\r\nconst widgetsFactory: {[type: string]: {widget?: TypeWidget, dataTypes?: DataType[]}} = {\r\n    id: {\r\n        dataTypes: ['id'],\r\n        widget: IdWidget,\r\n    },\r\n    text: {\r\n        dataTypes: ['integer', 'number', 'string'],\r\n        widget: TextWidget\r\n    },\r\n    textarea: {\r\n        dataTypes: ['string'],\r\n        widget: TextAreaWidget\r\n    },\r\n    password: {\r\n        dataTypes: ['string'],\r\n        widget: PasswordWidget\r\n    },\r\n    date: {\r\n        dataTypes: ['date'],\r\n        widget: DateWidget\r\n    },\r\n    datetime: {\r\n        dataTypes: ['date'],\r\n        widget: DateTimeWidget\r\n    },\r\n    time: {\r\n        dataTypes: ['date'],\r\n        widget: TimeWidget\r\n    },\r\n    month: {\r\n        dataTypes: ['date'],\r\n        widget: MonthWidget\r\n    },\r\n    select: {\r\n        dataTypes: ['integer', 'number', 'string', 'date', 'boolean'],\r\n        widget: SelectWidget\r\n    },\r\n    url: {\r\n        dataTypes: ['string'],\r\n        widget: UrlWidget\r\n    },\r\n    email: {\r\n        dataTypes: ['string'],\r\n        widget: EmailWidget\r\n    },\r\n    number: {\r\n        dataTypes: ['integer', 'number'],\r\n        widget: NumberWidget\r\n    },\r\n    updown: {\r\n        dataTypes: ['integer', 'number'],\r\n        widget: UpdownWidget\r\n    },\r\n    color: {\r\n\r\n    },\r\n    checkbox: {\r\n        dataTypes: ['boolean', 'integer', 'number'],\r\n        widget: CheckBoxWidget\r\n    },\r\n    image: {\r\n        dataTypes: ['string'],\r\n        widget: ImageWidget,\r\n    },\r\n    checkboxes: {\r\n\r\n    },\r\n    radio: {\r\n        dataTypes: ['integer', 'number', 'string', 'date', 'boolean'],\r\n        widget: RadioWidget\r\n\t},\r\n\ttagSingle: {\r\n\t\tdataTypes: ['integer'],\r\n\t\twidget: TagSingleWidget\r\n\t},\r\n\ttagMulti: {\r\n\t\tdataTypes: ['string'],\r\n\t\twidget: TagMultiWidget\r\n\t},\r\n    range: {\r\n        dataTypes: ['integer'],\r\n        widget: RangeWidget,\r\n    },\r\n    button: {\r\n        dataTypes: ['button', 'submit'],\r\n        widget: ButtonWidget,\r\n    }\r\n}\r\n\r\nexport function factory(context: Context, itemSchema: ItemSchema, children:React.ReactNode, fieldProps?: FieldProps):JSX.Element {\r\n    if (context === undefined) {\r\n        debugger;\r\n        return null;\r\n    }\r\n    if (itemSchema === undefined) return undefined;\r\n    let {name, type} = itemSchema;\r\n    switch (type) {\r\n    case 'arr':\r\n        let arrSchema = context.getItemSchema(name) as ArrSchema;\r\n        return <ArrComponent parentContext={context} arrSchema={arrSchema} children={children} />;\r\n    default:\r\n        break;\r\n    }\r\n\r\n    let typeWidget: TypeWidget;\r\n    let ui = context.getUiItem(name);\r\n    function getTypeWidget(t:DataType): TypeWidget {\r\n        switch(t) {\r\n        default: return TextWidget; \r\n        case 'id': return IdWidget;\r\n        case 'integer': return UpdownWidget;\r\n        case 'number': return NumberWidget; \r\n        case 'string': return TextWidget; \r\n        case 'date': return DateWidget; \r\n        case 'boolean': return CheckBoxWidget; \r\n        case 'button':\r\n        case 'submit': return ButtonWidget;\r\n        }\r\n    }\r\n    if (ui === undefined) { \r\n        typeWidget = getTypeWidget(type);\r\n    }\r\n    else {\r\n        let {widget:widgetType} = ui;\r\n        switch (widgetType) {\r\n        default:\r\n            if (widgetType !== undefined) {\r\n                let widgetFactory = widgetsFactory[widgetType];\r\n                typeWidget = widgetFactory.widget;\r\n            }\r\n            if (typeWidget === undefined) typeWidget = getTypeWidget(type);\r\n            break;\r\n        case 'custom':\r\n            typeWidget = (ui as UiCustom).WidgetClass;\r\n            break;\r\n        case 'group':\r\n            return <span>impletment group</span>;\r\n        }\r\n        //label = uiLabel || name;\r\n    }\r\n    \r\n    let {widgets} = context;\r\n    let widget = new typeWidget(context, itemSchema, fieldProps, children);\r\n    widget.init();\r\n    widgets[name] = widget;\r\n\r\n    return <widget.container />;\r\n    /*\r\n    if (isRow === false) {\r\n        let WidgetElement = observer(() => widget.container());\r\n        return <WidgetElement />;\r\n    }\r\n    else {\r\n        let widgetElement = widget.container();\r\n        return widgetElement;\r\n    }\r\n    */\r\n}\r\n\r\n","import * as React from 'react';\r\nimport {observable, IReactionDisposer, autorun} from 'mobx';\r\nimport classNames from 'classnames';\r\nimport { Schema, ItemSchema, ArrSchema } from '../schema';\r\nimport { UiSchema, TempletType } from '../schema';\r\nimport { factory } from './widgets';\r\nimport 'font-awesome/css/font-awesome.min.css';\r\nimport { ContextContainer, FormContext, Context } from './context';\r\nimport { FormRes, formRes } from '../../res';\r\nimport { resLang } from '../../res/res';\r\n\r\nexport type FormButtonClick = (name:string, context: Context) => Promise<any>;\r\nexport type InputEnter = (name:string, context: Context) => Promise<any>;\r\n\r\nexport interface FormProps {\r\n    className?: string;\r\n    schema: Schema;\r\n    uiSchema?: UiSchema;\r\n    formData?: any;\r\n    onButtonClick?: FormButtonClick;\r\n    onEnter?: InputEnter;\r\n    fieldLabelSize?: number;            // col-sm-2 for label\r\n    requiredFlag?: boolean;             // default=true\r\n    beforeShow?: (formContext:FormContext) => void;\r\n    res?: FormRes;\r\n\r\n    Container?: (content:JSX.Element) => JSX.Element;\r\n    FieldContainer?: (label:string|JSX.Element, content:JSX.Element) => JSX.Element;\r\n    FieldClass?: string;\r\n    ButtonClass?: string;\r\n}\r\n\r\nexport class Form extends React.Component<FormProps> {\r\n    readonly schema: Schema;\r\n    readonly itemSchemas: {[name:string]: ItemSchema};\r\n    readonly uiSchema: UiSchema;\r\n    readonly res?: FormRes;\r\n    protected formContext: FormContext;\r\n    private disposer: IReactionDisposer;\r\n    readonly data:any;\r\n\r\n    readonly Container: (content:JSX.Element) => JSX.Element;\r\n    readonly FieldContainer: (label:any, content:JSX.Element) => JSX.Element;\r\n    readonly FieldClass: string;\r\n    readonly ButtonClass: string;\r\n    \r\n    constructor(props:FormProps) {\r\n        super(props);\r\n        let {schema, uiSchema, \r\n            Container, FieldContainer, FieldClass, \r\n            ButtonClass, res,\r\n        } = props;\r\n        this.Container = Container || this.DefaultContainer;\r\n        this.FieldContainer = FieldContainer || this.DefaultFieldContainer;\r\n        this.FieldClass = FieldClass!==undefined && FieldClass!==''&&FieldClass!==null? FieldClass : this.DefaultFieldClass;\r\n        this.res = res || this.DefaultRes;\r\n        this.ButtonClass = ButtonClass || this.DefaultButtonClass;\r\n\r\n        this.schema = schema;\r\n        this.itemSchemas = {};\r\n        for (let itemSchema of this.schema) {\r\n            this.itemSchemas[itemSchema.name] = itemSchema;\r\n        }\r\n        this.uiSchema = uiSchema;\r\n\r\n        this.disposer = autorun(this.watch);\r\n        this.data = {};\r\n    }\r\n\r\n    private renderContent():any {\r\n        this.initData(this.props.formData);\r\n        let {children} = this.props;\r\n        if (children !== undefined) {\r\n            this.formContext = new FormContext(this, true);\r\n            return <>{children}</>;\r\n        }\r\n\r\n        let Templet: TempletType;\r\n        if (this.uiSchema !== undefined) {\r\n            Templet = this.uiSchema.Templet;\r\n        }\r\n        if (Templet !== undefined) {\r\n            this.formContext = new FormContext(this, true);\r\n            return typeof(Templet) === 'function'? Templet(this.data) : Templet;\r\n        }\r\n\r\n        this.formContext = new FormContext(this, false);\r\n        return <>{this.schema.map((v, index) => {\r\n            return <React.Fragment key={index}>{factory(this.formContext, v, children)}</React.Fragment>\r\n        })}</>;\r\n    }\r\n\r\n    private initData(formData: any) {\r\n        if (formData === undefined) formData = {};\r\n        if (this.uiSchema !== undefined) {\r\n            let {items} = this.uiSchema;\r\n            if (items !== undefined) {\r\n                for (let i in items) {\r\n                    let ui = items[i];\r\n                    let dv = ui.defaultValue;\r\n                    if (dv !== undefined) {\r\n                        if (formData[i] === undefined) {\r\n                            formData[i] = dv;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        for (let itemSchema of this.schema) {\r\n            this.initDataItem(itemSchema, this.data, formData);\r\n        }\r\n    }\r\n\r\n    private initDataItem(itemSchema: ItemSchema, data:any, formData: any):any {\r\n        let {name, type} = itemSchema;\r\n        if (type === 'button') return;\r\n        if (type !== 'arr') {\r\n            data[name] = formData[name];\r\n            return;\r\n        }\r\n\r\n        let arrItem:ArrSchema = itemSchema as ArrSchema;\r\n        let {arr:arrItems} = arrItem;\r\n        if (arrItems === undefined) return;\r\n        let arrDict:any = arrItem.itemSchemas = {};\r\n        for (let item of arrItems) {\r\n            arrDict[item.name] = item;\r\n        }\r\n        let val:any[] = formData[name];\r\n        if (val === undefined) val = [];\r\n        else if (Array.isArray(val) === false) val = [val];\r\n        let arr:any[] = [];\r\n        for (let row of val) {\r\n            let {$isSelected, $isDeleted} = row;\r\n            let r = {\r\n                $source: row,\r\n                $isSelected: $isSelected,\r\n                $isDeleted: $isDeleted,\r\n            };\r\n            for (let item of arrItems) {\r\n                this.initDataItem(item, r, row);\r\n            }\r\n            arr.push(r);\r\n        }\r\n        // 如果没有observable，行删除标志点击不管用\r\n        // 不知道这里为什么要去掉observable。有可能会有别的问题\r\n        data[name] = observable(arr);\r\n        //data[name] = arr;\r\n        return;\r\n    }\r\n\r\n    private watch = () => {\r\n        let {formData} = this.props;\r\n        if (formData === undefined) return;\r\n        //this.initData(formData);\r\n        this.calcSelectOrDelete();\r\n    }\r\n    private calcSelectOrDelete() {\r\n        for (let itemSchema of this.schema) {\r\n            this.arrItemOperated(itemSchema);\r\n        }\r\n    }\r\n\r\n    private arrItemOperated(itemSchema: ItemSchema) {\r\n        let {name, type} = itemSchema;\r\n        if (type !== 'arr') return;\r\n        if (this.data === undefined) return;\r\n        let formArrVal = this.data[name];\r\n        if (formArrVal === undefined) return;\r\n        let {arr: arrItems} = itemSchema as ArrSchema;\r\n        for (let row of formArrVal) {\r\n            let {$source} = row;\r\n            if ($source === undefined) continue;\r\n            let {$isSelected, $isDeleted} = $source;\r\n            row.$isSelected = $isSelected;\r\n            row.$isDeleted = $isDeleted;\r\n            //console.log($isSelected, $isDeleted);\r\n            for (let item of arrItems) {\r\n                this.arrItemOperated(item);\r\n            }\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        let {beforeShow} = this.props;\r\n        if (beforeShow !== undefined) beforeShow(this.formContext);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        if (this.disposer !== undefined) this.disposer();\r\n    }\r\n\r\n    render() {\r\n        let content = this.renderContent();\r\n        return <ContextContainer.Provider value={this.formContext}>\r\n            <this.formContext.renderErrors />\r\n            {this.Container(content)}\r\n        </ContextContainer.Provider>;\r\n    }\r\n\r\n    async buttonClick(buttonName:string) {\r\n        this.formContext.checkRules()\r\n        if (this.formContext.hasError === true) return;\r\n\r\n        let {onButtonClick} = this.formContext.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(buttonName, this.formContext);\r\n        if (ret === undefined) return;\r\n        this.formContext.setError(buttonName, ret);\r\n    }\r\n\r\n    protected DefaultContainer = (content:JSX.Element): JSX.Element => {\r\n        return <form className={classNames(this.props.className)} onSubmit={e=>e.preventDefault()}>\r\n            {content}\r\n        </form>;\r\n    }\r\n    protected DefaultFieldContainer = (label:string|JSX.Element, content:JSX.Element): JSX.Element => {\r\n        let {fieldLabelSize} = this.props;\r\n\r\n        if (fieldLabelSize > 0) {\r\n            let labelView:any;\r\n            if (label === null) {\r\n                fieldLabelSize = 0;\r\n            }\r\n            else {\r\n                labelView = <label className={classNames('col-sm-' + fieldLabelSize, 'col-form-label')}>{label}</label>\r\n            }\r\n            let fieldCol = 'col-sm-' + (12 - fieldLabelSize);\r\n            return <div className=\"form-group row\">\r\n                {labelView}\r\n                <div className={fieldCol}>{content}</div>\r\n            </div>;\r\n        }\r\n        return <div className=\"form-group\">\r\n            {label===null? null:<label className=\"col-form-label\">{label}</label>}\r\n            {content}\r\n        </div>;\r\n    }\r\n    protected DefaultFieldClass:string = undefined;\r\n    protected DefaultButtonClass = 'text-center py-2';\r\n    protected DefaultRes:FormRes = resLang<FormRes>(formRes);\r\n\r\n    ArrContainer = (label:any, content:JSX.Element): JSX.Element => {\r\n        return <div>\r\n            <div className={classNames('small text-muted text-center bg-light py-1 px-3 mt-4 mb-1')}>{label}</div>\r\n            {content}\r\n        </div>;\r\n    }\r\n    RowContainer = (content:JSX.Element): JSX.Element => {\r\n        let cn = classNames({\r\n            'py-3': true\r\n        });\r\n        return <div className={cn}>{content}</div>\r\n    }\r\n    RowSeperator = <div className=\"border border-gray border-top\" />;\r\n}\r\n","import * as React from 'react';\r\nimport { factory } from './widgets';\r\nimport { ContextContainer, Context } from './context';\r\n\r\nexport interface FieldProps {\r\n    name: string;\r\n}\r\n\r\nexport class FormField extends React.Component<FieldProps> {\r\n    static contextType = ContextContainer;\r\n    render() {\r\n        let {name, children } = this.props;\r\n        let context:Context = this.context;\r\n        if (context === undefined) return <span className=\"text-danger\">!only in Form!</span>;\r\n        let itemSchema = context.getItemSchema(name);\r\n        let content = factory(context, itemSchema, children, this.props);\r\n        if (content === undefined) {\r\n            return <span className=\"text-danger\">!!{name} is not defined!!</span>;\r\n        }\r\n        return content;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { UiTextItem } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class StringItemEdit extends ItemEdit {\r\n    get uiItem(): UiTextItem {return this._uiItem as UiTextItem}\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve, reject});\r\n            nav.push(element,reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.newValue = evt.target.value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private onBlur = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.verifyValue();\r\n    }\r\n\r\n    private onFocus = () => {\r\n        this.error = undefined;\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n\t\tlet {resolve} = props;\r\n\t\tlet onSave = () => {\r\n\t\t\tthis.verifyValue();\r\n\t\t\tif (this.error === undefined) {\r\n\t\t\t\tlet val = this.newValue;\r\n\t\t\t\tresolve(val);\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center mr-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={onSave}>保存</button>;\r\n\t\tlet onKeyDown = (evt: React.KeyboardEvent<HTMLInputElement>) => {\r\n\t\t\tif (evt.keyCode === 13) onSave();\r\n\t\t}\r\n        return <Page header={this.label} right={right}>\r\n            <div className=\"m-3\">\r\n                <input type=\"text\" \r\n\t\t\t\t\tonChange={this.onChange}\r\n\t\t\t\t\tonKeyDown={onKeyDown}\r\n                    onBlur={this.onBlur}\r\n                    onFocus={this.onFocus}\r\n                    className=\"form-control\" \r\n                    defaultValue={this.value} />\r\n                {\r\n                    this.uiItem && <div className=\"small muted m-2\">{this.uiItem.placeholder}</div>\r\n                }\r\n                {this.error && <div className=\"text-danger\">{this.error}</div>}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiRadio } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class RadioItemEdit extends ItemEdit {\r\n    get uiItem(): UiRadio {return this._uiItem as UiRadio}\r\n\r\n\tinit() {\r\n        if (this.value === undefined) {\r\n            this.value = this._uiItem===undefined? undefined : this._uiItem.defaultValue;\r\n        }\r\n\t}\r\n\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            nav.push(element,reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (value: any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let {name} = this.itemSchema;\r\n        let {list} = this.uiItem;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center\"\r\n            disabled={!this.isChanged}\r\n            onClick={()=>{\r\n                this.verifyValue();\r\n                if (this.error === undefined) resolve(this.newValue);\r\n            }}>保存</button>;\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {title, value} = v;\r\n                return <div key={index} className=\"col\"><label className=\"px-3 py-2 cursor-pointer\">\r\n                    <input name={name} type=\"radio\" value={value} \r\n                        onClick={()=>this.onChange(value)} \r\n                        defaultChecked={value === this.value} /> {title || value} &nbsp;\r\n                </label></div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label} right={right}>\r\n            <div className=\"m-3\">\r\n\t\t\t\t<div className=\"row row-cols-2 row-cols-sm-3 row-cols-md-4\">{content}</div>\r\n\t\t\t</div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiSelect } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class SelectItemEdit extends ItemEdit {\r\n    get uiItem(): UiSelect {return this._uiItem as UiSelect}\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            nav.push(element,reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (value:any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let {list} = this.uiItem;\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {title, value} = v;\r\n                return <div key={index} className=\"px-3 py-2 cursor-pointer bg-white mb-1\" onClick={()=>{this.onChange(value); resolve(this.newValue)}}>\r\n                    {title || value}\r\n                </div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label}>\r\n            <div className=\"my-3\">\r\n                {content}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiIdItem } from '../schema';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class IdItemEdit extends ItemEdit {\r\n    get uiItem(): UiIdItem {return this._uiItem as UiIdItem}\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            //let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            //nav.push(element,reject);\r\n\r\n            let {pickId} = this.uiItem;\r\n            if (pickId === undefined) {\r\n                alert('IdItemEdit.pickId = undefined');\r\n                return;\r\n            }\r\n            let boxId = await pickId(undefined, undefined, this.value);\r\n            //if (typeof id === 'object') {\r\n            //    id = (id as any).id;\r\n            //}\r\n            this.onChange(boxId.id);\r\n            resolve(boxId);\r\n            //this.newValue = id;\r\n        });\r\n    }\r\n\r\n    protected async internalEnd():Promise<void> {}\r\n\r\n    private onChange = (value:any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        /*\r\n        let {resolve, reject} = props;\r\n        let {list} = this.uiItem;\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {title, value} = v;\r\n                return <div key={index} className=\"px-3 py-2 cursor-pointer bg-white mb-1\" onClick={()=>{this.onChange(value); resolve(this.newValue)}}>\r\n                    {title || value}\r\n                </div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label}>\r\n            <div className=\"my-3\">\r\n                {content}\r\n            </div>\r\n        </Page>;\r\n        */\r\n        return <Page header={'更改' + this.label}>\r\n            ddd\r\n        </Page>\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiTag } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nabstract class TagItemEdit extends ItemEdit {\r\n\tprotected inputs: {[index:number]: HTMLInputElement} = {};\r\n\tprotected inputType: 'checkbox' | 'radio';\r\n    get uiItem(): UiTag {return this._uiItem as UiTag};\r\n\r\n\tinit() {\r\n        if (this.value === undefined) {\r\n            this.value = this._uiItem===undefined? undefined : this._uiItem.defaultValue;\r\n        }\r\n\t}\r\n\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            nav.push(element,reject);\r\n        });\r\n\t}\r\n\t\r\n\trenderContent() {\r\n\t\tlet valuesView = this.uiItem.valuesView;\r\n\t\tif (valuesView === undefined) return super.renderContent();\r\n\t\treturn valuesView.render(this.value);\r\n\t}\r\n\r\n\tprotected abstract renderInputs():JSX.Element;\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center\"\r\n            disabled={!this.isChanged}\r\n            onClick={()=>{\r\n                this.verifyValue();\r\n                if (this.error === undefined) resolve(this.newValue);\r\n\t\t\t}}>保存</button>;\r\n\t\t/*\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {name:itemName, id} = v;\r\n                return <div key={index} className=\"col\"><label className=\"px-3 py-2 cursor-pointer\">\r\n                    <input ref={input=>this.inputs[id] = input} name={name} type={this.inputType} value={id} \r\n\t\t\t\t\t\tonClick={(e)=>this.onChange(e.currentTarget.checked, id)}\r\n                        defaultChecked={this.defaultChecked(id)} /> {itemName} &nbsp;\r\n                </label></div>;\r\n            })\r\n            :\r\n\t\t\t<>no list defined</>;\r\n\t\t*/\r\n        return <Page header={'更改' + this.label} right={right}>\r\n\t\t\t<div className=\"p-3\">\r\n\t\t\t\t{this.renderInputs()}\r\n\t\t\t</div>\r\n        </Page>;\r\n    })\r\n}\r\n\r\nexport class TagSingleItemEdit extends TagItemEdit {\r\n\tprotected inputType:'radio'|'checkbox' = 'radio';\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tlet {currentTarget} = evt;\r\n\t\tif (currentTarget.checked === false) return;\r\n        this.newValue = Number(currentTarget.value);\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n\t}\r\n\t\r\n\tprotected renderInputs():JSX.Element {\r\n\t\tlet {valuesView} = this.uiItem;\r\n\t\tlet options = {\r\n\t\t\tinputs: this.inputs,\r\n\t\t\tonInputChange: this.onInputChange,\r\n\t\t};\r\n\t\treturn valuesView.renderRadios(this.value, options);\r\n\t}\r\n}\r\n\r\nexport class TagMultiItemEdit extends TagItemEdit {\r\n\t//private arr:number[];\r\n\tprotected inputType:'radio'|'checkbox' = 'checkbox';\r\n\r\n\tprivate onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tlet values:string[] = [];\r\n\t\tfor (let i in this.inputs) {\r\n\t\t\tlet input = this.inputs[i];\r\n\t\t\tif (input.checked === true) values.push(input.value);\r\n\t\t}\r\n        this.newValue = values.join('|');\r\n        //this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n\t}\r\n\tprotected renderInputs():JSX.Element {\r\n\t\tlet {valuesView} = this.uiItem;\r\n\t\tlet options = {\r\n\t\t\tinputs: this.inputs,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t};\r\n\t\treturn valuesView.renderChecks(this.value, options);\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { UiTextItem } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class TextAreaItemEdit extends ItemEdit {\r\n    get uiItem(): UiTextItem {return this._uiItem as UiTextItem}\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve, reject});\r\n            nav.push(element,reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.newValue = evt.target.value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private onBlur = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.verifyValue();\r\n    }\r\n\r\n    private onFocus = () => {\r\n        this.error = undefined;\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n\t\tlet {resolve} = props;\r\n\t\tlet onSave = () => {\r\n\t\t\tthis.verifyValue();\r\n\t\t\tif (this.error === undefined) {\r\n\t\t\t\tlet val = this.newValue;\r\n\t\t\t\tresolve(val);\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center mr-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={onSave}>保存</button>;\r\n\t\tlet onKeyDown = (evt: React.KeyboardEvent<HTMLTextAreaElement>) => {\r\n\t\t\t// if (evt.keyCode === 13) onSave();\r\n\t\t}\r\n        return <Page header={this.label} right={right}>\r\n            <div className=\"m-3\">\r\n                <textarea\r\n\t\t\t\t\tonChange={this.onChange}\r\n\t\t\t\t\tonKeyDown={onKeyDown}\r\n                    onBlur={this.onBlur}\r\n                    onFocus={this.onFocus}\r\n                    className=\"form-control\" \r\n\t\t\t\t\tdefaultValue={this.value}\r\n\t\t\t\t\trows={6} />\r\n                {\r\n                    this.uiItem && <div className=\"small muted m-2\">{this.uiItem.placeholder}</div>\r\n                }\r\n                {this.error && <div className=\"text-danger\">{this.error}</div>}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\n//import _ from 'lodash';\r\nimport { observer } from 'mobx-react';\r\nimport { Schema, UiSchema, ItemSchema, UiItem, UiRadio, UiTagSingle, UiTagMulti } from '../schema';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { StringItemEdit } from './stringItemEdit';\r\nimport { ImageItemEdit } from './imageItemEdit';\r\nimport { RadioItemEdit } from './radioItemEdit';\r\nimport { SelectItemEdit } from './selectItemEdit';\r\nimport { IdItemEdit } from './idItemEdit';\r\nimport { TagSingleItemEdit, TagMultiItemEdit } from './tagItemEdit';\r\nimport { TextAreaItemEdit } from './textAreaItemEdit';\r\n\r\nexport interface EditProps {\r\n    className?: string;\r\n    schema: Schema;\r\n    data: any;\r\n    onItemClick?: (itemSchema: ItemSchema, uiItem: UiItem, value: any) => Promise<void>;\r\n    onItemChanged?: (itemSchema: ItemSchema, newValue:any, preValue:any) => Promise<void>;\r\n    stopEdit?: boolean;\r\n    uiSchema?: UiSchema;\r\n    sepClassName?: string;\r\n    topBorderClassName?: string;\r\n    bottomBorderClassName?: string;\r\n    rowContainerClassName?: string;\r\n}\r\n\r\n@observer\r\nexport class Edit extends React.Component<EditProps> {\r\n    private defaultSepClassName = 'border-top edit-sep-light-gray';\r\n    private defaultRowContainerClassName = 'd-flex px-3 py-2 bg-white align-items-center';\r\n    private topBorder:JSX.Element;\r\n    private bottomBorder:JSX.Element;\r\n    private rowContainerClassName?: string;\r\n    private sep:JSX.Element;\r\n\tprivate uiSchema: {[name:string]: UiItem};\r\n\r\n    constructor(props: EditProps) {\r\n        super(props);\r\n        let {topBorderClassName, bottomBorderClassName, sepClassName, rowContainerClassName, uiSchema, stopEdit} = props;\r\n        this.topBorder = <div className={topBorderClassName || this.defaultSepClassName} />;\r\n        this.bottomBorder = <div className={bottomBorderClassName || this.defaultSepClassName} />;\r\n        this.rowContainerClassName = rowContainerClassName || this.defaultRowContainerClassName;\r\n        if (stopEdit !== true) this.rowContainerClassName += ' cursor-pointer';\r\n        this.sep = <div className={sepClassName || this.defaultSepClassName} />;\r\n\t\tthis.uiSchema = (uiSchema && uiSchema.items) || {};\r\n    }\r\n\r\n    render() {\r\n        let {schema} = this.props;\r\n\t\tlet sep:any;\r\n        return <div>\r\n\t\t\t{this.topBorder}\r\n            {schema.map((itemSchema, index) => {\r\n\t\t\t\tlet {name} = itemSchema;\r\n\t\t\t\tlet uiItem = this.uiSchema===undefined? undefined : this.uiSchema[name];\r\n\t\t\t\tlet label:string, labelHide:any;\r\n\t\t\t\tif (uiItem !== undefined) {\r\n\t\t\t\t\tlabel = uiItem.label || name;\r\n\t\t\t\t\tlabelHide = uiItem.labelHide;\r\n\t\t\t\t};\r\n\t\t\t\tlet value = this.props.data[name];\r\n\t\t\t\tlet itemEdit = createItemEdit(itemSchema, uiItem, label, value);\r\n\r\n\t\t\t\tlet {required} = itemSchema;\r\n\t\t\t\tlet requireFlag = required===true && <span className=\"text-danger\">*</span>;\r\n\t\t\t\tlet divLabel:any, cn:string = 'flex-fill d-flex ';\r\n\t\t\t\tif (labelHide === true) {\r\n\t\t\t\t\tdivLabel = undefined;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tdivLabel = <div>{label} {requireFlag}</div>;\r\n\t\t\t\t\tcn += 'justify-content-end';\r\n\t\t\t\t}\r\n\t\t\t\tlet ret = <React.Fragment key={index}>\r\n\t\t\t\t\t{sep}\r\n\t\t\t\t\t<div className={'d-flex align-items-center' + this.rowContainerClassName} \r\n\t\t\t\t\t\tonClick={async ()=>await this.rowClick(itemEdit)}>\r\n\t\t\t\t\t\t{divLabel}\r\n\t\t\t\t\t\t<div className={cn}>{\r\n\t\t\t\t\t\t\titemEdit===undefined? undefined: itemEdit.renderContent()\r\n\t\t\t\t\t\t}</div>\r\n\t\t\t\t\t\t{this.props.stopEdit!==true && <div className=\"w-2c text-right\"><i className=\"fa fa-angle-right\" /></div>}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</React.Fragment>;\r\n\t\t\t\tsep = this.sep;\r\n\t\t\t\treturn ret;\r\n\t\t\t})}\r\n\t\t\t{this.bottomBorder}\r\n\t\t</div>;\r\n    }\r\n\r\n\tprivate rowClick = async (itemEdit:ItemEdit) => {\r\n\t\tif (itemEdit === undefined) {\r\n\t\t\talert('item has no edit');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet {itemSchema, uiItem, value} = itemEdit;\r\n        let {onItemChanged, onItemClick, stopEdit} = this.props;\r\n        if (stopEdit === true) return;\r\n        let changeValue:any;\r\n        if (onItemClick !== undefined) {\r\n            await onItemClick(itemSchema, uiItem, value);\r\n            return;\r\n        }\r\n        //let itemEdit:ItemEdit = createItemEdit(itemSchema, uiItem, label, value);\r\n        if (itemEdit === undefined) {\r\n            alert('undefined: let itemEdit:ItemEdit = createItemEdit(itemSchema, uiItem, label, value);');\r\n            return;\r\n        }\r\n        try {\r\n            changeValue = await itemEdit.start();\r\n            if (changeValue !== value) {\r\n\t\t\t\t// 2020-04-15：改值之后，应该赋值吧。所以移到这里来\r\n\t\t\t\tthis.props.data[itemSchema.name] = changeValue;\r\n                if (onItemChanged === undefined) {\r\n                    alert(`${itemSchema.name} value changed, new: ${changeValue}, pre: ${value}`);\r\n\t\t\t\t\t// 2020-04-15：改值之后，应该赋值吧。所以这一句移到前面去\r\n                    //this.props.data[itemSchema.name] = changeValue;\r\n                }\r\n                else {\r\n                    await onItemChanged(itemSchema, changeValue, value);\r\n                }\r\n            }\r\n            await itemEdit.end();\r\n        }\r\n        catch (err) {\r\n            // 如果直接back，会触发reject，就到这里了\r\n\t\t\tconsole.log('no value changed');\r\n\t\t\tconsole.error(err);\r\n        }\r\n    }\r\n}\r\n\r\ntype NewItemEdit = new (itemSchema: ItemSchema, uiItem:UiItem, label:string, value: any) => ItemEdit;\r\n\r\nfunction createItemEdit(itemSchema: ItemSchema, uiItem:UiItem, label:string, value: any):ItemEdit {\r\n\tlet ie: ItemEdit;\r\n    let itemEdit: NewItemEdit;\r\n    if (uiItem !== undefined) {\r\n        switch (uiItem.widget) {\r\n            default: break;\r\n            case 'id': itemEdit = IdItemEdit; break;\r\n\t\t\tcase 'text': itemEdit = StringItemEdit; break;\r\n\t\t\tcase 'textarea': itemEdit = TextAreaItemEdit; break;\r\n            case 'image': itemEdit = ImageItemEdit; break;\r\n\t\t\tcase 'select': itemEdit = SelectItemEdit; break;\r\n\t\t\tcase 'range': itemEdit = StringItemEdit; break;\r\n            case 'radio': \r\n\t\t\t\tie = new RadioItemEdit(itemSchema, uiItem as UiRadio, label, value);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'tagSingle':\r\n\t\t\t\tie = new TagSingleItemEdit(itemSchema, uiItem as UiTagSingle, label, value);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'tagMulti':\r\n\t\t\t\tie = new TagMultiItemEdit(itemSchema, uiItem as UiTagMulti, label, value);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t}\r\n\tif (ie === undefined) {\r\n\t\tif (itemEdit === undefined) {\r\n\t\t\tswitch (itemSchema.type) {\r\n\t\t\t\tcase 'string': itemEdit = StringItemEdit; break;\r\n\t\t\t\tcase 'image': itemEdit = ImageItemEdit; break;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (itemEdit === undefined) return;\r\n\t\tie = new itemEdit(itemSchema, uiItem, label, value);\r\n\t}\r\n\tie.init();\r\n\treturn ie;\r\n}\r\n","import {CenterApiBase} from '../net';\r\n\r\nexport class CenterApi extends CenterApiBase {\r\n    async userAppUnits(app:number):Promise<any[]> {\r\n        return await this.get('tie/user-app-units', {app:app});\r\n    };\r\n    async userFromId(userId:number):Promise<any> {\r\n        return await this.get('user/user-name-nick-icon-from-id', {userId:userId});\r\n    }\r\n}\r\n\r\nexport const centerApi = new CenterApi('tv/', undefined);\r\n","import * as React from 'react';\r\nimport { Page, FA, nav, LMR, List } from \"../components\";\r\nimport { VPage } from '../vm';\r\nimport { appInFrame } from '../net';\r\nimport { CAppBase } from \"./CAppBase\";\r\nimport { UQsMan } from '../uq';\r\n\r\n/*\r\nexport class VAppMain extends VPage<CMainBase> {\r\n    async open(param?:any) {\r\n        this.openPage(this.appPage);\r\n    }\r\n\r\n    render(param?:any) {\r\n        return this.appContent();\r\n    }\r\n\r\n    protected appPage = () => {\r\n        let {caption} = this.controller;\r\n        return <Page header={caption} logout={async()=>{appInFrame.unit = undefined}}>\r\n            {this.appContent()}\r\n        </Page>;\r\n    }\r\n\r\n    protected appContent = () => {\r\n        let {cUqArr} = this.controller;\r\n        let content:any;\r\n        if (cUqArr.length === 0) {\r\n            content = <div className=\"text-danger\">\r\n                <FA name=\"\" /> 此APP没有绑定任何的UQ\r\n            </div>;\r\n        }\r\n        else {\r\n            content = cUqArr.map((v,i) => <div key={i}>{v.render()}</div>);\r\n        }\r\n        return <>{content}</>;\r\n    };\r\n}\r\n*/\r\nexport class VUnsupportedUnit extends VPage<CAppBase> {\r\n    async open(predefinedUnit: number) {\r\n        this.openPage(this.page, {predefinedUnit:predefinedUnit});\r\n    }\r\n\r\n    private page = ({predefinedUnit}:{predefinedUnit: number}) => {\r\n        let {user} = nav;\r\n        let userName:string = user? user.name : '[未登录]';\r\n        let {appOwner, appName} = UQsMan.value;\r\n        return <Page header=\"APP无法运行\" logout={true}>\r\n            <div className=\"m-3 text-danger container\">\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">登录用户</div>\r\n                    <div className=\"col-sm text-body\">{userName}</div>\r\n                </div>\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">App</div>\r\n                    <div className=\"col-sm text-body\">{`${appOwner}/${appName}`}</div>\r\n                </div>\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">预设小号</div>\r\n                    <div className=\"col-sm text-body\">{predefinedUnit || <small className=\"\">[无预设小号]</small>}</div>\r\n                </div>\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">\r\n                        可能原因<FA name=\"exclamation-triangle\" />\r\n                    </div>\r\n                    <div className=\"col-sm text-body\">\r\n                        <ul className=\"p-0\">\r\n                            <li>没有小号运行 {appName}</li>\r\n                            <li>用户 <b>{userName}</b> 没有加入任何一个运行{appName}的小号</li>\r\n                            {\r\n                                predefinedUnit && \r\n                                <li>预设小号 <b>{predefinedUnit}</b> 没有运行App {appName}</li>\r\n                            }\r\n                        </ul>\r\n                    </div>\r\n                </div>\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">小号{predefinedUnit}</div>\r\n                    <div className=\"col-sm text-body\">\r\n                        预设小号定义在 public/unit.json 文件中。\r\n                        定义了这个文件的程序，只能由url直接启动。\r\n                        用户第一次访问app之后，会缓存在localStorage里。<br/>\r\n                        如果要删去缓存的预定义Unit，logout然后再login。\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport class VUnitSelect extends VPage<CAppBase> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderRow = (item: any, index: number):JSX.Element => {\r\n        let {id, nick, name} = item;\r\n        return <LMR className=\"px-3 py-2\" right={'id: ' + id}>\r\n            <div>{nick || name}</div>\r\n        </LMR>;\r\n    }\r\n    private onRowClick = async (item: any) => {\r\n        appInFrame.unit = item.id; // 25;\r\n        await this.controller.start();\r\n    }\r\n\r\n    private page = () => {\r\n        return <Page header=\"选择小号\" logout={true}>\r\n            <List items={this.controller.appUnits} item={{render: this.renderRow, onClick: this.onRowClick}}/>\r\n        </Page>\r\n    }\r\n}\r\n\r\nexport class VErrorsPage extends VPage<CAppBase> {\r\n    async open(errors:string[]) {\r\n        this.openPage(this.page, {errors:errors});\r\n    }\r\n\r\n    private page = (errors:{errors:string[]}) => {\r\n        return <Page header=\"ERROR\">\r\n            <div className=\"m-3\">\r\n\t\t\t\t<div className=\"p-3 d-flex justify-content-center align-items-center\">\r\n\t\t\t\t\t<button className=\"btn btn-danger\" onClick={nav.resetAll}>重启网页</button>\r\n\t\t\t\t</div>\r\n\r\n                <div>Load Uqs 发生错误：</div>\r\n                {errors.errors.map((r, i) => <div key={i}>{r}</div>)}\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport class VStartError extends VPage<CAppBase> {\r\n    async open(error:any) {\r\n        this.openPage(this.page, {error:error});\r\n    }\r\n\r\n    private page = ({error}:{error:any}) => {\r\n        return <Page header=\"App start error!\">\r\n            <pre>\r\n                {typeof error === 'string'? error : error.message}\r\n            </pre>\r\n        </Page>;\r\n    }\r\n}","import { nav, t, setGlobalRes } from \"../components\";\r\nimport { Controller } from '../vm';\r\nimport { UQsMan, TVs } from \"../uq\";\r\nimport { appInFrame } from \"../net\";\r\nimport { centerApi } from \"./centerApi\";\r\nimport { VUnitSelect, VErrorsPage, VStartError, VUnsupportedUnit } from \"./vMain\";\r\n\r\nexport interface IConstructor<T> {\r\n    new (...args: any[]): T;\r\n}\r\n\r\nexport interface AppConfig {\r\n    appName: string;        // 格式: owner/appName\r\n    version: string;        // 版本变化，缓存的uqs才会重载\r\n    tvs: TVs;\r\n    uqNameMap?: {[uqName:string]: string};      // uqName='owner/uq' 映射到内存简单名字：uq, 可以注明映射，也可以自动。有可能重\r\n    loginTop?: JSX.Element;\r\n    oem?: string;               // 用户注册发送验证码的oem厂家，默认同花\r\n\tprivacy?: string;\r\n\tnoUnit?: boolean;\t\t\t// app的运行，不跟unit绑定\r\n\thtmlTitle?: string;\r\n}\r\n\r\nexport interface Elements {\r\n\t[id:string]: (element: HTMLElement)=>void,\r\n}\r\n\r\nexport abstract class CAppBase extends Controller {\r\n\tprivate appConfig: AppConfig;\r\n    protected _uqs: any;\r\n\r\n    protected readonly name: string;\r\n\t//protected readonly version: string;\r\n\tprotected readonly noUnit: boolean;\r\n\r\n    //readonly uqsMan: UQsMan;\r\n    appUnits:any[];\r\n\r\n    // appName: owner/name\r\n    constructor(config?: AppConfig) {\r\n\t\tsuper(undefined);\r\n\t\tthis.appConfig = config || (nav.navSettings as AppConfig);\r\n        let {appName, noUnit} = this.appConfig;\r\n        this.name = appName;\r\n        if (appName === undefined) {\r\n            throw new Error('appName like \"owner/app\" must be defined in MainConfig');\r\n        }\r\n\t\tthis.noUnit = noUnit;\r\n\t\t//this._uqs = UQsMan._uqs;\r\n\t\t//this.version = version;\r\n        //this.uqsMan = new UQsMan(this.name, tvs);\r\n    }\r\n\r\n    get uqs(): any {return this._uqs;}\r\n\r\n\tinternalT(str:string):any {\r\n\t\treturn t(str);\r\n\t}\r\n\t\r\n\tprotected setRes(res:any) {\r\n\t\tsetGlobalRes(res);\r\n\t}\r\n\t\r\n\tprotected hookElements(elements: Elements) {\r\n\t\tif (elements === undefined) return;\r\n\t\t//nav.setSettings(appConfig);\r\n\t\t//let cApp:CApp = (await start(CApp, appConfig)) as CApp;\r\n\t\tfor (let i in elements) {\r\n\t\t\tlet el = document.getElementById(i);\r\n\t\t\tif (el) {\r\n\t\t\t\telements[i](el);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t\r\n    protected async beforeStart():Promise<boolean> {\r\n        try {\r\n\t\t\tif (!nav.isRouting) {\r\n\t\t\t\t//await nav.init();\r\n\t\t\t\tlet {appName, version, tvs} = this.appConfig;\r\n\t\t\t\tawait UQsMan.load(appName, version, tvs);\r\n\t\t\t}\r\n\t\t\tthis._uqs = UQsMan._uqs;\r\n\t\t\r\n            //let retErrors = await this.load();\r\n            //let app = await loadAppUqs(this.appOwner, this.appName);\r\n            // if (isDevelopment === true) {\r\n\t\t\t// 这段代码原本打算只是在程序员调试方式下使用，实际上，也可以开放给普通用户，production方式下\r\n\t\t\tlet retErrors = UQsMan.errors;\r\n            let {predefinedUnit} = appInFrame;\r\n            let {user} = nav;\r\n            if (user !== undefined && user.id > 0) {\r\n\t\t\t\tthis.appUnits = await centerApi.userAppUnits(UQsMan.value.id);\r\n\t\t\t\tif (this.noUnit === true) return true;\r\n                switch (this.appUnits.length) {\r\n                    case 0:\r\n                        this.showUnsupport(predefinedUnit);\r\n\t\t\t\t\t\treturn false;\r\n                    case 1:\r\n                        let appUnit = this.appUnits[0].id;\r\n                        if (appUnit === undefined || appUnit < 0 || \r\n                            (predefinedUnit !== undefined && appUnit !== predefinedUnit))\r\n                        {\r\n                            this.showUnsupport(predefinedUnit);\r\n                            return false;\r\n                        }\r\n                        appInFrame.unit = appUnit;\r\n                        break;\r\n                    default:\r\n                        if (predefinedUnit>0 && this.appUnits.find(v => v.id===predefinedUnit) !== undefined) {\r\n                            appInFrame.unit = predefinedUnit;\r\n                            break;\r\n                        }\r\n                        this.openVPage(VUnitSelect);\r\n                        return false;\r\n                }\r\n            }\r\n            if (retErrors !== undefined) {\r\n                this.openVPage(VErrorsPage, retErrors);\r\n                return false;\r\n            }\r\n            return true;\r\n        }\r\n        catch (err) {\r\n            this.openVPage(VStartError, err);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    async userFromId(userId:number):Promise<any> {\r\n        return await centerApi.userFromId(userId);\r\n    }\r\n\r\n\t/*\r\n    private async load(): Promise<string[]> {\r\n        let {appOwner, appName} = this.uqsMan;\r\n        let {localData} = this.uqsMan;\r\n        let uqAppData:UqAppData = localData.get();\r\n        if (!uqAppData || uqAppData.version !== this.version) {\r\n\t\t\tuqAppData = await loadAppUqs(appOwner, appName);\r\n\t\t\tif (!uqAppData.id) {\r\n\t\t\t\treturn [\r\n\t\t\t\t\t`${appOwner}/${appName}不存在。请仔细检查app全名。`\r\n\t\t\t\t];\r\n\t\t\t}\r\n            uqAppData.version = this.version;\r\n            localData.set(uqAppData);\r\n            // \r\n            for (let uq of uqAppData.uqs) uq.newVersion = true;\r\n        }\r\n        let {id, uqs} = uqAppData;\r\n        this.uqsMan.id = id;\r\n        await this.uqsMan.init(uqs);\r\n        let retErrors = await this.uqsMan.load();\r\n        if (retErrors.length === 0) {\r\n            retErrors.push(...this.uqsMan.setTuidImportsLocal());\r\n            if (retErrors.length === 0) {\r\n                this._uqs = this.uqsMan.buildUQs();\r\n                return;\r\n            }\r\n        }\r\n        return retErrors;\r\n\t}\r\n\t*/\r\n\r\n    private showUnsupport(predefinedUnit: number) {\r\n        nav.clear();\r\n        this.openVPage(VUnsupportedUnit, predefinedUnit);\r\n    }\r\n}\r\n","import { AppConfig, CAppBase } from './CAppBase';\r\n\r\nexport async function start(CApp: new (config: AppConfig) => CAppBase, appConfig: AppConfig) {\t\r\n\tlet {htmlTitle} = appConfig;\r\n\tif (htmlTitle) {\r\n\t\tdocument.title = htmlTitle;\r\n\t}\r\n\tlet html = document.getElementsByTagName('html');\r\n\tlet html0 = html[0];\r\n\tif (html0) {\r\n\t\tlet version = html0?.getAttribute('data-version');\r\n\t\tif (version) appConfig.version = version;\r\n\t}\r\n\r\n\tlet cApp = new CApp(appConfig);\r\n    await cApp.start();\r\n}\r\n","import { Controller } from \"../vm\";\r\nimport { IConstructor } from \"./CAppBase\";\r\n\r\nexport abstract class CBase extends Controller {\r\n    protected readonly _uqs: any;\r\n    protected readonly _cApp: any;\r\n\r\n    constructor(cApp: any) {\r\n        super(undefined);\r\n        this._cApp = cApp;\r\n        this._uqs = cApp && cApp.uqs;\r\n\t}\r\n\r\n    protected get uqs(): any {return this._uqs}\r\n\tget cApp(): any {return this._cApp}\r\n\r\n\tinternalT(str:string):any {\r\n\t\tlet r = super.internalT(str);\r\n\t\tif (r!==undefined) return r;\r\n\t\treturn this._cApp.internalT(str);\r\n\t}\r\n\r\n    protected newC<T extends CBase>(type: IConstructor<T>, param?:any):T {\r\n\t\tlet c = new type(this.cApp);\r\n\t\tc.init(param);\r\n\t\treturn c;\r\n    }\r\n\r\n    protected newSub<O extends CBase, T extends CSub<O>>(type: IConstructor<T>, param?:any):T {\r\n\t\tlet s = new type(this);\r\n\t\ts.init(param);\r\n\t\treturn s;\r\n    }\r\n}\r\n\r\nexport abstract class CSub<T extends CBase> extends CBase {\r\n    protected _owner: T;\r\n\r\n    constructor(owner: T) {\r\n        super(owner.cApp);\r\n        this._owner = owner;\r\n\t}\r\n\r\n\tinternalT(str:string):any {\r\n\t\tlet r = super.internalT(str);\r\n\t\tif (r!==undefined) return r;\r\n\t\treturn this._owner.internalT(str);\r\n\t}\r\n\r\n    protected get owner(): CBase {return this._owner}\r\n}\r\n","import { AppConfig } from './CAppBase';\r\nimport { nav } from '../components';\r\nimport { UQsMan } from '../uq';\r\n\t\r\nexport async function startRoute(appConfig: AppConfig) {\r\n\tlet {htmlTitle} = appConfig;\r\n\tif (htmlTitle) {\r\n\t\tdocument.title = htmlTitle;\r\n\t}\r\n\tlet html = document.getElementsByTagName('html');\r\n\tlet html0 = html[0];\r\n\tif (html0) {\r\n\t\tlet version = html0?.getAttribute('data-version');\r\n\t\tif (version) appConfig.version = version;\r\n\t}\r\n\t\r\n\tnav.setSettings(appConfig);\r\n\tawait nav.init();\r\n\tlet {appName, version, tvs} = appConfig;\r\n\tawait UQsMan.load(appName, version, tvs);\r\n\tnav.resolveRoute();\r\n}\r\n","import * as React from 'react';\r\nimport { IObservableArray, computed } from 'mobx';\r\nimport { PageItems } from '../../tool/pageItems';\r\nimport {List} from './index';\r\n\r\nexport abstract class ListBase {\r\n    protected list: List;\r\n    constructor(list: List) {\r\n        this.list = list;\r\n    }\r\n    get isPaged():boolean {\r\n        let items = this.list.props.items;\r\n        return (items !== null && items !== undefined && Array.isArray(items) === false);\r\n    }\r\n    get items():any[]|IObservableArray<any> {\r\n        let items = this.list.props.items;\r\n        if (items === null) return null;\r\n        if (items === undefined) return undefined;\r\n        if (Array.isArray(items) === true)\r\n            return items as IObservableArray<any>;\r\n        else\r\n            return (items as PageItems<any>).items;\r\n    }\r\n    @computed get loading():boolean {\r\n        let items = this.list.props.items;\r\n        if (items === null) return false;\r\n        if (items === undefined) return true;\r\n        let pageItems = items as PageItems<any>;\r\n        if (pageItems.items === undefined) return false;\r\n        return pageItems.loading;\r\n    }\r\n    get selectedItems():any[] { return undefined; }\r\n    //updateProps(nextProps:any) {}\r\n    dispose() {};\r\n    abstract render: (item:any, index:number) => JSX.Element;\r\n    protected renderContent(item:any, index:number) {\r\n        let {render} = this.list.props.item;\r\n        if (render === undefined) return <div className=\"px-3 py-2\">{JSON.stringify(item)}</div>;\r\n        return render(item, index);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {ListBase} from './base';\r\n\r\nexport class Clickable extends ListBase {\r\n    render = (item:any, index:number):JSX.Element => {\r\n        let {className, key, onClick} = this.list.props.item;\r\n        return <li key={key===undefined?index:key(item)} className={classNames('va-row-clickable', className)} onClick={()=>onClick && onClick(item)}>\r\n            {this.renderContent(item, index)}\r\n        </li>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { ListBase } from './base';\r\nimport { uid } from '../../tool/uid';\r\n\r\nexport class Static extends ListBase {\r\n    render = (item:any, index:number):JSX.Element => {\r\n        let {className, key} = this.list.props.item;\r\n        if (typeof item === 'string') {\r\n            let cn = classNames('va-list-gap', 'px-3', 'pt-1');\r\n            return <li key={uid()} className={cn}>{item}</li>;\r\n        }\r\n        return <li key={key===undefined?index:key(item)} className={classNames(className)}>\r\n            {this.renderContent(item, index)}\r\n        </li>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observable, IObservableArray, isObservableArray, observe} from 'mobx';\r\nimport classNames from 'classnames';\r\nimport {ListBase} from './base';\r\nimport {uid} from '../../tool/uid';\r\nimport { PageItems } from '../../tool/pageItems';\r\nimport { List } from './index';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport interface SelectableItem {\r\n    selected: boolean;\r\n    item: any;\r\n    labelId: string;\r\n}\r\n\r\nexport class Selectable extends ListBase {\r\n    @observable private _items: SelectableItem[];\r\n    private inputItems:{[uid:string]: HTMLInputElement} = {};\r\n\r\n    constructor(list: List) {\r\n        super(list);\r\n        this.buildItems();\r\n        this.listenArraySplice();\r\n    }    \r\n\r\n    private listenArraySplice() {\r\n        let {items} = this.list.props;\r\n        if (items === undefined) return;\r\n        if (items === null) return;\r\n        let itemsArray:any;\r\n        if (Array.isArray(items) === true) {\r\n            itemsArray = items as any;\r\n        }\r\n        else {\r\n            itemsArray = (items as PageItems<any>).items;\r\n        }\r\n        if (isObservableArray(items) === true) {\r\n            observe(itemsArray as IObservableArray<any>, (change) => {                \r\n                if (change.type === 'splice') {\r\n                    let {index, removedCount, added} = change;\r\n                    let _added = added && added.map(v => {\r\n                        return {\r\n                            selected: false, \r\n                            item: v, \r\n                            labelId:uid()\r\n                        }\r\n                    });\r\n                    this._items.splice(index, removedCount, ..._added);\r\n                    this.buildItems();\r\n                }\r\n            }, true);\r\n        }\r\n    }\r\n\r\n    private buildItems = () => {\r\n        let {items, selectedItems, compare} = this.list.props;\r\n        let itemsArray:any[] | IObservableArray<any>;\r\n        if (items === undefined) {\r\n            this._items = undefined;\r\n            return;\r\n        }\r\n        if (items === null) {\r\n            this._items = null;\r\n            return;\r\n        }\r\n        \r\n        if (Array.isArray(items) === true) {\r\n            itemsArray = items as any;\r\n        }\r\n        else {\r\n            itemsArray = (items as PageItems<any>).items;\r\n        }\r\n        //let items = this.items;\r\n        //this._selectedItems = selectedItems;\r\n\r\n        let comp: ((item:any, selectItem:any)=>boolean);\r\n        if (compare === undefined) {\r\n            comp = (item:any, selectItem:any) => item === selectItem;\r\n        }\r\n        else {\r\n            comp = compare;\r\n        }\r\n        let retItems = itemsArray.map(v => {\r\n            //let isObserved = isObservable(v);\r\n            //let obj = isObserved === true? toJS(v) : v;\r\n            //let obj = v;\r\n            let selected = selectedItems === undefined?\r\n                false\r\n                : selectedItems.find(si => comp(v, si)) !== undefined;\r\n            return {\r\n                selected: selected, \r\n                item: v, \r\n                labelId:uid()\r\n            };\r\n        });\r\n        this._items = retItems;\r\n    }\r\n\r\n    get items() {\r\n        //if (this._items === undefined) \r\n        //this.buildItems();\r\n        return this._items;\r\n    }\r\n    private checkAll(on: boolean) {\r\n        for (let i in this.inputItems) this.inputItems[i].checked = on;\r\n        for (let item of this._items) item.selected = on;\r\n    }\r\n    selectAll() {\r\n        //if (this._items) this._items.forEach(v => v.selected = true);\r\n        this.checkAll(true);\r\n        this.list.props.item.onSelect(undefined, true, this.anySelected);\r\n    }\r\n    unselectAll() {\r\n        // if (this._items) this._items.forEach(v => v.selected = false);\r\n        this.checkAll(false);\r\n        this.list.props.item.onSelect(undefined, false, this.anySelected);\r\n    }\r\n    /*\r\n    updateProps(nextProps:any) {\r\n        if (nextProps.selectedItems === this._selectedItems) return;\r\n        this.buildItems();\r\n    }\r\n    */\r\n    private get anySelected():boolean {return this._items.some(v => v.selected)}\r\n    private onSelect(item:SelectableItem, selected:boolean) {\r\n        item.selected = selected;\r\n        this.list.props.item.onSelect(item.item, selected, this.anySelected);\r\n    }\r\n    \r\n    get selectedItems():any[] {\r\n        return this._items.filter(v => v.selected === true).map(v => v.item);\r\n    }\r\n    /*\r\n    set selectedItems(value: any[]) {\r\n        if (value === undefined) return;\r\n        if (this._items === undefined) return;\r\n        let sLen = this._items.length;\r\n        let list = value.slice();\r\n        for (let n=0; n<sLen; n++) {\r\n            let sItem = this._items[n];\r\n            let len = list.length;\r\n            if (len === 0) break;\r\n            let item = sItem.item;\r\n            for (let i=0; i<len; i++) {\r\n                let v = list[i];\r\n                if (item === v) {\r\n                    sItem.selected = true;\r\n                    value.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        };\r\n    }\r\n    */\r\n    //w-100 mb-0 pl-3\r\n    //m-0 w-100\r\n    render = (item:SelectableItem, index:number):JSX.Element => {\r\n        let {key} = this.list.props.item;\r\n        return <this.row item={item} index={index} key={key===undefined?index:key(item)} />;\r\n    }\r\n\r\n    private row = observer((props: {item:SelectableItem, index:number}):JSX.Element => {\r\n        let {item, index} = props;\r\n        let {className} = this.list.props.item;\r\n        let {labelId, selected, item:obItem} = item;\r\n        return <li className={classNames(className)}>\r\n            <div className=\"d-flex align-items-center px-3\">\r\n                <input ref={input=>{if (input) this.inputItems[labelId] = input;}}\r\n                    className=\"\" type=\"checkbox\" value=\"\" id={labelId}\r\n                    defaultChecked={selected}\r\n                    onChange={(e)=>{\r\n                        this.onSelect(item, e.target.checked)} \r\n                    }/>\r\n                <label className=\"\" style={{flex:1, marginBottom:0}} htmlFor={labelId}>\r\n                    {this.renderContent(obItem, index)}\r\n                </label>\r\n            </div>\r\n        </li>\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {observer} from 'mobx-react';\r\nimport _ from 'lodash';\r\nimport {PageItems} from '../../tool/pageItems';\r\nimport {ListBase} from './base';\r\nimport {Clickable} from './clickable';\r\nimport {Static} from './static';\r\nimport {Selectable} from './selectable';\r\nimport '../../css/va-list.css';\r\nimport { IObservableArray } from 'mobx';\r\nimport { resLang } from '../../res/res';\r\nimport { ListRes, listRes } from '../../res';\r\n\r\ntype StaticRow = string|JSX.Element|(()=>string|JSX.Element);\r\ninterface ItemProps {\r\n\tclassName?: string|string[];\r\n\trender?: (item:any, index:number) => JSX.Element;\r\n\tonSelect?: (item:any, isSelected:boolean, anySelected:boolean)=>void;\r\n\tonClick?: (item:any)=>void;\r\n\tkey?: (item:any)=>string|number;\r\n}\r\n\r\nexport interface ListProps {\r\n    className?: string|string[];\r\n    items: any[] | IObservableArray<any> | PageItems<any>;\r\n    item: ItemProps;\r\n    compare?:(item:any, selectItem:any)=>boolean;\r\n    selectedItems?:any[];\r\n    header?: StaticRow;\r\n    footer?: StaticRow;\r\n    before?: StaticRow;\r\n    loading?: StaticRow;\r\n\tnone?: StaticRow;\r\n\tonFocus?: (evt: React.FocusEvent<HTMLUListElement>)=>void;\r\n}\r\n\r\n@observer\r\nexport class List extends React.Component<ListProps> {\r\n\tprivate static res:ListRes = resLang<ListRes>(listRes);\r\n\r\n\tprivate listBase: ListBase;\r\n\tprivate selectable: Selectable;\r\n    constructor(props:ListProps) {\r\n\t\tsuper(props);\r\n        this.buildBase();\r\n    }\r\n    _$scroll = (direct: 'top'|'bottom') => {\r\n        console.log('############### items scroll to ' + direct);\r\n    }\r\n    private buildBase() {\r\n        let {item} = this.props;\r\n        let {onClick, onSelect} = item;\r\n        if (onSelect !== undefined)\r\n            this.selectable = this.listBase = new Selectable(this);\r\n        else if (onClick !== undefined)\r\n            this.listBase = new Clickable(this);\r\n        else\r\n            this.listBase = new Static(this);\r\n\t}\r\n\tcomponentDidUpdate(prevProps: Readonly<ListProps>, prevState: Readonly<any>) {\r\n\t\tif (_.isEqual(this.props.item, prevProps.item) === false) {\r\n\t\t\tthis.buildBase();\r\n\t\t\tthis.forceUpdate();\r\n\t\t}\r\n\t}\r\n    componentWillUnmount() {\r\n        this.listBase.dispose();\r\n    }\r\n    selectAll() {\r\n        if (this.selectable) this.selectable.selectAll();\r\n    }\r\n    unselectAll() {\r\n        if (this.selectable) this.selectable.unselectAll();\r\n    }\r\n    get selectedItems():any[] {\r\n        return this.listBase.selectedItems;\r\n    }\r\n    render() {\r\n        let {className, header, footer, before, loading, none, onFocus} = this.props;\r\n        if (before === undefined) before = '-';\r\n        if (loading === undefined) loading = () => <i className=\"fa fa-spinner fa-spin fa-2x fa-fw text-info\" />;\r\n        if (none === undefined) none = List.res.none;\r\n        //this.listBase.selectedItems = selectedItems;\r\n        let {items, loading:isLoading} = this.listBase;\r\n        function staticRow(row:StaticRow, type:string) {\r\n            if (!row) return;\r\n            switch (typeof row) {\r\n                default:\r\n                case 'string': return <li className={\"va-list-\"+type}>{row}</li>;\r\n                case 'function': return <li className={\"va-list-\"+type}>{(row as ()=>string|JSX.Element)()}</li>;\r\n                case 'object': return <li>{row}</li>\r\n            } \r\n        }\r\n        let content:any, waitingMore:any;\r\n        if (items === null)\r\n            content = staticRow(before, 'before');\r\n        else if (items === undefined)\r\n            content = staticRow(loading, 'loading');\r\n        else if (items.length === 0)\r\n            content = staticRow(none, 'none');\r\n        else {\r\n            content = items.map((item, index) => {\r\n                return this.listBase.render(item, index);\r\n            });\r\n        }\r\n        if (isLoading === true && items) {\r\n            waitingMore = staticRow(loading, 'loading');\r\n\t\t}\r\n\t\tlet tabIndex:number;\r\n\t\tif (onFocus !== undefined) tabIndex = -1;\r\n        return <ul className={classNames('va-list', className)} onFocus={onFocus} tabIndex={tabIndex}>\r\n            {staticRow(header, 'header')}\r\n            {content}\r\n            {waitingMore}\r\n            {staticRow(footer, 'footer')}\r\n        </ul>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport className from 'classnames';\r\nimport {PropGridProps} from './PropGrid';\r\nimport {LabeledProp, StringProp, NumberProp, ListProp, ComponentProp} from './propView';\r\n\r\nexport abstract class PropRow {\r\n    setValues(values: any) {}\r\n    abstract render(key:string): any;\r\n}\r\n\r\nexport class PropBorder extends PropRow {\r\n    render(key:string): JSX.Element {\r\n        return <div key={'_b_' + key} className=\"\">\r\n            <div className=\"w-100\">\r\n                <div style={{borderTop: '1px solid #f0f0f0'}} />\r\n            </div>\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport class PropGap extends PropRow {\r\n    private param: string;\r\n    constructor(param?: string) {\r\n        super();\r\n        this.param = param;\r\n    }\r\n    render(key:string): JSX.Element {\r\n        let w: string;\r\n        switch (this.param) {\r\n            default: w = 'py-2'; break;\r\n            case '=': w = 'py-1'; break;\r\n            case '-': w = 'pb-1'; break;\r\n        }\r\n        let cn = className(w);\r\n        return <div key={'_g_' + key} className={cn} />;\r\n    }\r\n}\r\n\r\nconst valueAlignStart = 'justify-content-start';\r\nconst valueAlignCenter = 'justify-content-center';\r\nconst valueAlignEnd = 'justify-content-end';\r\nexport abstract class LabeledPropRow extends PropRow {\r\n    protected gridProps: PropGridProps;\r\n    protected _prop: LabeledProp;\r\n    protected get prop():LabeledProp {return this._prop}\r\n    protected content: any;\r\n    protected col: string;\r\n    //protected values: any;\r\n    constructor(gridProps:PropGridProps, prop: LabeledProp) {\r\n        super();\r\n        this.gridProps = gridProps;\r\n        this._prop = prop;\r\n        this.col = gridProps.labelFixLeft === true? 'col' : 'col-sm';\r\n        //this.values = values;\r\n    }\r\n    render(key:string):any {\r\n        let {onClick, bk} = this.prop;\r\n        let cn = className({\r\n            \"cursor-pointer\": onClick !== undefined,\r\n            \"bg-white\": bk === undefined, \r\n            \"row\": true\r\n        });\r\n        return <div key={key} className={cn} onClick={onClick}>\r\n            {this.renderLabel()}\r\n            {this.renderProp()}\r\n        </div>;\r\n    }\r\n    protected renderLabel():any {\r\n        let {label} = this.prop;\r\n        if (label === undefined) return null;\r\n        return <label className={this.col + '-3 col-form-label'}>\r\n            {label}\r\n        </label>;\r\n    }\r\n    protected renderProp():any {\r\n        let {label} = this.prop;\r\n        let align, vAlign;\r\n        switch (this.gridProps.alignValue) {\r\n            case 'left': align = valueAlignStart; break;\r\n            case 'center': align = valueAlignCenter; break;\r\n            case 'right': align = valueAlignEnd; break;\r\n        }\r\n        switch (this.prop.vAlign) {\r\n            case 'top': vAlign = 'align-items-start'; break;\r\n            default:\r\n            case 'center': vAlign = 'align-items-center'; break;\r\n            case 'bottom': vAlign = 'align-items-end'; break;\r\n            case 'stretch': vAlign = 'align-items-stretch'; break;\r\n        }\r\n        let col:string = this.col + (label===undefined? '-12':'-9');\r\n        let cn = className(align, vAlign, col, 'd-flex');\r\n        return <div className={cn}>\r\n            {this.renderPropBody()}\r\n        </div>;\r\n    }\r\n    protected renderPropBody():any {\r\n        return <div className=\"form-control-plaintext\">\r\n            {this.renderPropContent()}\r\n        </div>;\r\n    }\r\n    protected renderPropContent():any {\r\n        return this.content;\r\n    }\r\n}\r\n\r\nexport class StringPropRow extends LabeledPropRow {\r\n    protected get prop(): StringProp {return this._prop as StringProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else this.content = values[this.prop.name];\r\n    }\r\n}\r\n\r\nexport class NumberPropRow extends LabeledPropRow {\r\n    protected get prop(): NumberProp {return this._prop as NumberProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else this.content = values[this.prop.name];\r\n    }\r\n}\r\n\r\nexport class ListPropRow extends LabeledPropRow {\r\n    protected get prop(): ListProp {return this._prop as ListProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else {\r\n            let list = this.prop.list;\r\n            if (typeof list === 'string') this.content = values[list];\r\n            else this.content = undefined;\r\n        }\r\n    }\r\n    protected renderPropBody() {\r\n        let {list, row} = this.prop;\r\n        let items:any[] = typeof list === 'string'? this.content : list;\r\n        if (items === undefined) return <div/>;\r\n        // new row(item)\r\n        return <div className=\"w-100\">\r\n            {\r\n                items.map((item, index) => <React.Fragment key={index}>\r\n                    {index===0? null: <div style={{width:'100%', borderBottom:'1px solid #f0f0f0'}} />}\r\n                    {React.createElement(row, item)}\r\n                </React.Fragment>)\r\n            }\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport class ComponentPropRow extends LabeledPropRow {\r\n    protected get prop(): ComponentProp {return this._prop as ComponentProp;}\r\n    protected renderPropBody() {\r\n        let {component} = this.prop;\r\n        return component;\r\n    }\r\n    protected renderProp():any {\r\n        let {label, full} = this.prop;\r\n        let align, vAlign;\r\n        switch (this.gridProps.alignValue) {\r\n            case 'left': align = valueAlignStart; break;\r\n            case 'center': align = valueAlignCenter; break;\r\n            case 'right': align = valueAlignEnd; break;\r\n        }\r\n        switch (this.prop.vAlign) {\r\n            case 'top': vAlign = 'align-items-start'; break;\r\n            default:\r\n            case 'center': vAlign = 'align-items-center'; break;\r\n            case 'bottom': vAlign = 'align-items-end'; break;\r\n            case 'stretch': vAlign = 'align-items-stretch'; break;\r\n        }\r\n        let col:string;\r\n        if (full !== true)\r\n            col = this.col + (label===undefined? '-12':'-9');\r\n        else\r\n            col = 'w-100';\r\n        let cn = className(align, vAlign, col, 'd-flex');\r\n        return <div className={cn}>\r\n            {this.renderPropBody()}\r\n        </div>;\r\n    }\r\n}\r\n","import { PropGridProps } from './PropGrid';\r\nimport {\r\n    PropRow, PropBorder, PropGap, \r\n    StringPropRow, NumberPropRow, ListPropRow, ComponentPropRow\r\n} from './row';\r\n\r\nexport interface Format {\r\n\r\n}\r\n\r\nexport interface PropBase {\r\n    onClick?: () => void;\r\n}\r\n\r\nexport interface LabeledProp extends PropBase {\r\n    label?: string;\r\n    bk?: string;\r\n    vAlign?: 'top' | 'bottom' | 'center' | 'stretch';\r\n}\r\n\r\nexport interface StringProp extends LabeledProp {\r\n    type: 'string';\r\n    name: string;\r\n}\r\n\r\nexport interface NumberProp extends LabeledProp {\r\n    type: 'number';\r\n    name: string;\r\n}\r\n\r\nexport interface FormatProp extends LabeledProp {\r\n    type: 'format';\r\n    format: Format;\r\n}\r\n\r\nexport interface ListProp extends LabeledProp {\r\n    type: 'list';\r\n    list: string | any[];  // string 表示名字，否则就是值\r\n    row: new (props: any) => React.Component;\r\n}\r\n\r\nexport interface ComponentProp extends LabeledProp {\r\n    type: 'component';\r\n    full?: boolean;\r\n    component: any; //JSX.Element;\r\n}\r\n\r\nexport type Prop = StringProp | NumberProp | FormatProp | ListProp | ComponentProp | string;\r\n\r\nexport class PropView {\r\n    private gridProps: PropGridProps\r\n    private props: Prop[];\r\n    //private values:any;\r\n    private rows: PropRow[];\r\n\r\n    constructor(gridProps: PropGridProps, props: Prop[]) {\r\n        this.gridProps = gridProps;\r\n        this.props = props;\r\n        //this.values = values;\r\n        this.buildRows();\r\n    }\r\n\r\n    private buildRows() {\r\n        this.rows = [];\r\n        let isGap: boolean = true;\r\n        for (let prop of this.props) {\r\n            if (typeof prop === 'string') {\r\n                this.rows.push(new PropGap(prop));\r\n                isGap = true;\r\n            }\r\n            else {\r\n                if (!isGap) this.rows.push(new PropBorder());\r\n                let row;\r\n                switch (prop.type) {\r\n                    default: continue;\r\n                    case 'string': row = new StringPropRow(this.gridProps, prop); break;\r\n                    case 'number': row = new NumberPropRow(this.gridProps, prop); break;\r\n                    case 'list': row = new ListPropRow(this.gridProps, prop); break;\r\n                    case 'component': row = new ComponentPropRow(this.gridProps, prop); break;\r\n                }\r\n                this.rows.push(row);\r\n                isGap = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    setValues(values: any) {\r\n        for (let r of this.rows) r.setValues(values);\r\n    }\r\n\r\n    render() {\r\n        return this.rows.map((row, index) => row.render(String(index)));\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {observer} from 'mobx-react';\r\nimport {Prop, PropView} from './propView';\r\n\r\nexport interface PropGridProps {\r\n    className?: string;\r\n    rows: Prop[];\r\n    values: any;\r\n    alignValue?: 'left'|'center'|'right';\r\n    labelFixLeft?: boolean;\r\n}\r\n\r\n@observer\r\nexport class PropGrid extends React.Component<PropGridProps> {\r\n    render() {\r\n        let {className, rows, values} = this.props;\r\n        let propView = new PropView(this.props, rows);\r\n        propView.setValues(values);\r\n        let cn = classNames('container-fluid', className);\r\n        return <div className={cn}>\r\n            {propView.render()}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observable } from 'mobx';\r\nimport { Page, ItemSchema, UiSchema, StringSchema, UiTextItem, Edit, ImageSchema, nav, UiImageItem } from '../components';\r\nimport { userApi } from '../net';\r\n\r\nexport class EditMeInfo extends React.Component {\r\n    private schema:ItemSchema[] = [\r\n        {name:'nick', type:'string'} as StringSchema,\r\n        {name:'icon', type:'image'} as ImageSchema\r\n    ];\r\n    private uiSchema:UiSchema = {\r\n        items: {\r\n            nick: {widget:'text', label:'别名', placeholder:'好的别名更方便记忆'} as UiTextItem,\r\n            icon: {widget:'image', label:'头像'} as UiImageItem,\r\n        }\r\n    }\r\n    @observable private data:any;\r\n\r\n    constructor(props:any) {\r\n        super(props);\r\n        let {nick, icon} = nav.user;\r\n        this.data = {\r\n            nick: nick,\r\n            icon: icon,\r\n        }\r\n    }\r\n\r\n    private onItemChanged = async (itemSchema:ItemSchema, newValue:any, preValue:any) => {\r\n        let {name} = itemSchema;        \r\n        await userApi.userSetProp(name, newValue);\r\n        this.data[name] = newValue;\r\n        let user:any = nav.user;\r\n        user[name] = newValue;\r\n        nav.saveLocalUser();\r\n    }\r\n\r\n    render() {\r\n        return <Page header=\"个人信息\">\r\n            <Edit schema={this.schema} uiSchema={this.uiSchema}\r\n                data={this.data}\r\n                onItemChanged={this.onItemChanged} />\r\n        </Page>;\r\n    }\r\n}\r\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import { AppConfig } from \"tonva\";\r\nimport { appName } from \"./appName\";\r\n\r\nexport const appConfig: AppConfig = {\r\n    appName: appName,\r\n\tversion: '1.0.0',\r\n\tnoUnit: true,\r\n    tvs: {},\r\n\toem: undefined,\r\n\thtmlTitle: '小单 - 记录和协作',\r\n};\r\n","export const appName = 'BizDev/notes';","import { CSub, CBase, CAppBase, IConstructor } from 'tonva';\r\nimport { UQs } from './uqs';\r\nimport { CApp } from './CApp';\r\n\r\nexport abstract class CUqBase extends CBase {\r\n    get cApp(): CApp { return this._cApp; }\r\n    protected get uqs(): UQs { return this._uqs as UQs };\r\n}\r\n\r\nexport abstract class CUqSub<T extends CUqBase> extends CSub<T> {\r\n    get cApp(): CApp { return this._cApp; }\r\n    protected get uqs(): UQs { return this._uqs as UQs };\r\n    get owner(): T { return this._owner as T }\r\n}\r\n\r\nexport abstract class CUqApp extends CAppBase {\r\n    get uqs(): UQs { return this._uqs };\r\n\r\n    protected newC<T extends CUqBase>(type: IConstructor<T>): T {\r\n\t\tlet c = new type(this);\r\n\t\tc.init();\r\n\t\treturn c;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { VPage, TabCaptionComponent, Page, TabProp } from 'tonva';\r\nimport { CApp } from './CApp';\r\n\r\nconst color = (selected: boolean) => selected === true ? 'text-primary' : 'text-muted';\r\nfunction caption(label:string, icon:string) {\r\n\treturn (selected: boolean) => TabCaptionComponent(label, icon, color(selected));\r\n}\r\nexport class VMain extends VPage<CApp> {\r\n    async open(param?: any) {\r\n        this.openPage(this.render);\r\n    }\r\n\r\n    render = (param?: any): JSX.Element => {\r\n\t\tlet { cHome, cRelation, cDiscover, cMe } = this.controller;\r\n\t\t/*\r\n        let faceTabs = [\r\n\t\t\t{ name: 'note', label: '首页', icon: 'home', content: cGroup.tab},\r\n\t\t\t{ name: 'job', label: '查看', icon: 'list', content: cReport.tab, onShown: cReport.load, className: 'job-tab' },\r\n            //{ name: 'home', label: '绩效', icon: 'tasks', content: cHome.tab, },\r\n            { name: 'me', label: '我的', icon: 'user', content: cMe.tab }\r\n        ].map(v => {\r\n            let { name, label, icon, content, onShown, className } = v;\r\n            return {\r\n                name: name,\r\n                caption: (selected: boolean) => TabCaptionComponent(label, icon, color(selected)),\r\n                content: content,\r\n\t\t\t\tonShown: onShown,\r\n\t\t\t\tclassName: className\r\n            }\r\n\t\t});\r\n\t\t*/\r\n\t\tlet tabs: TabProp[] = [\r\n\t\t\t{name: 'home', caption: caption('首页', 'home'), content: cHome.tab},\r\n\t\t\t{name: 'relation', caption: caption('关系', 'user-plus'), content: cRelation.tab, onShown: cRelation.load},\r\n\t\t\t{name: 'discover', caption: caption('发现', 'arrows-alt'), content: cDiscover.tab},\r\n\t\t\t{name: 'me', caption: caption('我', 'user-o'), content: cMe.tab},\r\n\t\t];\r\n\t\treturn <Page tabsProps={{tabs}} />;\r\n    }\r\n}\r\n","import { BoxId } from \"tonva\";\r\n\r\nexport const notesName = '小单';\r\n\r\nexport enum EnumNoteItemType {text=0, task=1}\r\n\r\nexport interface NoteItem {\r\n\tseconds: number;\r\n\towner: number | BoxId;\r\n\tnote: number;\r\n\ttype: EnumNoteItemType;\r\n\tfrom: number | BoxId;\r\n\tcaption: string;\r\n\tcontent: string;\r\n\tassigned: string;\r\n\tstate: number;\r\n\tunread: number;\r\n\tobj: any;\r\n\t$create: Date;\r\n\t$update: Date;\r\n}\r\n\r\nexport interface NoteFlow {\t\r\n}\r\n\r\nexport interface Access {\r\n\tuser: number;\r\n\taccess: number;\r\n\tassigned: string;\r\n}\r\n\r\nexport interface NoteModel {\r\n\tid: number;\r\n\tcaption: string;\r\n\tcontent: string;\r\n\ttype: EnumNoteItemType,\r\n\t$create: Date;\r\n\t$update: Date;\r\n\tto: Access[];\r\n\tflow: NoteFlow[];\r\n\tspawn: NoteItem[];\r\n\tcontain: NoteItem[];\r\n}\r\n\r\nexport function replaceAll(str:string, findStr:string, repStr:string):string {\r\n\tif (!str) return str;\r\n\treturn str.split(findStr).join(repStr);\r\n}\r\n\r\nexport function numberFromId(id:number|BoxId):number {\r\n\tlet _id:number;\r\n\tswitch (typeof id) {\r\n\t\t\tcase 'object': _id = (id as BoxId).id; break;\r\n\t\t\tcase 'number': _id = id as number; break;\r\n\t\t\tdefault: return;\r\n\t}\r\n\treturn _id;\r\n}\r\n\r\n","import { CNoteItem } from \"../item\";\r\nimport { NoteItem, NoteModel, numberFromId } from '../model';\r\nimport { VTaskParams } from \"./VTaskParams\";\r\nimport { Contact } from \"model\";\r\nimport { TaskViewFactory, VCheckTask, VRateTask } from \"./state\";\r\n\r\nexport interface AssignTaskParam {\r\n\tcontacts: Contact[];\r\n\tchecker: Contact;\r\n\trater: Contact;\r\n\tpoint?: number;\r\n}\r\n\r\nexport enum EnumTaskState {Start=0, Done=1, Pass=2, Fail=3, Rated=4, Canceled=5};\r\n\r\nexport class CTaskNoteItem extends CNoteItem {\r\n\tprivate getTaskView = new TaskViewFactory().getView;\r\n\r\n\tprivate getView() {\r\n\t\tlet state = this.noteItem.state as EnumTaskState;\r\n\t\tif (state == EnumTaskState.Done) {\r\n\t\t\tif (this.noteItem.obj && this.isMe(this.noteItem.obj.checker)) {\r\n\t\t\t\treturn VCheckTask;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (state == EnumTaskState.Pass) {\r\n\t\t\tif (this.noteItem.obj && this.isMe(this.noteItem.obj.rater)) {\r\n\t\t\t\treturn VRateTask;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this.getTaskView(state);\r\n\t}\r\n\r\n\trenderItem(index:number): JSX.Element {\r\n\t\tlet TaskView = this.getTaskView(this.noteItem.state as EnumTaskState);\r\n\t\tlet v = new TaskView(this);\r\n\t\treturn v.renderListItem();\r\n\t}\r\n\r\n\trenderBaseItem(index:number): JSX.Element {\r\n\t\treturn super.renderItem(index);\r\n\t}\r\n\r\n\tonClickItem(noteModel: NoteModel) {\r\n\t\tlet TaskView = this.getView();\r\n\t\tthis.openVPage(TaskView);\r\n\t}\r\n\r\n\t// convert 可以在不同的继承中被重载\r\n\t// task 里面是把content parse 成json，放到obj里面\t\r\n\tconvert(noteItem: NoteItem): NoteItem {\r\n\t\tnoteItem.obj = JSON.parse(noteItem.content);\r\n\t\treturn noteItem;\r\n\t}\r\n\r\n\tshowAssignTaskPage() {\r\n\t\tthis.openVPage(VTaskParams, {contacts: this.owner.contacts}, () => this.closePage());\r\n\t}\r\n\r\n\tasync assignTask(param: AssignTaskParam) {\r\n\t\tlet {note:noteId} = this.noteItem;\r\n\t\tlet {contacts, checker, rater, point} = param;\r\n\t\tlet note:NoteModel = await this.uqs.notes.Note.assureBox(noteId);\r\n\t\tlet {caption, content} = note;\r\n\t\tlet cObj = JSON.parse(content);\r\n\t\tif (checker) {\r\n\t\t\tcObj.checker = numberFromId(checker.contact);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdelete cObj.checker;\r\n\t\t}\r\n\t\tif (rater) {\r\n\t\t\tcObj.rater = numberFromId(rater.contact);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdelete cObj.rater;\r\n\t\t}\r\n\t\tlet data = {\r\n\t\t\tnote: numberFromId(noteId),\r\n\t\t\tcaption,\r\n\t\t\tcontent: JSON.stringify(cObj),\r\n\t\t\ttos: contacts.map(v => {return {to: v.contact}}),\r\n\t\t\tchecker: checker?.contact,\r\n\t\t\trater: rater?.contact,\r\n\t\t\tpoint,\r\n\t\t}\r\n\t\tawait this.uqs.notes.AssignTask.submit(data);\r\n\t}\r\n\r\n\tasync DoneTask() {\r\n\t\tlet {note:noteId} = this.noteItem;\r\n\t\tlet note:NoteModel = await this.uqs.notes.Note.assureBox(noteId);\r\n\t\tlet {content} = note;\r\n\t\tlet data = {\r\n\t\t\tnote: numberFromId(noteId),\r\n\t\t\tcontent: content\r\n\t\t}\r\n\r\n\t\tlet ret = await this.uqs.notes.DoneTask.submit(data);\r\n\t\tthis.noteItem.state = Number(EnumTaskState.Done);\r\n\t}\r\n\r\n\tasync CheckTask(pass:boolean) {\r\n\t\tlet {note:noteId} = this.noteItem;\r\n\t\tlet note:NoteModel = await this.uqs.notes.Note.assureBox(noteId);\r\n\t\tlet {content} = note;\r\n\t\tlet data = {\r\n\t\t\tnote: numberFromId(noteId),\r\n\t\t\taction: pass?1:2,\r\n\t\t\tcontent: content\r\n\t\t}\r\n\t\t\r\n\t\tlet ret = await this.uqs.notes.CheckTask.submit(data);\r\n\t\tthis.noteItem.state = Number(pass?EnumTaskState.Pass:EnumTaskState.Fail);\r\n\t}\r\n\r\n\tasync RateTask(value: number) {\r\n\t\tlet {note:noteId} = this.noteItem;\r\n\t\tlet note:NoteModel = await this.uqs.notes.Note.assureBox(noteId);\r\n\t\tlet {content} = note;\r\n\t\tlet data = {\r\n\t\t\tnote: numberFromId(noteId),\r\n\t\t\tvalue: value,\r\n\t\t\tcontent: content\r\n\t\t}\r\n\t\t\r\n\t\tlet ret = await this.uqs.notes.RateTask.submit(data);\r\n\t\tthis.noteItem.state = Number(EnumTaskState.Rated);\r\n\t}\r\n}\r\n","import React from 'react';\r\nimport { VPage, User, Image, UserView } from \"tonva\";\r\nimport { CNote } from \"../CNote\";\r\nimport { Contact } from 'model';\r\n\r\nexport abstract class VBasePage extends VPage<CNote> {\r\n\tprotected renderContact = (userId:number, assigned:string) => {\r\n\t\tlet renderUser = (user:User) => {\r\n\t\t\tlet {name, nick, icon} = user;\r\n\t\t\treturn <>\r\n\t\t\t\t<Image className=\"w-1-5c h-1-5c mr-2\" src={icon} />\r\n\t\t\t\t{name} {nick} {assigned}\r\n\t\t\t</>\r\n\t\t}\r\n\t\treturn <UserView user={userId as number} render={renderUser} />;\r\n\t}\r\n\r\n\tprotected renderContactItem = (item:Contact, index:number) => {\r\n\t\tlet {contact, assigned} = item;\r\n\t\treturn <div className=\"px-3 py-2\">\r\n\t\t\t{this.renderContact(contact, assigned)}\r\n\t\t</div>;\r\n\t\t/*\r\n\t\tlet renderUser = (user:User) => {\r\n\t\t\tlet {name, nick, icon} = user;\r\n\t\t\treturn <div className=\"px-3 py-2\">\r\n\t\t\t\t<Image className=\"w-2c h-2c mr-3\" src={icon} />\r\n\t\t\t\t{name} {nick} {assigned}\r\n\t\t\t</div>\r\n\t\t}\r\n\t\treturn <UserView user={contact} render={renderUser} />;\r\n\t\t*/\r\n\t}\r\n}\r\n","import React from 'react';\r\nimport { List } from \"tonva\";\r\nimport { VBasePage } from './VBasePage';\r\nimport { NoteItem } from '../model';\r\nimport { CNoteItem } from 'note/item';\r\n\r\nexport class VList extends VBasePage {\r\n\trender() {\r\n\t\treturn <List className=\"my-1\" items={this.controller.notesPager} \r\n\t\t\titem={{render: this.renderNote, key: this.noteKey, onClick: this.onNoteClick, className:'notes'}} />\r\n\t}\r\n\r\n\tprivate noteKey = (item: CNoteItem) => {\r\n\t\tlet note = item.noteItem.note;\r\n\t\t//if (typeof note === \"object\") return note.id;\r\n\t\treturn note;\r\n\t}\r\n\r\n\tprivate renderNote = (item: CNoteItem, index:number) => {\r\n\t\tlet {type, unread} = item.noteItem;\r\n\t\tlet cn = 'd-block rounded mx-2 my-1 bg-white border ';\r\n\t\tif (unread>0) cn += 'border-info shadow';\r\n\t\treturn <div className={cn}>\r\n\t\t\t{item.renderItem(index)}\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate onNoteClick = async (item: CNoteItem) => {\r\n\t\tlet noteItem = item.noteItem;\r\n\t\tlet noteModel = await this.controller.getNote(noteItem.note);\r\n\t\tnoteItem.unread = 0;\r\n\t\t//this.controller.noteModel = noteModel;\r\n\t\titem.noteModel = noteModel;\r\n\t\treturn item.onClickItem(noteModel);\r\n\t}\r\n}\r\n","import React from 'react';\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport { VBasePage } from './VBasePage';\r\nimport { List, User, Image, UserView, FA } from 'tonva';\r\nimport { Contact } from 'model';\r\n\r\nexport interface SelectContactOptions {\r\n\ttitle?: string;\r\n\taction?: string;\r\n\tsingle?: boolean;\r\n}\r\n\r\nexport class VSelectContact extends VBasePage {\r\n\t@observable private anySelected:boolean = false;\r\n\t@observable private contacts: Contact[];\r\n\t@observable private multiple:boolean = false;\r\n\tprivate list: List;\r\n\tprivate options: SelectContactOptions;\r\n\r\n\tinit(options: SelectContactOptions):void {\r\n\t\tthis.options = options;\r\n\t}\r\n\r\n\tprotected get back(): 'close' | 'back' | 'none' {return 'close'}\r\n\r\n\theader() {return this.options?.title ?? '选择'}\r\n\tright() {\r\n\t\treturn React.createElement(observer(this.buildRight));\r\n\t}\r\n\r\n\tprivate buildRight = () => {\r\n\t\tif (this.options?.single === true) return;\r\n\t\tlet cn = 'btn btn-sm btn-success mr-1';\r\n\t\tif (this.multiple === false) {\r\n\t\t\treturn <button className={cn} onClick={this.onToggleSelect}>多选</button>;\r\n\t\t}\r\n\t\tif (this.contacts && this.contacts.length > 0) {\r\n\t\t\treturn <button className={cn} onClick={this.onNext} disabled={!this.anySelected}>\r\n\t\t\t\t{this.options?.action ?? '选中'}({this.contacts.length}) <FA name=\"angle-right\" />\r\n\t\t\t</button>;\r\n\t\t}\r\n\t\treturn <button className={cn} onClick={this.onToggleSelect}>单选</button>;\r\n\t}\r\n\r\n\tprivate onToggleSelect = () => {\r\n\t\tthis.multiple = !this.multiple;\r\n\t}\r\n\r\n\tcontent() {\r\n\t\tlet render = () => {\r\n\t\t\tlet list:any;\r\n\t\t\tlet items = this.controller.cApp.contacts;\r\n\t\t\tif (this.multiple === true) {\r\n\t\t\t\tlist = <List ref={v => this.list = v}\r\n\t\t\t\t\titems={items} \r\n\t\t\t\t\titem={{render:this.renderContactItem, onSelect:this.onContactSelect}} />\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlist = <List ref={v => this.list = v}\r\n\t\t\t\t\titems={items} \r\n\t\t\t\t\titem={{render:this.renderContactItem, onClick:this.onContactClick}} />\r\n\t\t\t}\r\n\t\t\treturn <div className=\"\">\r\n\t\t\t\t{list}\r\n\t\t\t</div>;\r\n\t\t}\r\n\t\treturn React.createElement(observer(render));\r\n\t}\r\n\r\n\tprivate onContactSelect = (item:Contact, isSelected:boolean, anySelected:boolean):void => {\r\n\t\tthis.anySelected = anySelected;\r\n\t\tthis.contacts = this.list.selectedItems;\r\n\t}\r\n\r\n\tprivate onContactClick = (item:Contact) => {\r\n\t\tthis.returnCall([item]);\r\n\t}\r\n\r\n\tprivate onNext = () => {\r\n\t\tthis.returnCall(this.list.selectedItems);\r\n\t}\r\n}\r\n","import React from \"react\";\r\nimport classNames from 'classnames';\r\nimport { VPage, User, Image, UserView, Page, List, LMR, EasyTime } from \"tonva\";\r\nimport { CNoteItem, CheckItem } from \"./CNoteItem\";\r\nimport { observer } from \"mobx-react\";\r\nimport { NoteItem } from \"note/model\";\r\n\r\nexport abstract class VNoteBase<T extends CNoteItem> extends VPage<T> {\r\n\tprotected renderContent() {\r\n\t\treturn <div className=\"px-3\">{this.controller.noteContent?.split('\\n').map((v, index) => {\r\n\t\t\tlet c = !v? <>&nbsp;</>: v;\r\n\t\t\treturn <div key={index}>{c}</div>;\r\n\t\t})}</div>;\r\n\t}\r\n\r\n\tprotected renderCheckItems(checkable:boolean) {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet uncheckedItems:CheckItem[] = [];\r\n\t\t\tlet checkedItems:CheckItem[] = [];\r\n\t\t\tfor (let ci of this.controller.items) {\r\n\t\t\t\tlet {checked} = ci;\r\n\t\t\t\tif (checked === true) checkedItems.push(ci);\r\n\t\t\t\telse uncheckedItems.push(ci);\r\n\t\t\t}\t\t\t\r\n\t\t\treturn <div className=\"\">\r\n\t\t\t\t{uncheckedItems.map((v, index) => this.renderCheckItem(v, checkable))}\r\n\t\t\t\t{\r\n\t\t\t\t\tcheckedItems.length > 0 && <div className=\"border-top pt2\">\r\n\t\t\t\t\t\t<div className=\"px-3 pt-2 small text-muted\">{checkedItems.length}项完成</div>\r\n\t\t\t\t\t\t{checkedItems.map((v, index) => this.renderCheckItem(v, checkable))}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t</div>;\r\n\t\t}));\r\n\t}\r\n\r\n\tprotected renderCheckItem(v:CheckItem, checkable:boolean) {\r\n\t\tlet {key, text, checked} = v;\r\n\t\tlet cn = 'form-control-plaintext ml-3 ';\r\n\t\tlet content: any;\r\n\t\tif (checked === true) {\r\n\t\t\tcn += 'text-muted';\r\n\t\t\tcontent = <del>{text}</del>;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tcontent = text;\r\n\t\t}\r\n\t\treturn <div key={key} className=\"d-flex mx-3 my-0 align-items-center form-group form-check\">\r\n\t\t\t<input className=\"form-check-input mr-3 mt-0\" type=\"checkbox\"\r\n\t\t\t\tdefaultChecked={checked}\r\n\t\t\t\tdata-key={key}\r\n\t\t\t\tdisabled={!checkable} />\r\n\t\t\t<div className={cn}>{content}</div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprotected renderContact = (userId:number, assigned:string) => {\r\n\t\tlet renderUser = (user:User) => {\r\n\t\t\tlet {name, nick, icon} = user;\r\n\t\t\treturn <>\r\n\t\t\t\t<Image className=\"w-1-5c h-1-5c mr-2\" src={icon} />\r\n\t\t\t\t{name} {nick} {assigned}\r\n\t\t\t</>\r\n\t\t}\r\n\t\treturn <UserView user={userId as number} render={renderUser} />;\r\n\t}\r\n\r\n\tprotected renderFrom = (className?:string) => {\r\n\t\tlet {owner, assigned, from} = this.controller.noteItem;\r\n\t\tlet contact = (from? from : owner) as number;\r\n\t\treturn <div className={classNames('d-flex assign-items-center small text-muted', className)}>\r\n\t\t\t来自：{this.renderSmallContact(contact, assigned)}\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate renderSmallContact = (userId:number, assigned:string) => {\r\n\t\tlet renderUser = (user:User) => {\r\n\t\t\tlet {name, nick, icon} = user;\r\n\t\t\treturn <>\r\n\t\t\t\t<Image className=\"w-1c h-1c mr-2\" src={icon} />\r\n\t\t\t\t{name} {nick} {assigned}\r\n\t\t\t</>\r\n\t\t}\r\n\t\treturn <UserView user={userId as number} render={renderUser} />;\r\n\t}\r\n\r\n\tprotected renderTo() {\r\n\t\tlet {to} = this.controller.noteModel;\r\n\t\tif (!to || to.length === 0) return;\r\n\t\treturn <div className=\"px-3 py-2\">\r\n\t\t\t<small className=\"text-muted mr-3\">已分享给: </small>\r\n\t\t\t{to.map(t => {\r\n\t\t\t\tlet {user, assigned} = t;\r\n\t\t\t\treturn <span key={user} className=\"mr-3\">{this.renderContact(user, assigned)}</span>;\r\n\t\t\t})}\r\n\t\t</div>\r\n\t}\r\n\r\n\tprotected renderFlow() {\r\n\t\tlet {flow} = this.controller.noteModel;\r\n\t\tif (!flow || flow.length === 0) return;\r\n\t\treturn <div>flow: {flow.length}</div>\r\n\t}\r\n\r\n\tprivate renderSpawnItem = (item:NoteItem, index:number):JSX.Element => {\r\n\t\tlet {caption, $create, $update, owner, assigned} = item;\r\n\t\tlet divOwner = this.renderContact(owner as number, assigned);\r\n\t\tlet right = <small className=\"text-muted\"><EasyTime date={$update} /></small>;\r\n\t\treturn <div className=\"px-3 py-2 d-block\">\r\n\t\t\t<LMR right={right}>\r\n\t\t\t\t<span className=\"mr-3\">{divOwner}</span>{caption}\r\n\t\t\t</LMR>\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprotected renderSpawn() {\r\n\t\tlet {spawn} = this.controller.noteModel;\r\n\t\tif (!spawn || spawn.length === 0) return;\r\n\t\treturn <div className=\"pb-3\">\r\n\t\t\t<div className=\"px-3 pt-2 pb-1 text-muted small\">派发任务</div>\r\n\t\t\t<List\r\n\t\t\t\titems={spawn} \r\n\t\t\t\titem={{render: this.renderSpawnItem,  className: \"notes\"}} />\r\n\t\t</div>\r\n\t}\r\n\r\n\tprotected renderContain() {\r\n\t\tlet {contain} = this.controller.noteModel;\r\n\t\tif (!contain || contain.length === 0) return;\r\n\t\treturn <div>contain: {contain.length}</div>\r\n\t}\r\n\r\n\tprotected renderRelatives() {\r\n\t\treturn <div>\r\n\t\t\t{this.renderTo()}\r\n\t\t\t{this.renderFlow()}\r\n\t\t\t{this.renderSpawn()}\r\n\t\t\t{this.renderContain()}\r\n\t\t</div>\r\n\t}\r\n\r\n\tprotected showActionEndPage({content, onClick}:{content:any; onClick?:()=>void}) {\r\n\t\tthis.openPage(() => {\r\n\t\t\tonClick = onClick || (()=>this.closePage());\r\n\t\t\tlet {title} = this.controller;\r\n\t\t\treturn <Page header={title} back=\"close\">\r\n\t\t\t\t<div className=\"border bg-white rounded m-5\">\r\n\t\t\t\t\t<div className=\"py-5 text-center\">\r\n\t\t\t\t\t\t{content}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"border-top text-center py-3\">\r\n\t\t\t\t\t\t<button className=\"btn btn-outline-info\" onClick={onClick}>返回</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</Page>;\r\n\t\t});\r\n\t}\r\n}\r\n","import React from 'react';\r\nimport { VNoteBase } from '../item';\r\nimport { EasyTime, FA } from 'tonva';\r\nimport { CNoteItem } from './CNoteItem';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VNoteItem extends VNoteBase<CNoteItem> {\r\n\trender() {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet {owner, caption, $create, $update} = this.controller.noteItem;\r\n\t\t\tlet divChanged:any = undefined;\r\n\t\t\tlet create:Date = $create;\r\n\t\t\tlet update:Date = $update;\r\n\t\t\tif (create && update) {\r\n\t\t\t\tlet time:Date, action:any;\r\n\t\t\t\tif (update.getTime() - create.getTime() > 60*1000) {\r\n\t\t\t\t\taction = <FA name=\"pencil-square-o\" />;\r\n\t\t\t\t\ttime = update;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\ttime = create;\r\n\t\t\t\t}\r\n\t\t\t\tdivChanged = <div className=\"small text-muted\">\r\n\t\t\t\t\t<small>\r\n\t\t\t\t\t\t{action}\r\n\t\t\t\t\t\t<span className=\"text-info\"><EasyTime date={time} /></span>\r\n\t\t\t\t\t</small>\r\n\t\t\t\t</div>;\r\n\t\t\t}\r\n\t\t\tlet divFrom:any;\r\n\t\t\tif (this.isMe(owner) === false) {\r\n\t\t\t\tdivFrom = this.renderFrom();\r\n\t\t\t}\r\n\t\t\treturn <div className=\"d-block\">\r\n\t\t\t\t{caption && <div className=\"px-3 py-2\"><b>{caption}</b></div>}\r\n\t\t\t\t<div>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.controller.checkable===false? \r\n\t\t\t\t\t\t<div className=\"my-2\">{this.renderContent()}</div>\r\n\t\t\t\t\t\t: this.renderCheckItems(this.controller.checkable)\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t\t{\r\n\t\t\t\t\t(divFrom || divChanged) && <div className=\"d-flex align-items-center px-3 py-1\">\r\n\t\t\t\t\t\t{divFrom}\r\n\t\t\t\t\t\t<div className=\"mr-auto\" />\r\n\t\t\t\t\t\t{divChanged}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t</div>;\r\n\t\t}));\r\n\t}\r\n}\r\n","import React from 'react';\r\nimport { observable } from \"mobx\";\r\nimport { NoteItem, NoteModel, replaceAll } from '../model';\r\nimport { CNote } from '../CNote';\r\nimport { CUqSub } from '../../tapp';\r\nimport { VNoteItem } from './VNoteItem';\r\n\r\nexport interface CheckItem {\r\n\tkey: number;\r\n\ttext: string;\r\n\tchecked: boolean;\r\n}\r\n\r\nexport abstract class CNoteItem extends CUqSub<CNote> {\r\n\tnoteModel: NoteModel;\r\n\t@observable noteItem: NoteItem;\r\n\t\r\n\tinit(param: NoteItem):void {\r\n\t\tthis.noteItem = param;\r\n\t\tif (!param) return;\r\n\t\tthis.title = param.caption;\r\n\t\tlet {obj} = param;\r\n\t\tif (obj) {\r\n\t\t\tthis.checkable = obj.check;\r\n\t\t\tif (this.checkable === true) {\r\n\t\t\t\tthis.items.splice(0, this.items.length);\r\n\t\t\t\tthis.itemKey = obj.itemKey;\r\n\t\t\t\tthis.items.push(...obj.items);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.noteContent = obj.content;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t@observable title: string;\r\n\t@observable noteContent: string;\r\n\t@observable checkable: boolean = false;\r\n\t@observable items: CheckItem[] = [];\r\n\t@observable changedNoteContent: string;\r\n\titemKey:number = 1;\r\n\r\n\tprotected async internalStart() {}\r\n\r\n\trenderItem(index:number): JSX.Element {\r\n\t\tlet vNoteItem = new VNoteItem(this);\r\n\t\treturn vNoteItem.render();\r\n\t}\r\n\r\n\tabstract onClickItem(noteModel: NoteModel): void;\r\n\r\n\tprivate stringifyContent() {\r\n\t\tlet ret = JSON.stringify(this.buildObj());\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate buildObj():any {\r\n\t\tlet obj = this.noteItem?{...this.noteItem.obj}:{};\r\n\t\tif (this.checkable) {\r\n\t\t\tobj.check = true;\r\n\t\t\tobj.itemKey = this.itemKey;\r\n\t\t\tobj.items = this.items;\r\n\t\t\tdelete obj.content;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tobj.check = false;\r\n\t\t\tobj.content = this.changedNoteContent || this.noteContent;\r\n\t\t\tdelete obj.itemKey;\r\n\t\t\tdelete obj.items;\r\n\t\t}\r\n\t\treturn obj;\r\n\t}\r\n\r\n\tparseContent(content:string):any {\r\n\t\ttry {\r\n\t\t\tif (!content) return undefined;\r\n\t\t\treturn JSON.parse(content);\r\n\t\t}\r\n\t\tcatch (err) {\r\n\t\t\tconsole.error(err);\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t}\r\n\t\r\n\t/*\r\n\tprivate static replaceAll(str:string, findStr:string, repStr:string):string {\r\n\t\tif (!str) return str;\r\n\t\treturn str.split(findStr).join(repStr);\r\n\t}\r\n\t*/\r\n\r\n\tprotected renderNoteContent(content:string):JSX.Element {\r\n\t\treturn <>{(content as string).split('\\n').map((v, index) => {\r\n\t\t\treturn <div key={index}>{v}</div>;\r\n\t\t})}</>;\r\n\t}\r\n\r\n\tshowTo() {\r\n\t\tthis.owner.showTo(this.noteItem);\r\n\t}\r\n\r\n\tonCheckableChanged(checkable:boolean) {\r\n\t\tthis.checkable = checkable;\r\n\t\tif (this.checkable === true) {\r\n\t\t\tlet content = this.changedNoteContent || this.noteContent;\r\n\t\t\tif (content) {\r\n\t\t\t\tthis.items.splice(0, this.items.length);\r\n\t\t\t\tthis.items.push(...content.split('\\n').map((v, index) => {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tkey: this.itemKey++,\r\n\t\t\t\t\t\ttext: v,\r\n\t\t\t\t\t\tchecked: false\r\n\t\t\t\t\t}\r\n\t\t\t\t}));\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.noteContent = this.items.map(v => v.text).join('\\n');\r\n\t\t}\r\n\t\tthis.changedNoteContent = undefined;\r\n\t}\r\n\r\n\tasync onCheckChange(key:number, checked:boolean) {\r\n\t\tlet item = this.items.find(v => v.key === key);\r\n\t\tif (item) item.checked = checked;\r\n\t\tawait this.SetNote(false);\r\n\t}\r\n\r\n\tasync SetNote(waiting:boolean) {\r\n\t\tlet noteContent = this.stringifyContent();\r\n\t\tawait this.owner.setNote(waiting,\r\n\t\t\tthis.noteItem,\r\n\t\t\tthis.title, \r\n\t\t\tnoteContent,\r\n\t\t\tthis.buildObj());\r\n\t\tthis.updateChange();\r\n\t}\r\n\r\n\tprivate updateChange() {\r\n\t\tif (this.changedNoteContent) {\r\n\t\t\tthis.noteContent = this.changedNoteContent;\r\n\t\t\tthis.changedNoteContent = undefined;\r\n\t\t}\r\n\t\tif (this.title && this.title !== this.noteItem.caption) {\r\n\t\t\tthis.noteItem.caption = this.title;\r\n\t\t}\r\n\t}\r\n\r\n\tasync AddNote() {\r\n\t\tlet noteContent = this.stringifyContent();\r\n\t\tawait this.owner.addNote(this.title, noteContent, this.buildObj());\r\n\t\tthis.updateChange();\r\n\t}\r\n}\r\n","import React from 'react';\r\nimport { computed, observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport { VNoteBase, CheckItem } from '.';\r\nimport { FA, ConfirmOptions } from 'tonva';\r\nimport { CNoteItem } from './CNoteItem';\r\nimport { notesName } from '../../note';\r\n\r\nexport abstract class VNoteForm<T extends CNoteItem> extends VNoteBase<T> {\r\n\t@observable private changed: boolean = false;\r\n\tprivate inputAdd: HTMLInputElement;\r\n\r\n\theader() {return notesName}\r\n\r\n\tprotected onTitleChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tthis.controller.title = evt.target.value.trim();\r\n\t}\r\n\r\n\tprotected onContentChange = (evt:React.ChangeEvent<HTMLTextAreaElement>) => {\r\n\t\tthis.controller.changedNoteContent = evt.target.value;\r\n\t}\r\n\r\n\t@computed protected get btnSaveDisabled():boolean {\r\n\t\tif (this.changed === true) return false;\r\n\t\treturn this.getSaveDisabled();\r\n\t}\r\n\r\n\tprotected abstract getSaveDisabled():boolean;\r\n\r\n\tprotected abstract onButtonSave(): Promise<void>;\r\n\r\n\tprotected async onDelete(): Promise<void> {\r\n\t\tlet options: ConfirmOptions = {\r\n\t\t\tcaption: '请确认',\r\n\t\t\tmessage: '真的要删除这个小单吗？',\r\n\t\t\tyes: '确认删除',\r\n\t\t\tno: '不删除'\r\n\t\t};\r\n\t\tif (await this.controller.confirm(options) === 'yes') {\r\n\t\t\tawait this.controller.owner.hideNote(this.controller.noteItem.note, 1);\r\n\t\t\tthis.closePage(2);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate onCheckableChanged = (evt:React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tthis.changed = true;\r\n\t\tthis.controller.onCheckableChanged(evt.target.checked);\r\n\t}\r\n\r\n\tprotected renderEdit() {\r\n\t\treturn <div className=\"m-2\">\r\n\t\t\t<div className=\"border rounded\">\r\n\t\t\t\t<div className=\"bg-white\">\r\n\t\t\t\t\t<div className=\"py-1 px-1 border-bottom\">\r\n\t\t\t\t\t\t<input type=\"text\" className=\"w-100 border-0 form-control\" placeholder=\"标题\" maxLength={80}\r\n\t\t\t\t\t\t\tonChange={this.onTitleChange}\r\n\t\t\t\t\t\t\tdefaultValue={this.controller.title} />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"py-1 px-1\">\r\n\t\t\t\t\t\t{React.createElement(observer(() => this.controller.checkable===false? \r\n\t\t\t\t\t\t\tthis.renderContentTextArea()\r\n\t\t\t\t\t\t\t: this.renderContentList()))}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"py-2 px-3 bg-light border-top d-flex\">\r\n\t\t\t\t\t<div className=\"mr-auto\" />\r\n\t\t\t\t\t{React.createElement(observer(() => <button onClick={() => this.onButtonSave()}\r\n\t\t\t\t\t\tclassName=\"btn btn-primary mr-3\" disabled={this.btnSaveDisabled}>\r\n\t\t\t\t\t\t保存\r\n\t\t\t\t\t</button>))}\r\n\t\t\t\t\t<button className=\"btn btn-outline-secondary\" onClick={() => this.onDelete()}>\r\n\t\t\t\t\t\t删除\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"m-2 form-group form-check\">\r\n\t\t\t\t<label>\r\n\t\t\t\t\t<input type=\"checkbox\" className=\"form-check-input\" \r\n\t\t\t\t\t\tonChange={this.onCheckableChanged}\r\n\t\t\t\t\t\tdefaultChecked={this.controller.checkable} /> 勾选条目\r\n\t\t\t\t</label>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate renderContentTextArea() {\r\n\t\treturn <textarea rows={10} \r\n\t\t\tclassName=\"w-100 border-0 form-control\" \r\n\t\t\tplaceholder={notesName} maxLength={20000}\r\n\t\t\tdefaultValue={this.controller.noteContent}\r\n\t\t\tonChange={this.onContentChange} />;\r\n\t}\r\n\r\n\tprivate renderContentList() {\r\n\t\tlet uncheckedItems:CheckItem[] = [];\r\n\t\tlet checkedItems:CheckItem[] = [];\r\n\t\tfor (let ci of this.controller.items) {\r\n\t\t\tlet {checked} = ci;\r\n\t\t\tif (checked === true) checkedItems.push(ci);\r\n\t\t\telse uncheckedItems.push(ci);\r\n\t\t}\r\n\t\treturn <div className=\"\">\r\n\t\t\t{\r\n\t\t\t\tuncheckedItems.map((v, index) => {\r\n\t\t\t\t\tlet {key, text, checked} = v;\r\n\t\t\t\t\treturn <div key={key} className=\"d-flex mx-3 my-2 align-items-center form-group form-check\">\r\n\t\t\t\t\t\t<input className=\"form-check-input mr-3 mt-0\" type=\"checkbox\"\r\n\t\t\t\t\t\t\tdefaultChecked={checked}\r\n\t\t\t\t\t\t\tonChange={this.onCheckChange}\r\n\t\t\t\t\t\t\tdata-key={key} />\r\n\t\t\t\t\t\t<input className=\"flex-fill form-control border-0\"\r\n\t\t\t\t\t\t\ttype=\"text\" defaultValue={text}\r\n\t\t\t\t\t\t\tonChange={this.onItemChange}\r\n\t\t\t\t\t\t\tonKeyDown={this.onItemKeyDown}\r\n\t\t\t\t\t\t\tdata-key={key} />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\t<div className=\"d-flex mx-3 my-2 align-items-center\">\r\n\t\t\t\t<FA name=\"plus\" className=\"text-info mr-2\" />\r\n\t\t\t\t<input ref={t => this.inputAdd = t} className=\"flex-fill form-control\" type=\"text\" placeholder=\"新增\" onKeyDown={this.onAddEnter} />\r\n\t\t\t</div>\r\n\t\t\t{\r\n\t\t\t\tcheckedItems.length > 0 && <div className=\"border-top mt-2 pt2\">\r\n\t\t\t\t\t<div className=\"px-3 pt-2 small text-muted\">{checkedItems.length}项完成</div>\r\n\t\t\t\t\t{checkedItems.map((v, index) => {\r\n\t\t\t\t\t\tlet {key, text, checked} = v;\r\n\t\t\t\t\t\treturn <div key={key} className=\"d-flex mx-3 my-2 align-items-center form-group form-check\">\r\n\t\t\t\t\t\t\t<input className=\"form-check-input mr-3 mt-0\" type=\"checkbox\" \r\n\t\t\t\t\t\t\t\tdefaultChecked={checked} \r\n\t\t\t\t\t\t\t\tonChange={this.onCheckChange} \r\n\t\t\t\t\t\t\t\tdata-key={key} />\r\n\t\t\t\t\t\t\t<div className=\"text-muted form-control-plaintext ml-3\"><del>{text}</del></div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t})}\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate onAddEnter = (evt:React.KeyboardEvent<HTMLInputElement>) => {\r\n\t\tif (evt.keyCode === 13) {\r\n\t\t\tlet {value} = evt.currentTarget;\r\n\t\t\tif (value.trim().length === 0) return;\r\n\t\t\tthis.controller.items.push({\r\n\t\t\t\tkey: this.controller.itemKey++,\r\n\t\t\t\ttext: value,\r\n\t\t\t\tchecked: false,\r\n\t\t\t});\r\n\t\t\tevt.currentTarget.value = '';\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate onCheckChange = (evt:React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tlet t = evt.currentTarget;\r\n\t\tlet key = Number(t.getAttribute('data-key'));\r\n\t\tlet item = this.controller.items.find(v => v.key === key);\r\n\t\tif (item) item.checked = t.checked;\r\n\t}\r\n\r\n\tprivate onItemChange = (evt:React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tlet t = evt.currentTarget;\r\n\t\tlet key = Number(t.getAttribute('data-key'));\r\n\t\tlet item = this.controller.items.find(v => v.key === key);\r\n\t\tif (item) item.text = t.value;\r\n\t\tthis.changed = true;\r\n\t}\r\n\r\n\tprivate onItemKeyDown = (evt:React.KeyboardEvent<HTMLInputElement>) => {\r\n\t\tif (evt.keyCode === 13) {\r\n\t\t\tif (this.inputAdd) this.inputAdd.focus();\r\n\t\t}\r\n\t}\r\n}\r\n","import { tv } from \"tonva\";\r\nimport { VNoteForm } from '../item/VNoteForm';\r\nimport { CTextNoteItem } from \"./CTextNoteItem\";\r\n\r\nexport class VEdit extends VNoteForm<CTextNoteItem> {\r\n\tprotected get back(): 'close' | 'back' | 'none' {return 'close'}\r\n\tcontent() {\r\n\t\treturn this.renderEdit();\r\n\t}\r\n\r\n\tprotected getSaveDisabled():boolean {\r\n\t\treturn (this.controller.title === undefined && this.controller.changedNoteContent === undefined);\r\n\t}\r\n\r\n\tprotected async onButtonSave(): Promise<void> {\r\n\t\tawait this.controller.SetNote(true);\r\n\t\tthis.closePage();\r\n\t}\r\n}\r\n","import React from 'react';\r\nimport { tv, FA } from \"tonva\";\r\nimport { VEdit } from './VEdit';\r\nimport { observer } from 'mobx-react';\r\nimport { VNoteBase, CheckItem } from '../item';\r\nimport { CTextNoteItem } from './CTextNoteItem';\r\nimport { notesName } from '../../note';\r\n\r\nexport class VView extends VNoteBase<CTextNoteItem> {\r\n\tprotected get back(): 'close' | 'back' | 'none' {return 'close'}\r\n\theader() {return notesName}\r\n\tcontent() {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet {title, checkable} = this.controller;\r\n\t\t\treturn <div className=\"my-2 mx-1 border rounded\">\r\n\t\t\t\t<div className=\"bg-white\">\r\n\t\t\t\t\t{title && <div className=\"px-3 py-2 border-bottom\">\r\n\t\t\t\t\t\t<div><b>{title}</b></div>\r\n\t\t\t\t\t</div>}\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcheckable===false? \r\n\t\t\t\t\t\t<div className=\"py-3\">{this.renderContent()}</div>\r\n\t\t\t\t\t\t: this.renderCheckItems()\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t\t{this.renderBottomCommands()}\r\n\t\t\t\t{this.renderRelatives()}\r\n\t\t\t</div>;\r\n\t\t}));\r\n\t}\r\n\r\n\tprotected renderBottomCommands() {\r\n\t\tlet {owner} = this.controller.noteItem;\r\n\t\tlet left:any, right:any;\r\n\t\tlet isMe = this.isMe(owner);\r\n\t\tif (isMe === true) {\r\n\t\t\tleft = undefined;\r\n\t\t\tright = <>\r\n\t\t\t\t<button onClick={this.onSendNote}\r\n\t\t\t\t\tclassName=\"btn btn-outline-primary ml-3\">\r\n\t\t\t\t\t发给\r\n\t\t\t\t</button>\r\n\t\t\t\t<div onClick={this.onEdit} className=\"px-3 py-2 cursor-pointer text-primary ml-3\">\r\n\t\t\t\t\t<FA name=\"pencil-square-o\" />\r\n\t\t\t\t</div>\r\n\t\t\t</>;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tleft = this.renderFrom('px-2');\r\n\t\t\tright = undefined;\r\n\t\t}\r\n\t\treturn <div className=\"py-2 px-3 bg-light border-top d-flex\">\r\n\t\t\t{left}\r\n\t\t\t<div className=\"mr-auto\" />\r\n\t\t\t{right}\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate onEdit = () => {\r\n\t\tthis.openVPage(VEdit);\r\n\t}\r\n\r\n\tprivate onSendNote = async () => {\r\n\t\tawait this.controller.cApp.loadRelation();\r\n\t\tthis.controller.showTo();\r\n\t}\r\n\r\n\tprotected renderCheckItem(v:CheckItem, checkable:boolean) {\r\n\t\tlet {key, text, checked} = v;\r\n\t\tlet cn = 'form-control-plaintext ml-3 ';\r\n\t\tlet content: any;\r\n\t\tif (checked === true) {\r\n\t\t\tcn += 'text-muted';\r\n\t\t\tcontent = <del>{text}</del>;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tcontent = text;\r\n\t\t}\r\n\t\treturn <label key={key} className=\"d-flex mx-3 my-0 align-items-center form-group form-check\">\r\n\t\t\t<input className=\"form-check-input mr-3 mt-0\" type=\"checkbox\"\r\n\t\t\t\tdefaultChecked={checked}\r\n\t\t\t\tonChange={this.onCheckChange}\r\n\t\t\t\tdata-key={key}\r\n\t\t\t\tdisabled={!checkable} />\r\n\t\t\t<div className={cn}>{content}</div>\r\n\t\t</label>;\r\n\t}\r\n\r\n\tprotected renderCheckItems() {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet uncheckedItems:CheckItem[] = [];\r\n\t\t\tlet checkedItems:CheckItem[] = [];\r\n\t\t\tfor (let ci of this.controller.items) {\r\n\t\t\t\tlet {checked} = ci;\r\n\t\t\t\tif (checked === true) checkedItems.push(ci);\r\n\t\t\t\telse uncheckedItems.push(ci);\r\n\t\t\t}\t\t\t\r\n\t\t\treturn <div className=\"\">\r\n\t\t\t\t{uncheckedItems.map((v, index) => this.renderCheckItem(v, true))}\r\n\t\t\t\t{\r\n\t\t\t\t\tcheckedItems.length > 0 && <div className=\"border-top mt-2 pt2\">\r\n\t\t\t\t\t\t<div className=\"px-3 pt-2 small text-muted\">{checkedItems.length}项完成</div>\r\n\t\t\t\t\t\t{checkedItems.map((v, index) => this.renderCheckItem(v, true))}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t</div>;\r\n\t\t}));\r\n\t}\r\n\r\n\tprivate onCheckChange = async (evt:React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tlet t = evt.currentTarget;\r\n\t\tlet key = Number(t.getAttribute('data-key'));\r\n\t\tawait this.controller.onCheckChange(key, t.checked);\r\n\t}\r\n}\r\n","import { VNoteForm } from '../item/VNoteForm';\r\nimport { CTextNoteItem } from './CTextNoteItem';\r\n\r\nexport class VAdd extends VNoteForm<CTextNoteItem> {\r\n\tprotected get back(): 'close' | 'back' | 'none' {return 'close'}\r\n\tcontent() {\r\n\t\treturn this.renderEdit();\r\n\t}\r\n\r\n\tprotected getSaveDisabled():boolean {\r\n\t\tif (this.controller.title !== undefined) {\r\n\t\t\treturn this.controller.title.length === 0;\r\n\t\t}\r\n\t\tif (this.controller.changedNoteContent !== undefined) {\r\n\t\t\treturn this.controller.changedNoteContent.length === 0;\r\n\t\t}\r\n\t\treturn true;\r\n    }\r\n\r\n\tprotected async onButtonSave(): Promise<void> {\r\n\t\tawait this.controller.AddNote();\r\n\t\tthis.closePage();\r\n\t\treturn;\r\n\t}\r\n}\r\n","import { CNoteItem } from \"../item\";\r\nimport { NoteItem, NoteModel } from '../model';\r\nimport { VView } from './VView';\r\nimport { VAdd } from './VAdd';\r\n//import { VTextNoteItem } from './VTextNoteItem';\r\n\r\nexport class CTextNoteItem extends CNoteItem {\r\n\tinit(param: NoteItem):void {\r\n\t\tsuper.init(param);\r\n\t\tif (param) {\r\n\t\t\tif (!this.title) this.title = param.caption;\r\n\t\t}\r\n\t}\r\n\r\n\t// renderItem(index:number): JSX.Element {\r\n\t// \tlet vNoteItem = new VTextNoteItem(this);\r\n\t// \treturn vNoteItem.render();\r\n\t// }\r\n\r\n\tonClickItem(noteModel: NoteModel) {\r\n\t\tthis.openVPage(VView);\r\n\t}\r\n\r\n\tshowAddNotePage() {\r\n\t\tthis.openVPage(VAdd);\r\n\t}\r\n}\r\n","import React from 'react';\r\nimport { VBasePage } from \"./VBasePage\";\r\nimport { LMR, FA } from 'tonva';\r\n\r\nexport class VActions extends VBasePage {\r\n\theader() {return '操作'}\r\n\tcontent() {\r\n\t\tlet cn = 'px-3 py-2 cursor-pointer bg-white mt-1';\r\n\t\treturn <div className=\"\">\r\n\t\t\t<div className=\"text-muted small px-3 py-1 mt-2\">收件人</div>\r\n\t\t\t<div className=\"border rounded p-3 mb-3\">\r\n\t\t\t\t{this.controller.contacts.map(c => {\r\n\t\t\t\t\tlet {contact, assigned} = c;\r\n\t\t\t\t\treturn <span className=\"mr-3\">{this.renderContact(contact, assigned)}</span>;\r\n\t\t\t\t})}\r\n\t\t\t</div>\r\n\t\t\t<div className={cn} onClick={this.onSend}>\r\n\t\t\t\t分享内容\r\n\t\t\t</div>\r\n\t\t\t<div className={cn} onClick={this.onAssign}>\r\n\t\t\t\t<LMR right={<FA name=\"angle-right\" />}>\r\n\t\t\t\t\t分派任务\r\n\t\t\t\t</LMR>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate onSend = async () => {\r\n\t\tlet {contacts, noteItem} = this.controller;\r\n\t\tlet toList = contacts.map (v => {\r\n\t\t\tlet {contact} = v;\r\n\t\t\tif (!contact) return undefined;\r\n\t\t\tif (typeof contact === 'object') return (contact as any).id;\r\n\t\t\treturn contact;\r\n\t\t});\r\n\t\tawait this.controller.sendNoteTo(noteItem.note, toList);\r\n\t\tthis.closePage(3);\r\n\t\tthis.controller.showSentPage();\r\n\t}\r\n\r\n\tprivate onAssign = () => {\r\n\t\tthis.closePage();\r\n\t\tthis.controller.showAssignTaskPage();\r\n\t}\r\n}\r\n","import React from 'react';\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport { VBasePage } from './VBasePage';\r\nimport { List, User, Image, UserView, FA } from 'tonva';\r\nimport { Contact } from 'model';\r\nimport { VActions } from './VActions';\r\n\r\nexport class VTo extends VBasePage {\r\n\t@observable private anySelected:boolean = false;\r\n\tprivate list: List;\r\n\r\n\tprotected get back(): 'close' | 'back' | 'none' {return 'close'}\r\n\r\n\theader() {return '收件人'}\r\n\tright() {\r\n\t\tlet c = observer(() => <button className=\"btn btn-sm btn-primary mr-1\" onClick={this.onNext} disabled={!this.anySelected}>\r\n\t\t\t下一步 <FA name=\"angle-right\" />\r\n\t\t</button>);\r\n\t\treturn React.createElement(c);\r\n\t}\r\n\tcontent() {\r\n\t\treturn <div className=\"\">\r\n\t\t\t<List ref={v => this.list = v}\r\n\t\t\t\titems={this.controller.cApp.contacts} \r\n\t\t\t\titem={{render:this.renderContactItem, onSelect:this.onContactSelect}} />\r\n\t\t</div>\r\n\t}\r\n/*\r\n\tprivate renderContact = (item:Contact, index:number) => {\r\n\t\tlet {contact, assigned} = item;\r\n\t\tlet renderUser = (user:User) => {\r\n\t\t\tlet {name, nick, icon} = user;\r\n\t\t\treturn <div className=\"px-3 py-2\">\r\n\t\t\t\t<Image className=\"w-2c h-2c mr-3\" src={icon} />\r\n\t\t\t\t{name} {nick} {assigned}\r\n\t\t\t</div>\r\n\t\t}\r\n\t\treturn <UserView user={contact} render={renderUser} />;\r\n\t}\r\n*/\r\n\tprivate onContactSelect = (item:Contact, isSelected:boolean, anySelected:boolean):void => {\r\n\t\tthis.anySelected = anySelected;\r\n\t}\r\n\r\n\tprivate onNext = () => {\r\n\t\tlet contacts = this.list.selectedItems;\r\n\t\tthis.controller.contacts = contacts;\r\n\t\tthis.openVPage(VActions); //, {contacts, noteId: this.currentNoteId});\r\n\t}\r\n}\r\n","import React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\nimport { VPage, FA, UserView, Image, User } from \"tonva\";\r\nimport { CTaskNoteItem } from \"./CTaskNoteItem\";\r\nimport { Contact } from 'model';\r\nimport { SelectContactOptions } from 'note/views';\r\n\r\ninterface Param {\r\n\tlabel: string;\r\n\tvalues?: any;\r\n\tonClick?: () => void;\r\n}\r\n\r\nconst none = <small className=\"text-muted\">[无]</small>;\r\n\r\nexport class VTaskParams extends VPage<CTaskNoteItem> {\r\n\t@observable contacts: Contact[];\r\n\t@observable checker: Contact;\r\n\t@observable rater: Contact;\r\n\r\n\tprivate point:number = 100;\r\n\r\n\tinit(param:{contacts:Contact[]}) {\r\n\t\tlet {contacts} = param;\r\n\t\tthis.contacts = contacts;\r\n\t}\r\n\r\n\theader() {return '分派任务'}\r\n\tget back(): 'close'|'back'|'none' {return 'close';}\r\n\r\n\tprivate renderParam(param: Param) {\r\n\t\tlet {label, values, onClick} = param;\r\n\t\treturn <div key={label} className=\"px-3 py-2 bg-white d-flex cursor-pointer align-items-center border-bottom\" onClick={onClick}>\r\n\t\t\t<div className=\"text-muted mr-3 w-5c\">{label}</div>\r\n\t\t\t<div className=\"flex-fill mr-3 \">{values || none}</div>\r\n\t\t\t<FA className=\"ml-auto\" name=\"angle-right\" />\r\n\t\t</div>\r\n\t}\r\n\r\n\tcontent() {\r\n\t\tlet rows: Param[] = [\r\n\t\t\t{label: '执行人', values: this.renderContacts(), onClick: this.onClickContacts}, \r\n\t\t\t{label: '分值', values: this.renderPoint()}, \r\n\t\t\t{label: '检查人', values: this.renderChecker(), onClick: this.onClickChecker}, \r\n\t\t\t{label: '评价人', values: this.renderRater(), onClick: this.onClickRater}, \r\n\t\t];\r\n\t\tlet {owner} = this.controller;\r\n\t\treturn <div className=\"py-2\">\r\n\t\t\t{this.controller.renderBaseItem(0)}\r\n\t\t\t{rows.map(v => this.renderParam(v))}\r\n\t\t\t<div className=\"px-3 py-2\"><button className=\"btn btn-primary\" onClick={this.onSendTask}>发送</button></div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate onSendTask = async () => {\r\n\t\tawait this.controller.assignTask({\r\n\t\t\tcontacts: this.contacts,\r\n\t\t\tchecker: this.checker,\r\n\t\t\trater: this.rater,\r\n\t\t\tpoint: this.point,\r\n\t\t});\r\n\t\tthis.closePage(2);\r\n\t\tthis.controller.owner.showSentPage();\r\n\t}\r\n\r\n\tprivate renderContact = (item:Contact, index?:number) => {\r\n\t\tif (!item) return none;\r\n\t\tlet {contact, assigned} = item;\r\n\t\tlet renderUser = (user:User) => {\r\n\t\t\tlet {name, nick, icon} = user;\r\n\t\t\treturn <>\r\n\t\t\t\t<Image className=\"w-1c h-1c mr-1\" src={icon} />\r\n\t\t\t\t<span className=\"mr-3\">{name} {nick} {assigned}</span>\r\n\t\t\t</>;\r\n\t\t}\r\n\t\treturn <UserView user={contact} render={renderUser} />;\r\n\t}\r\n\r\n\tprivate renderContacts() {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet contacts = this.contacts;\r\n\t\t\tif (!contacts || contacts.length === 0) return <small className=\"text-muted\">请选择</small>;\r\n\t\t\treturn <>{contacts.map((v, index) => {\r\n\t\t\t\treturn <React.Fragment key={index}>{this.renderContact(v, index)}</React.Fragment>;\r\n\t\t\t})}</>;\t\r\n\t\t}));\r\n\t}\r\n\r\n\tprivate onClickContacts = async () => {\r\n\t\tlet options: SelectContactOptions = undefined; // {title: 'a', action: 'b', single: true};\r\n\t\tlet contacts = await this.controller.owner.callSelectContact(options);\r\n\t\tthis.closePage();\r\n\t\tthis.contacts = contacts;\r\n\t}\r\n\r\n\tprivate renderPoint() {\r\n\t\treturn <input className=\"flex-fill form-control border-0\"\r\n\t\t\t\ttype=\"number\" step=\"1\" min=\"1\" defaultValue={this.point}\r\n\t\t\t\tonChange={this.onItemChange}\r\n\t\t\t\tonKeyDown={this.onItemKeyDown}/>;\r\n\t}\r\n\r\n\tprivate onItemChange = (evt:React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tthis.point = Number(evt.currentTarget.value);\r\n\t}\r\n\r\n\tprivate onItemKeyDown = (evt:React.KeyboardEvent<HTMLInputElement>) => {\r\n\t}\r\n\r\n\r\n\tprivate renderChecker() {\r\n\t\treturn React.createElement(observer(() => this.renderContact(this.checker)));\r\n\t}\r\n\r\n\tprivate onClickChecker = async () => {\r\n\t\tlet options: SelectContactOptions = {title: '检查人', single: true};\r\n\t\tlet contacts = await this.controller.owner.callSelectContact(options);\r\n\t\tthis.closePage();\r\n\t\tthis.checker = contacts[0];\r\n\r\n\t}\r\n\r\n\tprivate renderRater() {\r\n\t\treturn React.createElement(observer(() => this.renderContact(this.rater)));\r\n\t}\r\n\r\n\tprivate onClickRater = async () => {\r\n\t\tlet options: SelectContactOptions = {title: '评价人', single: true};\r\n\t\tlet contacts = await this.controller.owner.callSelectContact(options);\r\n\t\tthis.closePage();\r\n\t\tthis.rater = contacts[0];\r\n\t}\r\n}\r\n","import { tv } from \"tonva\";\r\nimport { VNoteForm } from '../item/VNoteForm';\r\nimport { CTaskNoteItem } from \"./CTaskNoteItem\";\r\n\r\nexport class VEdit extends VNoteForm<CTaskNoteItem> {\r\n\tprotected get back(): 'close' | 'back' | 'none' {return 'close'}\r\n\tcontent() {\r\n\t\treturn this.renderEdit();\r\n\t}\r\n\r\n\tprotected getSaveDisabled():boolean {\r\n\t\treturn (this.controller.title === undefined && this.controller.changedNoteContent === undefined);\r\n\t}\r\n\r\n\tprotected async onButtonSave(): Promise<void> {\r\n\t\tawait this.controller.SetNote(true);\r\n\t\tthis.closePage();\r\n\t}\r\n}\r\n","import React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { FA, EasyTime } from \"tonva\";\r\nimport { CTaskNoteItem, EnumTaskState } from \"../CTaskNoteItem\";\r\nimport { VNoteBase, CheckItem } from '../../item';\r\nimport { VEdit } from '../VEdit';\r\n\r\nexport abstract class VTaskView extends VNoteBase<CTaskNoteItem> {\r\n\tprotected get back(): 'close' | 'back' | 'none' {return 'close'}\r\n\theader() {return '任务'}\r\n\tprotected get allowCheck() {return true;}\r\n\tcontent()  {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet {title} = this.controller;\r\n\t\t\tlet allowCheck = this.allowCheck;\r\n\t\t\tlet divCaption = this.renderCaption(title);\r\n\t\t\treturn <div className=\"my-2 mx-1 border rounded\">\r\n\t\t\t\t<div className=\"bg-white\">\r\n\t\t\t\t\t<div className=\"px-3 py-2 border-bottom\">\r\n\t\t\t\t\t\t{divCaption}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.controller.checkable===false? \r\n\t\t\t\t\t\t<div className=\"py-3\">{this.renderContent()}</div>\r\n\t\t\t\t\t\t: this.renderCheckItems(allowCheck)\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t\t{this.renderBottomCommands()}\r\n\t\t\t\t{this.renderRelatives()}\r\n\t\t\t</div>;\r\n\t\t}));\r\n\t}\r\n\r\n\tprotected onEdit = () => {\r\n\t\tthis.openVPage(VEdit);\r\n\t}\r\n\r\n\tprivate renderCaption(title:string) {\r\n\t\tlet divCaption = title? <b className=\"text-primary\">{title}</b> : <span className=\"text-info\">任务</span>;\r\n\t\treturn <>{this.renderState()} &nbsp; {divCaption}</>;\r\n\t}\r\n\r\n\tprotected renderBottomCommands() {\r\n\t\tlet {owner, state} = this.controller.noteItem;\r\n\t\tlet left:any, right:any;\r\n\t\tlet isMe = this.isMe(owner);\r\n\t\tif (isMe === true && state == EnumTaskState.Start) {\r\n\t\t\tright = <>\r\n\t\t\t\t<div onClick={this.onEdit} className=\"px-3 py-2 cursor-pointer text-primary ml-3\">\r\n\t\t\t\t\t<FA name=\"pencil-square-o\" />\r\n\t\t\t\t</div>\r\n\t\t\t</>;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tright = this.renderFrom('px-2');\r\n\t\t}\r\n\t\treturn <div className=\"py-2 bg-light border-top d-flex\">\r\n\t\t\t{left}\r\n\t\t\t<div className=\"mr-auto\" />\r\n\t\t\t{right}\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprotected renderCheckItem(v:CheckItem, allowCheck:boolean) {\r\n\t\tlet {key, text, checked} = v;\r\n\t\tlet cn = 'form-control-plaintext ml-3 ';\r\n\t\tlet content: any;\r\n\t\tif (checked === true) {\r\n\t\t\tcn += 'text-muted';\r\n\t\t\tcontent = <del>{text}</del>;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tcontent = text;\r\n\t\t}\r\n\t\treturn <div key={key} className=\"d-flex mx-3 my-0 align-items-center form-group form-check\">\r\n\t\t\t<input className=\"form-check-input mr-3 mt-0\" type=\"checkbox\"\r\n\t\t\t\tdefaultChecked={checked}\r\n\t\t\t\tonChange={this.onCheckChange}\r\n\t\t\t\tdata-key={key}\r\n\t\t\t\tdisabled={!allowCheck} />\r\n\t\t\t<div className={cn}>{content}</div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprotected renderCheckItems(allowCheck:boolean) {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet uncheckedItems:CheckItem[] = [];\r\n\t\t\tlet checkedItems:CheckItem[] = [];\r\n\t\t\tfor (let ci of this.controller.items) {\r\n\t\t\t\tlet {checked} = ci;\r\n\t\t\t\tif (checked === true) checkedItems.push(ci);\r\n\t\t\t\telse uncheckedItems.push(ci);\r\n\t\t\t}\t\t\t\r\n\t\t\treturn <div className=\"\">\r\n\t\t\t\t{uncheckedItems.map((v, index) => this.renderCheckItem(v, allowCheck))}\r\n\t\t\t\t{\r\n\t\t\t\t\tcheckedItems.length > 0 && <div className=\"border-top mt-2 pt2\">\r\n\t\t\t\t\t\t<div className=\"px-3 pt-2 small text-muted\">{checkedItems.length}项完成</div>\r\n\t\t\t\t\t\t{checkedItems.map((v, index) => this.renderCheckItem(v, allowCheck))}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t</div>;\r\n\t\t}));\r\n\t}\r\n\r\n\tprivate onCheckChange = async (evt:React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tlet t = evt.currentTarget;\r\n\t\tlet key = Number(t.getAttribute('data-key'));\r\n\t\tawait this.controller.onCheckChange(key, t.checked);\r\n\t}\r\n\r\n\tprotected renderState():JSX.Element {\r\n\t\treturn <>state</>;\r\n\t}\r\n\r\n\tprotected renderStateSpan(content:string, isEnd:boolean = false) {\r\n\t\tif (isEnd === true) {\r\n\t\t\treturn <span className=\"small text-danger\"><FA className=\"small mr-1\" name=\"stop\" />{content}</span>;\r\n\t\t}\r\n\t\treturn <span className=\"small text-success border border-success rounded px-2\">{content}</span>;\r\n\t}\r\n\r\n\trenderListItem() {\r\n\t\tlet {caption, $create, $update} = this.controller.noteItem;\r\n\t\t\tlet divChanged:any = undefined;\r\n\t\t\tlet create:Date = $create;\r\n\t\t\tlet update:Date = $update;\r\n\t\t\tif (create && update) {\r\n\t\t\t\tlet time:Date, action:any;\r\n\t\t\t\tif (update.getTime() - create.getTime() > 60*1000) {\r\n\t\t\t\t\taction = <FA name=\"pencil-square-o\" />;\r\n\t\t\t\t\ttime = update;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\ttime = create;\r\n\t\t\t\t}\r\n\t\t\t\tdivChanged = <div className=\"text-right small text-muted px-3 pb-1\">\r\n\t\t\t\t\t<small>\r\n\t\t\t\t\t\t{action}\r\n\t\t\t\t\t\t<span className=\"text-info\"><EasyTime date={time} /></span>\r\n\t\t\t\t\t</small>\r\n\t\t\t\t</div>;\r\n\t\t\t}\r\n\r\n\t\t\tlet divCaption = this.renderCaption(caption);\r\n\t\t\treturn <div className=\"d-block\">\r\n\t\t\t\t<div className=\"px-3 py-2\">\r\n\t\t\t\t\t{divCaption}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.controller.checkable===false? \r\n\t\t\t\t\t\t<div className=\"py-3\">{this.renderContent()}</div>\r\n\t\t\t\t\t\t: this.renderCheckItems(this.allowCheck)\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t\t{divChanged}\r\n\t\t\t</div>;\r\n\t}\r\n}\r\n\r\nclass VTaskStart extends VTaskView {\r\n\tprotected get allowCheck() {return this.isMe(this.controller.noteItem.owner);}\r\n\r\n\tprotected renderState():JSX.Element {\r\n\t\treturn this.renderStateSpan('待办');\r\n\t}\r\n\r\n\tprotected renderBottomCommands() {\r\n\t\tlet {owner} = this.controller.noteItem;\r\n\t\tlet left:any, right:any;\r\n\t\tlet isMe = this.isMe(owner);\r\n\t\tif (isMe === true) {\r\n\t\t\tleft = <button onClick={this.onDone} className=\"btn btn-primary mx-3\">\r\n\t\t\t\t完成\r\n\t\t\t</button>;\r\n\t\t\tright = <>\r\n\t\t\t\t<div onClick={this.onEdit} className=\"px-3 py-2 cursor-pointer text-primary ml-3\">\r\n\t\t\t\t\t<FA name=\"pencil-square-o\" />\r\n\t\t\t\t</div>\r\n\t\t\t</>;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tright = this.renderFrom('px-2');\r\n\t\t}\r\n\t\treturn <div className=\"py-2 bg-light border-top d-flex\">\r\n\t\t\t{left}\r\n\t\t\t<div className=\"mr-auto\" />\r\n\t\t\t{right}\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate onDone = async () => {\r\n\t\tawait this.controller.DoneTask();\r\n\t\tthis.closePage();\r\n\t\t//this.openPage(this.resultPage);\r\n\r\n\t\t// 这个地方应该要显示，下一步是由谁来做什么。比如谁来验收，或者谁来评价\r\n\t\t// 这些信息应该在nodeModel里面\r\n\t\t// 如果没有后续操作，显示成红色，加一个终止标志 #\r\n\t\t// 如果由后续操作，显示成绿色，并且显示下一步什么操作，由谁来操作\r\n\t\tlet content = <>任务完成</>;\r\n\t\tthis.showActionEndPage({content});\r\n\t}\r\n\t/*\r\n\tprotected resultPage = () => {\r\n\t\tlet {title} = this.controller;\r\n\t\treturn <Page header={title} back=\"close\">\r\n\t\t\t\t完成！\r\n\t\t</Page>;\r\n\t}\r\n\t*/\r\n}\r\n\r\nclass VTaskDone extends VTaskView {\r\n\tprotected get allowCheck() {return false;}\r\n\tprotected renderState() {\r\n\t\tlet {noteItem} = this.controller;\r\n\t\tlet obj = noteItem.obj;\r\n\t\tif (obj) {\r\n\t\t\tlet {checker} = obj;\r\n\t\t\tif (checker) {\r\n\t\t\t\treturn this.renderStateSpan('待验收');\r\n\t\t\t}\r\n\t\t\tlet {rater} = obj;\r\n\t\t\tif (rater) {\r\n\t\t\t\treturn this.renderStateSpan('待评分');\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this.renderStateSpan('已完成', true);\r\n\t}\r\n}\r\n\r\nclass VTaskPass extends VTaskView {\r\n\tprotected get allowCheck() {return false;}\r\n\tprotected renderState() {\r\n\t\tlet {noteItem} = this.controller;\r\n\t\tlet obj = noteItem.obj;\r\n\t\tif (obj) {\r\n\t\t\tlet {rater} = obj;\r\n\t\t\tif (rater) {\r\n\t\t\t\treturn this.renderStateSpan('待评价');\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this.renderStateSpan('已验收', true);\r\n\t}\r\n}\r\n\r\nclass VTaskFail extends VTaskView {\r\n\tprotected get allowCheck() {return false;}\r\n\tprotected renderState() {\r\n\t\treturn this.renderStateSpan('拒签', true);\r\n\t}\r\n}\r\n\r\nclass VTaskRated extends VTaskView {\r\n\tprotected get allowCheck() {return false;}\r\n\tprotected renderState() {\r\n\t\treturn this.renderStateSpan('已评价', true);\r\n\t}\r\n}\r\n\r\nclass VTaskCanceled extends VTaskView {\r\n\tprotected get allowCheck() {return false;}\r\n\tprotected renderState() {\r\n\t\treturn this.renderStateSpan('已取消', true);\r\n\t}\r\n}\r\n\r\nexport class TaskViewFactory {\r\n\tprivate stateViews:{[type in EnumTaskState]: new (controller: CTaskNoteItem)=>VTaskView} = {\r\n\t\t[EnumTaskState.Start]: VTaskStart,\r\n\t\t[EnumTaskState.Done]: VTaskDone,\r\n\t\t[EnumTaskState.Pass]: VTaskPass,\r\n\t\t[EnumTaskState.Fail]: VTaskFail,\r\n\t\t[EnumTaskState.Rated]: VTaskRated,\r\n\t\t[EnumTaskState.Canceled]: VTaskCanceled,\r\n\t}\r\n\r\n\tgetView = (enumTaskState: EnumTaskState) => {\r\n\t\tlet TaskView = this.stateViews[enumTaskState];\r\n\t\tif (!TaskView) {\r\n\t\t\tTaskView = VTaskStart;\r\n\t\t}\r\n\t\treturn TaskView;\r\n\t}\r\n}\r\n","import React from 'react';\r\nimport { VTaskView } from './VTaskView';\r\nimport { Page, FA } from 'tonva';\r\n\r\nexport class VCheckTask extends VTaskView {\r\n\tprotected get allowCheck() {return false;}\r\n\r\n\tprotected renderState():JSX.Element {\r\n\t\treturn this.renderStateSpan('待验收');\r\n\t}\r\n\r\n\tprotected renderBottomCommands() {\r\n\t\tlet {owner, assigned} = this.controller.noteItem;\r\n\t\tlet left:any, right:any;\r\n\t\tleft = <div>\r\n\t\t\t<button onClick={()=>this.onCheck(true)} className=\"btn btn-success mx-3\">\r\n\t\t\t\t<FA name=\"check\" /> 通过\r\n\t\t\t</button>\r\n\t\t\t<button onClick={()=>this.onCheck(false)} className=\"btn btn-outline-secondary mx-3\">\r\n\t\t\t\t<FA name=\"times\" /> 不通过\r\n\t\t\t</button>\r\n\t\t</div>;\r\n\r\n    \tright = this.renderFrom('px-2');\r\n\t\treturn <div className=\"py-2 bg-light border-top d-flex\">\r\n\t\t\t{left}\r\n\t\t\t<div className=\"mr-auto\" />\r\n\t\t\t{right}\r\n\t\t</div>;\r\n\t}\r\n  \r\n\tprivate onCheck = async (pass:boolean) => {\r\n\t\tawait this.controller.CheckTask(pass);\r\n\t\tthis.closePage();\r\n\t\tlet content = pass?\r\n\t\t\t<span className=\"text-success\"><FA name=\"check\" /> 验收通过</span>\r\n\t\t\t:\r\n\t\t\t<span className=\"text-secondary\"><FA name=\"check\" /> 验收不通过</span>\r\n\t\tthis.showActionEndPage({content});\r\n\t\t//this.openPage(this.resultPage, {pass})\r\n\t}\r\n\r\n\tprotected resultPage = ({pass}:{pass: boolean}) => {\r\n\t\tlet {title} = this.controller;\r\n\t\tlet content = pass?\r\n\t\t\t<span className=\"text-success\"><FA name=\"check\" /> 验收通过</span>\r\n\t\t\t:\r\n\t\t\t<span className=\"text-secondary\"><FA name=\"check\" /> 验收不通过</span>\r\n\t\treturn <Page header={title} back=\"close\">\r\n\t\t\t<div className=\"border bg-white rounded m-5\">\r\n\t\t\t\t<div className=\"py-5 text-center\">\r\n\t\t\t\t\t{content}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"border-top text-center py-3\">\r\n\t\t\t\t\t<button className=\"btn btn-outline-info\" onClick={()=>this.closePage()}>返回</button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</Page>;\r\n\t}\r\n}","import React from 'react';\r\nimport { VTaskView } from './VTaskView';\r\n\r\nexport class VRateTask extends VTaskView {\r\n  protected rateValue:number = 5;\r\n\r\n\tprotected get allowCheck() {return false;}\r\n\r\n  \tprotected renderState():JSX.Element {\r\n\t\treturn this.renderStateSpan('待评价');\r\n\t}\r\n\r\n  \tprivate onChange = (evt:React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tthis.rateValue = Number(evt.target.value);\r\n\t};\r\n\r\n\tprotected renderBottomCommands() {\r\n\t\tlet {owner, assigned} = this.controller.noteItem;\r\n\t\tlet left:any, right:any;\r\n\t\tleft = \r\n\t\t<div><button onClick={()=>this.onRate()} className=\"btn btn-success mx-3\">\r\n\t\t评价\r\n\t\t</button>\r\n\t\t</div>;\r\n\r\n\t\tright = this.renderFrom('px-2');\r\n\t\treturn <div>\r\n\t\t\t{this.renderValueRadio()}\r\n\t\t\t<div className=\"py-2 bg-light border-top d-flex\">\r\n\t\t\t\t\t{left}\r\n\t\t\t\t\t<div className=\"mr-auto\" />\r\n\t\t\t\t\t{right}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n  }\r\n\r\n  protected renderValueRadio(): JSX.Element {\r\n\t\tlet radios = [\r\n\t\t\t{val:5, text:'5分'},\r\n\t\t\t{val:4, text:'4分'},\r\n\t\t\t{val:3, text:'3分'},\r\n\t\t\t{val:2, text:'2分'},\r\n\t\t\t{val:1, text:'1分'},\r\n\t\t\t{val:0, text:'0分'},\r\n\t\t];\r\n\r\n\t\treturn <div className=\"my-3\">\r\n\t\t\t{radios.map((v, index) => {\r\n\t\t\t\tlet {val, text} = v;\r\n\t\t\t\treturn <label key={index} className=\"mb-0 mx-3\">\r\n\t\t\t\t\t<input className=\"mr-1\" type=\"radio\" value={val} \r\n\t\t\t\t\t\tdefaultChecked={this.rateValue===val} name={'ratevalue'} onChange={this.onChange} />\r\n\t\t\t\t\t{text}\r\n\t\t\t\t</label>\t\t\t\t\t\r\n\t\t\t})}\r\n\t\t</div>;\r\n\t}\r\n\r\n  \r\n  \tprivate onRate = async () => {\r\n\t\tawait this.controller.RateTask(this.rateValue);\r\n\t\tthis.closePage();\r\n\t\t//this.openPage(this.resultPage)\r\n\t\tlet content = <>评价完成</>;\r\n\t\tthis.showActionEndPage({content});\r\n\t}\r\n\r\n\t/*\r\n\tprotected resultPage = () => {\r\n\t\tlet {title} = this.controller;\r\n\t\treturn <Page header={title} back=\"close\">\r\n\t\t\t\t评分完成！\r\n\t\t</Page>;\r\n\t}\r\n\t*/\r\n}","import React from 'react';\r\nimport { VBasePage } from './VBasePage';\r\n\r\nexport class VSent extends VBasePage {\r\n\tprotected get back(): 'close' | 'back' | 'none' {return 'close'}\r\n\theader() {return '已发送'}\r\n\tcontent() {\r\n\t\treturn <div className=\"m-5 border rounded bg-white\">\r\n\t\t\t<div className=\"p-5 text-center border-bottom\">已发送</div>\r\n\t\t\t<div className=\"text-center py-3\">\r\n\t\t\t\t<button className=\"btn btn-outline-info\" onClick={()=>this.backPage()}>返回</button>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n}\r\n","import { CUqBase, EnumSpecFolder } from \"tapp\";\r\nimport { QueryPager } from \"tonva\";\r\nimport { VList, VSelectContact, SelectContactOptions } from \"./views\";\r\nimport { CTextNoteItem } from \"./text\";\r\nimport { EnumNoteItemType, NoteItem, NoteModel } from \"./model\";\r\nimport { CNoteItem } from \"./item/CNoteItem\";\r\nimport { VTo } from \"./views/VTo\";\r\nimport { CTaskNoteItem } from \"./task/CTaskNoteItem\";\r\nimport { Contact } from \"model\";\r\nimport { observable } from \"mobx\";\r\nimport { VSent } from \"./views/VSent\";\r\n\r\nconst cNoteItems: {[key in EnumNoteItemType]: new (...args: any[])=> CNoteItem} = {\r\n\t[EnumNoteItemType.text]: CTextNoteItem,\r\n\t[EnumNoteItemType.task]: CTaskNoteItem,\r\n};\r\n\r\nexport class CNote extends CUqBase {\r\n\tfolderId: number;\r\n\tnotesPager: QueryPager<CNoteItem>;\r\n\t@observable contacts: Contact[];\r\n\tnoteItem: NoteItem;\r\n\t//noteModel: NoteModel;\r\n\r\n    protected async internalStart() {\r\n\t}\r\n\r\n\tinit(folderId?: number) {\r\n\t\tif (!folderId) this.folderId = -EnumSpecFolder.notes;\r\n\t\telse this.folderId = folderId;\r\n\t\tlet {notes} = this.uqs;\r\n\t\tthis.notesPager = new QueryPager<CNoteItem>(notes.GetNotes, undefined, undefined, true);\r\n\t\tthis.notesPager.setItemConverter(this.noteItemConverter);\r\n\t}\r\n\r\n\tprivate noteItemConverter = (item:NoteItem, queryResults:{[name:string]:any[]}):CNoteItem => {\r\n\t\tlet cNoteItem = this.getCNoteItem(item.type);\r\n\t\titem.obj = cNoteItem.parseContent(item.content);\r\n\t\tcNoteItem.init(item);\r\n\t\treturn cNoteItem;\r\n\t}\r\n\r\n\tprivate getCNoteItem(type: EnumNoteItemType): CNoteItem {\r\n\t\tlet ret = cNoteItems[type];\r\n\t\tif (ret === undefined) {\r\n\t\t\tdebugger;\r\n\t\t\tthrow new Error(`type ${type} CNoteItem not defined`);\r\n\t\t}\r\n\t\treturn this.newSub(ret);\r\n\t}\r\n\r\n\tasync load() {\r\n\t\tawait this.notesPager.first({folderId: this.folderId});\r\n\t}\r\n\r\n\tasync getNote(id: number): Promise<NoteModel> {\r\n\t\tlet ret = await this.uqs.notes.GetNote.query({folder: this.folderId, note: id});\r\n\t\tlet noteModel:NoteModel = ret.ret[0];\r\n\t\tnoteModel.to = ret.to;\r\n\t\tnoteModel.flow = ret.flow;\r\n\t\tnoteModel.spawn = ret.spawn;\r\n\t\tnoteModel.contain = ret.contain;\r\n\t\treturn noteModel;\r\n\t}\r\n\r\n\tasync addNote(caption:string, content:string, obj:any) {\r\n\t\tlet type = EnumNoteItemType.text;\r\n\t\tlet sub = 0;\r\n\t\tlet ret = await this.uqs.notes.AddNote.submit({caption, content, type, sub});\r\n\t\tlet {note} = ret;\r\n\t\t//let {Note} = this.uqs.notes;\r\n\t\tlet date = new Date();\r\n\t\tlet noteItem:NoteItem = {\r\n\t\t\tseconds: undefined,\r\n\t\t\towner: this.user.id,\r\n\t\t\tnote: note as number,\r\n\t\t\ttype: EnumNoteItemType.text,\r\n\t\t\tfrom: undefined,\r\n\t\t\tcaption,\r\n\t\t\tcontent,\r\n\t\t\tassigned: undefined,\r\n\t\t\tstate: undefined,\r\n\t\t\tunread: undefined,\r\n\t\t\tobj,\r\n\t\t\t$create: date,\r\n\t\t\t$update: date,\r\n\t\t}\r\n\t\tlet cNoteItem = this.getCNoteItem(EnumNoteItemType.text);\r\n\t\tcNoteItem.init(noteItem);\r\n\t\tthis.notesPager.items.unshift(cNoteItem);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync setNote(waiting:boolean, noteItem:NoteItem, caption:string, content:string, obj:any) {\r\n\t\tlet {SetNote, Note} = this.uqs.notes;\r\n\t\tlet {note, type} = noteItem;\r\n\t\tawait SetNote.submit({note, caption, content, type}, waiting);\r\n\t\tNote.resetCache(note);\r\n\t\tlet {items} = this.notesPager;\r\n\t\tlet index = items.findIndex(v => v.noteItem.note===note);\r\n\t\tif (index >= 0) {\r\n\t\t\tlet theItems = items.splice(index, 1);\r\n\t\t\tlet theItem = theItems[0];\r\n\t\t\ttheItem.noteItem.caption = caption;\r\n\t\t\ttheItem.noteItem.content = content;\r\n\t\t\ttheItem.noteItem.obj = obj;\r\n\t\t\titems.unshift(theItem);\r\n\t\t}\r\n\t}\r\n\r\n\tasync sendNoteTo(note:number, toList:number[]) {\r\n\t\tlet tos = toList.join('|');\r\n\t\tawait this.uqs.notes.SendNoteTo.submit({note, tos});\r\n\t}\r\n\r\n\tasync hideNote(note:number, x:number) {\r\n\t\tawait this.uqs.notes.HideNote.submit({note, x});\r\n\t\tlet index = this.notesPager.items.findIndex(v => v.noteItem.note === note);\r\n\t\tif (index >= 0) this.notesPager.items.splice(index, 1);\r\n\t}\r\n\r\n\trenderListView() {\r\n\t\treturn this.renderView(VList);\r\n\t}\r\n\r\n\tshowAddNotePage = () => {\r\n\t\tlet cTextNoteItem = this.newSub(CTextNoteItem);\r\n\t\tcTextNoteItem.showAddNotePage();\r\n\t}\r\n\r\n\tshowTo(noteItem:NoteItem) {\r\n\t\tthis.noteItem = noteItem;\r\n\t\tthis.openVPage(VTo);\r\n\t}\r\n\r\n\tshowSentPage() {\r\n\t\tthis.openVPage(VSent);\r\n\t}\r\n\r\n\tasync callSelectContact(options: SelectContactOptions): Promise<Contact[]> {\r\n\t\treturn await this.vCall(VSelectContact, options);\r\n\t}\r\n\r\n\tshowAssignTaskPage() {\r\n\t\tlet cTaskNoteItem = this.newSub(CTaskNoteItem);\r\n\t\tcTaskNoteItem.init(this.noteItem);\r\n\t\tcTaskNoteItem.showAssignTaskPage();\r\n\t}\r\n}\r\n","import React from 'react';\r\nimport { CHome } from './CHome';\r\nimport { VPage, Page, FA } from 'tonva';\r\nimport { notesName } from '../note';\r\n\r\nexport class VHome extends VPage<CHome> {\r\n\trender() {\r\n\t\tlet {cNode} = this.controller;\r\n\t\tlet right = <button onClick={cNode.showAddNotePage} className=\"btn btn-success btn-sm mr-1\">\r\n\t\t\t<FA name=\"plus\" /> {notesName}\r\n\t\t</button>;\r\n\t\treturn <Page header=\"首页\" right={right}>\r\n\t\t\t{cNode.renderListView()}\r\n\t\t</Page>;\r\n\t}\r\n}\r\n","import { CUqBase } from \"tapp\";\r\nimport { CNote } from \"../note\";\r\nimport { VHome } from \"./VHome\";\r\n\r\nexport class CHome extends CUqBase {\r\n\tcNode: CNote;\r\n\r\n  protected async internalStart() {\r\n\t}\r\n\r\n\tinit() {\r\n\t\tthis.cNode = this.newC(CNote);\r\n\t}\r\n\r\n\ttab = () => this.renderView(VHome);\r\n\r\n\tasync load() {\r\n\t\tawait this.cNode.load();\r\n\t}\r\n}\r\n","import React from \"react\";\r\nimport { CRelation } from \"./CRelation\";\r\nimport { VPage, SearchBox, userApi, Image, FA, Muted } from \"tonva\";\r\nimport { observable } from \"mobx\";\r\nimport { observer } from \"mobx-react\";\r\n\r\nexport class VAdd extends VPage<CRelation> {\r\n\t@observable private hasError = false;\r\n\t@observable private user:{id:number, name:string, nick:string, icon:string};\r\n\r\n\theader() {\r\n\t\treturn <div className=\"w-100 mr-1 d-flex\">\r\n\t\t\t<SearchBox className=\"flex-fill\" \r\n\t\t\t\tonSearch={this.onSearch} \r\n\t\t\t\tonFocus={this.onFocus}\r\n\t\t\t\tplaceholder=\"搜索联系人\" />\r\n\t\t\t<button className=\"btn btn-sm btn-outline-info ml-1\" onClick={()=>this.closePage()}>取消</button>\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate onSearch = async (key:string) => {\r\n\t\tthis.user = await userApi.fromKey(key);\r\n\t\tif (!this.user) {\r\n\t\t\tthis.hasError = true;\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate onFocus = () => {\r\n\t\tthis.hasError = false;\r\n\t}\r\n\r\n\tprivate onAddContact = async () => {\r\n\t\tawait this.controller.AddContact(this.user.id);\r\n\t\tthis.closePage();\r\n\t}\r\n\r\n\tcontent() {\r\n\t\tlet c = observer(() => {\r\n\t\t\tif (this.hasError === true) {\r\n\t\t\t\treturn <div className=\"p-4\">\r\n\t\t\t\t\t<FA className=\"text-danger mr-2\" name=\"times-circle\" />\r\n\t\t\t\t\t<Muted>账号不存在或者不接受邀请</Muted>\r\n\t\t\t\t</div>\r\n\t\t\t}\r\n\t\t\tif (!this.user) return;\r\n\r\n\t\t\tlet {name, nick, icon} = this.user;\r\n\t\t\tlet div:any;\r\n\t\t\tif (nick) {\r\n\t\t\t\tdiv =  <div>\r\n\t\t\t\t\t<div><b>{nick}</b></div>\r\n\t\t\t\t\t<div>{name}</div>\r\n\t\t\t\t</div>;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tdiv = <div><b>{name}</b></div>\r\n\t\t\t}\r\n\t\t\treturn <div className=\"my-3 mx-3 border rounded\">\r\n\t\t\t\t<div className=\"p-4 d-flex bg-white rounded-top\">\r\n\t\t\t\t\t<Image className=\"w-3c h-3c mr-3\" src={icon} />\r\n\t\t\t\t\t{div}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"py-3 px-4\">\r\n\t\t\t\t\t<button className=\"btn btn-primary\" onClick={this.onAddContact}>增加</button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>;\r\n\t\t});\r\n\t\treturn React.createElement(c);\r\n\t}\r\n}","import React from 'react';\r\nimport { CRelation } from './CRelation';\r\nimport { VPage, FA, List, UserView, User, Image } from 'tonva';\r\nimport { VAdd } from './VAdd';\r\nimport { Contact } from 'model';\r\n\r\nexport class VRelation extends VPage<CRelation> {\r\n\theader() {return '关系'}\r\n\r\n\tright() {\r\n\t\treturn <button className=\"btn btn-sm btn-primary mr-1\" onClick={()=>this.openVPage(VAdd)}>\r\n\t\t\t<FA name=\"user-plus\" />\r\n\t\t</button>;\r\n\t}\r\n\r\n\tcontent() {\r\n\t\treturn <div className=\"\">\r\n\t\t\t<List items={this.controller.contacts} item={{render: this.renderContact}} />\r\n\t\t</div>\r\n\t}\r\n\r\n\tprivate renderContact = (item:Contact, index:number) => {\r\n\t\tlet {contact, assigned} = item;\r\n\t\tlet renderUser = (user:User) => {\r\n\t\t\tlet {name, nick, icon} = user;\r\n\t\t\treturn <div className=\"px-3 py-2\">\r\n\t\t\t\t<Image className=\"w-2c h-2c mr-3\" src={icon} />\r\n\t\t\t\t{name} {nick} {assigned}\r\n\t\t\t</div>\r\n\t\t}\r\n\t\treturn <UserView user={contact} render={renderUser} />;\r\n\t}\r\n}\r\n","import { CUqBase } from \"tapp\";\r\nimport { VRelation } from \"./VRelation\";\r\nimport { observable } from \"mobx\";\r\nimport { Contact } from \"model\";\r\n\r\nexport class CRelation extends CUqBase {\r\n\tprivate loaded: boolean = false;\r\n\t@observable contacts: Contact[] = [];\r\n\r\n    protected async internalStart() {\r\n\t}\r\n\r\n\ttab = () => this.renderView(VRelation);\r\n\r\n\tload = async () => {\r\n\t\tif (this.loaded === true) return;\r\n\t\tlet ret = await this.uqs.notes.GetMyContacts.page({}, 0, 500, true);\r\n\t\tthis.contacts.push(...ret['$page']);\r\n\t\tthis.loaded = true;\r\n\t}\r\n\r\n\tasync AddContact(contact: number) {\r\n\t\tawait this.uqs.notes.AddContact.submit({contact});\r\n\t\tthis.contacts.unshift({contact, assigned:undefined});\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { observable } from 'mobx';\r\nimport {\r\n    userApi, ItemSchema, StringSchema, ImageSchema, UiTextItem, UiImageItem, nav, Page,\r\n    Edit, UiSchema, VPage\r\n} from 'tonva';\r\nimport { CMe } from './CMe';\r\n\r\nexport class VEditMe extends VPage<CMe>{\r\n\r\n    async open(param: any) {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private schema: ItemSchema[] = [\r\n        { name: 'nick', type: 'string' } as StringSchema,\r\n        { name: 'icon', type: 'image' } as ImageSchema,\r\n    ];\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            nick: { widget: 'text', label: '别名', placeholder: '好的别名更方便记忆' } as UiTextItem,\r\n            icon: { widget: 'image', label: '头像' } as UiImageItem,\r\n        }\r\n    }\r\n    @observable private data: any;\r\n\r\n    constructor(props: any) {\r\n        super(props);\r\n        let { nick, icon } = nav.user;\r\n        this.data = {\r\n            nick: nick,\r\n            icon: icon,\r\n        };\r\n\r\n        let { cApp } = this.controller;\r\n    }\r\n\r\n    private onItemChanged = async (itemSchema: ItemSchema, newValue: any, preValue: any) => {\r\n        let { name } = itemSchema;\r\n        await userApi.userSetProp(name, newValue);\r\n        this.data[name] = newValue;\r\n        nav.user.name = newValue;\r\n        nav.saveLocalUser();\r\n    }\r\n\r\n\r\n    private page = () => {\r\n        let { schema, uiSchema, data, onItemChanged } = this;\r\n        return <Page header=\"个人信息\">\r\n            <Edit schema={schema} uiSchema={uiSchema}\r\n                data={data}\r\n                onItemChanged={onItemChanged} />\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport const webUserSchema: ItemSchema[] = [\r\n    { name: 'firstName', type: 'string', required: true } as StringSchema,\r\n    { name: 'gender', type: 'string' } as StringSchema,\r\n    { name: 'salutation', type: 'string' } as StringSchema,\r\n    { name: 'organizationName', type: 'string', required: true } as StringSchema,\r\n    { name: 'departmentName', type: 'string' } as StringSchema,\r\n];\r\n\r\n","import React from 'react';\r\nimport { CMe } from './CMe';\r\nimport { Image, VPage, nav, IconText, PropGrid, LMR, FA, Prop } from 'tonva';\r\nimport { observer } from 'mobx-react';\r\nimport { VEditMe } from './VEditMe';\r\nimport { appConfig } from 'tapp';\r\n\r\nexport class VMe extends VPage<CMe> {\r\n\theader() {return  '我'}\r\n\r\n\t// logout(): boolean | (()=>Promise<void>) {return true;}\r\n\r\n\tcontent() {\r\n        const { user } = nav;\r\n        let aboutRows: Prop[] = [\r\n            '',\r\n            {\r\n                type: 'component',\r\n                component: <div className=\"w-100 d-flex justify-content-between\">\r\n                    <IconText iconClass=\"text-info mr-2\" icon=\"smile-o\" text=\"关于本APP\" />\r\n                    <div className=\"py-2 small\">V{appConfig.version}</div>\r\n                </div>,\r\n            }\r\n        ];\r\n\r\n        let rows: Prop[];\r\n        if (user === undefined) {\r\n            rows = aboutRows;\r\n            rows.push(\r\n                {\r\n                    type: 'component',\r\n                    component: <button className=\"btn btn-success w-100 my-2\" onClick={() => nav.showLogin(undefined, true)}>\r\n                        <FA name=\"sign-out\" size=\"lg\" /> 请登录\r\n                    </button>\r\n                },\r\n            );\r\n        }\r\n        else {\r\n            let logOutRows: Prop[] = [\r\n                '',\r\n                {\r\n                    type: 'component',\r\n                    bk: '',\r\n                    component: <button className=\"btn btn-danger w-100\" onClick={this.onExit}>\r\n                        <FA name=\"sign-out\" size=\"lg\" /> 退出登录\r\n                </button>\r\n                },\r\n            ];\r\n\r\n            rows = [\r\n                '',\r\n                {\r\n                    type: 'component',\r\n                    component: <this.meInfo />\r\n                },\r\n                '',\r\n                {\r\n                    type: 'component',\r\n                    component: <IconText iconClass=\"text-info mr-2\" icon=\"key\" text=\"修改密码\" />,\r\n                    onClick: this.changePassword\r\n                },\r\n            ]\r\n            rows.push(...aboutRows, ...logOutRows);\r\n        }\r\n        return <PropGrid rows={[...rows]} values={{}} />;\r\n\t}\r\n\r\n\tprivate onExit = () => {\r\n        nav.showLogout();\r\n    }\r\n\r\n    private changePassword = async () => {\r\n        await nav.changePassword();\r\n    }\r\n\r\n    private meInfo = observer(() => {\r\n        let { user } = nav;\r\n        if (user === undefined) return null;\r\n        let { id, name, nick, icon } = user;\r\n        return <LMR className=\"py-2 cursor-pointer w-100\"\r\n            left={<Image className=\"w-3c h-3c mr-3\" src={icon} />}\r\n            right={<FA className=\"align-self-end\" name=\"angle-right\" />}\r\n            onClick={() => {\r\n                this.openVPage(VEditMe);\r\n            }}>\r\n            <div>\r\n                <div>{userSpan(name, nick)}</div>\r\n                <div className=\"small\"><span className=\"text-muted\">ID:</span> {id > 10000 ? id : String(id + 10000).substr(1)}</div>\r\n            </div>\r\n        </LMR>;\r\n    });\r\n}\r\n\r\nfunction userSpan(name: string, nick: string): JSX.Element {\r\n    return nick ?\r\n        <><b>{nick} &nbsp; <small className=\"muted\">{name}</small></b></>\r\n        : <b>{name}</b>\r\n}\r\n","import { CUqBase } from \"tapp\";\r\nimport { VMe } from \"./VMe\";\r\n\r\nexport class CMe extends CUqBase {\r\n    protected async internalStart() {\r\n\t}\r\n\r\n\ttab = () => this.renderView(VMe);\r\n\r\n}\r\n","import { Tuid, Query, Action/*, Map, Sheet, Tag*/ } from \"tonva\";\r\n\r\nexport enum EnumSpecFolder {notes=1};\r\n\r\nexport interface Notes {\r\n\tNote: Tuid;\r\n\r\n\tAddNote: Action;\r\n\tSetNote: Action;\r\n\tSendNoteTo: Action;\r\n\tHideNote: Action;\r\n\tAddContact: Action;\r\n\tAssignTask: Action;\r\n\r\n\tDoneTask: Action;\r\n\tCheckTask: Action;\r\n\tRateTask: Action;\r\n\r\n\t$Poked: Query;\r\n\tGetNotes: Query;\r\n\tGetMyContacts: Query;\r\n\tGetNote: Query;\r\n};\r\n\r\nexport interface UQs {\r\n    notes: Notes\r\n}\r\n","import React from 'react';\r\nimport { CDiscover } from './CDiscover';\r\nimport { VPage, LMR, FA } from 'tonva';\r\n\r\ninterface Item {\r\n\ticon: string;\r\n\tcaption: string;\r\n\tonClick: () => void;\r\n}\r\n\r\nexport class VDiscover extends VPage<CDiscover> {\r\n\tprivate onTaskReport = () => {\r\n\t\talert('实现中');\r\n\t}\r\n\r\n\tprivate onOtherReport = () => {\r\n\t\talert('实现中');\r\n\t}\r\n\r\n\tprivate items:(Item|string)[] = [\r\n\t\t{icon: undefined, caption: '任务报表', onClick: this.onTaskReport}, \r\n\t\t{icon: undefined, caption: '其它报表', onClick: this.onOtherReport}, \r\n\t\t'-',\r\n\t\t{icon: undefined, caption: '任务报表', onClick: this.onTaskReport}, \r\n\t\t{icon: undefined, caption: '其它报表', onClick: this.onOtherReport}, \r\n\t];\r\n\r\n\theader() {return '发现'}\r\n\tcontent() {\r\n\t\tlet cn = 'px-3 py-2 cursor-pointer bg-white mb-1';\r\n\t\tlet right = <FA name=\"angle-right\" />;\r\n\t\treturn <div className=\"py-3\">\r\n\t\t\t{this.items.map((v, index) => {\r\n\t\t\t\tif (typeof v === 'string') {\r\n\t\t\t\t\treturn <div className=\"pt-2\" />;\r\n\t\t\t\t}\r\n\t\t\t\tlet {icon, caption, onClick} = v;\r\n\t\t\t\tlet left = <FA name={icon} />;\r\n\t\t\t\treturn <LMR key={index} className={cn} onClick={onClick} left={left} right={right}>\r\n\t\t\t\t\t{caption}\r\n\t\t\t\t</LMR>\r\n\t\t\t})}\r\n\t\t</div>;\r\n\t}\r\n}\r\n","import { CUqBase } from \"tapp\";\r\nimport { VDiscover } from \"./VDiscover\";\r\n\r\nexport class CDiscover extends CUqBase {\r\n    protected async internalStart() {\r\n\t}\r\n\r\n\ttab = () => this.renderView(VDiscover);\r\n\r\n}\r\n","import { CUqApp } from \"./CBase\";\r\nimport { VMain } from \"./main\";\r\nimport { CHome } from \"home\";\r\nimport { CRelation } from \"relation\";\r\nimport { CMe } from \"me\";\r\nimport { CDiscover } from \"discover\";\r\nimport { computed } from \"mobx\";\r\nimport { Contact } from \"model\";\r\n\r\nconst gaps = [10, 3,3,3,3,3,5,5,5,5,5,5,5,5,10,10,10,10,15,15,15,30,30,60];\r\n\r\nexport class CApp extends CUqApp {\r\n\tcHome: CHome;\r\n\tcRelation: CRelation;\r\n\tcDiscover: CDiscover;\r\n\tcMe: CMe;\r\n\r\n\tprotected async internalStart() {\r\n\t\tthis.cHome = this.newC(CHome);\r\n\t\tthis.cRelation = this.newC(CRelation);\r\n\t\tthis.cDiscover = this.newC(CDiscover);\r\n\t\tthis.cMe = this.newC(CMe);\t\t\r\n\t\tthis.cHome.load();\r\n\t\tthis.showMain();\r\n\r\n\t\tsetInterval(this.callTick, 1000);\r\n\t}\r\n\r\n\t@computed get contacts(): Contact[] {return this.cRelation.contacts;};\r\n\r\n\tasync loadRelation() {\r\n\t\tawait this.cRelation.load();\r\n\t}\r\n\r\n    private showMain(initTabName?: string) {\r\n        this.openVPage(VMain, initTabName);\r\n\t}\r\n\r\n\tprivate tick = 0;\r\n\tprivate gapIndex = 0;\r\n\tprivate callTick = async () => {\r\n\t\ttry {\r\n\t\t\tif (!this.user) return;\r\n\t\t\t++this.tick;\r\n\t\t\tif (this.tick<gaps[this.gapIndex]) return;\r\n\t\t\tconsole.error('tick ', new Date());\r\n\t\t\tthis.tick = 0;\r\n\t\t\tif (this.gapIndex < gaps.length - 1) ++this.gapIndex;\r\n\t\t\tlet ret = await this.uqs.notes.$Poked.query(undefined, false);\r\n\t\t\tlet v = ret.ret[0];\r\n\t\t\tif (v === undefined) return;\r\n\t\t\tif (!v.poke) return;\r\n\t\t\tthis.gapIndex = 1;\r\n\r\n\t\t\t// uq 里面加入这一句，会让相应的$Poked查询返回poke=1：\r\n\t\t\t// TUID [$User] ID (member) SET poke=1;\r\n\t\t\t// 这个地方重新调入的数据\r\n\t\t\t// this.cGroup.refresh();\r\n\t\t}\r\n\t\tcatch {\r\n\t\t}\r\n\t}\r\n}\r\n","import React from 'react';\r\nimport { CUqApp } from \"./CBase\";\r\nimport { navigo } from 'tonva/components/navigo';\r\n\r\nexport class CAppAB extends CUqApp {\r\n\tprotected async internalStart() {\r\n\t\tthis.openPage(<div>\r\n\t\t\t/a/b \r\n\t\t\t<button onClick={this.onClick}>test</button>\r\n\t\t</div>)\r\n\t}\r\n\r\n\tprivate onClick = () => {\r\n\t\t//window.history.pushState({}, 'aaaa', '/bbbb/cccc');\r\n\t\tnavigo.navigate('/bbbb/cccc');\r\n\t}\r\n}\r\n\r\nexport class CAppCD extends CUqApp {\r\n\tprotected async internalStart() {\r\n\t\tthis.openPage(<div>/c/d</div>)\r\n\t}\r\n}\r\n\r\nexport class CAppBBBBCCCC extends CUqApp {\r\n\tprotected async internalStart() {\r\n\t\tthis.openPage(<div>/bbbb/cccc</div>)\r\n\t}\r\n}\r\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport 'bootstrap/dist/css/bootstrap.css';\nimport './index.css';\n//import App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nimport { NavView, start, startRoute, nav, CAppBase } from 'tonva';\n//import logo from './logo.svg';\nimport './App.css';\nimport { CApp, appConfig } from './tapp';\nimport { CAppAB, CAppCD, CAppBBBBCCCC } from 'tapp/CAppAB';\n\nlet {location} = document;\nif (location.host) {\n\t(async function() {\n\t\tfunction renderDom(div:any) {\n\t\t\tReactDOM.render(\n\t\t\t\t<React.StrictMode>\n\t\t\t\t\t{div}\n\t\t\t\t</React.StrictMode>,\n\t\t\t\tdocument.getElementById('root')\n\t\t\t);\n\t\t}\n\n\t\tfunction renderCApp(cApp: CAppBase) {\n\t\t\tconst App: React.FC = () => {\n\t\t\t\tconst onLogined = async () => {\n\t\t\t\t\tawait cApp.start();\n\t\t\t\t}\n\t\t\t\treturn <NavView onLogined={onLogined} />;\n\t\t\t}\n\t\t\trenderDom(<App/>);\n\t\t}\n\n\t\tnav.on({\n\t\t\t'/a/b': () => {\n\t\t\t\trenderDom(<div>/a/b <button onClick={()=>nav.navigate('/c/d')}>test</button></div>)\n\t\t\t},\n\t\t\t'/c/d': () => {\n\t\t\t\trenderDom(<div>\n\t\t\t\t\t/c/d\n\t\t\t\t\t<button onClick={()=>nav.navigate('/eeee/a/1?c=1 & d=3')}>test</button>\n\t\t\t\t</div>)\n\t\t\t},\n\t\t\t'/eeee/:action/:id': (params:any, queryStr:any) => {\n\t\t\t\tlet span:any;\n\t\t\t\tif (queryStr) {\n\t\t\t\t\tspan = <span>{queryStr}</span>\n\t\t\t\t}\n\t\t\t\trenderDom(<div>/e query:{span}  params:{JSON.stringify(params)}</div>)\n\t\t\t},\n\t\t\t'/bbbb/cccc': () => {\n\t\t\t\trenderCApp(new CAppBBBBCCCC());\n\t\t\t},\n\t\t});\n\t\tnav.on(() => {\n\t\t\trenderCApp(new CApp());\n\t\t});\n\t\tawait startRoute(appConfig);\n\n\t\t// If you want your app to work offline and load faster, you can change\n\t\t// unregister() to register() below. Note this comes with some pitfalls.\n\t\t// Learn more about service workers: https://bit.ly/CRA-PWA\n\t\tserviceWorker.unregister();\n\t})();\n}\nelse {\n\t(async function() {\n\t\tnav.setSettings(appConfig);\n\t\tconst App: React.FC = () => {\n\t\t\tconst onLogined = async () => {\n\t\t\t\tawait start(CApp, appConfig);\n\t\t\t}\n\t\t\treturn <NavView onLogined={onLogined} />;\n\t\t}\n\n\t\tReactDOM.render(\n\t\t<React.StrictMode>\n\t\t\t<App />\n\t\t</React.StrictMode>,\n\t\tdocument.getElementById('root')\n\t\t);\n\n\t\t// If you want your app to work offline and load faster, you can change\n\t\t// unregister() to register() below. Note this comes with some pitfalls.\n\t\t// Learn more about service workers: https://bit.ly/CRA-PWA\n\t\tserviceWorker.unregister();\n\t})();\n}"],"sourceRoot":""}